{
  MockUserSession.set().setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN);
  RuleKey rule1=RuleKey.of("javascript","S001");
  dao.insert(newRuleDto(rule1).setTags(Sets.newHashSet("security")).setSystemTags(Collections.<String>emptySet()),dbSession);
  RuleKey rule2=RuleKey.of("java","S001");
  dao.insert(newRuleDto(rule2).setTags(Sets.newHashSet("toberemoved")).setSystemTags(Sets.newHashSet("bug")),dbSession);
  dbSession.commit();
  service.setTags(rule2,Sets.newHashSet("bug","security"));
  service.refresh();
  Set<String> tags=service.listTags();
  assertThat(tags).containsOnly("security","bug");
}
