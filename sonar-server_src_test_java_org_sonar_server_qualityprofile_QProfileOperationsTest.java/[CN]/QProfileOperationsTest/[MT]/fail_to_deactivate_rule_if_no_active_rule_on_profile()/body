{
  QualityProfileDto qualityProfile=new QualityProfileDto().setId(1).setName("My profile").setLanguage("java");
  Rule rule=Rule.create().setRepositoryKey("squid").setKey("AvoidCycle");
  rule.setId(10);
  when(activeRuleDao.selectByProfileAndRule(1,10)).thenReturn(null);
  try {
    operations.deactivateRule(qualityProfile,rule,MockUserSession.create().setName("nicolas").setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN));
    fail();
  }
 catch (  Exception e) {
    assertThat(e).isInstanceOf(BadRequestException.class);
  }
  verify(activeRuleDao,never()).update(any(ActiveRuleDto.class),eq(session));
  verify(session,never()).commit();
  verifyZeroInteractions(profilesManager);
}
