{
  ActiveRuleDto activeRule=new ActiveRuleDto().setId(5).setProfileId(1).setRuleId(10L).setSeverity(1);
  RuleParamDto ruleParam=new RuleParamDto().setRuleId(10L).setName("max").setDefaultValue("20");
  when(ruleDao.selectParamByRuleAndKey(10L,"max",session)).thenReturn(ruleParam);
  operations.createActiveRuleParam(activeRule,"max","30",MockUserSession.create().setName("nicolas").setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN));
  ArgumentCaptor<ActiveRuleParamDto> argumentCaptor=ArgumentCaptor.forClass(ActiveRuleParamDto.class);
  verify(activeRuleDao).insert(argumentCaptor.capture(),eq(session));
  assertThat(argumentCaptor.getValue().getKey()).isEqualTo("max");
  assertThat(argumentCaptor.getValue().getValue()).isEqualTo("30");
  assertThat(argumentCaptor.getValue().getActiveRuleId()).isEqualTo(5);
  verify(profilesManager).ruleParamChanged(eq(1),eq(5),eq("max"),eq((String)null),eq("30"),eq("nicolas"));
}
