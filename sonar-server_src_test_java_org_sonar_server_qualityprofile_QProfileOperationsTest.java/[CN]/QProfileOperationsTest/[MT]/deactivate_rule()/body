{
  ActiveRuleDto activeRule=new ActiveRuleDto().setId(5).setProfileId(1).setRuleId(10).setSeverity(1);
  when(activeRuleDao.selectByProfileAndRule(1,10)).thenReturn(activeRule);
  when(profileRules.getFromRuleId(anyInt())).thenReturn(mock(QProfileRule.class));
  when(profilesManager.deactivated(eq(1),anyInt(),eq("Nicolas"))).thenReturn(new RuleInheritanceActions());
  operations.deactivateRule(activeRule,authorizedUserSession);
  verify(activeRuleDao).delete(eq(5),eq(session));
  verify(activeRuleDao).deleteParameters(eq(5),eq(session));
  verify(session).commit();
  verify(profilesManager).deactivated(eq(1),anyInt(),eq("Nicolas"));
  verify(ruleRegistry).bulkIndexActiveRules(anyList(),isA(Multimap.class));
}
