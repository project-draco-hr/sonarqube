{
  when(qualityProfileDao.selectById(1,session)).thenReturn(new QualityProfileDto().setId(1).setName("Child").setLanguage("java").setParent(null));
  when(qualityProfileDao.selectById(2,session)).thenReturn(new QualityProfileDto().setId(2).setName("Parent").setLanguage("java"));
  when(profilesManager.profileParentChanged(anyInt(),anyString(),anyString())).thenReturn(new ProfilesManager.RuleInheritanceActions());
  operations.updateParentProfile(1,2,authorizedUserSession);
  ArgumentCaptor<QualityProfileDto> profileArgument=ArgumentCaptor.forClass(QualityProfileDto.class);
  verify(qualityProfileDao).update(profileArgument.capture(),eq(session));
  assertThat(profileArgument.getValue().getParent()).isEqualTo("Parent");
  assertThat(profileArgument.getValue().getLanguage()).isEqualTo("java");
  verify(session).commit();
  verify(profilesManager).profileParentChanged(1,"Parent","Nicolas");
  verify(ruleRegistry).deleteActiveRules(anyListOf(Integer.class));
  verify(ruleRegistry).bulkIndexActiveRules(anyListOf(Integer.class),eq(session));
}
