{
  Date createdAt=DateUtils.parseDate("2013-12-20");
  ActiveRuleDto activeRule=new ActiveRuleDto().setId(5).setProfileId(1).setRuleId(10).setSeverity(1).setNoteCreatedAt(createdAt).setNoteData("My previous note").setNoteUserLogin("nicolas");
  long now=System.currentTimeMillis();
  doReturn(now).when(system).now();
  operations.updateActiveRuleNote(activeRule,"My new note",MockUserSession.create().setLogin("guy").setName("Guy").setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN));
  ArgumentCaptor<ActiveRuleDto> argumentCaptor=ArgumentCaptor.forClass(ActiveRuleDto.class);
  verify(activeRuleDao).update(argumentCaptor.capture());
  assertThat(argumentCaptor.getValue().getNoteData()).isEqualTo("My new note");
  assertThat(argumentCaptor.getValue().getNoteUserLogin()).isEqualTo("nicolas");
  assertThat(argumentCaptor.getValue().getNoteCreatedAt()).isEqualTo(createdAt);
  assertThat(argumentCaptor.getValue().getNoteUpdatedAt().getTime()).isEqualTo(now);
}
