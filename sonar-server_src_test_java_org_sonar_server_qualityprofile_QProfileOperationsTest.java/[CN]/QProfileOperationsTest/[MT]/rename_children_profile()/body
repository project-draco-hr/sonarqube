{
  QualityProfileDto profile=new QualityProfileDto().setId(1).setName("Old Default").setLanguage("java");
  when(qualityProfileDao.selectById(1,session)).thenReturn(profile);
  when(profileLookup.children(any(QProfile.class),eq(session))).thenReturn(newArrayList(new QProfile().setId(2).setName("Child1").setLanguage("java").setParent("Old Default")));
  operations.renameProfile(1,"Default profile",authorizedUserSession);
  ArgumentCaptor<QualityProfileDto> profileArgument=ArgumentCaptor.forClass(QualityProfileDto.class);
  verify(qualityProfileDao,times(2)).update(profileArgument.capture(),eq(session));
  assertThat(profileArgument.getAllValues()).hasSize(2);
  QualityProfileDto child=profileArgument.getAllValues().get(1);
  assertThat(child.getId()).isEqualTo(2);
  assertThat(child.getParent()).isEqualTo("Default profile");
  verify(session).commit();
}
