{
  Measure utLineHits=new Measure<>(CoreMetrics.COVERAGE_LINE_HITS_DATA).setData("2=1;3=1;5=0;6=3");
  when(measureCache.byMetric("foo:src/Foo.php",CoreMetrics.COVERAGE_LINE_HITS_DATA_KEY)).thenReturn(Arrays.asList(utLineHits));
  Measure conditionsByLine=new Measure<>(CoreMetrics.CONDITIONS_BY_LINE).setData("3=4");
  when(measureCache.byMetric("foo:src/Foo.php",CoreMetrics.CONDITIONS_BY_LINE_KEY)).thenReturn(Arrays.asList(conditionsByLine));
  Measure coveredConditionsByUts=new Measure<>(CoreMetrics.COVERED_CONDITIONS_BY_LINE).setData("3=2");
  when(measureCache.byMetric("foo:src/Foo.php",CoreMetrics.COVERED_CONDITIONS_BY_LINE_KEY)).thenReturn(Arrays.asList(coveredConditionsByUts));
  Measure itLineHits=new Measure<>(CoreMetrics.IT_COVERAGE_LINE_HITS_DATA).setData("2=0;3=0;5=1");
  when(measureCache.byMetric("foo:src/Foo.php",CoreMetrics.IT_COVERAGE_LINE_HITS_DATA_KEY)).thenReturn(Arrays.asList(itLineHits));
  Measure coveredConditionsByIts=new Measure<>(CoreMetrics.IT_COVERED_CONDITIONS_BY_LINE).setData("3=1");
  when(measureCache.byMetric("foo:src/Foo.php",CoreMetrics.IT_COVERED_CONDITIONS_BY_LINE_KEY)).thenReturn(Arrays.asList(coveredConditionsByIts));
  Measure overallCoveredConditions=new Measure<>(CoreMetrics.OVERALL_COVERED_CONDITIONS_BY_LINE).setData("3=2");
  when(measureCache.byMetric("foo:src/Foo.php",CoreMetrics.OVERALL_COVERED_CONDITIONS_BY_LINE_KEY)).thenReturn(Arrays.asList(overallCoveredConditions));
  File outputDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(outputDir);
  publisher.publish(writer);
  try (CloseableIterator<Coverage> it=new BatchReportReader(outputDir).readComponentCoverage(2)){
    assertThat(it.next()).isEqualTo(Coverage.newBuilder().setLine(2).setUtHits(true).setItHits(false).build());
    assertThat(it.next()).isEqualTo(Coverage.newBuilder().setLine(3).setUtHits(true).setItHits(false).setConditions(4).setUtCoveredConditions(2).setItCoveredConditions(1).setOverallCoveredConditions(2).build());
    assertThat(it.next()).isEqualTo(Coverage.newBuilder().setLine(5).setUtHits(false).setItHits(true).build());
  }
 }
