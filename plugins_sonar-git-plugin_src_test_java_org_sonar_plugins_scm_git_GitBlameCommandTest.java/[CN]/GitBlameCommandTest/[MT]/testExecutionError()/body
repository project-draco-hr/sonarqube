{
  File source=new File(baseDir,"src/foo.xoo");
  FileUtils.write(source,"sample content");
  DefaultInputFile inputFile=new DefaultInputFile("foo","src/foo.xoo").setAbsolutePath(new File(baseDir,"src/foo.xoo").getAbsolutePath());
  fs.add(inputFile);
  BlameResult result=mock(BlameResult.class);
  CommandExecutor commandExecutor=mock(CommandExecutor.class);
  when(commandExecutor.execute(any(Command.class),any(StreamConsumer.class),any(StreamConsumer.class),anyLong())).thenAnswer(new Answer<Integer>(){
    @Override public Integer answer(    InvocationOnMock invocation) throws Throwable {
      StreamConsumer errConsumer=(StreamConsumer)invocation.getArguments()[2];
      errConsumer.consumeLine("My error");
      return 1;
    }
  }
);
  thrown.expect(IllegalStateException.class);
  thrown.expectMessage("The git blame command [git blame --porcelain src/foo.xoo -w] failed: My error");
  new GitBlameCommand(commandExecutor).blame(fs,Arrays.<InputFile>asList(inputFile),result);
}
