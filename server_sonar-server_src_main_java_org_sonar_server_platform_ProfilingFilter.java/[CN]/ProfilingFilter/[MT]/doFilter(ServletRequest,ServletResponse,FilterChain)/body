{
  if (request instanceof HttpServletRequest) {
    HttpServletRequest httpRequest=(HttpServletRequest)request;
    String requestUri=httpRequest.getRequestURI();
    String rootDir=getRootDir(requestUri);
    if (staticResourceDirs.contains(rootDir)) {
      chain.doFilter(request,response);
    }
 else {
      Profiler profiler=Profiler.createIfDebug(Logger).start();
      try {
        chain.doFilter(request,response);
      }
  finally {
        if (profiler.isDebugEnabled()) {
          String queryString=httpRequest.getQueryString();
          String message=String.format(queryString == null ? MESSAGE_WITHOUT_QUERY : MESSAGE_WITH_QUERY,httpRequest.getMethod(),requestUri,queryString);
          profiler.stopDebug(message);
        }
      }
    }
  }
 else {
    chain.doFilter(request,response);
  }
}
