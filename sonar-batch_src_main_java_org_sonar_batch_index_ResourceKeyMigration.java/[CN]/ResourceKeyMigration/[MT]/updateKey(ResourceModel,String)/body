{
  List<ResourceModel> duplicateDisabledResources=session.createQuery(new StringBuilder().append("from ").append(ResourceModel.class.getSimpleName()).append(" where enabled = false ").append(" and kee = :kee ").append(" and qualifier = :qualifier ").toString()).setParameter("kee",newEffectiveKey).setParameter("qualifier",resourceModel.getQualifier()).getResultList();
  if (duplicateDisabledResources.size() > 0) {
    ResourceModel duplicateDisabledResource=duplicateDisabledResources.get(0);
    String disabledKey=newEffectiveKey + "_renamed_by_resource_key_migration";
    duplicateDisabledResource.setKey(disabledKey);
    logger.info(COMPONENT_CHANGED_TO,newEffectiveKey,disabledKey);
  }
  resourceModel.setKey(newEffectiveKey);
}
