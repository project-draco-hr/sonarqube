{
  XContentBuilder document=jsonBuilder().startObject();
  indexField(RuleField.KEY.key(),rule.getRuleKey(),document);
  indexField(RuleField.REPOSITORY.key(),rule.getRepositoryKey(),document);
  indexField(RuleField.NAME.key(),rule.getName(),document);
  indexField(RuleField.CREATED_AT.key(),rule.getCreatedAt(),document);
  indexField(RuleField.UPDATED_AT.key(),rule.getUpdatedAt(),document);
  indexField(RuleField.DESCRIPTION.key(),rule.getDescription(),document);
  indexField(RuleField.SEVERITY.key(),rule.getSeverityString(),document);
  indexField(RuleField.STATUS.key(),rule.getStatus(),document);
  indexField(RuleField.LANGUAGE.key(),rule.getLanguage(),document);
  indexField(RuleField.INTERNAL_KEY.key(),rule.getConfigKey(),document);
  indexField(RuleField.TEMPLATE.key(),rule.getCardinality() == Cardinality.MULTIPLE,document);
  List<RuleRuleTagDto> tags=ruleDao.selectTagsByRuleId(rule.getId());
  if (!tags.isEmpty()) {
    XContentBuilder sysTags=document.startArray(RuleField.SYSTEM_TAGS.key());
    XContentBuilder adminTags=document.startArray(RuleField.TAGS.key());
    for (    RuleRuleTagDto tag : tags) {
switch (tag.getType()) {
case SYSTEM:
        sysTags.startObject(tag.getTag()).endObject();
      break;
case ADMIN:
    adminTags.startObject(tag.getTag()).endObject();
  break;
}
}
sysTags.endArray();
adminTags.endArray();
}
List<RuleParamDto> params=ruleDao.selectParametersByRuleId(rule.getId());
if (!params.isEmpty()) {
document.startArray(RuleField.PARAMS.key());
for (RuleParamDto param : params) {
document.startObject();
indexField(RuleParamField.NAME.key(),param.getName(),document);
indexField(RuleParamField.TYPE.key(),param.getType(),document);
indexField(RuleParamField.DESCRIPTION.key(),param.getDescription(),document);
indexField(RuleParamField.DEFAULT_VALUE.key(),param.getDefaultValue(),document);
document.endObject();
}
document.endArray();
}
List<ActiveRuleDto> activeRules=activeRuleDao.selectByRuleId(rule.getId());
if (!activeRules.isEmpty()) {
document.startArray(RuleField.ACTIVE.key());
for (ActiveRuleDto activeRule : activeRules) {
document.startObject();
indexField(ActiveRuleField.OVERRIDE.key(),activeRule.doesOverride(),document);
indexField(ActiveRuleField.INHERITANCE.key(),activeRule.getInheritance(),document);
indexField(ActiveRuleField.NOTE_CREATED.key(),activeRule.getNoteCreatedAt(),document);
indexField(ActiveRuleField.NOTE_UPDATED.key(),activeRule.getNoteUpdatedAt(),document);
indexField(ActiveRuleField.NOTE_DATA.key(),activeRule.getNoteData(),document);
indexField(ActiveRuleField.NOTE_USER.key(),activeRule.getNoteUserLogin(),document);
indexField(ActiveRuleField.PROFILE_ID.key(),activeRule.getProfileId(),document);
indexField(ActiveRuleField.SEVERITY.key(),activeRule.getSeverityString(),document);
indexField(ActiveRuleField.PARENT_ID.key(),activeRule.getParentId(),document);
document.endObject();
}
document.endArray();
}
return document.endObject();
}
