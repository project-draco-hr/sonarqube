{
  try {
    XContentBuilder document=jsonBuilder().startObject();
    indexField(RuleField.KEY.key(),rule.getRuleKey(),document);
    indexField(RuleField.REPOSITORY.key(),rule.getRepositoryKey(),document);
    indexField(RuleField.NAME.key(),rule.getName(),document);
    indexField(RuleField.CREATED_AT.key(),rule.getCreatedAt(),document);
    indexField(RuleField.UPDATED_AT.key(),rule.getUpdatedAt(),document);
    indexField(RuleField.HTML_DESCRIPTION.key(),rule.getDescription(),document);
    indexField(RuleField.SEVERITY.key(),rule.getSeverityString(),document);
    indexField(RuleField.STATUS.key(),rule.getStatus(),document);
    indexField(RuleField.LANGUAGE.key(),rule.getLanguage(),document);
    indexField(RuleField.INTERNAL_KEY.key(),rule.getConfigKey(),document);
    indexField(RuleField.TEMPLATE.key(),rule.getCardinality() == Cardinality.MULTIPLE,document);
    document.startArray(RuleField.TAGS.key()).endArray();
    document.startArray(RuleField.SYSTEM_TAGS.key()).endArray();
    document.startObject(RuleField.PARAMS.key()).endObject();
    document.startObject(RuleField.ACTIVE.key()).endObject();
    document.endObject();
    UpdateRequest request=new UpdateRequest().doc(document);
    request.docAsUpsert(true);
    return request;
  }
 catch (  Exception e) {
    throw new IllegalStateException(String.format("Could not normalize RuleDto with key %s",rule.getKey().toString()),e);
  }
}
