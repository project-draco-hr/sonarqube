{
  ValidationMessages messages=ValidationMessages.create();
  ProfileImporter importer=getProfileImporter(importerKey);
  RulesProfile profile=importer.importProfile(new StringReader(profileDefinition),messages);
  if (!messages.hasErrors()) {
    DatabaseSession session=sessionFactory.getSession();
    RulesProfile persistedProfile=session.getSingleResult(RulesProfile.class,"name",profileName,"language",language);
    for (    ActiveRule activeRule : profile.getActiveRules()) {
      ActiveRule persistedActiveRule=persistedProfile.activateRule(activeRule.getRule(),activeRule.getSeverity());
      for (      ActiveRuleParam activeRuleParam : activeRule.getActiveRuleParams()) {
        persistedActiveRule.setParameter(activeRuleParam.getKey(),activeRuleParam.getValue());
      }
    }
    session.saveWithoutFlush(persistedProfile);
    session.commit();
  }
  return messages;
}
