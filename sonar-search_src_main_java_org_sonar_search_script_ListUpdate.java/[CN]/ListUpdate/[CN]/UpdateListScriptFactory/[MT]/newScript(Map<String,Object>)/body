{
  String idField=XContentMapValues.nodeStringValue(params.get(ID_FIELD),null);
  String idValue=XContentMapValues.nodeStringValue(params.get(ID_VALUE),null);
  String field=XContentMapValues.nodeStringValue(params.get(FIELD),null);
  Map value=null;
  if (idField == null) {
    throw new IllegalStateException("Missing '" + ID_FIELD + "' parameter");
  }
  if (idValue == null) {
    throw new IllegalStateException("Missing '" + ID_VALUE + "' parameter");
  }
  if (field == null) {
    throw new IllegalStateException("Missing '" + FIELD + "' parameter");
  }
  if (params.containsKey(VALUE)) {
    Object obj=params.get(VALUE);
    if (obj != null) {
      value=XContentMapValues.nodeMapValue(params.get(VALUE),"Update item");
    }
  }
  return new ListUpdate(idField,idValue,field,value);
}
