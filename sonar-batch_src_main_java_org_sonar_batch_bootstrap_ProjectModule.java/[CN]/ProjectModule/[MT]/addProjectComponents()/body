{
  ProjectDefinition projectDefinition=getComponentByType(ProjectTree.class).getProjectDefinition(project);
  addCoreSingleton(projectDefinition);
  addCoreSingleton(project);
  addCoreSingleton(project.getConfiguration());
  addCoreSingleton(ProjectSettings.class);
  addCoreSingleton(IocContainer.class);
  for (  Object component : projectDefinition.getContainerExtensions()) {
    addCoreSingleton(component);
  }
  addCoreSingleton(DefaultProjectClasspath.class);
  addCoreSingleton(DefaultProjectFileSystem2.class);
  addCoreSingleton(DaoFacade.class);
  addCoreSingleton(RulesDao.class);
  if (!dryRun) {
    addCoreSingleton(getComponentByType(DefaultResourcePersister.class).getSnapshot(project));
  }
  addCoreSingleton(TimeMachineConfiguration.class);
  addCoreSingleton(org.sonar.api.database.daos.MeasuresDao.class);
  addCoreSingleton(ProfilesDao.class);
  addCoreSingleton(DefaultRulesManager.class);
  addCoreSingleton(DefaultSensorContext.class);
  addCoreSingleton(Languages.class);
  addCoreSingleton(BatchExtensionDictionnary.class);
  addCoreSingleton(DefaultTimeMachine.class);
  addCoreSingleton(ViolationFilters.class);
  addCoreSingleton(ResourceFilters.class);
  addCoreSingleton(DefaultModelFinder.class);
  addCoreSingleton(DefaultProfileLoader.class);
  addAdapter(new ProfileProvider());
}
