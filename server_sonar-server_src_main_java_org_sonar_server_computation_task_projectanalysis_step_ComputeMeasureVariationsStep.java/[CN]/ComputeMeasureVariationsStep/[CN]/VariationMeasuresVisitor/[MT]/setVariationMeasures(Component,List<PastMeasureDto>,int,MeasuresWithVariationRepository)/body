{
  Map<MeasureKey,PastMeasureDto> pastMeasuresByMeasureKey=from(pastMeasures).uniqueIndex(pastMeasureToMeasureKey);
  for (  Metric metric : metrics) {
    Optional<Measure> measure=measureRepository.getRawMeasure(component,metric);
    if (measure.isPresent() && !measure.get().hasVariations()) {
      PastMeasureDto pastMeasure=pastMeasuresByMeasureKey.get(new MeasureKey(metric.getKey(),null));
      double pastValue=(pastMeasure != null && pastMeasure.hasValue()) ? pastMeasure.getValue() : 0d;
      measuresWithVariationRepository.add(metric,measure.get(),period,computeVariation(measure.get(),pastValue));
    }
  }
}
