{
  String detectedLanguage=null;
  for (  String languageKey : languagesToConsider) {
    PathPattern[] patterns=patternsByLanguage.get(languageKey);
    if (patterns != null) {
      for (      PathPattern pathPattern : patterns) {
        if (pathPattern.match(inputFile,false)) {
          if (detectedLanguage == null) {
            detectedLanguage=languageKey;
            break;
          }
 else {
            throw MessageException.of("Language of file '" + inputFile.relativePath() + "' can not be decided as the file matches patterns of both "+ getDetails(detectedLanguage)+ " and "+ getDetails(languageKey));
          }
        }
      }
    }
  }
  if (detectedLanguage != null) {
    LOG.debug("Language of file '" + inputFile.relativePath() + "' was detected to be '"+ detectedLanguage+ "'");
    return detectedLanguage;
  }
  if (forcedLanguage != null) {
    if (patternsByLanguage.get(forcedLanguage).length == 0) {
      return forcedLanguage;
    }
  }
  return null;
}
