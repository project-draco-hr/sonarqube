{
  LOG.debug("Publish results");
  long startTime=System.currentTimeMillis();
  URL url;
  try {
    url=new URL(serverClient.getURL() + relativeUrl);
  }
 catch (  MalformedURLException e) {
    throw new IllegalArgumentException("Invalid URL",e);
  }
  HttpRequest request=HttpRequest.post(url);
  request.trustAllCerts();
  request.trustAllHosts();
  request.header("User-Agent",format("SonarQube %s",server.getVersion()));
  request.basic(serverClient.getLogin(),serverClient.getPassword());
  request.part("report",null,"application/octet-stream",report);
  if (!request.ok()) {
    int responseCode=request.code();
    if (responseCode == 401) {
      throw new IllegalStateException(format(serverClient.getMessageWhenNotAuthorized(),CoreProperties.LOGIN,CoreProperties.PASSWORD));
    }
    if (responseCode == 403) {
      throw new IllegalStateException(request.body());
    }
    throw new IllegalStateException(format("Fail to execute request [code=%s, url=%s]: %s",responseCode,url,request.body()));
  }
  long stopTime=System.currentTimeMillis();
  LOG.info("Analysis reports sent to server in " + (stopTime - startTime) + "ms");
  String responseStr=request.body();
  SubmitResponse response=new Gson().fromJson(responseStr,SubmitResponse.class);
  return response.getTaskId();
}
