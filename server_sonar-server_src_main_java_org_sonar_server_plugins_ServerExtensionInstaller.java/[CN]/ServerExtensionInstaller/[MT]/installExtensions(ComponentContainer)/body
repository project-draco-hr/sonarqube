{
  ListMultimap<PluginInfo,Object> installedExtensionsByPlugin=ArrayListMultimap.create();
  for (  PluginInfo pluginInfo : pluginRepository.getPluginInfos()) {
    String pluginKey=pluginInfo.getKey();
    Plugin plugin=pluginRepository.getPluginInstance(pluginKey);
    container.addExtension(pluginInfo,plugin);
    for (    Object extension : plugin.getExtensions()) {
      if (installExtension(container,pluginInfo,extension,true) != null) {
        installedExtensionsByPlugin.put(pluginInfo,extension);
      }
 else {
        container.declareExtension(pluginInfo,extension);
      }
    }
  }
  for (  Map.Entry<PluginInfo,Object> entry : installedExtensionsByPlugin.entries()) {
    PluginInfo plugin=entry.getKey();
    Object extension=entry.getValue();
    if (isExtensionProvider(extension)) {
      ExtensionProvider provider=(ExtensionProvider)container.getComponentByKey(extension);
      installProvider(container,plugin,provider);
    }
  }
}
