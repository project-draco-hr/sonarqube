{
  checkNotStarted();
  Properties properties=new Properties();
  properties.putAll(initialProps);
  properties.setProperty(ProcessConstants.CLUSTER_NAME,clusterName);
  properties.setProperty(ProcessConstants.CLUSTER_NODE_NAME,"test");
  properties.setProperty(ProcessConstants.SEARCH_PORT,clusterPort.toString());
  properties.setProperty(ProcessConstants.PATH_HOME,homeDir.getAbsolutePath());
  properties.setProperty(DatabaseProperties.PROP_URL,"jdbc:h2:" + homeDir.getAbsolutePath() + "/h2");
  for (  Map.Entry<Object,Object> entry : System.getProperties().entrySet()) {
    String key=entry.getKey().toString();
    if (key.startsWith(PROP_PREFIX)) {
      properties.put(StringUtils.substringAfter(key,PROP_PREFIX),entry.getValue());
    }
  }
  searchServer.start();
  platform.init(properties);
  platform.addComponents(components);
  platform.doStart();
  if (!platform.isStarted()) {
    throw new IllegalStateException("Server not started. You should check that db migrations " + "are correctly declared, for example in schema-h2.sql or DatabaseVersion");
  }
}
