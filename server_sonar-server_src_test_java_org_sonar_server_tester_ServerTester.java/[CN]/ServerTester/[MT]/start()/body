{
  checkNotStarted();
  Properties properties=new Properties();
  properties.putAll(initialProps);
  try {
    searchServer.start();
    System.out.println("searchServer = " + searchServer.isReady());
    while (!searchServer.isReady()) {
      Thread.sleep(100);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  properties.setProperty(IndexProperties.CLUSTER_NAME,clusterName);
  properties.setProperty(IndexProperties.NODE_PORT,clusterPort.toString());
  properties.setProperty(MonitoredProcess.NAME_PROPERTY,"ES");
  properties.setProperty("sonar.path.home",homeDir.getAbsolutePath());
  properties.setProperty(DatabaseProperties.PROP_URL,"jdbc:h2:" + homeDir.getAbsolutePath() + "/h2");
  for (  Map.Entry<Object,Object> entry : System.getProperties().entrySet()) {
    String key=entry.getKey().toString();
    if (key.startsWith(PROP_PREFIX)) {
      properties.put(StringUtils.substringAfter(key,PROP_PREFIX),entry.getValue());
    }
  }
  platform.init(properties);
  platform.addComponents(components);
  platform.doStart();
  if (!platform.isStarted()) {
    throw new IllegalStateException("Server not started. You should check that db migrations " + "are correctly declared, for example in schema-h2.sql or DatabaseVersion");
  }
}
