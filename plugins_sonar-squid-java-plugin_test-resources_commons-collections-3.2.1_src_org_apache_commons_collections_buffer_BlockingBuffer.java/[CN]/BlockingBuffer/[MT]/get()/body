{
synchronized (lock) {
    while (collection.isEmpty()) {
      try {
        if (timeout <= 0) {
          lock.wait();
        }
 else {
          return get(timeout);
        }
      }
 catch (      InterruptedException e) {
        PrintWriter out=new PrintWriter(new StringWriter());
        e.printStackTrace(out);
        throw new BufferUnderflowException("Caused by InterruptedException: " + out.toString());
      }
    }
    return getBuffer().get();
  }
}
