{
  String login=newUser.login();
  UserDto existingUser=dbClient.userDao().selectNullableByLogin(dbSession,login);
  if (existingUser != null) {
    if (!existingUser.isActive()) {
      if (newUser.isPreventReactivation()) {
        throw new ReactivationException(String.format("A disabled user with the login '%s' already exists",login),login);
      }
 else {
        existingUser.setActive(true);
        existingUser.setUpdatedAt(system2.now());
        dbClient.userDao().update(dbSession,existingUser);
        addDefaultGroup(dbSession,existingUser);
      }
    }
 else {
      throw new IllegalArgumentException(String.format("A user with the login '%s' already exists",login));
    }
  }
}
