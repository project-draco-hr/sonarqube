{
  validate(newUser);
  DbSession dbSession=dbClient.openSession(false);
  try {
    String login=newUser.login();
    UserDto existingUser=dbClient.userDao().selectNullableByLogin(dbSession,login);
    if (existingUser != null) {
      updateExistingUser(dbSession,newUser);
    }
 else {
      createNewUser(dbSession,newUser);
    }
    dbSession.commit();
    notifyNewUser(newUser);
  }
  finally {
    dbSession.close();
  }
}
