{
  ProjectDefinition root=reactor.getRoot();
  BatchComponent rootProject=componentCache.getRoot();
  ScannerReport.Metadata.Builder builder=ScannerReport.Metadata.newBuilder().setAnalysisDate(((Project)rootProject.resource()).getAnalysisDate().getTime()).setProjectKey(root.getKey()).setCrossProjectDuplicationActivated(SonarCpdBlockIndex.isCrossProjectDuplicationEnabled(settings)).setRootComponentRef(rootProject.batchId());
  String branch=root.properties().get(CoreProperties.PROJECT_BRANCH_PROPERTY);
  if (branch != null) {
    builder.setBranch(branch);
  }
  writer.writeMetadata(builder.build());
}
