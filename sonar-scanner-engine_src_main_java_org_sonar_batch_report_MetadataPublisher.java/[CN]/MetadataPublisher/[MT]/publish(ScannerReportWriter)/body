{
  ProjectDefinition root=reactor.getRoot();
  BatchComponent rootProject=componentCache.getRoot();
  ScannerReport.Metadata.Builder builder=ScannerReport.Metadata.newBuilder().setAnalysisDate(((Project)rootProject.resource()).getAnalysisDate().getTime()).setProjectKey(root.getKey()).setCrossProjectDuplicationActivated(SonarCpdBlockIndex.isCrossProjectDuplicationEnabled(settings)).setRootComponentRef(rootProject.batchId());
  String branch=root.getBranch();
  if (branch != null) {
    builder.setBranch(branch);
  }
  for (  QProfile qp : qProfiles.findAll()) {
    builder.getMutableQprofilesPerLanguage().put(qp.getLanguage(),org.sonar.scanner.protocol.output.ScannerReport.Metadata.QProfile.newBuilder().setKey(qp.getKey()).setLanguage(qp.getLanguage()).setName(qp.getName()).setRulesUpdatedAt(qp.getRulesUpdatedAt().getTime()).build());
  }
  writer.writeMetadata(builder.build());
}
