{
  List<DecoratorContext> childrenContexts=Lists.newArrayList();
  for (  Resource child : index.getChildren(resource)) {
    boolean isModule=(child instanceof Project);
    DefaultDecoratorContext childContext=(DefaultDecoratorContext)decorateResource(child,decorators,!isModule);
    childrenContexts.add(childContext.setReadOnly(true));
  }
  DefaultDecoratorContext context=new DefaultDecoratorContext(resource,index,childrenContexts,session);
  if (executeDecorators) {
    for (    Decorator decorator : decorators) {
      eventBus.fireEvent(new DecoratorExecutionEvent(decorator,true));
      decorator.decorate(resource,context);
      eventBus.fireEvent(new DecoratorExecutionEvent(decorator,false));
    }
  }
  return context;
}
