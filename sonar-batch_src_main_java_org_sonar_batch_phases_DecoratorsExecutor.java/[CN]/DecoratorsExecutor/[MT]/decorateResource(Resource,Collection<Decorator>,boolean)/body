{
  List<DecoratorContext> childrenContexts=Lists.newArrayList();
  for (  Resource child : index.getChildren(resource)) {
    boolean isModule=child instanceof Project;
    DefaultDecoratorContext childContext=(DefaultDecoratorContext)decorateResource(child,decorators,!isModule);
    childrenContexts.add(childContext.lock());
  }
  DefaultDecoratorContext context=new DefaultDecoratorContext(resource,index,childrenContexts,measurementFilters,measureCache,metricFinder);
  if (executeDecorators) {
    context.init();
    for (    Decorator decorator : decorators) {
      executeDecorator(decorator,context,resource);
    }
  }
  return context;
}
