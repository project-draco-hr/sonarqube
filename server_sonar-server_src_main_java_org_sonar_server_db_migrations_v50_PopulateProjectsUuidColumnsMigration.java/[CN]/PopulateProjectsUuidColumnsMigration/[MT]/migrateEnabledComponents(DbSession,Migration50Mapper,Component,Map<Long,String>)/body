{
  Map<Long,Component> componentsBySnapshotId=newHashMap();
  List<Component> components=mapper.selectComponentChildrenForProjects(project.getId());
  components.add(project);
  for (  Component component : components) {
    componentsBySnapshotId.put(component.getSnapshotId(),component);
    component.setUuid(getOrCreateUuid(component.getId(),uuidByComponentId));
    component.setProjectUuid(getOrCreateUuid(project.getId(),uuidByComponentId));
  }
  for (  Component component : components) {
    updateComponent(component,project,componentsBySnapshotId,uuidByComponentId);
    mapper.updateComponentUuids(component);
    counter.getAndIncrement();
  }
}
