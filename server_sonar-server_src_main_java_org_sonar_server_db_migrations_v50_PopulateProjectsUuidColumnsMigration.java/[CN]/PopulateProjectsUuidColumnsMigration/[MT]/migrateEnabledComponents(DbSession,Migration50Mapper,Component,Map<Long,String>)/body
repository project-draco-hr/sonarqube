{
  Map<Long,Component> componentsBySnapshotId=newHashMap();
  List<Component> components=mapper.selectComponentChildrenForProjects(project.getId());
  components.add(project);
  for (  Component component : components) {
    componentsBySnapshotId.put(component.getSnapshotId(),component);
    component.setUuid(getOrCreateUuid(component,uuidByComponentId));
    component.setProjectUuid(getOrCreateUuid(project,uuidByComponentId));
  }
  for (  Component component : components) {
    updateComponent(component,project,componentsBySnapshotId,uuidByComponentId);
    mapper.updateComponentUuids(component);
    counter.getAndIncrement();
  }
}
