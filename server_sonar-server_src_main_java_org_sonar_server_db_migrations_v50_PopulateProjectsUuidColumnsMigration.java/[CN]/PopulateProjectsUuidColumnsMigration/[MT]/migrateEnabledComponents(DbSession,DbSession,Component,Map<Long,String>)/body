{
  Map<Long,Component> componentsBySnapshotId=newHashMap();
  List<Component> components=readSession.getMapper(Migration50Mapper.class).selectComponentChildrenForProjects(project.getId());
  components.add(project);
  List<Component> componentsToMigrate=newArrayList();
  for (  Component component : components) {
    componentsBySnapshotId.put(component.getSnapshotId(),component);
    if (component.getUuid() == null) {
      component.setUuid(getOrCreateUuid(component,uuidByComponentId));
      component.setProjectUuid(getOrCreateUuid(project,uuidByComponentId));
      componentsToMigrate.add(component);
    }
  }
  for (  Component component : componentsToMigrate) {
    updateComponent(component,project,componentsBySnapshotId,uuidByComponentId);
    writeSession.getMapper(Migration50Mapper.class).updateComponentUuids(component);
    counter.getAndIncrement();
  }
}
