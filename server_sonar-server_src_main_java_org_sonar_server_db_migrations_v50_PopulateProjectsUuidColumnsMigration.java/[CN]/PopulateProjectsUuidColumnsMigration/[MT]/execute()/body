{
  Timer timer=new Timer("Db Migration Progress");
  timer.schedule(progressTask,MassUpdate.ProgressTask.PERIOD_MS,MassUpdate.ProgressTask.PERIOD_MS);
  DbSession session=db.openSession(true);
  try {
    Migration50Mapper mapper=session.getMapper(Migration50Mapper.class);
    for (    Component project : mapper.selectRootProjects()) {
      Map<Long,String> uuidByComponentId=newHashMap();
      migrateEnabledComponents(session,mapper,project,uuidByComponentId);
      migrateDisabledComponents(session,mapper,project,uuidByComponentId);
    }
    migrateComponentsWithoutUuid(session,mapper);
    session.commit();
    progressTask.log();
  }
  finally {
    session.close();
    timer.cancel();
    timer.purge();
  }
}
