{
  RuleQuery query=service.newRuleQuery();
  query.setQueryText(request.param(PARAM_TEXT_QUERY));
  query.setSeverities(request.paramAsStrings(PARAM_SEVERITIES));
  query.setRepositories(request.paramAsStrings(PARAM_REPOSITORIES));
  query.setStatuses(toStatuses(request.paramAsStrings(PARAM_STATUSES)));
  query.setLanguages(request.paramAsStrings(PARAM_LANGUAGES));
  query.setDebtCharacteristics(request.paramAsStrings(PARAM_DEBT_CHARACTERISTICS));
  query.setHasDebtCharacteristic(request.paramAsBoolean(PARAM_HAS_DEBT_CHARACTERISTIC));
  query.setSortField(RuleQuery.SortField.valueOfOrNull(request.param(PARAM_SORT)));
  query.setAscendingSort(request.mandatoryParamAsBoolean(PARAM_ASCENDING));
  QueryOptions options=new QueryOptions();
  options.setFieldsToReturn(request.paramAsStrings(PARAM_FIELDS));
  options.setPage(request.mandatoryParamAsInt(PARAM_PAGE),request.mandatoryParamAsInt(PARAM_PAGE_SIZE));
  Results results=service.search(query,options);
  JsonWriter json=response.newJsonWriter().beginObject();
  writeStatistics(results,json);
  writeHits(results,json);
  json.close();
}
