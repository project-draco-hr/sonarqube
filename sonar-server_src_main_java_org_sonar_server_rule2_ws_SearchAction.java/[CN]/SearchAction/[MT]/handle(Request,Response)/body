{
  RuleQuery query=service.newRuleQuery();
  query.setQueryText(request.param(PARAM_TEXT_QUERY));
  query.setSeverities(request.paramAsStrings(PARAM_SEVERITIES));
  query.setRepositories(request.paramAsStrings(PARAM_REPOSITORIES));
  query.setStatuses(toStatuses(request.paramAsStrings(PARAM_STATUSES)));
  query.setLanguages(request.paramAsStrings(PARAM_LANGUAGES));
  Results results=service.search(query,new QueryOptions());
  JsonWriter json=response.newJsonWriter().beginObject().name("hits").beginArray();
  for (  Hit hit : results.getHits()) {
    json.beginObject();
    for (    Map.Entry<String,Object> entry : hit.getFields().entrySet()) {
      Object value=entry.getValue();
      json.prop(entry.getKey(),value == null ? null : value.toString());
    }
    json.endObject();
  }
  json.endArray();
  json.endObject().close();
}
