{
  RuleQuery query=createRuleQuery(request);
  SearchOptions searchOptions=SearchOptions.create(request);
  RuleResult results=service.search(query,mapping.newQueryOptions(searchOptions));
  JsonWriter json=response.newJsonWriter().beginObject();
  searchOptions.writeStatistics(json,results);
  writeRules(results,json,searchOptions);
  if (searchOptions.hasField("actives")) {
    writeActiveRules(results,json);
  }
  json.endObject();
  json.close();
}
