{
  Query query=session.createQuery("FROM " + Snapshot.class.getSimpleName() + " WHERE (root_snapshot_id=:rootId OR id=:rootId) AND scope=:scope");
  query.setParameter("rootId",snapshot.getId());
  query.setParameter("scope",Scopes.PROJECT);
  List<Snapshot> moduleSnapshots=query.getResultList();
  for (  Snapshot moduleSnapshot : moduleSnapshots) {
    Snapshot previousLastSnapshot=resourcePersister.getLastSnapshot(moduleSnapshot,true);
    if (previousLastSnapshot != null) {
      setFlags(previousLastSnapshot,false,null);
    }
  }
}
