{
  PluginMetadata metadata=mock(DefaultPluginMetadata.class);
  when(metadata.getKey()).thenReturn("foo");
  when(metadata.getRequiredPlugins()).thenReturn(new String[]{});
  PluginRepository pluginRepository=mock(PluginRepository.class);
  when(pluginRepository.getMetadata()).thenReturn(newArrayList(metadata));
  InstalledPluginReferentialFactory installedPluginReferentialFactory=new InstalledPluginReferentialFactory(pluginRepository);
  assertThat(installedPluginReferentialFactory.getInstalledPluginReferential()).isNull();
  installedPluginReferentialFactory.start();
  assertThat(installedPluginReferentialFactory.getInstalledPluginReferential()).isNotNull();
  assertThat(installedPluginReferentialFactory.getInstalledPluginReferential().getPlugins()).hasSize(1);
}
