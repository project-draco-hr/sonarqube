{
  if (shouldSaveLater(measure)) {
    unsavedMeasuresByResource.put(resource,measure);
    return;
  }
  MeasureModel model=null;
  if (measure.getId() != null) {
    model=update(measure);
  }
 else   if (shouldPersistMeasure(resource,measure)) {
    model=insert(measure,resourcePersister.getSnapshotOrFail(resource));
  }
  if (model != null) {
    memoryOptimizer.evictDataMeasure(measure,model);
  }
}
