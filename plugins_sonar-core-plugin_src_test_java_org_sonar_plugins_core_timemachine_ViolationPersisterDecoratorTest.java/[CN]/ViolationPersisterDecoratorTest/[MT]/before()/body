{
  setupData("shared");
  Snapshot snapshot=getSession().getSingleResult(Snapshot.class,"id",1000);
  ResourcePersister resourcePersister=mock(ResourcePersister.class);
  when(resourcePersister.saveResource((Project)anyObject(),eq(javaFile))).thenReturn(snapshot);
  when(resourcePersister.getSnapshot(javaFile)).thenReturn(snapshot);
  tracker=mock(ViolationTrackingDecorator.class);
  decorator=new ViolationPersisterDecorator(tracker,resourcePersister,new DefaultRuleFinder(getSessionFactory()),getSession());
}
