{
  ActiveRuleDao dao=db.activeRuleDao();
  ActiveRuleDto activeRule=null;
  if (change.getType() == ActiveRuleChange.Type.ACTIVATED) {
    activeRule=ActiveRuleDto.createFor(context.profile(),context.rule());
    activeRule.setSeverity(change.getSeverity());
    if (change.getInheritance() != null) {
      activeRule.setInheritance(change.getInheritance().name());
    }
    dao.insert(dbSession,activeRule);
    for (    Map.Entry<String,String> param : change.getParameters().entrySet()) {
      ActiveRuleParamDto paramDto=ActiveRuleParamDto.createFor(context.ruleParamsByKeys().get(param.getKey()));
      paramDto.setValue(param.getValue());
      dao.addParam(dbSession,activeRule,paramDto);
    }
  }
 else   if (change.getType() == ActiveRuleChange.Type.DEACTIVATED) {
    dao.deleteByKey(dbSession,change.getKey());
  }
 else   if (change.getType() == ActiveRuleChange.Type.UPDATED) {
    activeRule=context.activeRule();
    activeRule.setSeverity(change.getSeverity());
    if (change.getInheritance() != null) {
      activeRule.setInheritance(change.getInheritance().name());
    }
    dao.update(dbSession,activeRule);
    for (    Map.Entry<String,String> param : change.getParameters().entrySet()) {
      ActiveRuleParamDto activeRuleParamDto=context.activeRuleParamsAsMap().get(param.getKey());
      if (activeRuleParamDto == null) {
        activeRuleParamDto=ActiveRuleParamDto.createFor(context.ruleParamsByKeys().get(param.getKey()));
        activeRuleParamDto.setValue(param.getValue());
        dao.addParam(dbSession,activeRule,activeRuleParamDto);
      }
 else {
        activeRuleParamDto.setValue(param.getValue());
        dao.updateParam(dbSession,activeRule,activeRuleParamDto);
      }
    }
    for (    ActiveRuleParamDto activeRuleParamDto : context.activeRuleParams()) {
      if (!change.getParameters().containsKey(activeRuleParamDto.getKey())) {
      }
    }
  }
  return activeRule;
}
