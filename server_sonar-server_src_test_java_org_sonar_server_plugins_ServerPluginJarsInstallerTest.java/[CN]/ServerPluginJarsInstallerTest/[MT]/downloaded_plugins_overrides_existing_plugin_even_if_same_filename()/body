{
  FileUtils.copyFileToDirectory(jar("foo-plugin-1.0.jar"),pluginsDir,true);
  FileUtils.copyFile(jar("foo-plugin-2.0.jar"),new File(downloadsDir,"foo-plugin-1.0.jar"));
  when(upgradeStatus.isFreshInstall()).thenReturn(false);
  jarsInstaller.install();
  PluginMetadata plugin=jarsInstaller.getMetadata("foo");
  assertThat(plugin).isNotNull();
  assertThat(plugin.getVersion()).isEqualTo("2.0");
  assertThat(FileUtils.listFiles(pluginsDir,new String[]{"jar"},false)).hasSize(1);
  assertThat(FileUtils.listFiles(downloadsDir,new String[]{"jar"},false)).isEmpty();
  File installed=new File(pluginsDir,"foo-plugin-1.0.jar");
  assertThat(installed).exists().isFile();
}
