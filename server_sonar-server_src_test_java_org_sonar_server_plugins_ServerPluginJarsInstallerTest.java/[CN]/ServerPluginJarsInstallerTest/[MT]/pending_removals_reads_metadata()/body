{
  when(upgradeStatus.isFreshInstall()).thenReturn(false);
  FileUtils.copyFileToDirectory(jar("foo-plugin-1.0.jar"),pluginsDir);
  jarsInstaller.install();
  jarsInstaller.uninstall("foo");
  assertThat(FileUtils.listFiles(pluginsDir,new String[]{"jar"},false)).isEmpty();
  assertThat(FileUtils.listFiles(trashDir,new String[]{"jar"},false)).hasSize(1);
  Collection<DefaultPluginMetadata> removals=jarsInstaller.getUninstalledPlugins();
  assertThat(removals).hasSize(1);
  PluginMetadata metadata=removals.iterator().next();
  assertThat(metadata.getKey()).isEqualTo("foo");
  assertThat(metadata.getName()).isEqualTo("Foo");
  assertThat(metadata.getVersion()).isEqualTo("1.0");
  assertThat(metadata.getOrganization()).isEqualTo("SonarSource");
  assertThat(metadata.getOrganizationUrl()).isEqualTo("http://www.sonarsource.org");
  assertThat(metadata.getLicense()).isEqualTo("LGPL 3");
  assertThat(metadata.getMainClass()).isEqualTo("foo.Main");
}
