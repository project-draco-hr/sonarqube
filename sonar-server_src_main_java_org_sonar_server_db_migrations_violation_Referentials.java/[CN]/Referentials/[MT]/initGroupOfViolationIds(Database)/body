{
  Connection connection=database.getDataSource().getConnection();
  Statement stmt=null;
  ResultSet rs=null;
  try {
    connection.setAutoCommit(false);
    stmt=connection.createStatement();
    stmt.setFetchSize(10000);
    rs=stmt.executeQuery("select id from rule_failures");
    Queue<long[]> queue=new ConcurrentLinkedQueue<long[]>();
    totalViolations=0;
    long[] block=new long[VIOLATION_GROUP_SIZE];
    int cursor=0;
    while (rs.next()) {
      block[cursor++]=rs.getLong(1);
      totalViolations++;
      if (cursor == VIOLATION_GROUP_SIZE) {
        queue.add(block);
        block=new long[VIOLATION_GROUP_SIZE];
        cursor=0;
      }
    }
    if (cursor > 0) {
      queue.add(block);
    }
    return queue;
  }
  finally {
    DbUtils.closeQuietly(connection,stmt,rs);
  }
}
