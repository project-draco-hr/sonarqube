{
  CeActivityQuery query=new CeActivityQuery();
  query.setType(wsRequest.param(PARAM_TYPE));
  query.setOnlyCurrents(wsRequest.mandatoryParamAsBoolean(PARAM_ONLY_CURRENTS));
  query.setMinSubmittedAt(toTime(wsRequest.paramAsDateTime(PARAM_MIN_SUBMITTED_AT)));
  query.setMaxFinishedAt(toTime(wsRequest.paramAsDateTime(PARAM_MAX_FINISHED_AT)));
  String status=wsRequest.param(PARAM_STATUS);
  if (status != null) {
    query.setStatus(CeActivityDto.Status.valueOf(status));
  }
  String componentUuid=wsRequest.param(PARAM_COMPONENT_UUID);
  if (componentUuid == null) {
    userSession.checkGlobalPermission(UserRole.ADMIN);
  }
 else {
    userSession.checkProjectUuidPermission(UserRole.USER,componentUuid);
    query.setComponentUuid(componentUuid);
  }
  return query;
}
