{
  when(componentDao.getAuthorizedComponentByKey("org.sample.Sample",session)).thenReturn(new AuthorizedComponentDto().setId(10L).setKey("org.sample.Sample"));
  params=buildPermissionChangeParams("user",null,"org.sample.Sample","codeviewer");
  setUpComponentUserPermissions("user",10L,"codeviewer");
  MockUserSession.set().setLogin("admin").addProjectPermissions(UserRole.ADMIN,"org.sample.Sample");
  service.removePermission(params);
  verify(permissionFacade).deleteUserPermission(eq(10L),eq(2L),eq("codeviewer"),eq(session));
  verify(issueAuthorizationDao).synchronizeAfter(eq(session),any(Date.class),eq(ImmutableMap.of("project","org.sample.Sample")));
}
