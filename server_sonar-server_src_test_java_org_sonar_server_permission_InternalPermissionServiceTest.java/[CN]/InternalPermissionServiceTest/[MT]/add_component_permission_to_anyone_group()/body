{
  ComponentDto project=ComponentTesting.newProjectDto().setId(10L).setKey("org.sample.Sample");
  when(componentDao.getByKey(session,"org.sample.Sample")).thenReturn(project);
  params=buildPermissionChangeParams(null,DefaultGroups.ANYONE,"org.sample.Sample","user");
  MockUserSession.set().setLogin("admin").addProjectPermissions(UserRole.ADMIN,"org.sample.Sample");
  service.addPermission(params);
  verify(permissionFacade).insertGroupPermission(eq(10L),eq((Long)null),eq("user"),eq(session));
  verify(issueAuthorizationDao).synchronizeAfter(eq(session),any(Date.class),eq(ImmutableMap.of("project",project.uuid())));
}
