{
  final String componentKey="component";
  final long componentId=1234l;
  final String qualifier=Qualifiers.PROJECT;
  ComponentDto mockComponent=mock(ComponentDto.class);
  when(mockComponent.getId()).thenReturn(componentId);
  when(mockComponent.key()).thenReturn(componentKey);
  when(mockComponent.qualifier()).thenReturn(qualifier);
  MockUserSession.set().setLogin("admin").addProjectPermissions(UserRole.ADMIN,componentKey);
  when(componentDao.getByKey(session,componentKey)).thenReturn(mockComponent);
  service.applyDefaultPermissionTemplate(componentKey);
  verify(permissionFacade).grantDefaultRoles(session,componentId,qualifier);
  verify(issueAuthorizationDao).synchronizeAfter(eq(session),any(Date.class),eq(ImmutableMap.of("project","component")));
}
