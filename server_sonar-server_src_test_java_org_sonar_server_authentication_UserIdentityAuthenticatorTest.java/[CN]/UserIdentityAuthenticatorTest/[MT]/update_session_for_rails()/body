{
  when(userDao.selectByExternalIdentity(dbSession,USER_IDENTITY.getId(),IDENTITY_PROVIDER.getKey())).thenReturn(Optional.of(ACTIVE_USER));
  underTest.authenticate(USER_IDENTITY,IDENTITY_PROVIDER,httpSession);
  verify(httpSession).setAttribute("user_id",ACTIVE_USER.getId());
}
