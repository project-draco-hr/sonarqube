{
  when(userDao.selectByLogin(dbSession,USER_IDENTITY.getLogin())).thenReturn(ACTIVE_USER);
  underTest.authenticate(USER_IDENTITY,IDENTITY_PROVIDER,httpSession);
  ArgumentCaptor<UpdateUser> updateUserArgumentCaptor=ArgumentCaptor.forClass(UpdateUser.class);
  verify(userUpdater).update(eq(dbSession),updateUserArgumentCaptor.capture());
  UpdateUser updateUser=updateUserArgumentCaptor.getValue();
  assertThat(updateUser.login()).isEqualTo(USER_LOGIN);
  assertThat(updateUser.name()).isEqualTo("John");
  assertThat(updateUser.email()).isEqualTo("john@email.com");
  assertThat(updateUser.externalIdentity().getProvider()).isEqualTo("github");
  assertThat(updateUser.externalIdentity().getId()).isEqualTo("johndoo");
}
