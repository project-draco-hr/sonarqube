{
  when(userDao.selectByLogin(dbSession,USER_IDENTITY.getLogin())).thenReturn(UNACTIVE_USER);
  when(userDao.selectOrFailByLogin(dbSession,USER_IDENTITY.getLogin())).thenReturn(UNACTIVE_USER);
  underTest.authenticate(USER_IDENTITY,IDENTITY_PROVIDER,httpSession);
  ArgumentCaptor<NewUser> newUserArgumentCaptor=ArgumentCaptor.forClass(NewUser.class);
  verify(userUpdater).create(eq(dbSession),newUserArgumentCaptor.capture());
}
