{
  int httpPort=NetworkUtils.getNextAvailablePort();
  httpsPort=NetworkUtils.getNextAvailablePort();
  QueuedThreadPool threadPool=new QueuedThreadPool();
  threadPool.setMaxThreads(500);
  server=new Server(threadPool);
  HttpConfiguration httpConfig=new HttpConfiguration();
  httpConfig.setSecureScheme("https");
  httpConfig.setSecurePort(httpsPort);
  httpConfig.setSendServerVersion(true);
  httpConfig.setSendDateHeader(false);
  HandlerCollection handlers=new HandlerCollection();
  handlers.setHandlers(new Handler[]{proxyHandler(),new DefaultHandler()});
  server.setHandler(handlers);
  ServerConnector http=new ServerConnector(server,new HttpConnectionFactory(httpConfig));
  http.setPort(httpPort);
  server.addConnector(http);
  Path serverKeyStore=Paths.get(SSLTest.class.getResource("/analysis/SSLTest/serverkeystore.jks").toURI()).toAbsolutePath();
  String keyStorePassword="serverkeystorepwd";
  String serverKeyPassword="serverp12pwd";
  Path serverTrustStore=Paths.get(SSLTest.class.getResource("/analysis/SSLTest/servertruststore.jks").toURI()).toAbsolutePath();
  String trustStorePassword="servertruststorepwd";
  SslContextFactory sslContextFactory=new SslContextFactory();
  sslContextFactory.setKeyStorePath(serverKeyStore.toString());
  sslContextFactory.setKeyStorePassword(keyStorePassword);
  sslContextFactory.setKeyManagerPassword(serverKeyPassword);
  sslContextFactory.setTrustStorePath(serverTrustStore.toString());
  sslContextFactory.setTrustStorePassword(trustStorePassword);
  sslContextFactory.setNeedClientAuth(requireClientAuth);
  sslContextFactory.setExcludeCipherSuites("SSL_RSA_WITH_DES_CBC_SHA","SSL_DHE_RSA_WITH_DES_CBC_SHA","SSL_DHE_DSS_WITH_DES_CBC_SHA","SSL_RSA_EXPORT_WITH_RC4_40_MD5","SSL_RSA_EXPORT_WITH_DES40_CBC_SHA","SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA","SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA");
  HttpConfiguration httpsConfig=new HttpConfiguration(httpConfig);
  ServerConnector sslConnector=new ServerConnector(server,new SslConnectionFactory(sslContextFactory,HttpVersion.HTTP_1_1.asString()),new HttpConnectionFactory(httpsConfig));
  sslConnector.setPort(httpsPort);
  server.addConnector(sslConnector);
  server.start();
}
