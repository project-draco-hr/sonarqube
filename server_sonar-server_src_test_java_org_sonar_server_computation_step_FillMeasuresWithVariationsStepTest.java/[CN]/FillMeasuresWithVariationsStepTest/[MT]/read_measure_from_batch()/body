{
  SnapshotDto period1ProjectSnapshot=createForProject(PROJECT_DTO);
  dbClient.snapshotDao().insert(session,period1ProjectSnapshot);
  dbClient.measureDao().insert(session,newMeasureDto(ISSUES_METRIC.getId(),PROJECT_DTO.getId(),period1ProjectSnapshot.getId(),60d));
  session.commit();
  periodsHolder.addPeriod(newPeriod(1,period1ProjectSnapshot));
  treeRootHolder.setRoot(PROJECT);
  reportReader.putMeasures(PROJECT.getRef(),Collections.singletonList(BatchReport.Measure.newBuilder().setIntValue(80).setMetricKey(ISSUES_METRIC.getKey()).build()));
  sut.execute();
  assertThat(measureRepository.getRawMeasure(PROJECT,toMetric(ISSUES_METRIC)).get().getVariations().getVariation1()).isEqualTo(20d);
}
