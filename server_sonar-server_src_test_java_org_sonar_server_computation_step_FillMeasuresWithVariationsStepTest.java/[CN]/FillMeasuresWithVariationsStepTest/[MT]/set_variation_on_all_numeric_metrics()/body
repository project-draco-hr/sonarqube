{
  SnapshotDto period1ProjectSnapshot=createForProject(PROJECT_DTO);
  dbClient.snapshotDao().insert(session,period1ProjectSnapshot);
  dbClient.measureDao().insert(session,newMeasureDto(ISSUES_METRIC.getId(),PROJECT_DTO.getId(),period1ProjectSnapshot.getId(),60d),newMeasureDto(DEBT_METRIC.getId(),PROJECT_DTO.getId(),period1ProjectSnapshot.getId(),10d),newMeasureDto(FILE_COMPLEXITY_METRIC.getId(),PROJECT_DTO.getId(),period1ProjectSnapshot.getId(),2d),newMeasureDto(BUILD_BREAKER_METRIC.getId(),PROJECT_DTO.getId(),period1ProjectSnapshot.getId(),1d));
  session.commit();
  periodsHolder.addPeriod(newPeriod(1,period1ProjectSnapshot));
  treeRootHolder.setRoot(PROJECT);
  addRawMeasure(PROJECT,ISSUES_METRIC,Measure.newMeasureBuilder().create(80,null));
  addRawMeasure(PROJECT,DEBT_METRIC,Measure.newMeasureBuilder().create(5L,null));
  addRawMeasure(PROJECT,FILE_COMPLEXITY_METRIC,Measure.newMeasureBuilder().create(3d,null));
  addRawMeasure(PROJECT,BUILD_BREAKER_METRIC,Measure.newMeasureBuilder().create(false,null));
  sut.execute();
  assertThat(measureRepository.getRawMeasures(PROJECT).keys()).hasSize(4);
  assertThat(measureRepository.getRawMeasure(PROJECT,toMetric(ISSUES_METRIC)).get().getVariations().getVariation1()).isEqualTo(20d);
  assertThat(measureRepository.getRawMeasure(PROJECT,toMetric(DEBT_METRIC)).get().getVariations().getVariation1()).isEqualTo(-5d);
  assertThat(measureRepository.getRawMeasure(PROJECT,toMetric(FILE_COMPLEXITY_METRIC)).get().getVariations().getVariation1()).isEqualTo(1d);
  assertThat(measureRepository.getRawMeasure(PROJECT,toMetric(BUILD_BREAKER_METRIC)).get().getVariations().getVariation1()).isEqualTo(-1d);
}
