{
  PmdRuleset ruleset=new PmdRuleset(profileName);
  for (  ActiveRule activeRule : activeRules) {
    if (activeRule.getRule().getPluginName().equals(CoreProperties.PMD_PLUGIN)) {
      String configKey=activeRule.getRule().getConfigKey();
      PmdRule rule=new PmdRule(configKey,PmdLevelUtils.toLevel(activeRule.getPriority()));
      List<PmdProperty> properties=null;
      if (activeRule.getActiveRuleParams() != null && !activeRule.getActiveRuleParams().isEmpty()) {
        properties=new ArrayList<PmdProperty>();
        for (        ActiveRuleParam activeRuleParam : activeRule.getActiveRuleParams()) {
          properties.add(new PmdProperty(activeRuleParam.getRuleParam().getKey(),activeRuleParam.getValue()));
        }
      }
      rule.setProperties(properties);
      ruleset.addRule(rule);
      processXPathRule(activeRule.getRuleKey(),rule);
    }
  }
  return ruleset;
}
