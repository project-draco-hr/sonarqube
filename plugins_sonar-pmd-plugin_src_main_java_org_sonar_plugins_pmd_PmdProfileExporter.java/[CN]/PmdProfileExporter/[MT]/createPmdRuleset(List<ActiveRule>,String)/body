{
  PmdRuleset ruleset=new PmdRuleset(profileName);
  for (  ActiveRule activeRule : activeRules) {
    if (activeRule.getRule().getRepositoryKey().equals(PmdConstants.REPOSITORY_KEY)) {
      String configKey=activeRule.getRule().getConfigKey();
      PmdRule rule=new PmdRule(configKey,PmdLevelUtils.toLevel(activeRule.getSeverity()));
      if (activeRule.getActiveRuleParams() != null && !activeRule.getActiveRuleParams().isEmpty()) {
        List<PmdProperty> properties=new ArrayList<PmdProperty>();
        for (        ActiveRuleParam activeRuleParam : activeRule.getActiveRuleParams()) {
          properties.add(new PmdProperty(activeRuleParam.getRuleParam().getKey(),activeRuleParam.getValue()));
        }
        rule.setProperties(properties);
      }
      ruleset.addRule(rule);
      processXPathRule(activeRule.getRuleKey(),rule);
    }
  }
  return ruleset;
}
