{
  SonarCache cache=mock(SonarCache.class);
  BatchSonarCache batchCache=mock(BatchSonarCache.class);
  when(batchCache.getCache()).thenReturn(cache);
  File fakeDriver=new File(getClass().getResource("/org/sonar/batch/bootstrap/JdbcDriverHolderTest/jdbc-driver.jar").toURI());
  when(cache.cacheFile(Mockito.any(File.class),Mockito.anyString())).thenReturn("anotherfakemd5");
  when(cache.getFileFromCache(Mockito.anyString(),Mockito.anyString())).thenReturn(null).thenReturn(fakeDriver);
  ServerClient server=mock(ServerClient.class);
  when(server.request("/deploy/jdbc-driver.txt")).thenReturn("ojdbc14.jar|fakemd5");
  when(server.request("/deploy/ojdbc14.jar")).thenReturn("fakecontent");
  JdbcDriverHolder holder=new JdbcDriverHolder(batchCache,new Settings(),server);
  thrown.expect(SonarException.class);
  thrown.expectMessage("INVALID CHECKSUM");
  holder.start();
}
