{
  if (shouldStartNewLine(charsReader)) {
    if (shouldReopenPendingTags(charsReader)) {
      reopenCurrentSyntaxTags(charsReader,currentHtmlLine);
    }
  }
  int numberOfTagsToClose=getNumberOfTagsToClose(charsReader.getCurrentIndex(),decorationDataHolder);
  closeCompletedTags(charsReader,numberOfTagsToClose,currentHtmlLine);
  if (shouldClosePendingTags(charsReader)) {
    closeCurrentSyntaxTags(charsReader,currentHtmlLine);
  }
  Collection<String> tagsToOpen=getTagsToOpen(charsReader.getCurrentIndex(),decorationDataHolder);
  openNewTags(charsReader,tagsToOpen,currentHtmlLine);
  if (shouldAppendCharToHtmlOutput(charsReader)) {
    char currentChar=(char)charsReader.getCurrentValue();
    currentHtmlLine.append(normalize(currentChar));
  }
}
