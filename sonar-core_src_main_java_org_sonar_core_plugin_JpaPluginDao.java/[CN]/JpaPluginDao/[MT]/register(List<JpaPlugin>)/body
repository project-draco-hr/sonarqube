{
  DatabaseSession session=sessionFactory.getSession();
  List<Integer> ids=new ArrayList<Integer>();
  for (  JpaPlugin plugin : plugins) {
    session.saveWithoutFlush(plugin);
    ids.add(plugin.getId());
  }
  session.commit();
  if (ids.isEmpty()) {
    session.createQuery("DELETE " + JpaPluginFile.class.getSimpleName()).executeUpdate();
    session.createQuery("DELETE " + JpaPlugin.class.getSimpleName()).executeUpdate();
  }
 else {
    Query query=session.createQuery("DELETE " + JpaPluginFile.class.getSimpleName() + " WHERE plugin.id NOT IN (:ids)");
    query.setParameter("ids",ids);
    query.executeUpdate();
    query=session.createQuery("DELETE " + JpaPlugin.class.getSimpleName() + " WHERE id NOT IN (:ids)");
    query.setParameter("ids",ids);
    query.executeUpdate();
  }
  session.commit();
}
