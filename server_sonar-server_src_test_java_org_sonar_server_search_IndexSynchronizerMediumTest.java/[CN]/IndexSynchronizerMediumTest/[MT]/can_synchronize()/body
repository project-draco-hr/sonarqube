{
  int numberOfRules=1000;
  int batchSize=BatchSession.MAX_BATCH_SIZE;
  int count=0;
  for (int step=0; (step * batchSize) < numberOfRules; step++) {
    for (int i=0; i < batchSize; i++) {
      dbClient.ruleDao().insert(dbSession,RuleTesting.newDto(RuleKey.of("test","x" + (count++))));
    }
    dbSession.commit();
  }
  assertThat(indexClient.get(RuleIndex.class).countAll()).isEqualTo(numberOfRules);
  tester.clearIndexes();
  assertThat(indexClient.get(RuleIndex.class).countAll()).isEqualTo(0);
  synchronizer.execute();
  assertThat(indexClient.get(RuleIndex.class).countAll()).isEqualTo(numberOfRules);
}
