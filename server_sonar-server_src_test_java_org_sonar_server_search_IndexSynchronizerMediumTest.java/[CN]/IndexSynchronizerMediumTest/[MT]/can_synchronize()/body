{
  int numberOfRules=100;
  for (int i=0; i < numberOfRules; i++) {
    dbClient.ruleDao().insert(dbSession,RuleTesting.newDto(RuleKey.of("test","x" + i)));
  }
  dbSession.commit();
  assertThat(indexClient.get(RuleIndex.class).countAll()).isEqualTo(numberOfRules);
  tester.clearIndexes();
  assertThat(indexClient.get(RuleIndex.class).countAll()).isEqualTo(0);
  synchronizer.synchronize(dbSession,dbClient.ruleDao(),indexClient.get(RuleIndex.class));
  dbSession.commit();
  Thread.sleep(1000);
  assertThat(indexClient.get(RuleIndex.class).countAll()).isEqualTo(numberOfRules);
}
