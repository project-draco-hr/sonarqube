{
  Enumeration<NetworkInterface> ifaces=NetworkInterface.getNetworkInterfaces();
  while (ifaces.hasMoreElements()) {
    NetworkInterface iface=ifaces.nextElement();
    Enumeration<InetAddress> addresses=iface.getInetAddresses();
    while (addresses.hasMoreElements()) {
      InetAddress addr=addresses.nextElement();
      if (addr.getClass().isAssignableFrom(inetAddressClass)) {
        return addr;
      }
    }
  }
  throw new IllegalStateException("no ipv4 address");
}
