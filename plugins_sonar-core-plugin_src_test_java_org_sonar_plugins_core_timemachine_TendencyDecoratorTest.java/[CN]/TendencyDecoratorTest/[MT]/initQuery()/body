{
  Project project=mock(Project.class);
  when(project.getAnalysisDate()).thenReturn(date("2009-12-25"));
  MetricFinder metricFinder=mock(MetricFinder.class);
  when(metricFinder.findAll()).thenReturn(Arrays.asList(CoreMetrics.LINES,CoreMetrics.COVERAGE,CoreMetrics.COVERAGE_LINE_HITS_DATA,CoreMetrics.PROFILE));
  TendencyDecorator decorator=new TendencyDecorator(null,metricFinder,mock(DefaultIndex.class));
  TimeMachineQuery query=decorator.initQuery(project);
  assertThat(query.getMetrics().size(),is(2));
  assertThat(query.getMetrics(),hasItems(CoreMetrics.LINES,CoreMetrics.COVERAGE));
  assertThat(query.getFrom(),is(date("2009-11-25")));
  assertThat(query.isToCurrentAnalysis(),is(true));
}
