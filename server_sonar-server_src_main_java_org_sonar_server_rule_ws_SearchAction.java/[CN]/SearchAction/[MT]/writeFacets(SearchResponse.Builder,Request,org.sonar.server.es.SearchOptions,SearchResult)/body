{
  addMandatoryFacetValues(results,FACET_LANGUAGES,request.paramAsStrings(PARAM_LANGUAGES));
  addMandatoryFacetValues(results,FACET_REPOSITORIES,request.paramAsStrings(PARAM_REPOSITORIES));
  addMandatoryFacetValues(results,FACET_STATUSES,ALL_STATUSES_EXCEPT_REMOVED);
  addMandatoryFacetValues(results,FACET_SEVERITIES,Severity.ALL);
  addMandatoryFacetValues(results,FACET_ACTIVE_SEVERITIES,Severity.ALL);
  addMandatoryFacetValues(results,FACET_TAGS,request.paramAsStrings(PARAM_TAGS));
  addMandatoryFacetValues(results,FACET_TYPES,RuleType.ALL_NAMES);
  Common.Facet.Builder facet=Common.Facet.newBuilder();
  Common.FacetValue.Builder value=Common.FacetValue.newBuilder();
  for (  String facetName : context.getFacets()) {
    facet.clear().setProperty(facetName);
    Map<String,Long> facets=results.facets.get(facetName);
    if (facets != null) {
      Set<String> itemsFromFacets=Sets.newHashSet();
      for (      Map.Entry<String,Long> facetValue : facets.entrySet()) {
        itemsFromFacets.add(facetValue.getKey());
        facet.addValues(value.clear().setVal(facetValue.getKey()).setCount(facetValue.getValue()));
      }
      addZeroFacetsForSelectedItems(facet,request,facetName,itemsFromFacets);
    }
    response.getFacetsBuilder().addFacets(facet);
  }
}
