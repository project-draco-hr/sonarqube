{
  Logs.INFO.debug("Delivering notification " + notification);
  SetMultimap<String,NotificationChannel> recipients=HashMultimap.create();
  for (  NotificationChannel channel : channels) {
    for (    NotificationDispatcher dispatcher : dispatchers) {
      final Set<String> possibleRecipients=Sets.newHashSet();
      NotificationDispatcher.Context context=new NotificationDispatcher.Context(){
        public void addUser(        String username){
          if (username != null) {
            possibleRecipients.add(username);
          }
        }
      }
;
      try {
        dispatcher.dispatch(notification,context);
      }
 catch (      Exception e) {
        Logs.INFO.warn("Unable to dispatch notification " + notification + " using "+ dispatcher,e);
      }
      for (      String username : possibleRecipients) {
        if (manager.isEnabled(username,channel.getKey(),dispatcher.getKey())) {
          recipients.put(username,channel);
        }
      }
    }
  }
  dispatch(notification,recipients);
}
