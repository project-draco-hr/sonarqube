{
  Event snapshotVersion=mockVersionEvent("1.5-SNAPSHOT");
  Event otherEvent=mockVersionEvent("1.4");
  SensorContext context=mock(SensorContext.class);
  Project project=mock(Project.class);
  when(project.getAnalysisVersion()).thenReturn("1.5");
  when(context.getEvents(project)).thenReturn(Lists.newArrayList(snapshotVersion,otherEvent));
  VersionEventsSensor sensor=new VersionEventsSensor();
  sensor.analyse(project,context);
  verify(context).deleteEvent(snapshotVersion);
  verify(context).createEvent(eq(project),eq("1.5"),(String)isNull(),eq(Event.CATEGORY_VERSION),(Date)isNull());
}
