{
  File basedir=input.fileSystem().baseDir();
  Repository repo=buildRepository(basedir);
  try {
    Git git=Git.wrap(repo);
    File gitBaseDir=repo.getWorkTree();
    ExecutorService executorService=Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors() + 1);
    List<Future<Void>> tasks=submitTasks(input,output,git,gitBaseDir,executorService);
    waitForTaskToComplete(tasks);
  }
  finally {
    repo.close();
  }
}
