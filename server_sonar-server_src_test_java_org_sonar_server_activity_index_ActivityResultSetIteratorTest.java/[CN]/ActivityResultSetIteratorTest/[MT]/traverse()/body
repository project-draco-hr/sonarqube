{
  dbTester.prepareDbUnit(getClass(),"traverse.xml");
  ActivityResultSetIterator it=ActivityResultSetIterator.create(client,connection,0L);
  assertThat(it.hasNext()).isTrue();
  UpdateRequest request=it.next();
  Map<String,Object> doc=request.doc().sourceAsMap();
  assertThat(doc.get(ActivityIndexDefinition.FIELD_KEY)).isEqualTo("UUID1");
  assertThat(doc.get(ActivityIndexDefinition.FIELD_ACTION)).isEqualTo("THE_ACTION");
  assertThat(doc.get(ActivityIndexDefinition.FIELD_MESSAGE)).isEqualTo("THE_MSG");
  assertThat((Map)doc.get(ActivityIndexDefinition.FIELD_DETAILS)).containsOnly(MapEntry.entry("foo","bar"));
  assertThat(doc.get(ActivityIndexDefinition.FIELD_LOGIN)).isEqualTo("THE_AUTHOR");
  assertThat(it.hasNext()).isTrue();
  assertThat(it.next()).isNotNull();
  assertThat(it.hasNext()).isFalse();
  it.close();
  assertThat(it.getMaxRowDate()).isEqualTo(1420066800000L);
}
