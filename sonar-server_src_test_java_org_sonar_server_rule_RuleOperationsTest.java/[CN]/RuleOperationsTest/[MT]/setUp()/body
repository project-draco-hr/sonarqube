{
  when(myBatis.openSession(false)).thenReturn(session);
  when(system.now()).thenReturn(now.getTime());
  doAnswer(new Answer(){
    public Object answer(    InvocationOnMock invocation){
      Object[] args=invocation.getArguments();
      ActiveRuleDto dto=(ActiveRuleDto)args[0];
      dto.setId(currentId++);
      return null;
    }
  }
).when(activeRuleDao).insert(any(ActiveRuleDto.class),any(SqlSession.class));
  operations=new RuleOperations(myBatis,activeRuleDao,ruleDao,ruleTagDao,characteristicDao,ruleTagOperations,esActiveRule,ruleRegistry,system);
}
