{
  RuleDto rule=new RuleDto().setId(10).setNoteCreatedAt(null).setNoteData(null);
  List<RuleParamDto> ruleParams=newArrayList(new RuleParamDto().setId(20).setName("max").setDefaultValue("10"));
  when(ruleDao.selectParametersByRuleId(eq(10),eq(session))).thenReturn(ruleParams);
  operations.updateRuleNote(rule,"My note",authorizedUserSession);
  ArgumentCaptor<RuleDto> argumentCaptor=ArgumentCaptor.forClass(RuleDto.class);
  verify(ruleDao).update(argumentCaptor.capture());
  assertThat(argumentCaptor.getValue().getNoteData()).isEqualTo("My note");
  assertThat(argumentCaptor.getValue().getNoteUserLogin()).isEqualTo("nicolas");
  assertThat(argumentCaptor.getValue().getNoteCreatedAt()).isEqualTo(now);
  assertThat(argumentCaptor.getValue().getNoteUpdatedAt()).isEqualTo(now);
  verify(session).commit();
  verify(ruleRegistry).reindex(eq(rule),eq(session));
}
