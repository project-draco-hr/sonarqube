{
  final int ruleId=24;
  final RuleDto rule=new RuleDto().setId(ruleId);
  final String tag="polop";
  final long tagId=42L;
  when(ruleTagDao.selectId(tag,session)).thenReturn(tagId);
  operations.updateRuleTags(rule,ImmutableList.of(tag),authorizedUserSession);
  verify(ruleTagDao).selectId(tag,session);
  ArgumentCaptor<RuleRuleTagDto> capture=ArgumentCaptor.forClass(RuleRuleTagDto.class);
  verify(ruleDao).insert(capture.capture(),eq(session));
  final RuleRuleTagDto newTag=capture.getValue();
  assertThat(newTag.getRuleId()).isEqualTo(ruleId);
  assertThat(newTag.getTagId()).isEqualTo(tagId);
  assertThat(newTag.getType()).isEqualTo(RuleTagType.ADMIN);
  verify(ruleDao).update(rule,session);
  verify(session).commit();
}
