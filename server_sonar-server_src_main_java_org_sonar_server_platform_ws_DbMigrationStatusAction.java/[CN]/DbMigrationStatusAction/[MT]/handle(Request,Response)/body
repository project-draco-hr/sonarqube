{
  Integer currentVersion=databaseVersion.getVersion();
  JsonWriter json=response.newJsonWriter();
  try {
    if (currentVersion >= DatabaseVersion.LAST_VERSION) {
      write(json,databaseMigration);
    }
 else     if (!database.getDialect().supportsMigration()) {
      writeNotSupportedResponse(json);
    }
 else {
switch (databaseMigration.status()) {
case RUNNING:
case FAILED:
case SUCCEEDED:
        write(json,databaseMigration);
      break;
case NONE:
    writeMigrationRequiredResponse(json);
  break;
default :
throw new IllegalArgumentException(UNSUPPORTED_DATABASE_MIGRATION_STATUS);
}
}
}
  finally {
json.close();
}
}
