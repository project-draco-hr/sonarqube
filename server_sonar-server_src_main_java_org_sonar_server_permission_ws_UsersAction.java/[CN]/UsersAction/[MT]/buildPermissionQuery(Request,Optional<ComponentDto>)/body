{
  String permission=request.mandatoryParam(PARAM_PERMISSION);
  String selected=request.param(Param.SELECTED);
  int page=request.mandatoryParamAsInt(Param.PAGE);
  int pageSize=request.mandatoryParamAsInt(Param.PAGE_SIZE);
  String query=request.param(Param.TEXT_QUERY);
  if (query != null) {
    selected=SelectionMode.ALL.value();
  }
  PermissionQuery.Builder permissionQuery=PermissionQuery.builder().permission(permission).pageIndex(page).pageSize(pageSize).membership(toMembership(firstNonNull(selected,SelectionMode.SELECTED.value())));
  if (query != null) {
    permissionQuery.search(query);
  }
  if (project.isPresent()) {
    permissionQuery.component(project.get().getKey());
  }
  return permissionQuery.build();
}
