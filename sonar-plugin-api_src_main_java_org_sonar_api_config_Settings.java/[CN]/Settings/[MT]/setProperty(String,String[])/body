{
  PropertyDefinition property=getDefinitions().get(key);
  if ((null == property) || (!property.isMultiValues())) {
    throw new IllegalStateException("Fail to set multiple values on a single value property " + key);
  }
  if (values == null) {
    properties.remove(key);
    doOnRemoveProperty(key);
  }
 else {
    List<String> escaped=Lists.newArrayList();
    for (    String value : values) {
      if (null != value) {
        escaped.add(value.replace(",","%2C"));
      }
 else {
        escaped.add("");
      }
    }
    String escapedValue=Joiner.on(',').join(escaped);
    properties.put(key,StringUtils.trim(escapedValue));
    doOnSetProperty(key,escapedValue);
  }
  return this;
}
