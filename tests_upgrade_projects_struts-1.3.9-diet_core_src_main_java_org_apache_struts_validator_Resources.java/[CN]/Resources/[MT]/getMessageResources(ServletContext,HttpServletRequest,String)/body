{
  if (bundle == null) {
    bundle=Globals.MESSAGES_KEY;
  }
  MessageResources resources=(MessageResources)request.getAttribute(bundle);
  if (resources == null) {
    ModuleConfig moduleConfig=ModuleUtils.getInstance().getModuleConfig(request,application);
    resources=(MessageResources)application.getAttribute(bundle + moduleConfig.getPrefix());
  }
  if (resources == null) {
    resources=(MessageResources)application.getAttribute(bundle);
  }
  if (resources == null) {
    throw new NullPointerException("No message resources found for bundle: " + bundle);
  }
  return resources;
}
