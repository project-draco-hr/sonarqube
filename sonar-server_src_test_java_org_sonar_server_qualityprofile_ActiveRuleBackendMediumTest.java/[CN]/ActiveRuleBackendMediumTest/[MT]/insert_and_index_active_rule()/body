{
  QualityProfileDto profileDto=QualityProfileDto.createFor("myprofile","java");
  db.qualityProfileDao().insert(dbSession,profileDto);
  RuleKey ruleKey=RuleKey.of("javascript","S001");
  RuleDto ruleDto=newRuleDto(ruleKey);
  db.ruleDao().insert(dbSession,ruleDto);
  ActiveRuleDto activeRule=ActiveRuleDto.createFor(profileDto,ruleDto).setInheritance(ActiveRule.Inheritance.INHERIT.name()).setSeverity(Severity.BLOCKER);
  db.activeRuleDao().insert(dbSession,activeRule);
  dbSession.commit();
  assertThat(db.activeRuleDao().getByKey(dbSession,activeRule.getKey())).isNotNull();
  List<ActiveRuleDto> persistedDtos=db.activeRuleDao().findByRule(dbSession,ruleDto);
  assertThat(persistedDtos).hasSize(1);
  ActiveRule hit=index.getByKey(activeRule.getKey());
  assertThat(hit).isNotNull();
  assertThat(hit.key()).isEqualTo(activeRule.getKey());
  assertThat(hit.inheritance().name()).isEqualTo(activeRule.getInheritance());
  assertThat(hit.parentKey()).isEqualTo(activeRule.getParentId());
  assertThat(hit.severity()).isEqualTo(activeRule.getSeverityString());
}
