{
  QualityProfileDto profileDto1=QualityProfileDto.createFor("p1","java");
  QualityProfileDto profileDto2=QualityProfileDto.createFor("p2","java");
  db.qualityProfileDao().insert(dbSession,profileDto1,profileDto2);
  RuleKey ruleKey=RuleKey.of("javascript","S001");
  RuleDto ruleDto=newRuleDto(ruleKey);
  db.ruleDao().insert(dbSession,ruleDto);
  ActiveRuleDto activeRule1=ActiveRuleDto.createFor(profileDto1,ruleDto).setSeverity(Severity.MAJOR);
  ActiveRuleDto activeRule2=ActiveRuleDto.createFor(profileDto2,ruleDto).setSeverity(Severity.MAJOR);
  db.activeRuleDao().insert(dbSession,activeRule1,activeRule2);
  dbSession.commit();
  assertThat(index.countAll()).isEqualTo(2);
  assertThat(index.countByQualityProfileKey(profileDto1.getKey())).isEqualTo(1);
}
