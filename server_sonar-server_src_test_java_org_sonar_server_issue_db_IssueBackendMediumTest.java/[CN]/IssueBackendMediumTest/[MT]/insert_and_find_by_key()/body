{
  RuleDto rule=RuleTesting.newXooX1();
  tester.get(RuleDao.class).insert(dbSession,rule);
  ComponentDto project=new ComponentDto().setId(1L).setProjectId(1L);
  tester.get(ComponentDao.class).insert(dbSession,project);
  ComponentDto resource=new ComponentDto().setProjectId(1L).setId(2L);
  tester.get(ComponentDao.class).insert(dbSession,resource);
  IssueDto issue=new IssueDto().setId(1L).setRuleId(50).setComponentId(123l).setRootComponentId(100l).setRuleId(rule.getId()).setRootComponentId(project.getId()).setComponentId(resource.getId()).setStatus("OPEN").setResolution("OPEN").setKee(UUID.randomUUID().toString());
  dbClient.issueDao().insert(dbSession,issue);
  dbSession.commit();
  assertThat(issue.getId()).isNotNull();
  assertThat(indexClient.get(IssueIndex.class).countAll()).isEqualTo(1);
  IssueDoc issueDoc=indexClient.get(IssueIndex.class).getByKey(issue.getKey());
  assertThat(issueDoc).isNotNull();
  assertThat(issueDoc.key()).isEqualTo(issue.getKey());
}
