{
  RuleDto rule=RuleTesting.newXooX1();
  tester.get(RuleDao.class).insert(dbSession,rule);
  ComponentDto project=ComponentTesting.newProjectDto();
  tester.get(ComponentDao.class).insert(dbSession,project);
  ComponentDto file=ComponentTesting.newFileDto(project);
  tester.get(ComponentDao.class).insert(dbSession,file);
  IssueDto issue=IssueTesting.newDto(rule,file,project).setId(1L);
  dbClient.issueDao().insert(dbSession,issue);
  dbSession.commit();
  assertThat(issue.getId()).isNotNull();
  Date t0=new Date(0);
  assertThat(dbClient.issueDao().findAfterDate(dbSession,t0)).hasSize(1);
  Date t1=new Date();
  assertThat(dbClient.issueDao().findAfterDate(dbSession,t1)).hasSize(0);
  tester.clearIndexes();
  assertThat(indexClient.get(IssueIndex.class).countAll()).isEqualTo(0);
  tester.get(Platform.class).executeStartupTasks();
  assertThat(indexClient.get(IssueIndex.class).countAll()).isEqualTo(1);
}
