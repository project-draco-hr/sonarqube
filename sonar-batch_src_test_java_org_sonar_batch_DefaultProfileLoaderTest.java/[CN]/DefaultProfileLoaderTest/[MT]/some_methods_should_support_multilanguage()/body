{
  Settings settings=new Settings();
  settings.setProperty("sonar.profile.java","java profile");
  settings.setProperty("sonar.profile.cobol","cobol profile");
  RulesProfile javaProfile=RulesProfile.create("java profile","java");
  org.sonar.api.rules.Rule javaRule=new org.sonar.api.rules.Rule("javaplugin","javarule");
  ActiveRule javaActiveRule=new ActiveRule(javaProfile,javaRule,RulePriority.BLOCKER);
  javaProfile.addActiveRule(javaActiveRule);
  Alert javaAlert=mock(Alert.class);
  javaProfile.setAlerts(Arrays.asList(javaAlert));
  when(dao.getProfile(Java.KEY,"java profile")).thenReturn(javaProfile);
  RulesProfile cobolProfile=RulesProfile.create("cobol profile","cobol");
  org.sonar.api.rules.Rule cobolRule=new org.sonar.api.rules.Rule("cobolplugin","cobolrule");
  ActiveRule cobolActiveRule=new ActiveRule(cobolProfile,cobolRule,RulePriority.BLOCKER);
  cobolProfile.addActiveRule(cobolActiveRule);
  Alert cobolAlert=mock(Alert.class);
  cobolProfile.setAlerts(Arrays.asList(cobolAlert));
  when(dao.getProfile("cobol","cobol profile")).thenReturn(cobolProfile);
  DefaultModuleLanguages moduleLanguages=new DefaultModuleLanguages(settings,languages);
  RulesProfile profile=new DefaultProfileLoader(dao,moduleLanguages,languages).load(javaProject,settings);
  moduleLanguages.addLanguage("java");
  moduleLanguages.addLanguage("cobol");
  assertThat(profile.getActiveRules()).containsOnly(javaActiveRule,cobolActiveRule);
  assertThat(profile.getActiveRules(true)).containsOnly(javaActiveRule,cobolActiveRule);
  assertThat(profile.getActiveRulesByRepository("javaplugin")).containsOnly(javaActiveRule);
  assertThat(profile.getActiveRulesByRepository("cobolplugin")).containsOnly(cobolActiveRule);
  assertThat(profile.getActiveRule("javaplugin","javarule")).isEqualTo(javaActiveRule);
  assertThat(profile.getActiveRule(javaRule)).isEqualTo(javaActiveRule);
  assertThat(profile.getActiveRule("cobolplugin","cobolrule")).isEqualTo(cobolActiveRule);
  assertThat(profile.getActiveRule(cobolRule)).isEqualTo(cobolActiveRule);
  assertThat(profile.getAlerts()).containsOnly(javaAlert,cobolAlert);
  assertThat(profile.getLanguage()).isEqualTo("");
}
