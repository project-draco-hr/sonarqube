{
  DbSession session=dbClient.openSession(true);
  try {
    TestDepthTraversalTypeAwareVisitor visitor=new TestDepthTraversalTypeAwareVisitor(context,session,dbComponentsRefCache);
    visitor.visit(context.getRoot());
    session.commit();
    if (visitor.hasUnprocessedCoverageDetails) {
      String projectKey=dbComponentsRefCache.getByRef(reportReader.readMetadata().getRootComponentRef()).getKey();
      LOG.warn("Some coverage tests are not taken into account during analysis of project '{}'",projectKey);
    }
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
