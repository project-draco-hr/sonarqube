{
  ServerPluginJarsInstaller deployer=mock(ServerPluginJarsInstaller.class);
  File pluginFile=new File(Resources.getResource("org/sonar/server/plugins/ServerPluginRepositoryTest/sonar-artifact-size-plugin-0.2.jar").toURI());
  PluginMetadata plugin=DefaultPluginMetadata.create(pluginFile).setKey("artifactsize").setMainClass("org.sonar.plugins.artifactsize.ArtifactSizePlugin").addDeployedFile(pluginFile);
  when(deployer.getMetadata()).thenReturn(Arrays.asList(plugin));
  repository=new ServerPluginRepository(deployer);
  repository.start();
  assertThat(repository.getPlugin("artifactsize")).isNotNull();
  assertThat(repository.getClassLoader("artifactsize")).isNotNull();
  assertThat(repository.getClass("artifactsize","org.sonar.plugins.artifactsize.ArtifactSizeMetrics")).isNotNull();
  assertThat(repository.getClass("artifactsize","org.Unknown")).isNull();
  assertThat(repository.getClass("other","org.sonar.plugins.artifactsize.ArtifactSizeMetrics")).isNull();
}
