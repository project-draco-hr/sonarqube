{
  ByteSource bs=mock(ByteSource.class);
  when(wsLoader.loadSource("/batch/issues?key=foo")).thenReturn(new WSLoaderResult<>(bs,true));
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  ServerIssue.newBuilder().setKey("ab1").build().writeDelimitedTo(bos);
  ServerIssue.newBuilder().setKey("ab2").build().writeDelimitedTo(bos);
  when(bs.openBufferedStream()).thenReturn(new ByteArrayInputStream(bos.toByteArray()));
  final List<ServerIssue> result=new ArrayList<>();
  loader.load("foo",new Function<BatchInput.ServerIssue,Void>(){
    @Override public Void apply(    ServerIssue input){
      result.add(input);
      return null;
    }
  }
);
  assertThat(result).extracting("key").containsExactly("ab1","ab2");
}
