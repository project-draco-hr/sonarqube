{
  InputSupplier<InputStream> is=mock(InputSupplier.class);
  when(serverClient.doRequest("/batch/issues?key=foo","GET",null)).thenReturn(is);
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  ServerIssue.newBuilder().setKey("ab1").build().writeDelimitedTo(bos);
  ServerIssue.newBuilder().setKey("ab2").build().writeDelimitedTo(bos);
  when(is.getInput()).thenReturn(new ByteArrayInputStream(bos.toByteArray()));
  final List<ServerIssue> result=new ArrayList<>();
  loader.load("foo",new Function<BatchInput.ServerIssue,Void>(){
    @Override public Void apply(    ServerIssue input){
      result.add(input);
      return null;
    }
  }
,false);
  assertThat(result).extracting("key").containsExactly("ab1","ab2");
}
