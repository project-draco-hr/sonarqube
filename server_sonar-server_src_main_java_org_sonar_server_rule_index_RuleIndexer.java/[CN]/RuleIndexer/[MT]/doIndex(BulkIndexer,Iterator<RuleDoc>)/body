{
  bulk.start();
  long maxDate=0L;
  while (rules.hasNext()) {
    RuleDoc rule=rules.next();
    bulk.add(newUpsertRequest(rule));
    maxDate=Math.max(maxDate,rule.updatedAtAtAsLong());
  }
  bulk.stop();
  return maxDate;
}
