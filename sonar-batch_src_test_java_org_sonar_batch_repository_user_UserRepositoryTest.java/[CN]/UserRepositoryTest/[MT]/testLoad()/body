{
  ServerClient serverClient=mock(ServerClient.class);
  UserRepository userRepo=new UserRepository(serverClient);
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  BatchInput.User.Builder builder=BatchInput.User.newBuilder();
  builder.setLogin("fmallet").setName("Freddy Mallet").build().writeDelimitedTo(out);
  builder.setLogin("sbrandhof").setName("Simon").build().writeDelimitedTo(out);
  InputSupplier<InputStream> is=mock(InputSupplier.class);
  when(serverClient.doRequest("/batch/users?logins=fmallet,sbrandhof","GET",null)).thenReturn(is);
  when(is.getInput()).thenReturn(new ByteArrayInputStream(out.toByteArray()));
  assertThat(userRepo.loadFromWs(Arrays.asList("fmallet","sbrandhof"))).extracting("login","name").containsOnly(tuple("fmallet","Freddy Mallet"),tuple("sbrandhof","Simon"));
}
