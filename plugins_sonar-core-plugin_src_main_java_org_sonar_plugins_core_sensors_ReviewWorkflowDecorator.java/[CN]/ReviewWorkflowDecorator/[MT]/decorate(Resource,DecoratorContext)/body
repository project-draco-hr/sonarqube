{
  Snapshot snapshot=resourcePersister.getSnapshot(resource);
  if (snapshot != null) {
    Collection<ReviewDto> openReviews=reviewDao.selectOpenByResourceId(snapshot.getResourceId());
    Set<ReviewDto> updated=Sets.newHashSet();
    if (!openReviews.isEmpty()) {
      closeResolvedStandardViolations(openReviews,context.getViolations(),context.getProject(),resource,updated);
      closeResolvedManualViolations(openReviews,context.getProject(),resource,updated);
      reopenUnresolvedViolations(openReviews,context.getProject(),resource,updated);
      updateReviewInformation(openReviews,context.getViolations(),updated);
    }
    if (ResourceUtils.isRootProject(resource)) {
      closeReviewsOnDeletedResources((Project)resource,snapshot.getResourceId(),snapshot.getId(),updated);
    }
    persistUpdates(updated);
  }
}
