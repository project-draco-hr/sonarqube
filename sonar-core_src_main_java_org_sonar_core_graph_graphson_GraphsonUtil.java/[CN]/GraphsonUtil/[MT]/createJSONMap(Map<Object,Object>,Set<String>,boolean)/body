{
  JSONObject jsonMap=new JSONObject();
  for (  Map.Entry<Object,Object> entry : map.entrySet()) {
    Object value=entry.getValue();
    if (value != null) {
      if (value instanceof List) {
        value=createJSONList((List)value,propertyKeys,showTypes);
      }
 else       if (value instanceof Map) {
        value=createJSONMap((Map)value,propertyKeys,showTypes);
      }
 else       if (value instanceof Element) {
        value=jsonFromElement((Element)value,propertyKeys,showTypes ? GraphsonMode.EXTENDED : GraphsonMode.NORMAL);
      }
 else       if (value.getClass().isArray()) {
        value=createJSONList(convertArrayToList(value),propertyKeys,showTypes);
      }
    }
    putObject(jsonMap,entry.getKey().toString(),getValue(value,showTypes));
  }
  return jsonMap;
}
