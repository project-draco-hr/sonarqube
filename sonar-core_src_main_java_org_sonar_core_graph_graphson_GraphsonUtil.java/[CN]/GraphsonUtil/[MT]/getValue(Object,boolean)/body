{
  Object returnValue=value;
  if (includeType) {
    String type=determineType(value);
    JSONObject valueAndType=new JSONObject();
    valueAndType.put(GraphsonTokens.TYPE,type);
    if (type.equals(GraphsonTokens.TYPE_LIST)) {
      JSONArray list=(JSONArray)value;
      JSONArray valueArray=new JSONArray();
      valueAndType.put(GraphsonTokens.VALUE,valueArray);
      for (int ix=0; ix < list.size(); ix++) {
        addObject(valueArray,getValue(list.get(ix),includeType));
      }
    }
 else     if (type.equals(GraphsonTokens.TYPE_MAP)) {
      JSONObject convertedMap=new JSONObject();
      JSONObject jsonObject=(JSONObject)value;
      Map<Object,Object> jsonObjectMap=jsonObject;
      for (      Map.Entry<Object,Object> entry : jsonObjectMap.entrySet()) {
        convertedMap.put(entry.getKey(),entry.getValue());
      }
      valueAndType.put(GraphsonTokens.VALUE,convertedMap);
    }
 else {
      putObject(valueAndType,GraphsonTokens.VALUE,value);
    }
    returnValue=valueAndType;
  }
  return returnValue;
}
