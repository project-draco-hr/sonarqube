{
  if (cache == null) {
    PersistentCacheBuilder builder=new PersistentCacheBuilder(new Slf4jLogger());
    String projectKey=key.get();
    String home=props.property("sonar.userHome");
    String serverUrl=getServerUrl(props);
    if (home != null) {
      builder.setSonarHome(Paths.get(home));
    }
    if (mode.isNotAssociated()) {
      builder.setAreaForLocalProject(serverUrl,BatchUtils.getServerVersion());
    }
 else {
      Preconditions.checkNotNull(projectKey);
      builder.setAreaForProject(serverUrl,BatchUtils.getServerVersion(),projectKey);
    }
    cache=builder.build();
  }
  return cache;
}
