{
  ServerMetadata server=mock(ServerMetadata.class);
  when(server.getURL()).thenReturn("http://sonar:8000");
  HttpDownloader httpDownloader=mock(HttpDownloader.class);
  TempDirectories workingDirectories=new TempDirectories();
  ExtensionDownloader downloader=new ExtensionDownloader(httpDownloader,workingDirectories,server);
  JpaPluginFile extension=new JpaPluginFile(new JpaPlugin("findbugs"),"bcel.jar");
  File bcel=downloader.downloadExtension(extension);
  assertNotNull(bcel);
  verify(httpDownloader).download(new URI("http://sonar:8000/deploy/plugins/findbugs/bcel.jar"),bcel);
}
