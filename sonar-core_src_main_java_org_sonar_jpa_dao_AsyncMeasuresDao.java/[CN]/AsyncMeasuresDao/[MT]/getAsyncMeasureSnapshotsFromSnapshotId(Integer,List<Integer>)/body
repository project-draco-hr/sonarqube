{
  Query query=getSession().createQuery("SELECT ams FROM AsyncMeasureSnapshot ams " + "WHERE ams.snapshotId=:snapshotId " + (!metricIdsToExclude.isEmpty() ? "AND ams.metricId NOT IN (:metricIdsToExclude) " : "") + "ORDER BY ams.measureDate ASC").setParameter("snapshotId",snapshotId);
  if (!metricIdsToExclude.isEmpty()) {
    query.setParameter("metricIdsToExclude",metricIdsToExclude);
  }
  return query.getResultList();
}
