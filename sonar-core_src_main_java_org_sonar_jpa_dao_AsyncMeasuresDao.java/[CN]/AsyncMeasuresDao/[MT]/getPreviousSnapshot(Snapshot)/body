{
  try {
    return (Snapshot)getSession().createQuery("SELECT s FROM Snapshot s " + "WHERE s.createdAt<:date " + "AND s.scope=:scope "+ "AND s.resourceId=:resourceId "+ "ORDER BY s.createdAt DESC").setParameter("date",s.getCreatedAt()).setParameter("scope",s.getScope()).setParameter("resourceId",s.getResourceId()).setMaxResults(1).getSingleResult();
  }
 catch (  NoResultException ex) {
    return null;
  }
}
