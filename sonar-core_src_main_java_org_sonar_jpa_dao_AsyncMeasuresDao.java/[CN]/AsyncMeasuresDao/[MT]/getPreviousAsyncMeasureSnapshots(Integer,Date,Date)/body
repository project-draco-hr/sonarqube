{
  Query query=getSession().createQuery("SELECT ams FROM AsyncMeasureSnapshot ams " + "WHERE ams.projectId=:projectId " + "AND ams.measureDate<=:endDate " + (beginDate != null ? "AND ams.measureDate>:beginDate " : "") + "AND ams.snapshotId IS NULL "+ "ORDER BY ams.measureDate ASC").setParameter("projectId",projectId).setParameter("endDate",endDate);
  if (beginDate != null) {
    query.setParameter("beginDate",beginDate);
  }
  return query.getResultList();
}
