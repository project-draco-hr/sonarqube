{
  Query query=getSession().createQuery("SELECT ams FROM AsyncMeasureSnapshot ams " + "WHERE ams.projectId=:projectId " + "AND ams.metricId=:metricId " + (endDate != null ? "AND ams.measureDate<:endDate " : "") + "AND ams.snapshotDate>=:measureDate "+ "ORDER BY ams.snapshotDate ASC ").setParameter("projectId",asyncMeasure.getProjectId()).setParameter("metricId",asyncMeasure.getMetric().getId()).setParameter("measureDate",asyncMeasure.getMeasureDate());
  if (endDate != null) {
    query.setParameter("endDate",endDate);
  }
  return query.getResultList();
}
