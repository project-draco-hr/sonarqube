{
  if (context.getMeasure(CoreMetrics.VIOLATIONS) == null) {
    Collection<Measure> children=context.getChildrenMeasures(MeasuresFilters.rules(CoreMetrics.VIOLATIONS));
    for (    Measure childMeasure : children) {
      RuleMeasure childRuleMeasure=(RuleMeasure)childMeasure;
      Rule rule=childRuleMeasure.getRule();
      if (rule != null && MeasureUtils.hasValue(childRuleMeasure)) {
        rules.add(rule,childRuleMeasure.getValue().intValue());
        ruleToSeverity.put(childRuleMeasure.getRule(),childRuleMeasure.getRulePriority());
      }
    }
    for (    Multiset.Entry<Rule> entry : rules.entrySet()) {
      Rule rule=entry.getElement();
      RuleMeasure measure=RuleMeasure.createForRule(CoreMetrics.VIOLATIONS,rule,(double)entry.getCount());
      measure.setRulePriority(ruleToSeverity.get(rule));
      context.saveMeasure(measure);
    }
  }
}
