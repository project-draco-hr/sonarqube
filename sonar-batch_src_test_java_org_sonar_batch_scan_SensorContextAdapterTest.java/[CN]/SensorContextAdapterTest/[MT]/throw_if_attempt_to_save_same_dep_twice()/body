{
  File foo=File.create("src/Foo.java");
  File bar=File.create("src/Bar.java");
  when(sensorContext.getResource(foo)).thenReturn(foo);
  when(sensorContext.getResource(bar)).thenReturn(bar);
  when(sonarIndex.getEdge(foo,bar)).thenReturn(new Dependency(foo,bar));
  thrown.expect(IllegalStateException.class);
  thrown.expectMessage("Dependency between [moduleKey=foo, relative=src/Foo.java, abs=null] and [moduleKey=foo, relative=src/Bar.java, abs=null] was already saved.");
  adaptor.store(new DefaultDependency().from(new DefaultInputFile("foo","src/Foo.java").setType(Type.MAIN)).to(new DefaultInputFile("foo","src/Bar.java").setType(Type.MAIN)).weight(3));
}
