{
  if (componentIds.isEmpty()) {
    return Collections.emptySet();
  }
  String sql;
  Map<String,Object> params;
  List<List<Integer>> componentIdsPartition=Lists.partition(newArrayList(componentIds),1000);
  if (userId == null) {
    sql="keepAuthorizedComponentIdsForAnonymous";
    params=ImmutableMap.of("role",role,"componentIds",componentIdsPartition);
  }
 else {
    sql="keepAuthorizedComponentIdsForUser";
    params=ImmutableMap.of("userId",userId,"role",role,"componentIds",componentIdsPartition);
  }
  return Sets.newHashSet(session.<Integer>selectList(sql,params));
}
