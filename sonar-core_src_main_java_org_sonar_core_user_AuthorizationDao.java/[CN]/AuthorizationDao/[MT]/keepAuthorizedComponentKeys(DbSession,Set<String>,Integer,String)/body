{
  if (componentKeys.isEmpty()) {
    return Collections.emptySet();
  }
  return Sets.newHashSet(DaoUtils.executeLargeInputs(componentKeys,new Function<List<String>,List<String>>(){
    @Override public List<String> apply(    List<String> partition){
      if (userId == null) {
        return session.getMapper(AuthorizationMapper.class).keepAuthorizedComponentKeysForAnonymous(role,componentKeys);
      }
 else {
        return session.getMapper(AuthorizationMapper.class).keepAuthorizedComponentKeysForUser(userId,role,componentKeys);
      }
    }
  }
));
}
