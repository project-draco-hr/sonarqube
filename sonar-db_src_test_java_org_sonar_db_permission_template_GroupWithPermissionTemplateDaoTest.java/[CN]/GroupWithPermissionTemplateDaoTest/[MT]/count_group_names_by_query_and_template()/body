{
  GroupDto group1=groupDb.insertGroup(newGroupDto().setName("Group-1"));
  GroupDto group2=groupDb.insertGroup(newGroupDto().setName("Group-2"));
  GroupDto group3=groupDb.insertGroup(newGroupDto().setName("Group-3"));
  PermissionTemplateDto template=permissionTemplateDbTester.insertTemplate();
  permissionTemplateDbTester.addGroupToTemplate(template.getId(),group1.getId(),USER);
  permissionTemplateDbTester.addGroupToTemplate(template.getId(),group1.getId(),ADMIN);
  permissionTemplateDbTester.addGroupToTemplate(template.getId(),group2.getId(),PROVISIONING);
  PermissionTemplateDto anotherTemplate=permissionTemplateDbTester.insertTemplate();
  permissionTemplateDbTester.addGroupToTemplate(anotherTemplate.getId(),null,USER);
  permissionTemplateDbTester.addGroupToTemplate(anotherTemplate.getId(),group1.getId(),PROVISIONING);
  assertThat(countGroupNamesByQueryAndTemplate(builder().build(),template.getId())).isEqualTo(4);
  assertThat(countGroupNamesByQueryAndTemplate(builder().withAtLeastOnePermission().build(),template.getId())).isEqualTo(2);
  assertThat(countGroupNamesByQueryAndTemplate(builder().setPermission(USER).build(),template.getId())).isEqualTo(1);
  assertThat(countGroupNamesByQueryAndTemplate(builder().setPermission(USER).build(),anotherTemplate.getId())).isEqualTo(1);
  assertThat(countGroupNamesByQueryAndTemplate(builder().setSearchQuery("groU").build(),template.getId())).isEqualTo(3);
  assertThat(countGroupNamesByQueryAndTemplate(builder().setSearchQuery("nYo").build(),template.getId())).isEqualTo(1);
  assertThat(countGroupNamesByQueryAndTemplate(builder().setSearchQuery("p-2").build(),template.getId())).isEqualTo(1);
  assertThat(countGroupNamesByQueryAndTemplate(builder().withAtLeastOnePermission().build(),123L)).isZero();
  assertThat(countGroupNamesByQueryAndTemplate(builder().setSearchQuery("unknown").build(),template.getId())).isZero();
}
