{
  String projectKey="org.codehaus.sonar:sonar";
  ProjectRepository projectReferentials=mock(ProjectRepository.class);
  when(projectReferentials.toJson()).thenReturn("{\"settingsByModule\": {}}");
  ArgumentCaptor<ProjectRepositoryQuery> queryArgumentCaptor=ArgumentCaptor.forClass(ProjectRepositoryQuery.class);
  when(projectRepositoryLoader.load(queryArgumentCaptor.capture())).thenReturn(projectReferentials);
  WsTester.TestRequest request=tester.newGetRequest("batch","project").setParam("key",projectKey).setParam("profile","Default").setParam("preview","false");
  request.execute().assertJson("{\"settingsByModule\": {}}");
  assertThat(queryArgumentCaptor.getValue().getModuleKey()).isEqualTo(projectKey);
  assertThat(queryArgumentCaptor.getValue().getProfileName()).isEqualTo("Default");
  assertThat(queryArgumentCaptor.getValue().isPreview()).isFalse();
}
