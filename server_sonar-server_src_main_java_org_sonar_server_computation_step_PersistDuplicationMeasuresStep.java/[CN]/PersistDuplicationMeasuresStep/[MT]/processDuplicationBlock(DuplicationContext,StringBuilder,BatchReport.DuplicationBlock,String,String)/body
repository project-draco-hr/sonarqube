{
  if (duplicationBlock.hasComponentKey()) {
    String crossProjectComponentKey=duplicationBlock.getComponentKey();
    appendDuplication(xml,crossProjectComponentKey,duplicationBlock);
  }
 else {
    String branch=duplicationContext.context().getReportMetadata().getBranch();
    if (duplicationBlock.hasOtherComponentRef()) {
      BatchReport.Component duplicationComponent=duplicationContext.context().getReportReader().readComponent(duplicationBlock.getOtherComponentRef());
      appendDuplication(xml,ComponentKeys.createKey(parentComponentKey,duplicationComponent.getPath(),branch),duplicationBlock);
    }
 else {
      appendDuplication(xml,ComponentKeys.createKey(parentComponentKey,componentPath,branch),duplicationBlock);
    }
  }
}
