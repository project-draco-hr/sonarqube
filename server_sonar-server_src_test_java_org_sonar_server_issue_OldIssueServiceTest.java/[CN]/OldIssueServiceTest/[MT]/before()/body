{
  userSession=MockUserSession.set().setLogin("arthur").setUserId(10).setGlobalPermissions(GlobalPermissions.SYSTEM_ADMIN).addProjectPermissions(UserRole.USER,project.getKey()).addProjectPermissions(UserRole.ISSUE_ADMIN,project.getKey());
  when(authorizationDao.isAuthorizedComponentKey(anyString(),eq(10),anyString())).thenReturn(true);
  when(finder.find(any(IssueQuery.class))).thenReturn(issueQueryResult);
  when(issueQueryResult.issues()).thenReturn(newArrayList((Issue)issue));
  when(issueQueryResult.first()).thenReturn(issue);
  when(resource.getKey()).thenReturn("org.sonar.Sample");
  when(project.getKey()).thenReturn("Sample");
  issueService=new OldIssueService(finder,workflow,issueStorage,issueUpdater,issueNotifications,actionPlanService,ruleFinder,resourceDao,issueDao,authorizationDao,userFinder,mock(PreviewCache.class));
}
