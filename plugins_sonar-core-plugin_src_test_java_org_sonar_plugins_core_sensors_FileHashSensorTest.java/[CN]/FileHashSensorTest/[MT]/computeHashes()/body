{
  File baseDir=temp.newFolder();
  File file1=new File(baseDir,"src/com/foo/Bar.java");
  FileUtils.write(file1,"Bar",Charsets.UTF_8);
  when(fileHashCache.getCurrentHash(file1,Charsets.UTF_8)).thenReturn("barhash");
  File file2=new File(baseDir,"src/com/foo/Foo.java");
  FileUtils.write(file2,"Foo",Charsets.UTF_8);
  when(fileHashCache.getCurrentHash(file2,Charsets.UTF_8)).thenReturn("foohash");
  when(fileSystem.baseDir()).thenReturn(baseDir);
  when(fileSystem.files(any(FileQuery.class))).thenReturn(Arrays.asList(file1,file2)).thenReturn(Collections.<File>emptyList());
  sensor.analyse(project,mock(SensorContext.class));
  verify(componentDataCache).setStringData("java_project","hash","src/com/foo/Bar.java=barhash\n" + "src/com/foo/Foo.java=foohash\n");
}
