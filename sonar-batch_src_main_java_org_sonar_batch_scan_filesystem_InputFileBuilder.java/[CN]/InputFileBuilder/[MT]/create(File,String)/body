{
  String relativePath=pathResolver.relativePath(fs.baseDir(),file);
  if (relativePath == null) {
    throw MessageException.of(String.format("File '%s' is ignored. It is not in module basedir '%s'.",file.getAbsolutePath(),fs.baseDir()));
  }
  DefaultInputFile inputFile=DefaultInputFile.create(file,fs.sourceCharset(),relativePath,Maps.<String,String>newHashMap());
  inputFile.setType(type);
  inputFile.setKey(moduleKey + ":" + inputFile.path());
  String lang=langDetection.language(inputFile);
  if (lang == null) {
    return null;
  }
  inputFile.setLanguage(lang);
  FileMetadata.Metadata metadata=FileMetadata.INSTANCE.read(inputFile.file(),fs.sourceCharset());
  inputFile.setLines(metadata.lines);
  inputFile.setHash(metadata.hash);
  inputFile.setStatus(statusDetection.status(inputFile.path(),metadata.hash));
  fillDeprecatedData(inputFile);
  return inputFile;
}
