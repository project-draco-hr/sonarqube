{
  StringBuilder hql=new StringBuilder().append("from ").append(Rule.class.getSimpleName()).append(" where status<>:status ");
  Map<String,Object> params=new HashMap<>();
  params.put("status",Rule.STATUS_REMOVED);
  if (StringUtils.isNotBlank(query.getRepositoryKey())) {
    hql.append("AND pluginName=:repositoryKey ");
    params.put("repositoryKey",query.getRepositoryKey());
  }
  if (StringUtils.isNotBlank(query.getKey())) {
    hql.append("AND key=:key ");
    params.put("key",query.getKey());
  }
  if (StringUtils.isNotBlank(query.getConfigKey())) {
    hql.append("AND configKey=:configKey ");
    params.put("configKey",query.getConfigKey());
  }
  Query hqlQuery=session.createQuery(hql.toString());
  for (  Map.Entry<String,Object> entry : params.entrySet()) {
    hqlQuery.setParameter(entry.getKey(),entry.getValue());
  }
  return hqlQuery;
}
