{
  if (properties.containsKey(PROPERTY_MODULES)) {
    checkMandatoryProperties(properties,MANDATORY_PROPERTIES_FOR_MULTIMODULE_PROJECT);
  }
 else {
    checkMandatoryProperties(properties,MANDATORY_PROPERTIES_FOR_SIMPLE_PROJECT);
  }
  File baseDir=new File(properties.getProperty(PROPERTY_PROJECT_BASEDIR));
  final String projectKey=properties.getProperty(CoreProperties.PROJECT_KEY_PROPERTY);
  File workDir;
  if (parent == null) {
    validateDirectories(properties,baseDir,projectKey);
    workDir=initRootProjectWorkDir(baseDir);
  }
 else {
    workDir=initModuleWorkDir(baseDir,properties);
  }
  return ProjectDefinition.create().setProperties(properties).setBaseDir(baseDir).setWorkDir(workDir).setBuildDir(initModuleBuildDir(baseDir,properties));
}
