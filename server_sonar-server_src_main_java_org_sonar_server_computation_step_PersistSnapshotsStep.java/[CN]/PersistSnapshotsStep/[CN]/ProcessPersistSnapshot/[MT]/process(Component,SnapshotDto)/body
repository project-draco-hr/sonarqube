{
  long componentId=dbIdsRepository.getComponentId(component);
switch (component.getType()) {
case PROJECT:
    this.projectId=componentId;
  SnapshotDto projectSnapshot=persistSnapshot(componentId,Qualifiers.PROJECT,Scopes.PROJECT,component.getReportAttributes().getVersion(),parentSnapshot,true);
addToCache(component,projectSnapshot);
processChildren(component,projectSnapshot);
break;
case MODULE:
SnapshotDto moduleSnapshot=persistSnapshot(componentId,Qualifiers.MODULE,Scopes.PROJECT,component.getReportAttributes().getVersion(),parentSnapshot,true);
addToCache(component,moduleSnapshot);
processChildren(component,moduleSnapshot);
break;
case DIRECTORY:
SnapshotDto directorySnapshot=persistSnapshot(componentId,Qualifiers.DIRECTORY,Scopes.DIRECTORY,null,parentSnapshot,false);
addToCache(component,directorySnapshot);
processChildren(component,directorySnapshot);
break;
case FILE:
SnapshotDto fileSnapshot=persistSnapshot(componentId,getFileQualifier(component),Scopes.FILE,null,parentSnapshot,false);
addToCache(component,fileSnapshot);
break;
default :
throw new IllegalStateException(String.format("Unsupported component type '%s'",component.getType()));
}
}
