{
  SnapshotDto snapshotDto=new SnapshotDto().setRootProjectId(projectId).setVersion(version).setComponentId(componentId).setQualifier(qualifier).setScope(scope).setLast(false).setStatus(SnapshotDto.STATUS_UNPROCESSED).setCreatedAt(analysisDate).setBuildDate(system2.now());
  if (parentSnapshot != null) {
    snapshotDto.setParentId(parentSnapshot.getId()).setRootId(parentSnapshot.getRootId() == null ? parentSnapshot.getId() : parentSnapshot.getRootId()).setDepth(parentSnapshot.getDepth() + 1).setPath(parentSnapshot.getPath() + parentSnapshot.getId() + ".");
  }
 else {
    snapshotDto.setPath("").setDepth(0);
  }
  dbClient.snapshotDao().insert(dbSession,snapshotDto);
  return snapshotDto;
}
