{
  long componentId=dbIdsRepository.getComponentId(component);
  SnapshotDto snapshotDto=new SnapshotDto().setRootProjectId(rootId).setVersion(setVersion ? component.getReportAttributes().getVersion() : null).setComponentId(componentId).setQualifier(qualifier).setScope(scope).setLast(false).setStatus(SnapshotDto.STATUS_UNPROCESSED).setCreatedAt(analysisDate).setBuildDate(system2.now());
  if (setPeriods) {
    updateSnapshotPeriods(snapshotDto);
  }
  SnapshotDto parentSnapshot=path.isRoot() ? null : path.parent().getSnapshotDto();
  if (parentSnapshot != null) {
    snapshotDto.setParentId(parentSnapshot.getId()).setRootId(parentSnapshot.getRootId() == null ? parentSnapshot.getId() : parentSnapshot.getRootId()).setDepth(parentSnapshot.getDepth() + 1).setPath(parentSnapshot.getPath() + parentSnapshot.getId() + ".");
  }
 else {
    snapshotDto.setPath("").setDepth(0);
  }
  return snapshotDto;
}
