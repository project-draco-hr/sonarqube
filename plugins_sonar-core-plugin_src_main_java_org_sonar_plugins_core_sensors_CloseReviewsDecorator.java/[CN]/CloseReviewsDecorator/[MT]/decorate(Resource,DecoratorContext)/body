{
  Snapshot currentSnapshot=resourcePersister.getSnapshot(resource);
  if (currentSnapshot != null) {
    int resourceId=currentSnapshot.getResourceId();
    int snapshotId=currentSnapshot.getId();
    closeReviewsOnResolvedViolations(resource,resourceId,snapshotId);
    reopenReviewsOnUnresolvedViolations(resource,resourceId);
    if (ResourceUtils.isRootProject(resource)) {
      closeReviewsForDeletedResources(resourceId,currentSnapshot.getId());
    }
    databaseSession.commit();
  }
}
