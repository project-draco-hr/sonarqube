{
  orchestrator.getServer().restoreProfile(FileLocation.ofClasspath("/qualityModel/with-many-rules.xml"));
  orchestrator.getServer().associateProjectToQualityProfile(PROJECT,"xoo","with-many-rules");
  orchestrator.executeBuild(SonarScanner.create(projectDir("shared/xoo-multi-modules-sample")));
  assertThat(getMeasure(PROJECT,VULNERABILITIES_METRIC).getIntValue()).isEqualTo(4);
  assertThat(getMeasure(PROJECT,SECURITY_REMEDIATION_EFFORT_METRIC).getIntValue()).isEqualTo(340);
  assertThat(getMeasure(PROJECT,SECURITY_RATING_METRIC).getData()).isEqualTo("E");
  assertThat(getMeasure(PROJECT,EFFORT_TO_REACH_SECURITY_RATING_A_METRIC).getIntValue()).isEqualTo(340);
  assertThat(getMeasure(MODULE,VULNERABILITIES_METRIC).getIntValue()).isEqualTo(2);
  assertThat(getMeasure(MODULE,SECURITY_REMEDIATION_EFFORT_METRIC).getIntValue()).isEqualTo(170);
  assertThat(getMeasure(MODULE,SECURITY_RATING_METRIC).getData()).isEqualTo("E");
  assertThat(getMeasure(MODULE,EFFORT_TO_REACH_SECURITY_RATING_A_METRIC).getIntValue()).isEqualTo(170);
  assertThat(getMeasure(SUB_MODULE,VULNERABILITIES_METRIC).getIntValue()).isEqualTo(1);
  assertThat(getMeasure(SUB_MODULE,SECURITY_REMEDIATION_EFFORT_METRIC).getIntValue()).isEqualTo(85);
  assertThat(getMeasure(SUB_MODULE,SECURITY_RATING_METRIC).getData()).isEqualTo("E");
  assertThat(getMeasure(SUB_MODULE,EFFORT_TO_REACH_SECURITY_RATING_A_METRIC).getIntValue()).isEqualTo(85);
  assertThat(getMeasure(DIRECTORY,VULNERABILITIES_METRIC).getIntValue()).isEqualTo(0);
  assertThat(getMeasure(DIRECTORY,SECURITY_REMEDIATION_EFFORT_METRIC).getIntValue()).isEqualTo(0);
  assertThat(getMeasure(DIRECTORY,SECURITY_RATING_METRIC).getData()).isEqualTo("A");
  assertThat(getMeasure(DIRECTORY,EFFORT_TO_REACH_SECURITY_RATING_A_METRIC).getIntValue()).isEqualTo(0);
  assertThat(getMeasure(FILE,VULNERABILITIES_METRIC)).isNull();
  assertThat(getMeasure(FILE,SECURITY_REMEDIATION_EFFORT_METRIC)).isNull();
  assertThat(getMeasure(FILE,SECURITY_RATING_METRIC).getData()).isEqualTo("A");
  assertThat(getMeasure(FILE,EFFORT_TO_REACH_SECURITY_RATING_A_METRIC)).isNull();
}
