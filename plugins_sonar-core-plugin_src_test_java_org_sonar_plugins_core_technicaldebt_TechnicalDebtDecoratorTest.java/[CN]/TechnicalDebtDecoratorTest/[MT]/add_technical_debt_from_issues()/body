{
  WorkUnit technicalDebt1=new WorkUnit.Builder().setDays(1).build();
  WorkUnit technicalDebt2=new WorkUnit.Builder().setDays(2).build();
  Issue issue1=createIssue("rule1","repo1").setTechnicalDebt(technicalDebt1);
  Issue issue2=createIssue("rule1","repo1").setTechnicalDebt(technicalDebt1);
  Issue issue3=createIssue("rule2","repo2").setTechnicalDebt(technicalDebt2);
  Issue issue4=createIssue("rule2","repo2").setTechnicalDebt(technicalDebt2);
  when(issuable.issues()).thenReturn(newArrayList(issue1,issue2,issue3,issue4));
  DefaultCharacteristic rootCharacteristic=new DefaultCharacteristic().setKey("rootCharacteristic");
  DefaultCharacteristic characteristic=new DefaultCharacteristic().setKey("characteristic").setParent(rootCharacteristic);
  RuleKey ruleKey1=RuleKey.of("repo1","rule1");
  DefaultRequirement requirement1=new DefaultRequirement().setRuleKey(ruleKey1).setCharacteristic(characteristic);
  RuleKey ruleKey2=RuleKey.of("repo2","rule2");
  DefaultRequirement requirement2=new DefaultRequirement().setRuleKey(ruleKey2).setCharacteristic(characteristic);
  when(defaultTechnicalDebtModel.requirementsByRule(ruleKey1)).thenReturn(requirement1);
  when(defaultTechnicalDebtModel.requirementsByRule(ruleKey2)).thenReturn(requirement2);
  doReturn(newArrayList(requirement1,requirement2)).when(defaultTechnicalDebtModel).requirements();
  decorator.decorate(resource,context);
  verify(context).saveMeasure(argThat(new IsCharacteristicMeasure(CoreMetrics.TECHNICAL_DEBT,6.0)));
  verify(context).saveMeasure(argThat(new IsCharacteristicMeasure(CoreMetrics.TECHNICAL_DEBT,requirement1,2.0)));
  verify(context).saveMeasure(argThat(new IsCharacteristicMeasure(CoreMetrics.TECHNICAL_DEBT,requirement2,4.0)));
}
