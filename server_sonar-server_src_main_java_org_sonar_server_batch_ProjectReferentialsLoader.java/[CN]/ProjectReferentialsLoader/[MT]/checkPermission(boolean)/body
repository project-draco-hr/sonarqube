{
  UserSession userSession=UserSession.get();
  boolean hasScanPerm=userSession.hasGlobalPermission(GlobalPermissions.SCAN_EXECUTION);
  boolean hasPreviewPerm=userSession.hasGlobalPermission(GlobalPermissions.DRY_RUN_EXECUTION);
  if (!hasPreviewPerm && !hasScanPerm) {
    throw new ForbiddenException("You're not authorized to execute any SonarQube analysis. Please contact your SonarQube administrator.");
  }
  if (!preview && !hasScanPerm) {
    throw new ForbiddenException("You're only authorized to execute a local (dry run) SonarQube analysis without pushing the results to the SonarQube server. " + "Please contact your SonarQube administrator.");
  }
}
