{
  try {
    JSONParser parser=new JSONParser();
    JSONObject json=(JSONObject)parser.parse(new InputStreamReader(jsonInput));
    final BatchGraph batchGraph=BatchGraph.wrap(toGraph,bufferSize);
    ElementFactory elementFactory=new ElementFactory(batchGraph);
    final GraphonMode mode=GraphonMode.valueOf(json.get(GraphonTokens.MODE).toString());
    GraphsonUtil graphson=new GraphsonUtil(mode,elementFactory,vertexPropertyKeys,edgePropertyKeys);
    JSONArray vertices=(JSONArray)json.get(GraphonTokens.VERTICES);
    for (    Object vertice : vertices) {
      graphson.vertexFromJson((JSONObject)vertice);
    }
    JSONArray edges=(JSONArray)json.get(GraphonTokens.EDGES);
    for (    Object edgeObject : edges) {
      JSONObject edge=(JSONObject)edgeObject;
      final Vertex inV=batchGraph.getVertex(edge.get(GraphonTokens._IN_V));
      final Vertex outV=batchGraph.getVertex(edge.get(GraphonTokens._OUT_V));
      graphson.edgeFromJson(edge,outV,inV);
    }
    batchGraph.shutdown();
    return toGraph;
  }
 catch (  Exception e) {
    throw new GraphonException("Unable to parse GraphSON",e);
  }
}
