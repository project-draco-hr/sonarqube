{
  DbSession dbSession=dbClient.openSession(false);
  try {
    Optional<ComponentDto> component=searchComponent(dbSession,request);
    String componentUuid=component.isPresent() ? component.get().uuid() : null;
    checkPermissions(componentUuid);
    int pendingCount=dbClient.ceQueueDao().countByStatusAndComponentUuid(dbSession,CeQueueDto.Status.PENDING,componentUuid);
    int failingCount=dbClient.ceActivityDao().countLastByStatusAndComponentUuid(dbSession,CeActivityDto.Status.FAILED,componentUuid);
    return ActivityStatusWsResponse.newBuilder().setPending(pendingCount).setFailing(failingCount).build();
  }
  finally {
    dbClient.closeSession(dbSession);
  }
}
