{
  classloaders=new PluginClassloaders(getClass().getClassLoader());
  DefaultPluginMetadata checkstyle=DefaultPluginMetadata.create(null).setKey("checkstyle").setMainClass("org.sonar.plugins.checkstyle.CheckstylePlugin").addDeployedFile(getFile("sonar-checkstyle-plugin-2.8.jar"));
  DefaultPluginMetadata checkstyleExt=DefaultPluginMetadata.create(null).setKey("checkstyle-ext").setBasePlugin("checkstyle").setMainClass("com.mycompany.sonar.checkstyle.CheckstyleExtensionsPlugin").addDeployedFile(getFile("sonar-checkstyle-extensions-plugin-0.1-SNAPSHOT.jar"));
  Map<String,Plugin> map=classloaders.init(Arrays.<PluginMetadata>asList(checkstyle,checkstyleExt));
  Plugin checkstyleEntryPoint=map.get("checkstyle");
  Plugin checkstyleExtEntryPoint=map.get("checkstyle-ext");
  assertThat(checkstyleEntryPoint.getClass().getClassLoader().equals(checkstyleExtEntryPoint.getClass().getClassLoader())).isTrue();
}
