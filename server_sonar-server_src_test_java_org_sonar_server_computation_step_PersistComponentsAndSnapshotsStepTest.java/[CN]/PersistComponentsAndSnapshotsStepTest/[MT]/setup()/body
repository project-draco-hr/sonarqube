{
  dbTester.truncateTables();
  session=dbTester.myBatis().openSession(false);
  dbClient=new DbClient(dbTester.database(),dbTester.myBatis(),new ComponentDao());
  reportReader.setMetadata(BatchReport.Metadata.newBuilder().build());
  dbIdsRepository=new DbIdsRepository();
  sut=new PersistComponentsAndSnapshotsStep(system2,dbClient,treeRootHolder,reportReader,dbIdsRepository);
}
