{
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).setKey(PROJECT_KEY).setName("Project").setDescription("Project description").addChildRef(2).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(2).setType(Constants.ComponentType.MODULE).setKey("MODULE_KEY").setPath("module").setName("Module").setDescription("Module description").addChildRef(3).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(3).setType(Constants.ComponentType.DIRECTORY).setPath("src/main/java/dir").addChildRef(4).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(4).setType(Constants.ComponentType.FILE).setPath("src/main/java/dir/Foo.java").setLanguage("java").build());
  Component file=new DumbComponent(Component.Type.FILE,4,"DEFG","MODULE_KEY:src/main/java/dir/Foo.java");
  Component directory=new DumbComponent(Component.Type.DIRECTORY,3,"CDEF","MODULE_KEY:src/main/java/dir",file);
  Component module=new DumbComponent(Component.Type.MODULE,2,"BCDE","MODULE_KEY",directory);
  Component project=new DumbComponent(Component.Type.PROJECT,1,"ABCD",PROJECT_KEY,module);
  treeRootHolder.setRoot(project);
  sut.execute();
  assertThat(dbTester.countRowsOfTable("projects")).isEqualTo(4);
  ComponentDto projectDto=dbClient.componentDao().selectNullableByKey(session,PROJECT_KEY);
  assertThat(projectDto).isNotNull();
  assertThat(projectDto.name()).isEqualTo("Project");
  assertThat(projectDto.description()).isEqualTo("Project description");
  assertThat(projectDto.path()).isNull();
  assertThat(projectDto.uuid()).isEqualTo("ABCD");
  assertThat(projectDto.moduleUuid()).isNull();
  assertThat(projectDto.moduleUuidPath()).isEqualTo("." + projectDto.uuid() + ".");
  assertThat(projectDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(projectDto.qualifier()).isEqualTo("TRK");
  assertThat(projectDto.scope()).isEqualTo("PRJ");
  assertThat(projectDto.parentProjectId()).isNull();
  ComponentDto moduleDto=dbClient.componentDao().selectNullableByKey(session,"MODULE_KEY");
  assertThat(moduleDto).isNotNull();
  assertThat(moduleDto.name()).isEqualTo("Module");
  assertThat(moduleDto.description()).isEqualTo("Module description");
  assertThat(moduleDto.path()).isEqualTo("module");
  assertThat(moduleDto.uuid()).isEqualTo("BCDE");
  assertThat(moduleDto.moduleUuid()).isEqualTo(projectDto.uuid());
  assertThat(moduleDto.moduleUuidPath()).isEqualTo(projectDto.moduleUuidPath() + moduleDto.uuid() + ".");
  assertThat(moduleDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(moduleDto.qualifier()).isEqualTo("BRC");
  assertThat(moduleDto.scope()).isEqualTo("PRJ");
  assertThat(moduleDto.parentProjectId()).isEqualTo(projectDto.getId());
  ComponentDto directoryDto=dbClient.componentDao().selectNullableByKey(session,"MODULE_KEY:src/main/java/dir");
  assertThat(directoryDto).isNotNull();
  assertThat(directoryDto.name()).isEqualTo("src/main/java/dir");
  assertThat(directoryDto.description()).isNull();
  assertThat(directoryDto.path()).isEqualTo("src/main/java/dir");
  assertThat(directoryDto.uuid()).isEqualTo("CDEF");
  assertThat(directoryDto.moduleUuid()).isEqualTo(moduleDto.uuid());
  assertThat(directoryDto.moduleUuidPath()).isEqualTo(moduleDto.moduleUuidPath());
  assertThat(directoryDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(directoryDto.qualifier()).isEqualTo("DIR");
  assertThat(directoryDto.scope()).isEqualTo("DIR");
  assertThat(directoryDto.parentProjectId()).isEqualTo(moduleDto.getId());
  ComponentDto fileDto=dbClient.componentDao().selectNullableByKey(session,"MODULE_KEY:src/main/java/dir/Foo.java");
  assertThat(fileDto).isNotNull();
  assertThat(fileDto.name()).isEqualTo("Foo.java");
  assertThat(fileDto.description()).isNull();
  assertThat(fileDto.path()).isEqualTo("src/main/java/dir/Foo.java");
  assertThat(fileDto.language()).isEqualTo("java");
  assertThat(fileDto.uuid()).isEqualTo("DEFG");
  assertThat(fileDto.moduleUuid()).isEqualTo(moduleDto.uuid());
  assertThat(fileDto.moduleUuidPath()).isEqualTo(moduleDto.moduleUuidPath());
  assertThat(fileDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(fileDto.qualifier()).isEqualTo("FIL");
  assertThat(fileDto.scope()).isEqualTo("FIL");
  assertThat(fileDto.parentProjectId()).isEqualTo(moduleDto.getId());
  assertThat(dbIdsRepository.getComponentId(project)).isEqualTo(projectDto.getId());
  assertThat(dbIdsRepository.getComponentId(module)).isEqualTo(moduleDto.getId());
  assertThat(dbIdsRepository.getComponentId(directory)).isEqualTo(directoryDto.getId());
  assertThat(dbIdsRepository.getComponentId(file)).isEqualTo(fileDto.getId());
}
