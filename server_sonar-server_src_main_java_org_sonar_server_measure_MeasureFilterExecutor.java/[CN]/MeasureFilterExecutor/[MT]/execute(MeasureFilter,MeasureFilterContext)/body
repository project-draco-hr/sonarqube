{
  if (filter.isEmpty()) {
    return Collections.emptyList();
  }
  List<MeasureFilterRow> rows;
  DbSession session=null;
  Connection connection=null;
  try {
    session=mybatis.openSession(false);
    prepareContext(context,filter,session);
    if (isValid(filter,context)) {
      MeasureFilterSql sql=new MeasureFilterSql(database,filter,context);
      context.setSql(sql.sql());
      connection=session.getConnection();
      rows=sql.execute(connection);
    }
 else {
      rows=Collections.emptyList();
    }
  }
  finally {
    MyBatis.closeQuietly(session);
    DbUtils.closeQuietly(connection);
  }
  return rows;
}
