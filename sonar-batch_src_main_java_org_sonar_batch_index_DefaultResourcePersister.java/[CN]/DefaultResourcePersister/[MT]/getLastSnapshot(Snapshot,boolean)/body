{
  String hql="SELECT s FROM " + Snapshot.class.getSimpleName() + " s WHERE s.last=:last AND s.resourceId=:resourceId";
  if (onlyOlder) {
    hql+=" AND s.createdAt<:date";
  }
  Query query=session.createQuery(hql);
  query.setParameter(LAST,true);
  query.setParameter(RESOURCE_ID,snapshot.getResourceId());
  if (onlyOlder) {
    query.setParameter("date",snapshot.getCreatedAt());
  }
  return session.getSingleResult(query,null);
}
