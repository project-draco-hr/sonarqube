{
  BatchResource batchResource=resourceCache.get(resource.getEffectiveKey());
  if (batchResource == null || ResourceUtils.isLibrary(resource)) {
    Snapshot s=persist(project,resource,parent);
    batchResource=addToCache(resource,s);
  }
  return batchResource;
}
