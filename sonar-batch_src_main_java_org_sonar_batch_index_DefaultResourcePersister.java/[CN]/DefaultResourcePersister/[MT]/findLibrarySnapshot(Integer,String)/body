{
  Query query=session.createQuery("from " + Snapshot.class.getSimpleName() + " s WHERE s.resourceId=:resourceId AND s.version=:version AND s.scope=:scope AND s.qualifier<>:qualifier AND s.last=:last");
  query.setParameter("resourceId",resourceId);
  query.setParameter("version",version);
  query.setParameter("scope",Scopes.PROJECT);
  query.setParameter("qualifier",Qualifiers.LIBRARY);
  query.setParameter("last",Boolean.TRUE);
  List<Snapshot> snapshots=query.getResultList();
  if (snapshots.isEmpty()) {
    snapshots=session.getResults(Snapshot.class,"resourceId",resourceId,"version",version,"scope",Scopes.PROJECT,"qualifier",Qualifiers.LIBRARY);
  }
  return snapshots.isEmpty() ? null : snapshots.get(0);
}
