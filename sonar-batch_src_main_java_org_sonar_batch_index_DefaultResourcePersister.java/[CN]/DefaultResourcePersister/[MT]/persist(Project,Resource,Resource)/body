{
  Snapshot snapshot;
  if (resource instanceof Project) {
    snapshot=persistProject((Project)resource,project);
  }
 else   if (resource instanceof Library) {
    snapshot=persistLibrary(project,(Library)resource);
  }
 else {
    snapshot=persistFileOrDirectory(project,resource,parent);
  }
  indexer.index(resource.getName(),snapshot.getResourceId(),snapshot.getRootProjectId());
  return snapshot;
}
