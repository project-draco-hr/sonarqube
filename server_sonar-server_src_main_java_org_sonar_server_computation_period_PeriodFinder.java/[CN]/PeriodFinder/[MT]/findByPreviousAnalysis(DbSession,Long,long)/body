{
  SnapshotDto snapshot=findFirstSnapshot(session,createCommonQuery(projectId).setCreatedBefore(analysisDate).setIsLast(true).setSort(BY_DATE,DESC));
  if (snapshot == null) {
    return null;
  }
  return new Period(CoreProperties.TIMEMACHINE_MODE_PREVIOUS_ANALYSIS,snapshot.getCreatedAt(),snapshot).setModeParameter(DATE_FORMAT.format(snapshot.getCreatedAt()));
}
