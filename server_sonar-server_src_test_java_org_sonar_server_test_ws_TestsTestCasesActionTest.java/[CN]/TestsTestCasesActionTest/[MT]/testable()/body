{
  MockUserSession.set().addComponentPermission(UserRole.CODEVIEWER,"SonarQube",FILE_KEY);
  TestCase testCase1=testCase("test1",TestCase.Status.OK,10L,"org.foo.BarTest.java","src/test/java/org/foo/BarTest.java");
  TestCase testCase2=testCase("test2",TestCase.Status.ERROR,97L,"org.foo.FileTest.java","src/test/java/org/foo/FileTest.java");
  when(testable.testCasesOfLine(10)).thenReturn(newArrayList(testCase1,testCase2));
  WsTester.TestRequest request=tester.newGetRequest("api/tests","test_cases").setParam("key",FILE_KEY).setParam("line","10");
  request.execute().assertJson("{\n" + "  \"tests\": [\n" + "    {\n"+ "      \"name\": \"test1\",\n"+ "      \"status\": \"OK\",\n"+ "      \"durationInMs\": 10,\n"+ "      \"_ref\": \"1\"\n"+ "    },\n"+ "    {\n"+ "      \"name\": \"test2\",\n"+ "      \"status\": \"ERROR\",\n"+ "      \"durationInMs\": 97,\n"+ "      \"_ref\": \"2\"\n"+ "    }\n"+ "  ],\n"+ "  \"files\": {\n"+ "    \"1\": {\n"+ "      \"key\": \"org.foo.BarTest.java\",\n"+ "      \"longName\": \"src/test/java/org/foo/BarTest.java\"\n"+ "    },\n"+ "    \"2\": {\n"+ "      \"key\": \"org.foo.FileTest.java\",\n"+ "      \"longName\": \"src/test/java/org/foo/FileTest.java\"\n"+ "    }\n"+ "  }\n"+ "}");
}
