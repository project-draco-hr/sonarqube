{
  JsonWriter json=response.newJsonWriter();
  json.beginObject();
  if (userSession.isLoggedIn()) {
    List<IssueFilterDto> filters=service.findFavoriteFilters(userSession);
    List<IssueFilterDto> sharedFiltersWithoutUserFilters=service.findSharedFiltersWithoutUserFilters(userSession);
    filters.addAll(sharedFiltersWithoutUserFilters);
    ImmutableSortedSet<IssueFilterDto> allUniqueIssueFilters=FluentIterable.from(filters).toSortedSet(IssueFilterDtoIdComparator.INSTANCE);
    json.name("issueFilters").beginArray();
    for (    IssueFilterDto favorite : allUniqueIssueFilters) {
      issueFilterJsonWriter.write(json,favorite,userSession);
    }
    json.endArray();
  }
  json.endObject();
  json.close();
}
