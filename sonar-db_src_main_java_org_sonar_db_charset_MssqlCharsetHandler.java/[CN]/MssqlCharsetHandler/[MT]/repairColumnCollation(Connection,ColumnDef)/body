{
  String selectIndicesSql=format("SELECT I.name as index_name, I.is_unique as unik, IndexedColumns " + "     FROM sys.indexes I " + "     JOIN sys.tables T ON T.Object_id = I.Object_id "+ "     JOIN (SELECT * FROM ( "+ "     SELECT IC2.object_id, IC2.index_id, "+ "     STUFF((SELECT ' ,' + C.name "+ "     FROM sys.index_columns IC1 "+ "     JOIN sys.columns C "+ "     ON C.object_id = IC1.object_id "+ "     AND C.column_id = IC1.column_id "+ "     AND IC1.is_included_column = 0 "+ "     WHERE IC1.object_id = IC2.object_id "+ "     AND IC1.index_id = IC2.index_id "+ "     GROUP BY IC1.object_id,C.name,index_id "+ "     ORDER BY MAX(IC1.key_ordinal) "+ "     FOR XML PATH('')), 1, 2, '') IndexedColumns "+ "     FROM sys.index_columns IC2 "+ "     GROUP BY IC2.object_id ,IC2.index_id) tmp1 )tmp2 "+ "     ON I.object_id = tmp2.object_id AND I.Index_id = tmp2.index_id "+ "     WHERE I.is_primary_key = 0 AND I.is_unique_constraint = 0 "+ "     and T.name =('%s') "+ "     and CHARINDEX ('%s',IndexedColumns)>0",column.getTable(),column.getColumn());
  List<ColumnIndex> indices=getSqlExecutor().executeSelect(connection,selectIndicesSql,ColumnIndexConverter.INSTANCE);
  for (  ColumnIndex index : indices) {
    getSqlExecutor().executeUpdate(connection,format("DROP INDEX %s.%s",column.getTable(),index.name));
  }
  String csCollation=toCaseSensitive(column.getCollation());
  String nullability=column.isNullable() ? "NULL" : "NOT NULL";
  String size=column.getSize() >= 0 ? String.valueOf(column.getSize()) : "max";
  String alterSql=format("ALTER TABLE %s ALTER COLUMN %s %s(%s) COLLATE %s %s",column.getTable(),column.getColumn(),column.getDataType(),size,csCollation,nullability);
  LOGGER.info("Changing collation of column [{}.{}] from {} to {} | sql=",column.getTable(),column.getColumn(),column.getCollation(),csCollation,alterSql);
  getSqlExecutor().executeUpdate(connection,alterSql);
  for (  ColumnIndex index : indices) {
    String uniqueSql=index.unique ? "UNIQUE" : "";
    String createIndexSql=format("CREATE %s INDEX %s ON %s (%s)",uniqueSql,index.name,column.getTable(),index.csvColumns);
    getSqlExecutor().executeUpdate(connection,createIndexSql);
  }
}
