{
  BatchSession batchSession=mock(BatchSession.class);
  when(mybatis.openBatchSession()).thenReturn(batchSession);
  when(ruleDao.selectBySubCharacteristicId(2,batchSession)).thenReturn(newArrayList(new RuleDto().setSubCharacteristicId(10).setRemediationFunction("LINEAR_OFFSET").setRemediationCoefficient("2h").setRemediationOffset("5min").setDefaultSubCharacteristicId(2).setDefaultRemediationFunction("LINEAR_OFFSET").setDefaultRemediationCoefficient("4h").setDefaultRemediationOffset("15min")));
  when(dao.selectById(2,batchSession)).thenReturn(subCharacteristicDto);
  service.delete(2);
  ArgumentCaptor<RuleDto> ruleArgument=ArgumentCaptor.forClass(RuleDto.class);
  verify(ruleDao).update(ruleArgument.capture(),eq(batchSession));
  RuleDto ruleDto=ruleArgument.getValue();
  assertThat(ruleDto.getUpdatedAt()).isEqualTo(now);
  assertThat(ruleDto.getDefaultSubCharacteristicId()).isNull();
  assertThat(ruleDto.getDefaultRemediationFunction()).isNull();
  assertThat(ruleDto.getDefaultRemediationCoefficient()).isNull();
  assertThat(ruleDto.getDefaultRemediationOffset()).isNull();
  assertThat(ruleDto.getSubCharacteristicId()).isEqualTo(10);
  assertThat(ruleDto.getRemediationFunction()).isEqualTo("LINEAR_OFFSET");
  assertThat(ruleDto.getRemediationCoefficient()).isEqualTo("2h");
  assertThat(ruleDto.getRemediationOffset()).isEqualTo("5min");
  ArgumentCaptor<CharacteristicDto> characteristicArgument=ArgumentCaptor.forClass(CharacteristicDto.class);
  verify(dao).update(characteristicArgument.capture(),eq(batchSession));
  CharacteristicDto characteristicDto=characteristicArgument.getValue();
  assertThat(characteristicDto.getId()).isEqualTo(2);
  assertThat(characteristicDto.isEnabled()).isFalse();
  assertThat(characteristicDto.getUpdatedAt()).isEqualTo(now);
}
