{
  if (duplications.size() > MAX_CLONE_GROUP_PER_FILE) {
    LOG.warn("Too many duplication groups on file " + inputFile.relativePath() + ". Keep only the first "+ MAX_CLONE_GROUP_PER_FILE+ " groups.");
  }
  final BatchComponent component=batchComponentCache.get(inputFile);
  Iterable<org.sonar.batch.protocol.output.BatchReport.Duplication> reportDuplications=from(duplications).limit(MAX_CLONE_GROUP_PER_FILE).transform(new Function<CloneGroup,BatchReport.Duplication>(){
    private final BatchReport.Duplication.Builder dupBuilder=BatchReport.Duplication.newBuilder();
    private final BatchReport.Duplicate.Builder blockBuilder=BatchReport.Duplicate.newBuilder();
    @Override public BatchReport.Duplication apply(    CloneGroup input){
      return toReportDuplication(component,inputFile,dupBuilder,blockBuilder,input);
    }
  }
);
  publisher.getWriter().writeComponentDuplications(component.batchId(),reportDuplications);
}
