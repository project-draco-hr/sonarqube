{
  LineCounter lineCounter=new LineCounter(file,encoding);
  FileHashComputer fileHashComputer=new FileHashComputer();
  LineOffsetCounter lineOffsetCounter=new LineOffsetCounter();
  if (!analysisMode.isPreview()) {
    scanFile(file,encoding,lineCounter,fileHashComputer,lineOffsetCounter);
  }
 else {
    scanFile(file,encoding,lineCounter,fileHashComputer);
  }
  return new Metadata(lineCounter.lines(),lineCounter.nonBlankLines(),fileHashComputer.getHash(),lineOffsetCounter.getOriginalLineOffsets(),lineCounter.isEmpty());
}
