{
  SonarUpdate update=new SonarUpdate(sonarRelease);
  for (  Map.Entry<Plugin,Version> entry : installedPlugins.entrySet()) {
    Plugin plugin=entry.getKey();
    Version pluginVersion=entry.getValue();
    Release pluginRelease=plugin.getRelease(pluginVersion);
    if (pluginRelease == null) {
      update.addIncompatiblePlugin(plugin);
    }
 else     if (pluginRelease.supportSonarVersion(sonarRelease.getVersion())) {
      update.addCompatiblePlugin(plugin);
    }
 else {
      boolean ok=false;
      Release compatibleRelease=null;
      for (      Release greaterPluginRelease : plugin.getReleasesGreaterThan(pluginVersion)) {
        if (greaterPluginRelease.supportSonarVersion(sonarRelease.getVersion())) {
          compatibleRelease=greaterPluginRelease;
          ok=true;
        }
      }
      if (ok) {
        update.addPluginToUpgrade(compatibleRelease);
      }
 else {
        update.addIncompatiblePlugin(plugin);
      }
    }
  }
  return update;
}
