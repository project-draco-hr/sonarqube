{
  Module projectComponents=globalComponents.installChild(new ProjectComponents(project));
  projectComponents.install(new ProjectCoreComponents());
  projectComponents.start();
  Language language=projectComponents.getComponent(Languages.class).get(project.getLanguageKey());
  if (language == null) {
    throw new SonarException("Language with key '" + project.getLanguageKey() + "' not found");
  }
  project.setLanguage(language);
  index.setCurrentProject(project,projectComponents.getComponent(ResourceFilters.class),projectComponents.getComponent(ViolationFilters.class),projectComponents.getComponent(RulesProfile.class));
  project.setFileSystem(projectComponents.getComponent(ProjectFileSystem.class));
  return projectComponents;
}
