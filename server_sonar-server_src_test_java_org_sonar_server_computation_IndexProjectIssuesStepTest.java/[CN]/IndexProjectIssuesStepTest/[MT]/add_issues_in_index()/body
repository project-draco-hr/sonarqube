{
  ComponentDto project=insertPermissionsForProject(DEFAULT_PROJECT_KEY);
  db.issueAuthorizationDao().synchronizeAfter(session,new Date(0));
  ComponentDto file=ComponentTesting.newFileDto(project);
  db.componentDao().insert(session,file);
  db.snapshotDao().insert(session,SnapshotTesting.createForComponent(file,project));
  RuleDto rule=RuleTesting.newXooX1();
  tester.get(RuleDao.class).insert(session,rule);
  IssueDto issue=IssueTesting.newDto(rule,file,project);
  db.issueDao().insert(session,issue);
  session.commit();
  clearIssueIndexToSimulateBatchInsertWithoutIndexing();
  queue.add(DEFAULT_PROJECT_KEY,123L);
  AnalysisReportDto report=queue.bookNextAvailable();
  sut.execute(session,report);
  assertThat(tester.get(IssueIndex.class).getNullableByKey(issue.getKey())).isNotNull();
}
