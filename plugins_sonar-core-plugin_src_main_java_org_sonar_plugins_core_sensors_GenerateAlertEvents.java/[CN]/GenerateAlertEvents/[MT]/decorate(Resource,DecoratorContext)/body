{
  if (!shouldDecorateResource(resource)) {
    return;
  }
  Measure currentStatus=context.getMeasure(CoreMetrics.ALERT_STATUS);
  if (currentStatus == null) {
    return;
  }
  TimeMachineQuery query=new TimeMachineQuery(resource).setOnlyLastAnalysis(true).setMetrics(CoreMetrics.ALERT_STATUS);
  List<Measure> measures=timeMachine.getMeasures(query);
  Measure pastStatus=(measures != null && measures.size() == 1 ? measures.get(0) : null);
  if (pastStatus != null && pastStatus.getDataAsLevel() != currentStatus.getDataAsLevel()) {
    createEvent(context,getName(pastStatus,currentStatus),currentStatus.getAlertText());
  }
 else   if (pastStatus == null && currentStatus.getDataAsLevel() != Metric.Level.OK) {
    createEvent(context,getName(currentStatus),currentStatus.getAlertText());
  }
}
