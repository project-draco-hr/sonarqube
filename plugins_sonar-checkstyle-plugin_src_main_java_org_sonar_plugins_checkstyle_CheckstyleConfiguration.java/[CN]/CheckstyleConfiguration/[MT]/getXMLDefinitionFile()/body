{
  if (project.getReuseExistingRulesConfig()) {
    LOG.warn("Reusing existing Checkstyle configuration is deprecated as it's unstable and can not provide meaningful results. This feature will be removed soon.");
    return findExistingXML();
  }
  Writer writer=null;
  File xmlFile=new File(project.getFileSystem().getSonarWorkingDirectory(),"checkstyle.xml");
  try {
    writer=new OutputStreamWriter(new FileOutputStream(xmlFile,false),CharEncoding.UTF_8);
    confExporter.exportProfile(profile,writer);
    writer.flush();
    return xmlFile;
  }
 catch (  IOException e) {
    throw new SonarException("Fail to save the Checkstyle configuration to " + xmlFile.getPath(),e);
  }
 finally {
    IOUtils.closeQuietly(writer);
  }
}
