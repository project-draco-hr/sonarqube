{
  PermissionDependenciesFinder dependenciesFinder=new PermissionDependenciesFinder(dbClient,new ComponentFinder(dbClient),resourceTypes);
  underTest=new TemplateUsersAction(dbClient,userSession,dependenciesFinder);
  ws=new WsActionTester(underTest);
  userSession.login("login").setGlobalPermissions(ADMIN);
  template1=dbClient.permissionTemplateDao().insert(dbSession,newPermissionTemplateDto().setUuid("template-uuid-1"));
  template2=dbClient.permissionTemplateDao().insert(dbSession,newPermissionTemplateDto().setUuid("template-uuid-2"));
  UserDto user1=insertUser(new UserDto().setLogin("login-1").setName("name-1").setEmail("email-1"));
  UserDto user2=insertUser(new UserDto().setLogin("login-2").setName("name-2").setEmail("email-2"));
  UserDto user3=insertUser(new UserDto().setLogin("login-3").setName("name-3").setEmail("email-3"));
  addUserToTemplate(newPermissionTemplateUser(UserRole.USER,template1.getId(),user1.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.USER,template1.getId(),user2.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.ISSUE_ADMIN,template1.getId(),user1.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.ISSUE_ADMIN,template1.getId(),user3.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.USER,template2.getId(),user1.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.USER,template2.getId(),user2.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.USER,template2.getId(),user3.getId()));
  addUserToTemplate(newPermissionTemplateUser(UserRole.ISSUE_ADMIN,template2.getId(),user1.getId()));
  commit();
}
