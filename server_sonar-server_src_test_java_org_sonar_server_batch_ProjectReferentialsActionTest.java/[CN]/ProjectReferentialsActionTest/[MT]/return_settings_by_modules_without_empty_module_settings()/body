{
  MockUserSession.set().setLogin("john").setGlobalPermissions(GlobalPermissions.SCAN_EXECUTION,GlobalPermissions.DRY_RUN_EXECUTION);
  String projectKey="org.codehaus.sonar:sonar";
  String moduleKey="org.codehaus.sonar:sonar-server";
  when(componentDao.findModulesByProject(projectKey,session)).thenReturn(newArrayList(new ComponentDto().setKey(projectKey),new ComponentDto().setKey(moduleKey)));
  when(propertiesDao.selectProjectProperties(projectKey,session)).thenReturn(newArrayList(new PropertyDto().setKey("sonar.jira.project.key").setValue("SONAR"),new PropertyDto().setKey("sonar.jira.login.secured").setValue("john")));
  when(qProfileFactory.getDefault(session,"java")).thenReturn(QualityProfileDto.createFor("abcd").setName("Default").setLanguage("java").setRulesUpdatedAt("2014-01-14T14:00:00+0200"));
  WsTester.TestRequest request=tester.newGetRequest("batch","project").setParam("key",projectKey);
  request.execute().assertJson(getClass(),"return_settings_by_modules_without_empty_module_settings.json");
}
