{
  when(rulesXMLImporter.importXML(anyString(),any(ValidationMessages.class))).thenReturn(Collections.<RuleDebt>emptyList());
  when(ruleDao.selectEnabledAndNonManual(session)).thenReturn(newArrayList(new RuleDto().setId(1).setRepositoryKey("squid").setRuleKey("UselessImportCheck").setLanguage("java").setDefaultRemediationFunction("LINEAR").setDefaultRemediationCoefficient("2h").setRemediationFunction(DebtRemediationFunction.Type.LINEAR_OFFSET.toString()).setRemediationCoefficient("2h").setRemediationOffset("15min")));
  underTest.restoreFromXml("<xml/>","java");
  verify(ruleOperations).updateRule(ruleCaptor.capture(),isNull(String.class),isNull(String.class),isNull(String.class),eq(session));
  verify(ruleDao).selectEnabledAndNonManual(session);
  verify(session).commit();
  verify(ruleIndexer).index();
}
