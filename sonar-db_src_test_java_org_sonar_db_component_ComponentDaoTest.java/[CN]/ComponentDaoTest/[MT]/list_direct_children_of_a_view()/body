{
  ComponentDto view=newView("view-uuid");
  SnapshotDto viewSnapshot=componentDb.insertViewAndSnapshot(view);
  ComponentDto subView=newSubView(view,"subview-uuid","subview-key").setName("subview-name");
  componentDb.insertComponentAndSnapshot(subView,viewSnapshot);
  ComponentDto project=newProjectDto("project-uuid").setName("project-name");
  componentDb.insertProjectAndSnapshot(project);
  componentDb.insertComponentAndSnapshot(newProjectCopy("project-copy-uuid",project,view),viewSnapshot);
  componentDb.indexProjects();
  ComponentTreeQuery dbQuery=newTreeQuery(viewSnapshot).build();
  List<ComponentDtoWithSnapshotId> components=underTest.selectDirectChildren(dbSession,dbQuery);
  assertThat(components).extracting("uuid").containsOnly("project-copy-uuid","subview-uuid");
}
