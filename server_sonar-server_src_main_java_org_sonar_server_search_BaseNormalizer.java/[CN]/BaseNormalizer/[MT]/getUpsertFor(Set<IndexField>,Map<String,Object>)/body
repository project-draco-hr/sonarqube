{
  Map<String,Object> upsert=new HashMap<String,Object>(update);
  for (  IndexField field : fields) {
    if (!upsert.containsKey(field.field())) {
      if (field.type().equals(IndexField.Type.OBJECT)) {
        upsert.put(field.field(),new ArrayList<String>());
      }
 else {
        upsert.put(field.field(),null);
      }
    }
  }
  return upsert;
}
