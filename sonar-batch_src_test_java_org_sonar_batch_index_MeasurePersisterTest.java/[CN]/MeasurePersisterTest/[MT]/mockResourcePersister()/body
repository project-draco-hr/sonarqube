{
  measureCache=mock(MeasureCache.class);
  ResourceCache resourceCache=mock(ResourceCache.class);
  when(resourceCache.get("foo")).thenReturn(projectResource);
  when(resourceCache.get("foo:org/foo/Bar.java")).thenReturn(fileResource);
  when(resourceCache.get("foo:org/foo")).thenReturn(dirResource);
  MetricFinder metricFinder=mock(MetricFinder.class);
  Metric ncloc=ncloc();
  Metric coverage=coverage();
  when(metricFinder.findByKey(ncloc.getKey())).thenReturn(ncloc);
  when(metricFinder.findByKey(coverage.getKey())).thenReturn(coverage);
  measurePersister=new MeasurePersister(getMyBatis(),ruleFinder,metricFinder,measureCache,resourceCache);
}
