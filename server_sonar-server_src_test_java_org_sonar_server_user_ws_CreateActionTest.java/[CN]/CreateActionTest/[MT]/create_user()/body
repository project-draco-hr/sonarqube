{
  Map<String,Object> userDocMap=newHashMap();
  userDocMap.put("login","john");
  userDocMap.put("name","John");
  userDocMap.put("email","john@email.com");
  userDocMap.put("scmAccounts",newArrayList("jn"));
  userDocMap.put("active",true);
  userDocMap.put("createdAt",15000L);
  userDocMap.put("updatedAt",15000L);
  when(service.getByLogin("john")).thenReturn(new UserDoc(userDocMap));
  tester.newPostRequest("api/users","create").setParam("login","john").setParam("name","John").setParam("email","john@email.com").setParam("scm_accounts","jn").setParam("password","1234").setParam("password_confirmation","1234").execute().assertJson(getClass(),"create_user.json");
  verify(service).create(newUserCaptor.capture());
  assertThat(newUserCaptor.getValue().login()).isEqualTo("john");
  assertThat(newUserCaptor.getValue().name()).isEqualTo("John");
  assertThat(newUserCaptor.getValue().email()).isEqualTo("john@email.com");
  assertThat(newUserCaptor.getValue().scmAccounts()).containsOnly("jn");
  assertThat(newUserCaptor.getValue().password()).isEqualTo("1234");
  assertThat(newUserCaptor.getValue().passwordConfirmation()).isEqualTo("1234");
}
