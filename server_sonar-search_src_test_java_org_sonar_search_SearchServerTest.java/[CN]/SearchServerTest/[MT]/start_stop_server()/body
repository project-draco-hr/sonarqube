{
  Props props=new Props(new Properties());
  props.set(ProcessConstants.SEARCH_PORT,String.valueOf(port));
  props.set(ProcessConstants.CLUSTER_NAME,CLUSTER_NAME);
  props.set(ProcessConstants.CLUSTER_NODE_NAME,"test");
  props.set(ProcessConstants.PATH_HOME,temp.newFolder().getAbsolutePath());
  searchServer=new SearchServer(props);
  searchServer.start();
  assertThat(searchServer.isReady()).isTrue();
  client=getSearchClient();
  searchServer.stop();
  searchServer.awaitStop();
  searchServer=null;
  try {
    assertThat(client.admin().cluster().prepareClusterStats().get().getStatus()).isNotEqualTo(ClusterHealthStatus.GREEN);
  }
 catch (  NoNodeAvailableException exception) {
    assertThat(exception.getMessage()).isEqualTo("No node available");
  }
}
