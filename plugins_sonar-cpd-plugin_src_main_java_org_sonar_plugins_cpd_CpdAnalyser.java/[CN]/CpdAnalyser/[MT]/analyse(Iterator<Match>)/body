{
  Map<Resource,DuplicationsData> duplicationsData=new HashMap<Resource,DuplicationsData>();
  while (matches.hasNext()) {
    Match match=matches.next();
    for (    TokenEntry firstMark : match.getMarkSet()) {
      String firstAbsolutePath=firstMark.getTokenSrcID();
      int firstLine=firstMark.getBeginLine();
      Resource firstFile=mapping.createResource(new File(firstAbsolutePath),project.getFileSystem().getSourceDirs());
      if (firstFile == null) {
        LOG.warn("CPD - File not found : {}",firstAbsolutePath);
        continue;
      }
      DuplicationsData firstFileData=getDuplicationsData(duplicationsData,firstFile);
      firstFileData.incrementDuplicatedBlock();
      for (      TokenEntry tokenEntry : match.getMarkSet()) {
        String secondAbsolutePath=tokenEntry.getTokenSrcID();
        int secondLine=tokenEntry.getBeginLine();
        if (secondAbsolutePath.equals(firstAbsolutePath) && firstLine == secondLine) {
          continue;
        }
        Resource secondFile=mapping.createResource(new File(secondAbsolutePath),project.getFileSystem().getSourceDirs());
        if (secondFile == null) {
          LOG.warn("CPD - File not found : {}",secondAbsolutePath);
          continue;
        }
        String resourceKey=SonarEngine.getFullKey(project,secondFile);
        firstFileData.cumulate(resourceKey,secondLine,firstLine,match.getLineCount());
      }
    }
  }
  for (  Map.Entry<Resource,DuplicationsData> entry : duplicationsData.entrySet()) {
    entry.getValue().save(context,entry.getKey());
  }
}
