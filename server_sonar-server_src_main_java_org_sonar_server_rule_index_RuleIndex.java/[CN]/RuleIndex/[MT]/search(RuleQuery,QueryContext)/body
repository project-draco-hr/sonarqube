{
  SearchRequestBuilder esSearch=getClient().prepareSearch(this.getIndexName()).setTypes(this.getIndexType()).setIndices(this.getIndexName());
  if (options.isScroll()) {
    esSearch.setSearchType(SearchType.SCAN);
    esSearch.setScroll(TimeValue.timeValueMinutes(3));
  }
  QueryBuilder qb=this.getQuery(query);
  Map<String,FilterBuilder> filters=this.getFilters(query,options);
  if (options.isFacet()) {
    for (    AggregationBuilder aggregation : getFacets(query,options,qb,filters).values()) {
      esSearch.addAggregation(aggregation);
    }
  }
  setSorting(query,esSearch);
  setPagination(options,esSearch);
  setFields(options,esSearch);
  BoolFilterBuilder fb=FilterBuilders.boolFilter();
  for (  FilterBuilder ffb : filters.values()) {
    fb.must(ffb);
  }
  esSearch.setQuery(QueryBuilders.filteredQuery(qb,fb));
  SearchResponse esResult=esSearch.get();
  return new Result<>(this,esResult);
}
