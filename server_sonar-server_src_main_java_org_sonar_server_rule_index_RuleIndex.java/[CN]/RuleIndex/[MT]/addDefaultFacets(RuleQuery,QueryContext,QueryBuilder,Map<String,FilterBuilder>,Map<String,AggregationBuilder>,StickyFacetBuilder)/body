{
  if (options.facets().contains(FACET_LANGUAGES) || options.facets().contains(FACET_OLD_DEFAULT)) {
    Collection<String> languages=query.getLanguages();
    aggregations.put(FACET_LANGUAGES,stickyFacetBuilder.buildStickyFacet(RuleNormalizer.RuleField.LANGUAGE.field(),FACET_LANGUAGES,languages == null ? new String[0] : languages.toArray()));
  }
  if (options.facets().contains(FACET_TAGS) || options.facets().contains(FACET_OLD_DEFAULT)) {
    Collection<String> tags=query.getTags();
    aggregations.put(FACET_TAGS,stickyFacetBuilder.buildStickyFacet(RuleNormalizer.RuleField.ALL_TAGS.field(),FACET_TAGS,tags == null ? new String[0] : tags.toArray()));
  }
  if (options.facets().contains("repositories") || options.facets().contains(FACET_OLD_DEFAULT)) {
    Collection<String> repositories=query.getRepositories();
    aggregations.put(FACET_REPOSITORIES,stickyFacetBuilder.buildStickyFacet(RuleNormalizer.RuleField.REPOSITORY.field(),FACET_REPOSITORIES,repositories == null ? new String[0] : repositories.toArray()));
  }
}
