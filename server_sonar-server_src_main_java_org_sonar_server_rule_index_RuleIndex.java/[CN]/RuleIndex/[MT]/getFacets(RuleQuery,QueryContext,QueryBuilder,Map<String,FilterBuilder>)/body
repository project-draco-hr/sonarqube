{
  Map<String,AggregationBuilder> aggregations=new HashMap<String,AggregationBuilder>();
  StickyFacetBuilder stickyFacetBuilder=stickyFacetBuilder(queryBuilder,filters);
  if (options.facets().contains("languages") || options.facets().contains("true")) {
    aggregations.put(FACET_LANGUAGES,stickyFacetBuilder.buildStickyFacet(RuleNormalizer.RuleField.LANGUAGE.field(),FACET_LANGUAGES,query.getLanguages() == null ? new String[0] : query.getLanguages().toArray()));
  }
  if (options.facets().contains("tags") || options.facets().contains("true")) {
    aggregations.put(FACET_TAGS,stickyFacetBuilder.buildStickyFacet(RuleNormalizer.RuleField.ALL_TAGS.field(),FACET_TAGS,query.getTags() == null ? new String[0] : query.getTags().toArray()));
  }
  if (options.facets().contains("repositories") || options.facets().contains("true")) {
    aggregations.put(FACET_REPOSITORIES,stickyFacetBuilder.buildStickyFacet(RuleNormalizer.RuleField.REPOSITORY.field(),FACET_REPOSITORIES,query.getRepositories() == null ? new String[0] : query.getRepositories().toArray()));
  }
  return aggregations;
}
