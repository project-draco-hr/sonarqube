{
  StopWatch fullProfile=profiling.start("es",Profiling.Level.FULL);
  StopWatch basicProfile=profiling.start("es",Profiling.Level.BASIC);
  SearchRequestBuilder esSearch=getClient().prepareSearch(this.getIndexName()).setTypes(this.getIndexType()).setIndices(this.getIndexName());
  if (options.isScroll()) {
    esSearch.setSearchType(SearchType.SCAN);
    esSearch.setScroll(TimeValue.timeValueMinutes(3));
  }
  setFacets(options,esSearch);
  setSorting(query,esSearch);
  setPagination(options,esSearch);
  setFields(options,esSearch);
  FilterBuilder fb=this.getFilter(query,options);
  QueryBuilder qb=this.getQuery(query,options);
  esSearch.setQuery(QueryBuilders.filteredQuery(qb,fb));
  basicProfile.stop(esSearch.toString());
  SearchResponse esResult=esSearch.get();
  fullProfile.stop(esResult.toString());
  return new Result<Rule>(this,esResult);
}
