{
  if (configuration.isDisabled()) {
    LOG.info("SCM Sensor is disabled");
    return;
  }
  if (configuration.provider() == null) {
    LOG.info("No SCM provider for this project");
    return;
  }
  TimeProfiler profiler=new TimeProfiler().start("Retrieve SCM blame information with encoding " + Charset.defaultCharset());
  List<InputFile> filesToBlame=new LinkedList<InputFile>();
  for (  InputFile f : fs.inputFiles(fs.predicates().all())) {
    FileData fileData=projectReferentials.fileData(projectDefinition.getKeyWithBranch(),f.relativePath());
    if (f.status() == Status.SAME && fileData != null && fileData.scmAuthorsByLine() != null && fileData.scmLastCommitDatetimesByLine() != null && fileData.scmRevisionsByLine() != null) {
      saveMeasures(context,f,fileData.scmAuthorsByLine(),fileData.scmLastCommitDatetimesByLine(),fileData.scmRevisionsByLine());
    }
 else {
      filesToBlame.add(f);
    }
  }
  if (!filesToBlame.isEmpty()) {
    configuration.provider().blameCommand().blame(fs,filesToBlame,new DefaultBlameResult(context));
  }
  profiler.stop();
}
