{
  if (configuration.isDisabled()) {
    LOG.info("SCM Sensor is disabled");
    return;
  }
  if (configuration.provider() == null) {
    LOG.info("No SCM system was detected. You can use the '" + CoreProperties.SCM_PROVIDER_KEY + "' property to explicitly specify it.");
    return;
  }
  List<InputFile> filesToBlame=new LinkedList<InputFile>();
  for (  InputFile f : fs.inputFiles(fs.predicates().all())) {
    FileData fileData=projectReferentials.fileData(projectDefinition.getKeyWithBranch(),f.relativePath());
    if (f.status() == Status.SAME && fileData != null && fileData.scmAuthorsByLine() != null && fileData.scmLastCommitDatetimesByLine() != null && fileData.scmRevisionsByLine() != null) {
      saveMeasures(context,f,fileData.scmAuthorsByLine(),fileData.scmLastCommitDatetimesByLine(),fileData.scmRevisionsByLine());
    }
 else {
      filesToBlame.add(f);
    }
  }
  if (!filesToBlame.isEmpty()) {
    LOG.info("SCM provider for this project is: " + configuration.provider().key());
    TimeProfiler profiler=new TimeProfiler().start("Retrieve SCM blame information");
    configuration.provider().blameCommand().blame(fs,filesToBlame,new DefaultBlameResult(context));
    profiler.stop();
  }
}
