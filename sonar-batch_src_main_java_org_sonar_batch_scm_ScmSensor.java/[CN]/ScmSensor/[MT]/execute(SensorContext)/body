{
  if (configuration.isDisabled()) {
    LOG.info("SCM Sensor is disabled");
    return;
  }
  if (configuration.provider() == null) {
    LOG.info("No SCM system was detected. You can use the '" + CoreProperties.SCM_PROVIDER_KEY + "' property to explicitly specify it.");
    return;
  }
  List<InputFile> filesToBlame=new LinkedList<InputFile>();
  for (  InputFile f : fs.inputFiles(fs.predicates().all())) {
    copyPreviousMeasuresForUnmodifiedFiles(context,filesToBlame,f);
  }
  if (!filesToBlame.isEmpty()) {
    LOG.info("SCM provider for this project is: " + configuration.provider().key());
    TimeProfiler profiler=new TimeProfiler().start("Retrieve SCM blame information");
    DefaultBlameOutput output=new DefaultBlameOutput(context,filesToBlame);
    configuration.provider().blameCommand().blame(new DefaultBlameInput(fs,filesToBlame),output);
    if (!output.remainingFiles().isEmpty()) {
      throw new IllegalStateException("Some files were not blamed");
    }
    profiler.stop();
  }
}
