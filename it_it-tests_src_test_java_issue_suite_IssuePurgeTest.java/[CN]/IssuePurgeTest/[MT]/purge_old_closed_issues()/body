{
  setServerProperty(orchestrator,"sonar.dbcleaner.daysBeforeDeletingClosedIssues","5000");
  orchestrator.getServer().provisionProject("sample","Sample");
  orchestrator.getServer().associateProjectToQualityProfile("sample","xoo","with-many-rules");
  runProjectAnalysis(orchestrator,"shared/xoo-sample","sonar.dynamicAnalysis","false","sonar.projectDate","2014-10-01");
  List<Issue> issues=searchIssues();
  for (  Issue issue : issues) {
    assertThat(issue.resolution()).isNull();
  }
  orchestrator.getServer().associateProjectToQualityProfile("sample","xoo","empty");
  runProjectAnalysis(orchestrator,"shared/xoo-sample","sonar.dynamicAnalysis","false","sonar.projectDate","2014-10-15");
  issues=searchIssues();
  assertThat(issues).isNotEmpty();
  for (  Issue issue : issues) {
    assertThat(issue.resolution()).isNotNull();
    assertThat(issue.status()).isEqualTo("CLOSED");
  }
  setServerProperty(orchestrator,"sonar.dbcleaner.daysBeforeDeletingClosedIssues","1");
  runProjectAnalysis(orchestrator,"shared/xoo-sample","sonar.dynamicAnalysis","false","sonar.projectDate","2014-10-20");
  assertThat(searchIssues(IssueQuery.create())).isEmpty();
}
