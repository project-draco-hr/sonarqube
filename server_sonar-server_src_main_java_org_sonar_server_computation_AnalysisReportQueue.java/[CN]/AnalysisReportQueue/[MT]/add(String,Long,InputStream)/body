{
  UserSession.get().checkGlobalPermission(GlobalPermissions.SCAN_EXECUTION);
  AnalysisReportDto report=newPendingAnalysisReport(projectKey).setSnapshotId(snapshotId).setData(reportData);
  DbSession session=dbClient.openSession(false);
  try {
    checkThatProjectExistsInDatabase(projectKey,session);
    return insertInDb(report,session);
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
