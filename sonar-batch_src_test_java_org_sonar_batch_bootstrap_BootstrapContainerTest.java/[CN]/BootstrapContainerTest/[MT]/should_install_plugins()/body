{
  PluginMetadata metadata=mock(PluginMetadata.class);
  FakePlugin plugin=new FakePlugin();
  BatchPluginRepository pluginRepository=mock(BatchPluginRepository.class);
  when(pluginRepository.getPluginsByMetadata()).thenReturn(ImmutableMap.<PluginMetadata,Plugin>of(metadata,plugin));
  BootstrapContainer container=spy(BootstrapContainer.create(Lists.newArrayList(pluginRepository)));
  doNothing().when(container).executeTask();
  container.doAfterStart();
  assertThat(container.getComponentsByType(Plugin.class)).containsOnly(plugin);
}
