{
  final String ruleKeyParam=request.param("k");
  Collection<Rule> foundRules=Collections.emptyList();
  boolean hasMore=false;
  long total=0L;
  if (ruleKeyParam == null) {
    PagedResult<Rule> searchResult=rules.find(RuleQuery.builder().searchQuery(request.param("s")).languages(RubyUtils.toStrings(request.param("languages"))).repositories(RubyUtils.toStrings(request.param("repositories"))).severities(RubyUtils.toStrings(request.param("severities"))).statuses(RubyUtils.toStrings(request.param("statuses"))).tags(RubyUtils.toStrings(request.param("tags"))).debtCharacteristics(RubyUtils.toStrings(request.param("debtCharacteristics"))).pageSize(request.paramAsInt("ps")).pageIndex(request.paramAsInt("p")).build());
    foundRules=searchResult.results();
    hasMore=searchResult.paging().hasNextPage();
    total=searchResult.paging().total();
  }
 else {
    RuleKey ruleKey=RuleKey.parse(ruleKeyParam);
    Rule rule=findRule(ruleKey);
    if (rule != null) {
      foundRules=Collections.singleton(rule);
      total=1L;
    }
    hasMore=false;
  }
  JsonWriter json=response.newJsonWriter();
  json.beginObject().name("results").beginArray();
  for (  Rule rule : foundRules) {
    json.beginObject();
    writeRule(rule,json);
    json.endObject();
  }
  json.endArray().prop("more",hasMore).prop("total",total).endObject().close();
}
