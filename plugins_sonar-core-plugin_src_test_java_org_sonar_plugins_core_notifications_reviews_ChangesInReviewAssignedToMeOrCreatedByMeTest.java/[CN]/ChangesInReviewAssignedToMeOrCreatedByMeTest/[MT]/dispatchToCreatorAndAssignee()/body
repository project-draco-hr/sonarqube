{
  Multimap<String,NotificationChannel> recipients=HashMultimap.create();
  recipients.put("simon",emailChannel);
  recipients.put("freddy",twitterChannel);
  recipients.put("godin",twitterChannel);
  when(notificationManager.findSubscribedRecipientsForDispatcher(dispatcher,42)).thenReturn(recipients);
  Notification notification=new Notification("review-changed").setFieldValue("projectId","42").setFieldValue("author","olivier").setFieldValue("creator","simon").setFieldValue("old.assignee","godin").setFieldValue("assignee","freddy");
  dispatcher.performDispatch(notification,context);
  verify(context).addUser("simon",emailChannel);
  verify(context).addUser("freddy",twitterChannel);
  verify(context).addUser("godin",twitterChannel);
  verifyNoMoreInteractions(context);
}
