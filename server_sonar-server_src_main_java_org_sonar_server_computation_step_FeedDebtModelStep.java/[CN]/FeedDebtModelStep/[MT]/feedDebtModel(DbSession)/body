{
  List<CharacteristicDto> characteristicDtos=dbClient.debtCharacteristicDao().selectEnabledCharacteristics(session);
  List<CharacteristicDto> rootCharacteristicDtos=FluentIterable.from(characteristicDtos).filter(isRootPredicate).toList();
  Multimap<Integer,CharacteristicDto> subCharacteristicDtosByParentId=FluentIterable.from(characteristicDtos).filter(Predicates.not(isRootPredicate)).index(dtoToParentIdFunction);
  for (  CharacteristicDto rootCharacteristicDto : rootCharacteristicDtos) {
    Collection<CharacteristicDto> subCharacteristicDtos=subCharacteristicDtosByParentId.get(rootCharacteristicDto.getId());
    Characteristic rootCharacteristic=toCharacteristic(rootCharacteristicDto);
    List<Characteristic> subCharacteristic=FluentIterable.from(subCharacteristicDtos).transform(dtoToCharFunction).toList();
    mutableDebtModelHolder.addCharacteristics(rootCharacteristic,subCharacteristic);
  }
}
