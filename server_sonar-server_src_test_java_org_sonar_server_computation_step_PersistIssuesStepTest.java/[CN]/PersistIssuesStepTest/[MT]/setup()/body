{
  dbTester.truncateTables();
  session=dbTester.myBatis().openSession(false);
  dbClient=new DbClient(dbTester.database(),dbTester.myBatis(),new IssueDao(dbTester.myBatis()),new RuleDao(system2));
  issueCache=new IssueCache(temp.newFile(),System2.INSTANCE);
  system2=mock(System2.class);
  when(system2.now()).thenReturn(NOW);
  step=new PersistIssuesStep(dbClient,system2,new UpdateConflictResolver(),new RuleCache(new RuleCacheLoader(dbClient)),issueCache);
}
