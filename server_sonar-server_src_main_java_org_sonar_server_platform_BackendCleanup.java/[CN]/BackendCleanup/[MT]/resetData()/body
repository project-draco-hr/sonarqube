{
  DbSession dbSession=myBatis.openSession(false);
  Connection connection=dbSession.getConnection();
  try {
    for (    String table : INSPECTION_TABLES) {
      try {
        connection.createStatement().execute("TRUNCATE TABLE " + table.toLowerCase());
        connection.commit();
      }
 catch (      Exception e) {
        throw new IllegalStateException("Fail to truncate db table " + table,e);
      }
    }
    for (    String relatedTable : RESOURCE_RELATED_TABLES) {
      deleteWhereResourceIdNotNull(relatedTable,connection);
    }
    deleteManualRules(connection);
    clearIndex(IssueIndexDefinition.INDEX);
    clearIndex(ViewIndexDefinition.INDEX);
  }
  finally {
    dbSession.close();
    DbUtils.closeQuietly(connection);
  }
}
