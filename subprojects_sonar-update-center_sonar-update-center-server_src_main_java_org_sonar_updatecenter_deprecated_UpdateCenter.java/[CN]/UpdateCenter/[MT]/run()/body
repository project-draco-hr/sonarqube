{
  ClassWorld classWorld=new ClassWorld("plexus.core",UpdateCenter.class.getClassLoader());
  ContainerConfiguration configuration=new DefaultContainerConfiguration().setClassWorld(classWorld);
  PlexusContainer plexus=new DefaultPlexusContainer(configuration);
  artifactFactory=plexus.lookup(ArtifactFactory.class);
  artifactResolver=plexus.lookup(ArtifactResolver.class);
  metadataSource=plexus.lookup(ArtifactMetadataSource.class);
  mavenProjectBuilder=plexus.lookup(MavenProjectBuilder.class);
  ArtifactRepositoryFactory artifactRepositoryFactory=plexus.lookup(ArtifactRepositoryFactory.class);
  ArtifactRepositoryPolicy policy=new ArtifactRepositoryPolicy(true,ArtifactRepositoryPolicy.UPDATE_POLICY_DAILY,ArtifactRepositoryPolicy.CHECKSUM_POLICY_WARN);
  remoteRepositories=Collections.singletonList(artifactRepositoryFactory.createArtifactRepository("codehaus","http://repository.codehaus.org/",new DefaultRepositoryLayout(),policy,policy));
  File localRepo=new File(new File(System.getProperty("user.home")),".m2/repository");
  localRepository=artifactRepositoryFactory.createArtifactRepository("local",localRepo.toURI().toURL().toExternalForm(),new DefaultRepositoryLayout(),policy,policy);
  JSONObject obj=new JSONObject();
  obj.put("version","1");
  obj.put("plugins",resolvePlugins());
  obj.put("sonar",resolveSonar());
  if (outputDirectory != null) {
    FileUtils.writeStringToFile(new File(outputDirectory,"update-center.json"),obj.toJSONString());
  }
}
