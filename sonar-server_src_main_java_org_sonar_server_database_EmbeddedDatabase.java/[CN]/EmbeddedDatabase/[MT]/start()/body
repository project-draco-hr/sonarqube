{
  File dbHome=getDataDirectory(settings);
  if (dbHome.exists() && !dbHome.isDirectory()) {
    throw new SonarException("Database home " + dbHome.getPath() + " is not a directory");
  }
  if (!dbHome.exists()) {
    dbHome.mkdirs();
  }
  String port=getSetting(DatabaseProperties.PROP_EMBEDDED_PORT,DatabaseProperties.PROP_EMBEDDED_PORT_DEFAULT_VALUE);
  String user=getSetting(DatabaseProperties.PROP_USER,DatabaseProperties.PROP_USER_DEFAULT_VALUE);
  String password=getSetting(DatabaseProperties.PROP_PASSWORD,DatabaseProperties.PROP_PASSWORD_DEFAULT_VALUE);
  String url=getSetting(DatabaseProperties.PROP_URL,DatabaseProperties.PROP_USER_DEFAULT_VALUE);
  try {
    if (url.contains("/mem:")) {
      server=Server.createTcpServer("-tcpPort",port,"-tcpAllowOthers","-baseDir",dbHome.getAbsolutePath());
    }
 else {
      createDatabase(dbHome,user,password);
      server=Server.createTcpServer("-tcpPort",port,"-tcpAllowOthers","-ifExists","-baseDir",dbHome.getAbsolutePath());
    }
    LOG.info("Starting embedded database on port " + server.getPort() + " with url "+ url);
    server.start();
    LOG.info("Embedded database started. Data stored in: " + dbHome.getAbsolutePath());
  }
 catch (  Exception e) {
    throw new SonarException("Unable to start database",e);
  }
}
