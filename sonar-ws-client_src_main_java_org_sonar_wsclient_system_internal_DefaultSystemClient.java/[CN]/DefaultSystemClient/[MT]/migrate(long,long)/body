{
  if (rateInMs >= timeoutInMs) {
    throw new IllegalArgumentException("Timeout must be greater than rate");
  }
  Migration migration=null;
  boolean running=true;
  long endAt=System.currentTimeMillis() + timeoutInMs;
  while (running && System.currentTimeMillis() < endAt) {
    migration=migrate();
    if (migration.status() == Migration.Status.MIGRATION_NEEDED || migration.status() == Migration.Status.MIGRATION_RUNNING) {
      sleepQuietly(rateInMs);
    }
 else {
      running=false;
    }
  }
  return migration;
}
