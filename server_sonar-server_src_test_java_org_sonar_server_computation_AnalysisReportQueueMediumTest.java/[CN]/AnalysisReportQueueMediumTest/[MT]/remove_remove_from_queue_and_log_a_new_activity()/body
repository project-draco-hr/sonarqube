{
  insertPermissionsForProject(DEFAULT_PROJECT_KEY);
  sut.add(DEFAULT_PROJECT_KEY,123L);
  AnalysisReportDto report=sut.bookNextAvailable();
  report.setStatus(SUCCESS);
  sut.remove(report);
  assertThat(sut.all()).isEmpty();
  List<Activity> activities=tester.get(ActivityIndex.class).findAll().getHits();
  Map<String,String> details=activities.get(0).details();
  assertThat(activities).hasSize(1);
  assertThat(details.get("finishedAt")).isNotEmpty();
}
