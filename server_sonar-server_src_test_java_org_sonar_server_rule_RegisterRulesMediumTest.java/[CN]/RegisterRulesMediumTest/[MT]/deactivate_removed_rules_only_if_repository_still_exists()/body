{
  register(new Rules(){
    @Override public void init(    RulesDefinition.NewRepository repository){
      repository.createRule("x1").setName("x1 name").setHtmlDescription("x1 desc");
    }
  }
);
  userSessionRule.logon().setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN);
  db.qualityProfileDao().insert(dbSession,QProfileTesting.newXooP1());
  dbSession.commit();
  dbSession.clearCache();
  RuleActivation activation=new RuleActivation(RuleTesting.XOO_X1);
  TESTER.get(QProfileService.class).activate(QProfileTesting.XOO_P1_KEY,activation);
  register(new Rules(){
    @Override public void init(    RulesDefinition.NewRepository repository){
      repository.createRule("x2").setName("x2 name").setHtmlDescription("x2 desc");
    }
  }
);
  assertThat(ruleIndex.getByKey(RuleKey.of("xoo","x1")).status()).isEqualTo(RuleStatus.REMOVED);
  assertThat(ruleIndex.getByKey(RuleKey.of("xoo","x2")).status()).isEqualTo(RuleStatus.READY);
  assertThat(activeRuleIndex.findByProfile(QProfileTesting.XOO_P1_KEY)).hasSize(0);
}
