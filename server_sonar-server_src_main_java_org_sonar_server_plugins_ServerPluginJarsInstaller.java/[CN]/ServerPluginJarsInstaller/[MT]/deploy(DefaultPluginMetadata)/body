{
  LOG.info("Deploy plugin {}",Joiner.on(" / ").skipNulls().join(plugin.getName(),plugin.getVersion(),plugin.getImplementationBuild()));
  if (!plugin.isCompatibleWith(server.getVersion())) {
    throw MessageException.of(String.format("Plugin %s needs a more recent version of SonarQube than %s. At least %s is expected",plugin.getKey(),server.getVersion(),plugin.getSonarVersion()));
  }
  try {
    File pluginDeployDir=new File(fs.getDeployedPluginsDir(),plugin.getKey());
    FileUtils.forceMkdir(pluginDeployDir);
    FileUtils.cleanDirectory(pluginDeployDir);
    installer.installToDir(plugin,pluginDeployDir);
  }
 catch (  IOException e) {
    throw new IllegalStateException("Fail to deploy the plugin " + plugin,e);
  }
}
