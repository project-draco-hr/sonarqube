{
  boolean isUserReactivated=false;
  UserDto userDto=createNewUserDto(dbSession,newUser);
  String login=userDto.getLogin();
  Optional<UserDto> existingUser=dbClient.userDao().selectByExternalIdentity(dbSession,userDto.getExternalIdentity(),userDto.getExternalIdentityProvider());
  if (!existingUser.isPresent()) {
    saveUser(dbSession,userDto);
    addDefaultGroup(dbSession,userDto);
  }
 else {
    isUserReactivated=reactivateUser(dbSession,existingUser.get(),login,newUser);
  }
  dbSession.commit();
  notifyNewUser(userDto.getLogin(),userDto.getName(),newUser.email());
  userIndexer.index();
  return isUserReactivated;
}
