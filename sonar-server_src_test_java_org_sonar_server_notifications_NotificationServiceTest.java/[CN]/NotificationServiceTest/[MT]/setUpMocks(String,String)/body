{
  when(emailChannel.getKey()).thenReturn("email");
  when(gtalkChannel.getKey()).thenReturn("gtalk");
  when(commentOnReviewAssignedToMe.getKey()).thenReturn("comment on review assigned to me");
  when(commentOnReviewCreatedByMe.getKey()).thenReturn("comment on review created by me");
  when(queueElement.getNotification()).thenReturn(notification);
  when(manager.getFromQueue()).thenReturn(queueElement).thenReturn(null);
  doAnswer(addUser(assignee)).when(commentOnReviewAssignedToMe).dispatch(same(notification),any(NotificationDispatcher.Context.class));
  doAnswer(addUser(creator)).when(commentOnReviewCreatedByMe).dispatch(same(notification),any(NotificationDispatcher.Context.class));
  Settings settings=new Settings().setProperty("sonar.notifications.delay",1L);
  service=new NotificationService(settings,manager,new NotificationDispatcher[]{commentOnReviewAssignedToMe,commentOnReviewCreatedByMe},new NotificationChannel[]{emailChannel,gtalkChannel});
}
