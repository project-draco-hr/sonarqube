{
  String mainClass=metadata.getMainClass();
  File pluginFile=metadata.getFile();
  try {
    File tempFile=File.createTempFile(pluginFile.getName(),null);
    FileUtils.copyFile(pluginFile,tempFile);
    URLClassLoader pluginClassLoader=URLClassLoader.newInstance(new URL[]{tempFile.toURI().toURL()},getClass().getClassLoader());
    Plugin pluginInstance=(Plugin)pluginClassLoader.loadClass(mainClass).newInstance();
    metadata.setKey(PluginKeyUtils.sanitize(pluginInstance.getKey()));
    metadata.setDescription(pluginInstance.getDescription());
    metadata.setName(pluginInstance.getName());
  }
 catch (  Exception e) {
    throw new IllegalStateException("The metadata main class can not be created. Plugin file=" + pluginFile.getName() + ", class="+ mainClass,e);
  }
}
