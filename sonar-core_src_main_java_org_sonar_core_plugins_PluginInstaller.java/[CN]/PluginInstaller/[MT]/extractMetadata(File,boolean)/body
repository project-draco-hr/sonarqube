{
  try {
    PluginManifest manifest=new PluginManifest(file);
    DefaultPluginMetadata metadata=DefaultPluginMetadata.create(file);
    metadata.setKey(manifest.getKey());
    metadata.setName(manifest.getName());
    metadata.setDescription(manifest.getDescription());
    metadata.setLicense(manifest.getLicense());
    metadata.setOrganization(manifest.getOrganization());
    metadata.setOrganizationUrl(manifest.getOrganizationUrl());
    metadata.setMainClass(manifest.getMainClass());
    metadata.setVersion(manifest.getVersion());
    metadata.setSonarVersion(manifest.getSonarVersion());
    metadata.setHomepage(manifest.getHomepage());
    metadata.setPathsToInternalDeps(manifest.getDependencies());
    metadata.setUseChildFirstClassLoader(manifest.isUseChildFirstClassLoader());
    metadata.setBasePlugin(manifest.getBasePlugin());
    metadata.setCore(isCore);
    if (metadata.isOldManifest()) {
      completeDeprecatedMetadata(metadata);
    }
    return metadata;
  }
 catch (  IOException e) {
    throw new IllegalStateException("Fail to extract plugin metadata from file: " + file,e);
  }
}
