{
  if (database == null) {
    database=new H2Database("sonarHibernate",true);
    database.start();
    databaseCommands=DatabaseCommands.forDialect(database.getDialect());
    databaseTester=new DataSourceDatabaseTester(database.getDataSource());
    DefaultDatabaseConnector dbConnector=new MemoryDatabaseConnector(database);
    dbConnector.start();
    session=new JpaDatabaseSession(dbConnector);
    session.start();
    myBatis=new MyBatis(database,new Logback(),queue);
    myBatis.start();
  }
  databaseCommands.truncateDatabase(database.getDataSource());
}
