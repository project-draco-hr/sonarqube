{
  SecurityRealm realm=spy(new AlwaysFailsRealm());
  settings.setProperty(CoreProperties.CORE_AUTHENTICATOR_REALM,realm.getName());
  try {
    new SecurityRealmFactory(settings,new SecurityRealm[]{realm}).start();
    fail();
  }
 catch (  SonarException e) {
    assertThat(e.getCause(),instanceOf(IllegalStateException.class));
    assertThat(e.getMessage(),containsString("Security realm fails to start"));
  }
}
