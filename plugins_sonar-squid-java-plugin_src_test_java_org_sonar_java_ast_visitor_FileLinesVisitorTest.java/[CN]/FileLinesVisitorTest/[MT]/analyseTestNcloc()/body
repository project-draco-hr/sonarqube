{
  ArgumentCaptor<Resource> resourceCaptor=ArgumentCaptor.forClass(Resource.class);
  when(context.createFileLinesContext(resourceCaptor.capture())).thenReturn(measures);
  squid.register(SonarAccessor.class).setSensorContext(context);
  squid.register(JavaAstScanner.class).scanFile(SquidTestUtils.getInputFile("/metrics/ncloc/TestNcloc.java"));
  assertThat(resourceCaptor.getValue().getKey(),is("[default].TestNcloc"));
  verify(measures).setIntValue(CoreMetrics.NCLOC_DATA_KEY,1,1);
  verify(measures).setIntValue(CoreMetrics.NCLOC_DATA_KEY,2,0);
  verify(measures).setIntValue(CoreMetrics.NCLOC_DATA_KEY,3,1);
  verify(measures).save();
}
