{
  squid.register(SonarAccessor.class).setSensorContext(context);
  squid.register(JavaAstScanner.class).scanFile(SquidTestUtils.getInputFile("/metrics/ncloc/TestNcloc.java"));
  ArgumentCaptor<Resource> resourceCaptor=ArgumentCaptor.forClass(Resource.class);
  ArgumentCaptor<Measure> measureCaptor=ArgumentCaptor.forClass(Measure.class);
  verify(context,times(1)).saveMeasure(resourceCaptor.capture(),measureCaptor.capture());
  assertThat(resourceCaptor.getValue().getKey(),is("[default].TestNcloc"));
  Measure measure=measureCaptor.getValue();
  assertThat(measure.getMetricKey(),is(CoreMetrics.NCLOC_DATA_KEY));
  assertThat(measure.getPersistenceMode(),is(PersistenceMode.DATABASE));
  assertThat(measure.getData(),is("1,3,4,5,6,7,8,13,14,15,16,17,19,20,21,22,23,24,25,26,27,28,29,30,32,39"));
}
