{
  computeComponentsRefCache.addComponent(1,new ComputeComponentsRefCache.ComputeComponent(PROJECT_KEY,"PROJECT_UUID"));
  computeComponentsRefCache.addComponent(2,new ComputeComponentsRefCache.ComputeComponent("PROJECT_KEY:file1","FILE1_UUID"));
  computeComponentsRefCache.addComponent(3,new ComputeComponentsRefCache.ComputeComponent("PROJECT_KEY:file2","FILE2_UUID"));
  File reportDir=generateReport();
  ComputationContext context=new ComputationContext(new BatchReportReader(reportDir),PROJECT_KEY,new Settings(),mock(DbClient.class),ComponentTreeBuilders.from(DumbComponent.DUMB_PROJECT),mock(LanguageRepository.class));
  sut.execute(context);
  assertThat(context.getReportMetadata().getRootComponentRef()).isEqualTo(1);
  assertThat(context.getReportMetadata().getDeletedComponentsCount()).isEqualTo(1);
  verify(issueComputation).processComponentIssues(context,Collections.<BatchReport.Issue>emptyList(),"PROJECT_UUID",1,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).processComponentIssues(context,Collections.<BatchReport.Issue>emptyList(),"FILE1_UUID",2,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).processComponentIssues(context,Collections.<BatchReport.Issue>emptyList(),"FILE2_UUID",3,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).processComponentIssues(context,ISSUES_ON_DELETED_COMPONENT,"DELETED_UUID",null,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).afterReportProcessing();
}
