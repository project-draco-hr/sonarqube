{
  AnalysisReportDto reportDto=prepareAnalysisReportInDb();
  IssueComputation issueComputation=mock(IssueComputation.class);
  DbClient dbClient=new DbClient(dbTester.database(),dbTester.myBatis(),new AnalysisReportDao());
  ParseReportStep step=new ParseReportStep(issueComputation,dbClient,new DefaultTempFolder(temp.newFolder()));
  ComputationContext context=new ComputationContext(reportDto,mock(ComponentDto.class));
  step.execute(context);
  verify(issueComputation).processComponentIssues(context,"PROJECT_UUID",Collections.<BatchReport.Issue>emptyList());
  verify(issueComputation).processComponentIssues(context,"FILE1_UUID",Collections.<BatchReport.Issue>emptyList());
  verify(issueComputation).processComponentIssues(context,"FILE2_UUID",Collections.<BatchReport.Issue>emptyList());
  verify(issueComputation).afterReportProcessing();
  assertThat(context.getReportMetadata().getRootComponentRef()).isEqualTo(1);
}
