{
  DumbComponent root=DumbComponent.builder(Component.Type.PROJECT,1).setUuid("PROJECT_UUID").setKey(PROJECT_KEY).addChildren(DumbComponent.builder(Component.Type.FILE,2).setUuid("FILE1_UUID").setKey("PROJECT_KEY:file1").build(),DumbComponent.builder(Component.Type.FILE,3).setUuid("FILE2_UUID").setKey("PROJECT_KEY:file2").build()).build();
  generateReport();
  treeRootHolder.setRoot(root);
  sut.execute();
  assertThat(reportReader.readMetadata().getRootComponentRef()).isEqualTo(1);
  assertThat(reportReader.readMetadata().getDeletedComponentsCount()).isEqualTo(1);
  verify(issueComputation).processComponentIssues(Collections.<BatchReport.Issue>emptyList(),"PROJECT_UUID",1,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).processComponentIssues(Collections.<BatchReport.Issue>emptyList(),"FILE1_UUID",2,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).processComponentIssues(Collections.<BatchReport.Issue>emptyList(),"FILE2_UUID",3,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).processComponentIssues(ISSUES_ON_DELETED_COMPONENT,"DELETED_UUID",null,PROJECT_KEY,"PROJECT_UUID");
  verify(issueComputation).afterReportProcessing();
}
