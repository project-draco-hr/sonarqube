{
  userSession.login().setGlobalPermissions(GlobalPermissions.SYSTEM_ADMIN);
  dbClient=db.getDbClient();
  dbSession=db.getSession();
  defaultTemplatePermissionFinder=mock(DefaultPermissionTemplateFinder.class);
  when(defaultTemplatePermissionFinder.getDefaultTemplateUuids()).thenReturn(Collections.<String>emptySet());
  PermissionDependenciesFinder finder=new PermissionDependenciesFinder(dbClient,new ComponentFinder(dbClient),resourceTypes);
  ws=new WsActionTester(new DeleteTemplateAction(dbClient,userSession,finder,defaultTemplatePermissionFinder));
  permissionTemplate=insertTemplateAndAssociatedPermissions(newPermissionTemplateDto().setUuid(TEMPLATE_UUID));
  PermissionTemplateDto permissionTemplateInDatabase=dbClient.permissionTemplateDao().selectByUuidWithUserAndGroupPermissions(dbSession,TEMPLATE_UUID);
  assertThat(permissionTemplateInDatabase.getUuid()).isEqualTo(TEMPLATE_UUID);
  assertThat(permissionTemplateInDatabase.getGroupsPermissions()).isNotEmpty();
  assertThat(permissionTemplateInDatabase.getUsersPermissions()).isNotEmpty();
}
