{
  final SimpleDateFormat format=new SimpleDateFormat("yyyy-MM-dd");
  final Date date=format.parse("2010-05-18");
  Snapshot snapshot=new Snapshot();
  snapshot.setCreatedAt(date);
  when(finderByPreviousAnalysis.findByPreviousAnalysis(null)).thenReturn(new PastSnapshot(CoreProperties.TIMEMACHINE_MODE_PREVIOUS_ANALYSIS,date,snapshot));
  PastSnapshot variationSnapshot=finder.find(null,2,CoreProperties.TIMEMACHINE_MODE_PREVIOUS_ANALYSIS);
  verify(finderByPreviousAnalysis).findByPreviousAnalysis(null);
  assertThat(variationSnapshot.getIndex(),is(2));
  assertThat(variationSnapshot.getMode(),is(CoreProperties.TIMEMACHINE_MODE_PREVIOUS_ANALYSIS));
  assertThat(variationSnapshot.getProjectSnapshot(),not(nullValue()));
}
