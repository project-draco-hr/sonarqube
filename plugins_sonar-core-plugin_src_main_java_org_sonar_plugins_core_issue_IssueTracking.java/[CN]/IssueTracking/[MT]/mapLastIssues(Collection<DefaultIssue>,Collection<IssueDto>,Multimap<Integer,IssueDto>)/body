{
  unmappedLastIssues.addAll(lastIssues);
  for (  IssueDto lastIssue : lastIssues) {
    lastIssuesByRule.put(getRuleId(lastIssue),lastIssue);
  }
  for (  DefaultIssue newIssue : newIssues) {
    mapIssue(newIssue,findLastIssueWithSameKey(newIssue,lastIssuesByRule.get(getRuleId(newIssue))),lastIssuesByRule,referenceIssuesMap);
  }
  for (  DefaultIssue newIssue : newIssues) {
    if (isNotAlreadyMapped(newIssue)) {
      mapIssue(newIssue,findLastIssueWithSameLineAndChecksum(newIssue,lastIssuesByRule.get(getRuleId(newIssue))),lastIssuesByRule,referenceIssuesMap);
    }
  }
}
