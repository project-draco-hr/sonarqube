{
  treeRootHolder.setRoot(BALANCED_COMPONENT_TREE);
  measureRepository.addRawMeasure(1111,LINES_KEY,newMeasureBuilder().create(10));
  measureRepository.addRawMeasure(1112,LINES_KEY,newMeasureBuilder().create(8));
  measureRepository.addRawMeasure(1211,LINES_KEY,newMeasureBuilder().create(2));
  FormulaExecutorComponentVisitor underTest=FormulaExecutorComponentVisitor.newBuilder(metricRepository,measureRepository).withVariationSupport(periodsHolder).buildFor(ImmutableList.<Formula>of(new FakeMultiMetricFormula()));
  underTest.visit(BALANCED_COMPONENT_TREE);
  assertThat(measureRepository.getAddedRawMeasure(1,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(30);
  assertThat(measureRepository.getAddedRawMeasure(1,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(120);
  assertThat(measureRepository.getAddedRawMeasure(11,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(28);
  assertThat(measureRepository.getAddedRawMeasure(11,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(118);
  assertThat(measureRepository.getAddedRawMeasure(111,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(28);
  assertThat(measureRepository.getAddedRawMeasure(111,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(118);
  assertThat(measureRepository.getAddedRawMeasure(1111,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(20);
  assertThat(measureRepository.getAddedRawMeasure(1111,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(110);
  assertThat(measureRepository.getAddedRawMeasure(1112,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(18);
  assertThat(measureRepository.getAddedRawMeasure(1112,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(108);
  assertThat(measureRepository.getAddedRawMeasure(12,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(12);
  assertThat(measureRepository.getAddedRawMeasure(12,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(102);
  assertThat(measureRepository.getAddedRawMeasure(121,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(12);
  assertThat(measureRepository.getAddedRawMeasure(121,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(102);
  assertThat(measureRepository.getAddedRawMeasure(1211,NEW_LINES_TO_COVER_KEY).get().getIntValue()).isEqualTo(12);
  assertThat(measureRepository.getAddedRawMeasure(1211,NEW_IT_COVERAGE_KEY).get().getIntValue()).isEqualTo(102);
}
