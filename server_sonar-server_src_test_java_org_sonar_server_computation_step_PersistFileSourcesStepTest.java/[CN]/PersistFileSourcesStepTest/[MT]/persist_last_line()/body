{
  BatchReportWriter writer=new BatchReportWriter(reportDir);
  FileUtils.writeLines(writer.getFileStructure().fileFor(FileStructure.Domain.SOURCE,FILE_REF),Lists.newArrayList("line1","line2"));
  writer.writeMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).setProjectKey("PROJECT_KEY").build());
  writer.writeComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).setUuid(PROJECT_UUID).addChildRef(FILE_REF).build());
  writer.writeComponent(BatchReport.Component.newBuilder().setRef(FILE_REF).setType(Constants.ComponentType.FILE).setUuid(FILE_UUID).setLines(3).build());
  sut.execute(new ComputationContext(new BatchReportReader(reportDir),ComponentTesting.newProjectDto(PROJECT_UUID)));
  assertThat(dbTester.countRowsOfTable("file_sources")).isEqualTo(1);
  FileSourceDto fileSourceDto=dbClient.fileSourceDao().selectSource(FILE_UUID);
  FileSourceDb.Data data=FileSourceDto.decodeSourceData(fileSourceDto.getBinaryData());
  assertThat(data.getLinesCount()).isEqualTo(3);
  assertThat(data.getLines(2).getLine()).isEqualTo(3);
  assertThat(data.getLines(2).getSource()).isEmpty();
}
