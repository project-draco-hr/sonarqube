{
  dbComponentsRefCache.addComponent(1,new DbComponentsRefCache.DbComponent(1L,PROJECT_KEY,PROJECT_UUID));
  dbComponentsRefCache.addComponent(FILE_REF,new DbComponentsRefCache.DbComponent(2L,"PROJECT_KEY:file",FILE_UUID));
  reportReader.setMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).setProjectKey(PROJECT_KEY).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).addChildRef(FILE_REF).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(FILE_REF).setType(Constants.ComponentType.FILE).setLines(3).build());
  reportReader.putFileSourceLines(FILE_REF,"line1","line2");
  sut.execute();
  assertThat(dbTester.countRowsOfTable("file_sources")).isEqualTo(1);
  FileSourceDto fileSourceDto=dbClient.fileSourceDao().selectSource(FILE_UUID);
  FileSourceDb.Data data=FileSourceDto.decodeSourceData(fileSourceDto.getBinaryData());
  assertThat(data.getLinesCount()).isEqualTo(3);
  assertThat(data.getLines(2).getLine()).isEqualTo(3);
  assertThat(data.getLines(2).getSource()).isEmpty();
}
