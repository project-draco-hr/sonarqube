{
  BatchReportWriter writer=initReport();
  writer.writeComponent(BatchReport.Component.newBuilder().setRef(FILE_REF).setType(Constants.ComponentType.FILE).setUuid(FILE_UUID).setLines(3).build());
  File sourceFile=writer.getFileStructure().fileFor(FileStructure.Domain.SOURCE,FILE_REF);
  FileUtils.writeLines(sourceFile,Lists.newArrayList("line1","line2"));
  sut.execute(new ComputationContext(new BatchReportReader(reportDir),ComponentTesting.newProjectDto(PROJECT_UUID)));
  assertThat(dbTester.countRowsOfTable("file_sources")).isEqualTo(1);
  FileSourceDto fileSourceDto=dbClient.fileSourceDao().select(FILE_UUID);
  FileSourceDb.Data data=FileSourceDto.decodeData(fileSourceDto.getBinaryData());
  assertThat(data.getLinesCount()).isEqualTo(3);
  assertThat(data.getLines(2).getLine()).isEqualTo(3);
  assertThat(data.getLines(2).getSource()).isEmpty();
}
