{
  ByteList input=string.getByteList();
  ByteList output=new ByteList(before.getBytes());
  for (int i=input.begin; i < input.begin + input.realSize; i++) {
    byte b1=input.bytes[i];
    byte higher=HEX[(((char)b1) >> 4) % 16];
    byte lower=HEX[((char)b1) % 16];
    if (b1 == '\'') {
      output.append(higher);
      output.append(lower);
    }
    output.append(higher);
    output.append(lower);
  }
  output.append(after.getBytes());
  return runtime.newStringShared(output);
}
