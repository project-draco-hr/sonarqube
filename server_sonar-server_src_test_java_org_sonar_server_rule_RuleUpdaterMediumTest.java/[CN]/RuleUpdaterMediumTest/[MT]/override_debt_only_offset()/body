{
  insertDebtCharacteristics(dbSession);
  ruleDao.insert(dbSession,RuleTesting.newDto(RULE_KEY).setDefaultSubCharacteristicId(hardReliabilityId).setDefaultRemediationFunction(DebtRemediationFunction.Type.LINEAR.name()).setDefaultRemediationCoefficient("1d").setDefaultRemediationOffset(null).setRemediationFunction(null).setRemediationCoefficient(null).setRemediationOffset(null));
  dbSession.commit();
  RuleUpdate update=RuleUpdate.createForPluginRule(RULE_KEY).setDebtRemediationFunction(new DefaultDebtRemediationFunction(DebtRemediationFunction.Type.LINEAR,"2d",null));
  updater.update(update,userSessionRule);
  dbSession.clearCache();
  Rule indexedRule=tester.get(RuleIndex.class).getByKey(RULE_KEY);
  assertThat(indexedRule.debtCharacteristicKey()).isEqualTo("RELIABILITY");
  assertThat(indexedRule.debtSubCharacteristicKey()).isEqualTo("HARD_RELIABILITY");
  assertThat(indexedRule.debtRemediationFunction().type()).isEqualTo(DebtRemediationFunction.Type.LINEAR);
  assertThat(indexedRule.debtRemediationFunction().coefficient()).isEqualTo("2d");
  assertThat(indexedRule.debtRemediationFunction().offset()).isNull();
  assertThat(indexedRule.debtOverloaded()).isTrue();
  assertThat(indexedRule.defaultDebtCharacteristicKey()).isEqualTo("RELIABILITY");
  assertThat(indexedRule.defaultDebtSubCharacteristicKey()).isEqualTo("HARD_RELIABILITY");
  assertThat(indexedRule.defaultDebtRemediationFunction().type()).isEqualTo(DebtRemediationFunction.Type.LINEAR);
  assertThat(indexedRule.defaultDebtRemediationFunction().coefficient()).isEqualTo("1d");
  assertThat(indexedRule.defaultDebtRemediationFunction().offset()).isNull();
}
