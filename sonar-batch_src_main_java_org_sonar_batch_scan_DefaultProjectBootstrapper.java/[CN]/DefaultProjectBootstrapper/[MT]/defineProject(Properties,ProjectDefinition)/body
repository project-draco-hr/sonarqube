{
  File baseDir=new File(properties.getProperty(PROPERTY_PROJECT_BASEDIR));
  if (properties.containsKey(PROPERTY_MODULES)) {
    checkMandatoryProperties(properties,MANDATORY_PROPERTIES_FOR_MULTIMODULE_PROJECT);
  }
 else {
    checkMandatoryProperties(properties,MANDATORY_PROPERTIES_FOR_SIMPLE_PROJECT);
  }
  final String projectKey=properties.getProperty(CoreProperties.PROJECT_KEY_PROPERTY);
  checkProjectKeyValid(projectKey);
  File workDir;
  if (parent == null) {
    validateDirectories(properties,baseDir,projectKey);
    workDir=initRootProjectWorkDir(baseDir);
  }
 else {
    workDir=initModuleWorkDir(properties);
  }
  ProjectDefinition definition=ProjectDefinition.create().setProperties(properties).setBaseDir(baseDir).setWorkDir(workDir);
  return definition;
}
