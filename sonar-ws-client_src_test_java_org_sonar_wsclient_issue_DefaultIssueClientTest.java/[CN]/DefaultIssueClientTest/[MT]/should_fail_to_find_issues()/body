{
  HttpRequestFactory requestFactory=new HttpRequestFactory(httpServer.url());
  httpServer.doReturnStatus(500);
  IssueClient client=new DefaultIssueClient(requestFactory);
  try {
    client.find(IssueQuery.create());
    fail();
  }
 catch (  IllegalStateException e) {
    assertThat(e).hasMessage("Fail to search for issues. Bad HTTP response status: 500");
  }
}
