{
  HttpServletRequest request=(HttpServletRequest)servletRequest;
  HttpServletResponse response=(HttpServletResponse)servletResponse;
  ThreadLocalSettings settings=platform.getContainer().getComponentByType(ThreadLocalSettings.class);
  UserSessionInitializer userSessionInitializer=platform.getContainer().getComponentByType(UserSessionInitializer.class);
  settings.load();
  try {
    if (userSessionInitializer == null || userSessionInitializer.initUserSession(request,response)) {
      chain.doFilter(servletRequest,servletResponse);
    }
  }
  finally {
    if (userSessionInitializer != null) {
      userSessionInitializer.removeUserSession();
    }
    settings.unload();
  }
}
