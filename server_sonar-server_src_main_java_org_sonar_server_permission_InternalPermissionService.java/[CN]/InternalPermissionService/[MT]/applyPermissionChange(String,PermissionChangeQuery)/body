{
  DbSession session=dbClient.openSession(false);
  boolean changed;
  try {
    if (permissionChangeQuery.targetsUser()) {
      changed=applyUserPermissionChange(session,operation,permissionChangeQuery);
    }
 else {
      changed=applyGroupPermissionChange(session,operation,permissionChangeQuery);
    }
    if (changed) {
      String project=permissionChangeQuery.component();
      if (project != null) {
        synchronizePermissions(session,dbClient.componentDao().getAuthorizedComponentByKey(project,session).uuid());
      }
      session.commit();
    }
  }
  finally {
    session.close();
  }
}
