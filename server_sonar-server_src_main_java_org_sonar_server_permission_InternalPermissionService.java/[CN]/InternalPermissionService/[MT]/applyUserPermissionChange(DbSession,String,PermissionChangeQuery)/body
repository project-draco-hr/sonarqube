{
  Long componentId=getComponentId(session,permissionChangeQuery.component());
  checkProjectAdminPermission(permissionChangeQuery.component());
  List<String> existingPermissions=permissionFacade.selectUserPermissions(session,permissionChangeQuery.user(),componentId);
  if (shouldSkipPermissionChange(operation,existingPermissions,permissionChangeQuery)) {
    LOG.info("Skipping permission change '{} {}' for user {} as it matches the current permission scheme",new String[]{operation,permissionChangeQuery.permission(),permissionChangeQuery.user()});
    return false;
  }
 else {
    Long targetedUser=getTargetedUser(session,permissionChangeQuery.user());
    if (ADD.equals(operation)) {
      permissionFacade.insertUserPermission(componentId,targetedUser,permissionChangeQuery.permission(),session);
    }
 else {
      permissionFacade.deleteUserPermission(componentId,targetedUser,permissionChangeQuery.permission(),session);
    }
    return true;
  }
}
