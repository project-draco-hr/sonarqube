{
  insertAnalysis("P1","A1",SnapshotDto.STATUS_PROCESSED,true);
  insertAnalysis("P1","A2",SnapshotDto.STATUS_UNPROCESSED,false);
  insertAnalysis("P2","A3",SnapshotDto.STATUS_PROCESSED,true);
  db.commit();
  underTest.switchIsLastFlagAndSetProcessedStatus(db.getSession(),"P1","A2");
  verifyStatusAndIsLastFlag("A1",SnapshotDto.STATUS_PROCESSED,false);
  verifyStatusAndIsLastFlag("A2",SnapshotDto.STATUS_PROCESSED,true);
  verifyStatusAndIsLastFlag("A3",SnapshotDto.STATUS_PROCESSED,true);
}
