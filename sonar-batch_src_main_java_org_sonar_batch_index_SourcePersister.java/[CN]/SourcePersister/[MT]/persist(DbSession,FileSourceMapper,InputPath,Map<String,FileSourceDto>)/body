{
  DefaultInputFile inputFile=(DefaultInputFile)inputPath;
  org.sonar.api.resources.File file=(org.sonar.api.resources.File)resourceCache.get(inputFile.key());
  String fileUuid=file.getUuid();
  FileSourceDto previous=fileSourceDtoByFileUuid.get(fileUuid);
  String newData=getSourceData(inputFile);
  String newDataHash=newData != null ? DigestUtils.md5Hex(newData) : "0";
  Date now=system2.newDate();
  if (previous == null) {
    FileSourceDto newFileSource=new FileSourceDto().setProjectUuid(projectTree.getRootProject().getUuid()).setFileUuid(fileUuid).setStringData(newData).setDataHash(newDataHash).setCreatedAt(now).setUpdatedAt(now);
    mapper.insert(newFileSource);
    session.commit();
  }
 else {
    if (!newDataHash.equals(previous.getDataHash())) {
      previous.setStringData(newData).setDataHash(newDataHash).setUpdatedAt(now);
      mapper.update(previous);
      session.commit();
    }
  }
}
