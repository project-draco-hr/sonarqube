{
  Snapshot snapshot=resourcePersister.getSnapshotOrFail(resource);
  if (isCached(snapshot)) {
    throw new DuplicatedSourceException(resource);
  }
  session.save(new SnapshotSource(snapshot.getId(),source));
  session.commit();
  addToCache(snapshot);
}
