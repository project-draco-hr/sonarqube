{
  Snapshot snapshot=resourcePersister.saveResource(project,resource);
  if (snapshot != null) {
    if (savedSnapshotIds.contains(snapshot.getId())) {
      throw new SonarException("Can not set twice the source of " + resource);
    }
    session.save(new SnapshotSource(snapshot.getId(),source));
    session.commit();
    savedSnapshotIds.add(snapshot.getId());
  }
}
