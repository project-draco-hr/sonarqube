{
  Stream stream=response.stream();
  stream.setMediaType(MediaTypes.XML);
  DbSession dbSession=dbClient.openSession(false);
  OutputStreamWriter writer=new OutputStreamWriter(stream.output(),StandardCharsets.UTF_8);
  try {
    String profileKey=QProfileIdentificationParamUtils.getProfileKeyFromParameters(request,profileFactory,dbSession);
    response.setHeader("Content-Disposition",String.format("attachment; filename=%s.xml",profileKey));
    backuper.backup(profileKey,writer);
  }
  finally {
    dbSession.close();
    IOUtils.closeQuietly(writer);
  }
}
