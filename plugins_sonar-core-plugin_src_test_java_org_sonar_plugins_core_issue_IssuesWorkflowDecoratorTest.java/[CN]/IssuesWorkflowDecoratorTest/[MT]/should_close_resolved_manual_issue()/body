{
  when(moduleIssues.issues(anyString())).thenReturn(Collections.<Issue>emptyList());
  when(initialOpenIssuesStack.selectAndRemove(anyInt())).thenReturn(newArrayList(new IssueDto().setUuid("100").setRuleId(1).setManualIssue(true).setStatus(Issue.STATUS_RESOLVED)));
  Resource resource=new JavaFile("key");
  decorator.decorate(resource,null);
  ArgumentCaptor<DefaultIssue> argument=ArgumentCaptor.forClass(DefaultIssue.class);
  verify(moduleIssues).addOrUpdate(argument.capture());
  assertThat(argument.getValue().status()).isEqualTo(Issue.STATUS_CLOSED);
  assertThat(argument.getValue().updatedAt()).isNotNull();
}
