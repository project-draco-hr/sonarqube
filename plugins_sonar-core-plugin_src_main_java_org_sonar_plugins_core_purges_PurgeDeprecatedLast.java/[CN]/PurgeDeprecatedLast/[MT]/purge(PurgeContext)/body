{
  Query query=getSession().createQuery("SELECT s.id FROM " + Snapshot.class.getSimpleName() + " s WHERE s.last=true AND s.rootId IS NOT NULL AND NOT EXISTS(FROM "+ Snapshot.class.getSimpleName()+ " s2 WHERE s2.id=s.rootId AND s2.last=true)");
  List<Integer> snapshotIds=query.getResultList();
  deleteSnapshotData(snapshotIds);
}
