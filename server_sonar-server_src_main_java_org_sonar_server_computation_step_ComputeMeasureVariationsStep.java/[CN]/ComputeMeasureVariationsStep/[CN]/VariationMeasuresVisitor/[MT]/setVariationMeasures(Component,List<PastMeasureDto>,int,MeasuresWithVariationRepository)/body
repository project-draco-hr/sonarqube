{
  Map<MeasureKey,PastMeasureDto> pastMeasuresByMeasureKey=from(pastMeasures).uniqueIndex(pastMeasureToMeasureKey);
  for (  Map.Entry<String,Measure> entry : measureRepository.getRawMeasures(component).entries()) {
    String metricKey=entry.getKey();
    Measure measure=entry.getValue();
    PastMeasureDto pastMeasure=pastMeasuresByMeasureKey.get(new MeasureKey(metricKey,measure.getCharacteristicId(),measure.getRuleId()));
    if (pastMeasure != null && pastMeasure.hasValue()) {
      Metric metric=metricByKeys.get(metricKey);
      measuresWithVariationRepository.add(metric,measure,period,computeVariation(measure,pastMeasure.getValue()));
    }
  }
}
