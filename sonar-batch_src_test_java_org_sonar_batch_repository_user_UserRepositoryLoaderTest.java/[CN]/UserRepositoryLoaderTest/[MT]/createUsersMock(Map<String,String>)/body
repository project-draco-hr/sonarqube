{
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  for (  Map.Entry<String,String> user : users.entrySet()) {
    BatchInput.User.Builder builder=BatchInput.User.newBuilder();
    builder.setLogin(user.getKey()).setName(user.getValue()).build().writeDelimitedTo(out);
  }
  ByteSource source=mock(ByteSource.class);
  when(source.openStream()).thenReturn(new ByteArrayInputStream(out.toByteArray()));
  return source;
}
