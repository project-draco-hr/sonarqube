{
  ByteSource source=mock(ByteSource.class);
  WSLoaderResult<ByteSource> res=new WSLoaderResult<>(source,true);
  when(wsLoader.loadSource("/batch/users?logins=fmallet,sbrandhof")).thenReturn(res);
  InputStream errorInputStream=mock(InputStream.class);
  Mockito.doThrow(IOException.class).when(errorInputStream).read();
  when(source.openStream()).thenReturn(errorInputStream);
  exception.expect(IllegalStateException.class);
  exception.expectMessage("Unable to get user details from server");
  userRepo.load(Arrays.asList("fmallet","sbrandhof"));
}
