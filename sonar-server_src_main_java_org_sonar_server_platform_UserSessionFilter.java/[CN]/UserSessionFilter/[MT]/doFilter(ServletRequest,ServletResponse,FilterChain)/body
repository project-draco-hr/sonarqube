{
  try {
    HttpServletRequest request=(HttpServletRequest)servletRequest;
    HttpSession httpSession=request.getSession(true);
    String login=(String)httpSession.getAttribute("login");
    Long userId=(Long)httpSession.getAttribute("user_id");
    UserSession.set(new UserSession(userId != null ? userId.intValue() : null,login));
    filterChain.doFilter(servletRequest,servletResponse);
  }
  finally {
    UserSession.set(null);
  }
}
