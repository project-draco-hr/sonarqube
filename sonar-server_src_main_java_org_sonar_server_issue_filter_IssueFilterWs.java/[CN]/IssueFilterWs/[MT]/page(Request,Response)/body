{
  UserSession session=UserSession.get();
  JsonWriter json=response.newJsonWriter();
  json.beginObject();
  json.prop("canManageFilter",session.isLoggedIn());
  json.prop("canBulkChange",session.isLoggedIn());
  int filterId=request.intParam("id",-1);
  if (filterId >= 0) {
    DefaultIssueFilter filter=service.find((long)filterId,session);
    json.name("filter").beginObject().prop("id",filter.id()).prop("name",filter.name()).prop("user",filter.user()).prop("shared",filter.shared()).prop("query",filter.data()).endObject();
  }
  if (session.isLoggedIn()) {
    List<DefaultIssueFilter> favorites=service.findFavoriteFilters(session);
    json.name("favorites").beginArray();
    for (    DefaultIssueFilter favorite : favorites) {
      json.beginObject().prop("id",favorite.id()).prop("name",favorite.name()).endObject();
    }
    json.endArray();
  }
  json.endObject();
  json.close();
}
