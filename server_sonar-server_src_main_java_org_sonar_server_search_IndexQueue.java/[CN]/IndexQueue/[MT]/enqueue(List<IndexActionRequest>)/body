{
  if (actions.isEmpty()) {
    return;
  }
  try {
    boolean refreshRequired=false;
    Map<String,Index> indexes=getIndexMap();
    Set<String> indices=new HashSet<String>();
    for (    IndexActionRequest action : actions) {
      if (action.needsRefresh()) {
        refreshRequired=true;
      }
      Index index=indexes.get(action.getIndexType());
      action.setIndex(index);
      if (action.needsRefresh()) {
        indices.add(index.getIndexName());
      }
    }
    BulkRequestBuilder bulkRequestBuilder=new BulkRequestBuilder(searchClient);
    long normTime=executeNormalization(bulkRequestBuilder,actions);
    long indexTime=System.currentTimeMillis();
    BulkResponse response=searchClient.execute(bulkRequestBuilder.setRefresh(false));
    indexTime=System.currentTimeMillis() - indexTime;
    long refreshTime=0;
    if (refreshRequired) {
      refreshTime=this.refreshRequiredIndex(indices);
    }
    LOGGER.debug("-- submitted {} items with {}ms in normalization, {}ms indexing and {}ms refresh({}). Total: {}ms",bulkRequestBuilder.numberOfActions(),normTime,indexTime,refreshTime,indices,(normTime + indexTime + refreshTime));
    if (response.hasFailures()) {
      throw new IllegalStateException("Errors while indexing stack: " + response.buildFailureMessage());
    }
  }
 catch (  Exception e) {
    LOGGER.error("Could not commit to ElasticSearch",e);
  }
}
