{
  long normTime=System.currentTimeMillis();
  try {
    ExecutorService executorService=Executors.newFixedThreadPool(CONCURRENT_NORMALIZATION_FACTOR);
    for (    Future<List<ActionRequest>> updateRequests : executorService.invokeAll(actions)) {
      for (      ActionRequest update : updateRequests.get()) {
        if (UpdateRequest.class.isAssignableFrom(update.getClass())) {
          bulkRequestBuilder.add(((UpdateRequest)update).refresh(false));
        }
 else         if (DeleteRequest.class.isAssignableFrom(update.getClass())) {
          bulkRequestBuilder.add(((DeleteRequest)update).refresh(false));
        }
 else {
          throw new IllegalStateException("Un-managed request type: " + update.getClass());
        }
      }
    }
    executorService.shutdown();
  }
 catch (  Exception e) {
    throw new IllegalStateException("Could not execute normalization for stack",e);
  }
  return System.currentTimeMillis() - normTime;
}
