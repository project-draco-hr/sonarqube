{
  if (actions.isEmpty()) {
    return;
  }
  boolean refreshRequired=false;
  Map<String,Index> indexes=getIndexMap();
  Set<String> indices=new HashSet<>();
  for (  IndexAction action : actions) {
    Index index=indexes.get(action.getIndexType());
    action.setIndex(index);
    if (action.needsRefresh()) {
      refreshRequired=true;
      indices.add(index.getIndexName());
    }
  }
  BulkRequestBuilder bulkRequestBuilder=searchClient.prepareBulk();
  processActionsIntoQueries(bulkRequestBuilder,actions);
  if (bulkRequestBuilder.numberOfActions() > 0) {
    BulkResponse response=bulkRequestBuilder.setRefresh(false).get();
    if (refreshRequired) {
      this.refreshRequiredIndex(indices);
    }
    if (response.hasFailures()) {
      throw new IllegalStateException("Errors while indexing stack: " + response.buildFailureMessage());
    }
  }
}
