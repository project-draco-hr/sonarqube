{
  if (actions.isEmpty()) {
    return;
  }
  boolean refreshRequired=false;
  Map<String,Index> indexes=getIndexMap();
  Set<String> indices=new HashSet<String>();
  for (  IndexAction action : actions) {
    Index index=indexes.get(action.getIndexType());
    action.setIndex(index);
    if (action.needsRefresh()) {
      refreshRequired=true;
      indices.add(index.getIndexName());
    }
  }
  BulkRequestBuilder bulkRequestBuilder=searchClient.prepareBulk();
  long normTime=processActionsIntoQueries(bulkRequestBuilder,actions);
  if (bulkRequestBuilder.numberOfActions() > 0) {
    long indexTime=System.currentTimeMillis();
    BulkResponse response=bulkRequestBuilder.setRefresh(false).get();
    indexTime=System.currentTimeMillis() - indexTime;
    long refreshTime=0;
    if (refreshRequired) {
      refreshTime=this.refreshRequiredIndex(indices);
    }
    LOGGER.debug("-- submitted {} items with {}ms in normalization, {}ms indexing and {}ms refresh({}). Total: {}ms",bulkRequestBuilder.numberOfActions(),normTime,indexTime,refreshTime,indices,(normTime + indexTime + refreshTime));
    if (response.hasFailures()) {
      throw new IllegalStateException("Errors while indexing stack: " + response.buildFailureMessage());
    }
  }
}
