{
  Profiler profiler=Profiler.create(Loggers.get(getClass())).startInfo("Register quality profiles");
  DbSession session=dbClient.openSession(false);
  try {
    ListMultimap<String,RulesProfile> profilesByLanguage=profilesByLanguage();
    for (    String language : profilesByLanguage.keySet()) {
      List<RulesProfile> defs=profilesByLanguage.get(language);
      if (verifyLanguage(language,defs)) {
        for (        Map.Entry<String,Collection<RulesProfile>> entry : profilesByName(defs).entrySet()) {
          String name=entry.getKey();
          QProfileName profileName=new QProfileName(language,name);
          if (shouldRegister(profileName,session)) {
            register(profileName,entry.getValue(),session);
            session.commit();
          }
          builtInProfiles.put(language,name);
        }
        setDefault(language,defs,session);
        session.commit();
      }
    }
    profiler.stopDebug();
  }
  finally {
    session.close();
  }
}
