{
  if (!metadata.getPathsToInternalDeps().isEmpty()) {
    File baseDir;
    if (pluginBasedir == null) {
      baseDir=cache.unzip(pluginFile);
    }
 else {
      ZipUtils.unzip(pluginFile,pluginBasedir,new LibFilter());
      baseDir=pluginBasedir;
    }
    for (    String depPath : metadata.getPathsToInternalDeps()) {
      File dependency=new File(baseDir,depPath);
      if (!dependency.isFile() || !dependency.exists()) {
        throw new IllegalArgumentException("Dependency " + depPath + " can not be found in "+ pluginFile.getName());
      }
      metadata.addDeployedFile(dependency);
    }
  }
}
