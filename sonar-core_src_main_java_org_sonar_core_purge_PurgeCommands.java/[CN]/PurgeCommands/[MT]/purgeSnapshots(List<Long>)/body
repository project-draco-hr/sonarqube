{
  for (  Long snapshotId : snapshotIds) {
    purgeMapper.deleteSnapshotDependencies(snapshotId);
  }
  session.commit();
  for (  Long snapshotId : snapshotIds) {
    purgeMapper.deleteSnapshotDuplications(snapshotId);
  }
  session.commit();
  for (  Long snapshotId : snapshotIds) {
    purgeMapper.deleteSnapshotSource(snapshotId);
  }
  session.commit();
  for (  Long snapshotId : snapshotIds) {
    purgeMapper.deleteSnapshotViolations(snapshotId);
  }
  session.commit();
  List<Long> metricIdsWithoutHistoricalData=purgeMapper.selectMetricIdsWithoutHistoricalData();
  if (!metricIdsWithoutHistoricalData.isEmpty()) {
    for (    Long snapshotId : snapshotIds) {
      purgeMapper.deleteSnapshotWastedMeasures(snapshotId,metricIdsWithoutHistoricalData);
    }
    session.commit();
  }
  List<Long> characteristicIds=purgeMapper.selectCharacteristicIdsToPurge();
  if (!characteristicIds.isEmpty()) {
    for (    Long snapshotId : snapshotIds) {
      purgeMapper.deleteSnapshotMeasuresOnCharacteristics(snapshotId,characteristicIds);
    }
    session.commit();
  }
  for (  Long snapshotId : snapshotIds) {
    purgeMapper.updatePurgeStatusToOne(snapshotId);
  }
  session.commit();
}
