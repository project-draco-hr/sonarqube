{
  checkGlobalAdminUser(userSession);
  String key=wsRequest.mandatoryParam(PARAM_TEMPLATE_ID);
  String nameParam=wsRequest.param(PARAM_TEMPLATE_NAME);
  String descriptionParam=wsRequest.param(PARAM_TEMPLATE_DESCRIPTION);
  String projectPatternParam=wsRequest.param(PARAM_TEMPLATE_PATTERN);
  DbSession dbSession=dbClient.openSession(false);
  try {
    PermissionTemplateDto templateToUpdate=getAndBuildTemplateToUpdate(dbSession,key,nameParam,descriptionParam,projectPatternParam);
    validateTemplate(dbSession,templateToUpdate);
    PermissionTemplateDto updatedTemplate=updateTemplate(dbSession,templateToUpdate);
    UpdatePermissionTemplateResponse response=buildResponse(updatedTemplate);
    writeProtobuf(response,wsRequest,wsResponse);
  }
  finally {
    dbClient.closeSession(dbSession);
  }
}
