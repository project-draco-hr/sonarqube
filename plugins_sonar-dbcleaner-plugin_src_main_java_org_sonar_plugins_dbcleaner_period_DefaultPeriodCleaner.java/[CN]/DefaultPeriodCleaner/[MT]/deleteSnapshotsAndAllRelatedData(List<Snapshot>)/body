{
  if (snapshotHistory.isEmpty()) {
    LOG.info("There are no snapshots to purge");
    return;
  }
  List<Integer> ids=Lists.newArrayList();
  for (  Snapshot snapshot : snapshotHistory) {
    ids.addAll(sql.getChildIds(snapshot));
  }
  LOG.info("There are " + snapshotHistory.size() + " snapshots and "+ (ids.size() - snapshotHistory.size())+ " children snapshots which are obsolete and are going to be deleted.");
  if (LOG.isDebugEnabled()) {
    DateFormat format=DateFormat.getDateTimeInstance(DateFormat.SHORT,DateFormat.SHORT);
    for (    Snapshot snapshot : snapshotHistory) {
      LOG.debug("Delete snapshot created at " + format.format(snapshot.getCreatedAt()));
    }
  }
  PurgeUtils.deleteSnapshotsData(session,ids);
}
