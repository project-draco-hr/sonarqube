{
  Map<MeasureKey,MeasureModel> pastMeasuresByKey=Maps.newHashMap();
  for (  MeasureModel pastMeasure : pastMeasures) {
    pastMeasuresByKey.put(new MeasureKey(pastMeasure),pastMeasure);
  }
  for (  Measure measure : context.getMeasures(MeasuresFilters.all())) {
    Integer metricId=(measure.getMetric().getId() != null ? measure.getMetric().getId() : metricFinder.findByKey(measure.getMetric().getKey()).getId());
    MeasureModel pastMeasure=pastMeasuresByKey.get(new MeasureKey(measure,metricId));
    if (updateVariation(measure,pastMeasure,index)) {
      context.saveMeasure(measure);
    }
  }
}
