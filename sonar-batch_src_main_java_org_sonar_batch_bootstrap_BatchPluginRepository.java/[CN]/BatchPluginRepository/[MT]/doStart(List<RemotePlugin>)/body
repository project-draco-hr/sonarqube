{
  PluginFilter filter=new PluginFilter(settings,analysisMode);
  PluginInstaller extractor=new PluginInstaller();
  metadataByKey=Maps.newHashMap();
  for (  RemotePlugin remote : remotePlugins) {
    if (filter.accepts(remote.getKey())) {
      File pluginFile=pluginDownloader.downloadPlugin(remote);
      File targetDir=tempDirectories.newDir("plugins/" + remote.getKey());
      LOG.debug("Installing plugin {} into {}",remote.getKey(),targetDir.getAbsolutePath());
      PluginMetadata metadata=extractor.install(pluginFile,remote.isCore(),targetDir);
      if (StringUtils.isBlank(metadata.getBasePlugin()) || filter.accepts(metadata.getBasePlugin())) {
        metadataByKey.put(metadata.getKey(),metadata);
      }
 else {
        LOG.debug("Excluded plugin: " + metadata.getKey());
      }
    }
  }
  classLoaders=new PluginClassloaders(Thread.currentThread().getContextClassLoader());
  pluginsByKey=classLoaders.init(metadataByKey.values());
}
