{
  indexLine("P1","F1",1);
  indexLine("P1","F2",1);
  List<Integer> duplications=ImmutableList.of(1,2,3);
  FileSourceDb.Data.Builder dataBuilder=FileSourceDb.Data.newBuilder();
  dataBuilder.addLinesBuilder().setLine(1).setScmRevision("new_revision").setScmAuthor("new_author").setSource("new source").addAllDuplications(duplications).build();
  SourceFileResultSetIterator.Row dbRow=SourceFileResultSetIterator.toRow("P1","F1",new Date(),dataBuilder.build());
  indexer.index(Iterators.singletonIterator(dbRow));
  assertThat(countDocuments()).isEqualTo(2L);
  SearchResponse fileSearch=prepareSearch().setQuery(QueryBuilders.termQuery(FIELD_FILE_UUID,"F1")).get();
  assertThat(fileSearch.getHits().getTotalHits()).isEqualTo(1L);
  Map<String,Object> fields=fileSearch.getHits().getHits()[0].sourceAsMap();
  assertThat(fields).contains(entry(FIELD_PROJECT_UUID,"P1"),entry(FIELD_FILE_UUID,"F1"),entry(FIELD_LINE,1),entry(FIELD_SCM_REVISION,"new_revision"),entry(FIELD_SCM_AUTHOR,"new_author"),entry(FIELD_SOURCE,"new source"),entry(FIELD_DUPLICATIONS,duplications));
}
