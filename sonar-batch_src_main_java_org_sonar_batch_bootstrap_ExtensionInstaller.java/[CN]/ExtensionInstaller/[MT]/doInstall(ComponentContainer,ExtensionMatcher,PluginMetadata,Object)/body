{
  if (ExtensionUtils.supportsEnvironment(extension,env) && (analysisMode.isDb() || !ExtensionUtils.requiresDB(extension)) && matcher.accept(extension)) {
    container.addExtension(metadata,extension);
  }
 else {
    container.declareExtension(metadata,extension);
  }
}
