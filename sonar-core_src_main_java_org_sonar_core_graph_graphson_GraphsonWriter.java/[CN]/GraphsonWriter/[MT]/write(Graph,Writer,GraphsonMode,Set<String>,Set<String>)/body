{
  try {
    JSONObject root=new JSONObject();
    GraphsonUtil graphson=new GraphsonUtil(mode,null,vertexPropertyKeys,edgePropertyKeys);
    root.put(GraphsonTokens.MODE,mode.toString());
    JSONArray verticesArray=new JSONArray();
    for (    Vertex v : graph.getVertices()) {
      verticesArray.add(graphson.jsonFromElement(v));
    }
    root.put(GraphsonTokens.VERTICES,verticesArray);
    JSONArray edgesArray=new JSONArray();
    for (    Edge e : graph.getEdges()) {
      edgesArray.add(graphson.jsonFromElement(e));
    }
    root.put(GraphsonTokens.EDGES,edgesArray);
    output.write(root.toString());
  }
 catch (  Exception e) {
    throw new GraphsonException("Fail to generate GraphSON",e);
  }
}
