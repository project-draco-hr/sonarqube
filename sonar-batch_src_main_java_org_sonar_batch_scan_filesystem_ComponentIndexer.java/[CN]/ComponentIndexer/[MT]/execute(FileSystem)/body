{
  migration.migrateIfNeeded(module,fs);
  boolean shouldImportSource=settings.getBoolean(CoreProperties.CORE_IMPORT_SOURCES_PROPERTY);
  for (  InputFile inputFile : fs.inputFiles(FilePredicates.all())) {
    String languageKey=inputFile.language();
    boolean unitTest=InputFile.Type.TEST == inputFile.type();
    String pathFromSourceDir=((DefaultInputFile)inputFile).pathRelativeToSourceDir();
    if (pathFromSourceDir == null) {
      pathFromSourceDir=inputFile.relativePath();
    }
    Resource sonarFile=File.create(inputFile.relativePath(),pathFromSourceDir,languages.get(languageKey),unitTest);
    if (sonarFile != null) {
      sonarFile.setDeprecatedKey(((DefaultInputFile)inputFile).deprecatedKey());
      moduleLanguages.addLanguage(languageKey);
      sonarIndex.index(sonarFile);
      importSources(fs,shouldImportSource,inputFile,sonarFile);
    }
  }
}
