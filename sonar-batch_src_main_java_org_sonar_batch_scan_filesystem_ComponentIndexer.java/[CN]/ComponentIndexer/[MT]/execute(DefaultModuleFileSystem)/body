{
  module.setBaseDir(fs.baseDir());
  if (resourcePersister != null) {
    resourcePersister.persist();
  }
  if (migration != null) {
    migration.migrateIfNeeded(module,fs);
  }
  for (  InputFile inputFile : fs.inputFiles(fs.predicates().all())) {
    String languageKey=inputFile.language();
    boolean unitTest=InputFile.Type.TEST == inputFile.type();
    Resource sonarFile=File.create(inputFile.relativePath(),languages.get(languageKey),unitTest);
    sonarIndex.index(sonarFile);
    resourceCache.get(sonarFile).setInputPath(inputFile);
  }
  if (resourcePersister != null) {
    resourcePersister.persist();
  }
}
