{
  RuleIndexer indexer=createIndexer();
  RuleDto ruleDto=RuleTesting.newDto(RuleKey.of("xoo","S001")).setStatus(RuleStatus.READY).setUpdatedAtInMs(1000L);
  dbTester.getDbClient().ruleDao().insert(dbTester.getSession(),ruleDto);
  dbTester.getSession().commit();
  indexer.index();
  ruleDto.setStatus(RuleStatus.REMOVED);
  ruleDto.setUpdatedAtInMs(2000L);
  dbTester.getDbClient().ruleDao().update(dbTester.getSession(),ruleDto);
  dbTester.getSession().commit();
  indexer.index();
  assertThat(esTester.countDocuments(RuleIndexDefinition.INDEX,RuleIndexDefinition.TYPE_RULE)).isZero();
}
