{
  return new SQLBlock(){
    public IRubyObject call(    Connection c) throws SQLException {
      ResultSet rs=null;
      try {
        DatabaseMetaData metadata=c.getMetaData();
        String clzName=metadata.getClass().getName().toLowerCase();
        boolean isOracle=clzName.indexOf("oracle") != -1 || clzName.indexOf("oci") != -1;
        String realschema=schemapat;
        String realtablepat=tablepat;
        if (metadata.storesUpperCaseIdentifiers()) {
          if (realschema != null)           realschema=realschema.toUpperCase();
          if (realtablepat != null)           realtablepat=realtablepat.toUpperCase();
        }
 else         if (metadata.storesLowerCaseIdentifiers()) {
          if (null != realschema)           realschema=realschema.toLowerCase();
          if (realtablepat != null)           realtablepat=realtablepat.toLowerCase();
        }
        if (realschema == null && isOracle) {
          ResultSet schemas=metadata.getSchemas();
          String username=metadata.getUserName();
          while (schemas.next()) {
            if (schemas.getString(1).equalsIgnoreCase(username)) {
              realschema=schemas.getString(1);
              break;
            }
          }
          schemas.close();
        }
        rs=metadata.getTables(catalog,realschema,realtablepat,types);
        List arr=new ArrayList();
        while (rs.next()) {
          String name=rs.getString(3).toLowerCase();
          if (!isOracle || !name.startsWith("bin$")) {
            arr.add(RubyString.newUnicodeString(runtime,name));
          }
        }
        return runtime.newArray(arr);
      }
  finally {
        try {
          rs.close();
        }
 catch (        Exception e) {
        }
      }
    }
  }
;
}
