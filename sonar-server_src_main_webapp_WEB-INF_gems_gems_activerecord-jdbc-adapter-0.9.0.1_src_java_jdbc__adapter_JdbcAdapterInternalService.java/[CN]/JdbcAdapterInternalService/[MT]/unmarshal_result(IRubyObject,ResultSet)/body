{
  Ruby runtime=recv.getRuntime();
  List results=new ArrayList();
  try {
    ResultSetMetaData metadata=rs.getMetaData();
    boolean storesUpper=rs.getStatement().getConnection().getMetaData().storesUpperCaseIdentifiers();
    int col_count=metadata.getColumnCount();
    IRubyObject[] col_names=new IRubyObject[col_count];
    int[] col_types=new int[col_count];
    int[] col_scale=new int[col_count];
    for (int i=0; i < col_count; i++) {
      String s1=metadata.getColumnLabel(i + 1);
      if (storesUpper && !HAS_SMALL.matcher(s1).find()) {
        s1=s1.toLowerCase();
      }
      col_names[i]=RubyString.newUnicodeString(runtime,s1);
      col_types[i]=metadata.getColumnType(i + 1);
      col_scale[i]=metadata.getScale(i + 1);
    }
    while (rs.next()) {
      RubyHash row=RubyHash.newHash(runtime);
      for (int i=0; i < col_count; i++) {
        rubyApi.callMethod(row,"[]=",new IRubyObject[]{col_names[i],jdbc_to_ruby(runtime,i + 1,col_types[i],col_scale[i],rs)});
      }
      results.add(row);
    }
  }
  finally {
    try {
      rs.close();
    }
 catch (    Exception e) {
    }
  }
  return runtime.newArray(results);
}
