{
  String value=System.getProperty(PROPERTY);
  if (StringUtils.isBlank(value)) {
    value=System.getenv(PROPERTY);
    if (StringUtils.isBlank(value)) {
      value=openWarProperties().getProperty(PROPERTY);
    }
  }
  if (StringUtils.isBlank(value)) {
    throw new IllegalStateException("Sonar value is not defined. " + "Please set the environment variable/system property " + PROPERTY + " or edit the file WEB-INF/classes/sonar-war.properties");
  }
  File dir=new File(value);
  if (!dir.isDirectory() || !dir.exists()) {
    throw new IllegalStateException(PROPERTY + " is not valid: " + value+ ". Please fix the environment variable/system property SONAR_HOME or "+ "the file WEB-INF/classes/sonar-war.properties");
  }
  return dir;
}
