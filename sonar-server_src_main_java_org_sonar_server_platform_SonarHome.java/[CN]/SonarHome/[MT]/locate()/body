{
  String value=System.getProperty(CoreProperties.SONAR_HOME);
  if (StringUtils.isBlank(value)) {
    value=System.getenv(CoreProperties.SONAR_HOME);
  }
  if (StringUtils.isBlank(value)) {
    throw new IllegalStateException("The system property or env variable " + CoreProperties.SONAR_HOME + " is not set");
  }
  File dir=new File(value);
  if (!dir.isDirectory() || !dir.exists()) {
    throw new IllegalStateException(CoreProperties.SONAR_HOME + " is not valid: " + value+ ". Please fix the env variable/system "+ "property "+ CoreProperties.SONAR_HOME);
  }
  return dir;
}
