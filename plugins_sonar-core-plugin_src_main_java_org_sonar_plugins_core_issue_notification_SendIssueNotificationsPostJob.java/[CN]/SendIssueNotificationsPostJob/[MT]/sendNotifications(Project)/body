{
  IssuesBySeverity newIssues=new IssuesBySeverity();
  IssueChangeContext context=IssueChangeContext.createScan(project.getAnalysisDate());
  Map<DefaultIssue,Rule> shouldSentNotification=new LinkedHashMap<DefaultIssue,Rule>();
  for (  DefaultIssue issue : issueCache.all()) {
    if (issue.isNew() && issue.resolution() == null) {
      newIssues.add(issue);
    }
    if (!issue.isNew() && issue.isChanged() && issue.mustSendNotifications()) {
      Rule rule=ruleFinder.findByKey(issue.ruleKey());
      if (rule != null) {
        shouldSentNotification.put(issue,rule);
      }
    }
  }
  if (!shouldSentNotification.isEmpty()) {
    notifications.sendChanges(shouldSentNotification,context,project,null);
  }
  if (newIssues.size() > 0) {
    notifications.sendNewIssues(project,newIssues);
  }
}
