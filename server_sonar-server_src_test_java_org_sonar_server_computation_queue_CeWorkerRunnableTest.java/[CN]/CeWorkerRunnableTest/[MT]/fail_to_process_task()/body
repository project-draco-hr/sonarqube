{
  CeTask task=new CeTask.Builder().setUuid("TASK_1").setType(CeTaskTypes.REPORT).setComponentUuid("PROJECT_1").setSubmitterLogin(null).build();
  when(queue.peek()).thenReturn(Optional.of(task));
  doThrow(new IllegalStateException()).when(taskProcessor).process(task);
  underTest.run();
  InOrder inOrder=Mockito.inOrder(ceLogging,taskProcessor,queue);
  inOrder.verify(ceLogging).initForTask(task);
  inOrder.verify(taskProcessor).process(task);
  inOrder.verify(queue).remove(task,CeActivityDto.Status.FAILED);
  inOrder.verify(ceLogging).clearForTask();
}
