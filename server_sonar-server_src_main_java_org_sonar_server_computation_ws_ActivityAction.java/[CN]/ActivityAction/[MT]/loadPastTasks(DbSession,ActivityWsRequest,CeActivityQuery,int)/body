{
  int total=dbClient.ceActivityDao().countByQuery(dbSession,query);
  int offset=Math.max(0,offset(request.getPage(),request.getPageSize()) - totalQueuedTasks);
  List<CeActivityDto> dtos=dbClient.ceActivityDao().selectByQuery(dbSession,query,offset,request.getPageSize());
  Iterable<WsCe.Task> ceTasks=formatter.formatActivity(dbSession,dtos);
  return new TaskResult(ceTasks,total);
}
