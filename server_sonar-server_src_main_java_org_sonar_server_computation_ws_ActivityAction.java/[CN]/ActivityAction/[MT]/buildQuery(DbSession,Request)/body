{
  String componentUuid=wsRequest.param(PARAM_COMPONENT_UUID);
  String componentQuery=wsRequest.param(PARAM_COMPONENT_QUERY);
  checkRequest(componentUuid == null || componentQuery == null,format("Only one of following parameters is accepted: %s or %s",PARAM_COMPONENT_UUID,PARAM_COMPONENT_QUERY));
  CeActivityQuery query=new CeActivityQuery();
  query.setType(wsRequest.param(PARAM_TYPE));
  query.setOnlyCurrents(wsRequest.mandatoryParamAsBoolean(PARAM_ONLY_CURRENTS));
  query.setMinSubmittedAt(toTime(wsRequest.paramAsDateTime(PARAM_MIN_SUBMITTED_AT)));
  query.setMaxExecutedAt(toTime(wsRequest.paramAsDateTime(PARAM_MAX_EXECUTED_AT)));
  String status=wsRequest.param(PARAM_STATUS);
  if (status != null) {
    query.setStatus(CeActivityDto.Status.valueOf(status));
  }
  loadComponentUuids(dbSession,wsRequest,query);
  return query;
}
