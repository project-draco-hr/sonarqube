{
  File baseDir=project.getFileSystem().getBasedir();
  File reportUTs=new File(baseDir,configuration.getReportPath());
  File reportITs=new File(baseDir,configuration.getItReportPath());
  File reportAllTests=new File(baseDir,MERGED_EXEC);
  SessionInfoStore infoStore=new SessionInfoStore();
  ExecutionDataStore dataStore=new ExecutionDataStore();
  loadSourceFiles(infoStore,dataStore,reportUTs,reportITs);
  BufferedOutputStream outputStream=null;
  try {
    outputStream=new BufferedOutputStream(new FileOutputStream(reportAllTests));
    ExecutionDataWriter dataWriter=new ExecutionDataWriter(outputStream);
    infoStore.accept(dataWriter);
    dataStore.accept(dataWriter);
  }
 catch (  IOException e) {
    throw new SonarException(String.format("Unable to write merged file %s",reportAllTests.getAbsolutePath()),e);
  }
 finally {
    Closeables.closeQuietly(outputStream);
  }
}
