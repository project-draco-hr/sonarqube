{
  String hql="from " + Snapshot.class.getSimpleName() + " where createdAt<:date AND resourceId=:resourceId AND status=:status and last=true order by createdAt desc";
  List<Snapshot> snapshots=session.createQuery(hql).setParameter("date",projectSnapshot.getCreatedAt()).setParameter("resourceId",projectSnapshot.getResourceId()).setParameter("status",Snapshot.STATUS_PROCESSED).setMaxResults(1).getResultList();
  return snapshots.isEmpty() ? null : snapshots.get(0);
}
