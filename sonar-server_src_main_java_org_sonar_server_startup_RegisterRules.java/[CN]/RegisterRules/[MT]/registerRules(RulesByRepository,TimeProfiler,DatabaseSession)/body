{
  List<Rule> registeredRules=newArrayList();
  for (  RuleRepository repository : repositories) {
    profiler.start("Register rules [" + repository.getKey() + "/"+ StringUtils.defaultString(repository.getLanguage(),"-")+ "]");
    registeredRules.addAll(registerRepositoryRules(repository,existingRules,session));
    registeredRules.addAll(registerTemplateRules(repository,existingRules,registeredRules,session));
    profiler.stop();
  }
  return registeredRules;
}
