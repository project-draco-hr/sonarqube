{
  List<Rule> templateRules=newArrayList();
  for (  Rule persistedRule : existingRules.rules()) {
    Rule parent=persistedRule.getParent();
    if (parent != null && registeredRules.contains(parent)) {
      persistedRule.setRepositoryKey(parent.getRepositoryKey());
      persistedRule.setLanguage(parent.getLanguage());
      persistedRule.setStatus(Objects.firstNonNull(persistedRule.getStatus(),Rule.STATUS_READY));
      persistedRule.setCreatedAt(Objects.firstNonNull(persistedRule.getCreatedAt(),new Date()));
      persistedRule.setUpdatedAt(new Date());
      session.saveWithoutFlush(persistedRule);
      templateRules.add(persistedRule);
    }
  }
  return templateRules;
}
