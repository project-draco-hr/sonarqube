{
  List<RuleDto> templateRules=newArrayList();
  for (  RuleDto persistedRule : existingRules.rules()) {
    RuleDto parent=existingRules.ruleById(persistedRule.getParentId());
    if (parent != null && registeredRules.contains(parent)) {
      persistedRule.setRepositoryKey(parent.getRepositoryKey());
      persistedRule.setLanguage(parent.getLanguage());
      persistedRule.setStatus(Objects.firstNonNull(persistedRule.getStatus(),Rule.STATUS_READY));
      persistedRule.setCreatedAt(Objects.firstNonNull(persistedRule.getCreatedAt(),new Date()));
      persistedRule.setUpdatedAt(new Date());
      ruleDao.update(persistedRule,sqlSession);
      templateRules.add(persistedRule);
    }
  }
  return templateRules;
}
