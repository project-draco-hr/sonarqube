{
  int count=0;
  DbSession dbSession=dbClient.openSession(false);
  try {
    for (    CeQueueDto queueDto : dbClient.ceQueueDao().selectAllInAscOrder(dbSession)) {
      if (includeInProgress || !queueDto.getStatus().equals(CeQueueDto.Status.IN_PROGRESS)) {
        cancel(dbSession,queueDto);
        count++;
      }
    }
    return count;
  }
  finally {
    dbClient.closeSession(dbSession);
  }
}
