{
  IssueDto dto=IssueDto.toDtoForUpdate(issue,now);
  if (Issue.STATUS_CLOSED.equals(issue.status()) || issue.selectedAt() == null) {
    issueMapper.update(dto);
  }
 else {
    int count=issueMapper.updateIfBeforeSelectedDate(dto);
    if (count == 0) {
      conflictResolver.resolve(issue,issueMapper);
    }
  }
}
