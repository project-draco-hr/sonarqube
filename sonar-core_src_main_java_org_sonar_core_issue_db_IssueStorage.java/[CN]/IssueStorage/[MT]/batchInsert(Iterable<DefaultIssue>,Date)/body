{
  List<DefaultIssue> toBeUpdated=Lists.newArrayList();
  DbSession batchSession=mybatis.openSession(true);
  int count=0;
  IssueChangeMapper issueChangeMapper=batchSession.getMapper(IssueChangeMapper.class);
  try {
    for (    DefaultIssue issue : issues) {
      if (issue.isNew()) {
        doInsert(batchSession,now,issue);
        insertChanges(issueChangeMapper,issue);
        if (count > BatchSession.MAX_BATCH_SIZE) {
          batchSession.commit();
        }
        count++;
      }
 else       if (issue.isChanged()) {
        toBeUpdated.add(issue);
      }
    }
    batchSession.commit();
  }
  finally {
    MyBatis.closeQuietly(batchSession);
  }
  return toBeUpdated;
}
