{
  try {
    String nodeName="tmp-es-" + RandomUtils.nextInt();
    Path tmpDir=Files.createTempDirectory("tmp-es");
    tmpDir.toFile().deleteOnExit();
    node=NodeBuilder.nodeBuilder().local(true).data(true).settings(ImmutableSettings.builder().put("cluster.name",nodeName).put("node.name",nodeName).put(IndexMetaData.SETTING_NUMBER_OF_SHARDS,1).put(IndexMetaData.SETTING_NUMBER_OF_REPLICAS,0).put("processors",1).put("http.enabled",false).put("config.ignore_system_properties",true).put("path.home",tmpDir)).build();
    node.start();
    checkState(DiscoveryNode.localNode(node.settings()));
    checkState(!node.isClosed());
    node.client().admin().cluster().prepareHealth().setWaitForGreenStatus().get();
    DeleteIndexResponse response=node.client().admin().indices().prepareDelete("_all").get();
    checkState(response.isAcknowledged());
  }
 catch (  IOException e) {
    throw Throwables.propagate(e);
  }
}
