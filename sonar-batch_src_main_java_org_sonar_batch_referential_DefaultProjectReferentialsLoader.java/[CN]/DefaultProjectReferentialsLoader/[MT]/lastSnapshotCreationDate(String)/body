{
  StringBuilder sb=new StringBuilder();
  Map<String,Object> params=Maps.newHashMap();
  sb.append("SELECT s.buildDate");
  sb.append(" FROM ").append(ResourceModel.class.getSimpleName()).append(" r, ").append(Snapshot.class.getSimpleName()).append(" s WHERE s.resourceId=r.id AND r.key=:kee AND s.status=:status AND s.qualifier<>:lib");
  params.put("kee",resourceKey);
  params.put("status",Snapshot.STATUS_PROCESSED);
  params.put("lib",Qualifiers.LIBRARY);
  sb.append(" AND s.last=true ");
  Query jpaQuery=session.createQuery(sb.toString());
  for (  Map.Entry<String,Object> entry : params.entrySet()) {
    jpaQuery.setParameter(entry.getKey(),entry.getValue());
  }
  try {
    return (Date)jpaQuery.getSingleResult();
  }
 catch (  NoResultException e) {
    return null;
  }
}
