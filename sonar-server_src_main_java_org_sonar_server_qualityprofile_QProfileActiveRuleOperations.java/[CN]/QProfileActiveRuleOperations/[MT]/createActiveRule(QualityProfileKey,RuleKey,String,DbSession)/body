{
  RuleDto ruleDto=ruleDao.getNullableByKey(session,ruleKey);
  QualityProfileDto profileDto=profileDao.selectByNameAndLanguage(profileKey.name(),profileKey.lang(),session);
  ActiveRuleDto activeRule=ActiveRuleDto.createFor(profileDto,ruleDto).setSeverity(severity);
  activeRuleDao.insert(session,activeRule);
  List<RuleParamDto> ruleParams=ruleDao.findRuleParamsByRuleKey(session,ruleKey);
  List<ActiveRuleParamDto> activeRuleParams=newArrayList();
  for (  RuleParamDto ruleParam : ruleParams) {
    ActiveRuleParamDto activeRuleParam=ActiveRuleParamDto.createFor(ruleParam).setKey(ruleParam.getName()).setValue(ruleParam.getDefaultValue());
    activeRuleParams.add(activeRuleParam);
    activeRuleDao.addParam(session,activeRule,activeRuleParam);
  }
  return activeRule;
}
