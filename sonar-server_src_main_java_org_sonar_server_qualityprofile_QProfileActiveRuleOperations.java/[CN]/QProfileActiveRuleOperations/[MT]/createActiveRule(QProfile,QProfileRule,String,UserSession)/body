{
  SqlSession session=myBatis.openSession();
  try {
    ActiveRuleDto activeRule=new ActiveRuleDto().setProfileId(profile.id()).setRuleId(rule.id()).setSeverity(getSeverityOrdinal(severity));
    activeRuleDao.insert(activeRule,session);
    List<RuleParamDto> ruleParams=ruleDao.selectParameters(rule.id(),session);
    List<ActiveRuleParamDto> activeRuleParams=newArrayList();
    for (    RuleParamDto ruleParam : ruleParams) {
      ActiveRuleParamDto activeRuleParam=new ActiveRuleParamDto().setActiveRuleId(activeRule.getId()).setRulesParameterId(ruleParam.getId()).setKey(ruleParam.getName()).setValue(ruleParam.getDefaultValue());
      activeRuleParams.add(activeRuleParam);
      activeRuleDao.insert(activeRuleParam,session);
    }
    session.commit();
    ProfilesManager.RuleInheritanceActions actions=profilesManager.activated(profile.id(),activeRule.getId(),userSession.name());
    reindexInheritanceResult(actions,session);
    return activeRule;
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
