{
  validatePermission(userSession);
  String sanitizedValue=Strings.emptyToNull(value);
  QProfile profile=findProfileNotNull(profileId);
  ActiveRuleParamDto activeRuleParam=findActiveRuleParam(activeRuleId,key);
  ActiveRuleDto activeRule=findActiveRuleNotNull(activeRuleId);
  if (activeRuleParam == null && sanitizedValue != null) {
    createActiveRuleParam(activeRule,key,value,userSession);
  }
 else   if (activeRuleParam != null && sanitizedValue == null) {
    deleteActiveRuleParam(activeRule,activeRuleParam,userSession);
  }
 else   if (activeRuleParam != null) {
    updateActiveRuleParam(activeRule,activeRuleParam,value,userSession);
  }
  return activeRuleChanged(profile,activeRuleId);
}
