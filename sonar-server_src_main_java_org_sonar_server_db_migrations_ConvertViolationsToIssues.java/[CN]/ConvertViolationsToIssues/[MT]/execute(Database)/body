{
  Connection readConnection=null, writeConnection=null;
  try {
    readConnection=db.getDataSource().getConnection();
    writeConnection=db.getDataSource().getConnection();
    writeConnection.setAutoCommit(false);
    truncateIssueTables(writeConnection);
    convertViolations(readConnection,new Converter(db,runner,readConnection,writeConnection));
  }
 catch (  SQLException e) {
    logger.error("Fail to convert violations to issues",e);
    SQLException next=e.getNextException();
    while (next != null) {
      logger.error("SQL error: {}. Message: {}",next.getSQLState(),next.getMessage());
      next=next.getNextException();
    }
    throw MessageException.of("Fail to convert violations to issues");
  }
 finally {
    DbUtils.closeQuietly(readConnection);
    DbUtils.closeQuietly(writeConnection);
  }
}
