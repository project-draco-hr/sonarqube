{
  Builder<String,IndexHealth> builder=ImmutableMap.builder();
  for (  Index index : indexClient.allIndices()) {
    IndexStat indexStat=index.getIndexStat();
    IndexHealth newIndexHealth=new IndexHealth();
    newIndexHealth.name=index.getIndexName() + "/" + index.getIndexType();
    newIndexHealth.documentCount=indexStat.getDocumentCount();
    newIndexHealth.lastSync=indexStat.getLastUpdate();
    IndicesStatsRequestBuilder statRequest=searchClient.admin().indices().prepareStats(index.getIndexName()).setTypes(index.getIndexType());
    IndicesStatsResponse indicesStatsResponse=searchClient.execute(statRequest);
    newIndexHealth.segmentCount=indicesStatsResponse.getTotal().getSegments().getCount();
    newIndexHealth.pendingDeletion=indicesStatsResponse.getTotal().getDocs().getDeleted();
    builder.put(newIndexHealth.name,newIndexHealth);
  }
  return builder.build();
}
