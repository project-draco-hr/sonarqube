{
  CeTask task=new CeTask.Builder().setUuid("TASK_1").setType(CeTaskTypes.REPORT).setComponentUuid("PROJECT_1").setSubmitterLogin(null).build();
  when(queue.peek()).thenReturn(Optional.of(task));
  taskProcessorRepository.setProcessorForTask(task.getType(),taskProcessor);
  doThrow(new IllegalStateException("simulate exception thrown by TaskProcessor#process")).when(taskProcessor).process(task);
  assertThat(underTest.call()).isTrue();
  inOrder.verify(ceLogging).initForTask(task);
  inOrder.verify(taskProcessor).process(task);
  inOrder.verify(queue).remove(task,CeActivityDto.Status.FAILED);
  inOrder.verify(ceLogging).clearForTask();
}
