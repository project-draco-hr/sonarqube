{
  RuleDao dao=tester.get(RuleDao.class);
  dao.insert(newRuleDto(RuleKey.of("javascript","S001")));
  dao.insert(newRuleDto(RuleKey.of("java","S002")));
  RuleService service=tester.get(RuleService.class);
  RuleQuery query=service.newRuleQuery().setRepositories(Arrays.asList("findbugs","java"));
  Results results=service.search(query,new QueryOptions());
  assertThat(results.getTotal()).isEqualTo(1);
  assertThat(results.getHits()).hasSize(1);
  assertThat(Iterables.getFirst(results.getHits(),null).getFieldAsString("key")).isEqualTo("S002");
}
