{
  setupData("shared");
  deployer.start();
  List<JpaPlugin> plugins=dao.getPlugins();
  assertThat(plugins.size(),is(1));
  JpaPlugin plugin=plugins.get(0);
  assertThat(plugin.getKey(),is("build-breaker"));
  assertThat(plugin.getFiles().size(),is(1));
  assertThat(plugin.isCore(),is(false));
  JpaPluginFile pluginFile=plugin.getFiles().get(0);
  assertThat(pluginFile.getFilename(),is("sonar-build-breaker-plugin-0.1.jar"));
  assertThat(pluginFile.getPath(),is("build-breaker/sonar-build-breaker-plugin-0.1.jar"));
  File deployedJar=new File(deployDir,"plugins/build-breaker/sonar-build-breaker-plugin-0.1.jar");
  assertThat(deployedJar.exists(),is(true));
  assertThat(deployedJar.isFile(),is(true));
  ClassLoader classloader=classloaders.getClassLoader("build-breaker");
  assertNotNull(classloader);
  assertNotNull(classloader.loadClass("org.sonar.plugins.buildbreaker.BuildBreakerPlugin"));
}
