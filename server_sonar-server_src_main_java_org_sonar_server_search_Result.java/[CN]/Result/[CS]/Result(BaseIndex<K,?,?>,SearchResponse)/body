{
  this.index=index;
  this.scrollId=response.getScrollId();
  this.facets=LinkedListMultimap.create();
  this.total=(int)response.getHits().totalHits();
  this.timeInMillis=response.getTookInMillis();
  this.hits=new ArrayList<K>();
  if (index != null) {
    for (    SearchHit hit : response.getHits()) {
      this.hits.add(index.toDoc(hit.getSource()));
    }
  }
  if (response.getAggregations() != null) {
    for (    Map.Entry<String,Aggregation> facet : response.getAggregations().asMap().entrySet()) {
      if (Terms.class.isAssignableFrom(facet.getValue().getClass())) {
        Terms aggregation=(Terms)facet.getValue();
        for (        Terms.Bucket value : aggregation.getBuckets()) {
          this.facets.put(facet.getKey(),new FacetValue(value.getKey(),(int)value.getDocCount()));
        }
      }
 else {
        LOGGER.warn("Cannot process {} type of aggregation",facet.getValue().getClass());
      }
    }
  }
}
