{
  if (Missing.class.isAssignableFrom(aggregation.getClass())) {
    Missing missing=(Missing)aggregation;
    int docCount=(int)missing.getDocCount();
    if (docCount > 0) {
      this.facets.put(aggregation.getName().replace("_missing",""),new FacetValue("",docCount));
    }
  }
 else   if (Terms.class.isAssignableFrom(aggregation.getClass())) {
    Terms termAggregation=(Terms)aggregation;
    for (    Terms.Bucket value : termAggregation.getBuckets()) {
      this.facets.put(aggregation.getName().replace("_selected",""),new FacetValue(value.getKey(),(int)value.getDocCount()));
    }
  }
 else   if (HasAggregations.class.isAssignableFrom(aggregation.getClass())) {
    HasAggregations hasAggregations=(HasAggregations)aggregation;
    for (    Aggregation internalAggregation : hasAggregations.getAggregations()) {
      this.processAggregation(internalAggregation);
    }
  }
 else {
    LOGGER.warn("Cannot process {} type of aggregation",aggregation.getClass());
  }
}
