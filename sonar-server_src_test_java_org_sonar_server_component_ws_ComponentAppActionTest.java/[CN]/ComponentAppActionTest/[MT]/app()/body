{
  String projectKey="org.codehaus.sonar:sonar-plugin-api:api";
  String componentKey="org.codehaus.sonar:sonar-plugin-api:src/main/java/org/sonar/api/Plugin.java";
  MockUserSession.set().addProjectPermissions(UserRole.CODEVIEWER,projectKey).addComponent(componentKey,projectKey);
  ComponentDto file=new ComponentDto().setId(10L).setQualifier("FIL").setKey(componentKey).setName("Plugin.java").setPath("src/main/java/org/sonar/api/Plugin.java").setSubProjectId(5L).setProjectId(1L);
  when(resourceDao.selectComponentByKey(componentKey)).thenReturn(file);
  when(resourceDao.findById(5L)).thenReturn(new ComponentDto().setId(5L).setLongName("SonarQube :: Plugin API"));
  when(resourceDao.findById(1L)).thenReturn(new ComponentDto().setId(1L).setLongName("SonarQube"));
  WsTester.TestRequest request=tester.newGetRequest("api/components","app").setParam("key",componentKey);
  request.execute().assertJson(getClass(),"app.json");
}
