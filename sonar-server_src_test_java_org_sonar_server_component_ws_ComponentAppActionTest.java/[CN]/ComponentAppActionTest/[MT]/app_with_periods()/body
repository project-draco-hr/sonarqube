{
  MockUserSession.set().addComponentPermission(UserRole.CODEVIEWER,PROJECT_KEY,COMPONENT_KEY);
  addProjectSample();
  when(resourceDao.getLastSnapshotByResourceId(eq(1L),eq(session))).thenReturn(new SnapshotDto().setPeriod1Mode("previous_analysis").setPeriod1Date(DateUtils.parseDate("2014-05-08")));
  when(periods.label(anyString(),anyString(),any(Date.class))).thenReturn("since previous analysis (May 08 2014)");
  WsTester.TestRequest request=tester.newGetRequest("api/components","app").setParam("key",COMPONENT_KEY);
  request.execute().assertJson(getClass(),"app_with_periods.json");
}
