{
  json.name("users").beginArray();
  for (  UserDoc user : result.getDocs()) {
    json.beginObject();
    writeIfNeeded(json,user.login(),FIELD_LOGIN,fields);
    writeIfNeeded(json,user.name(),FIELD_NAME,fields);
    writeIfNeeded(json,user.email(),FIELD_EMAIL,fields);
    writeIfNeeded(json,groupsByLogin.get(user.login()),FIELD_GROUPS_COUNT,fields);
    if (fieldIsWanted(FIELD_SCM_ACCOUNTS,fields)) {
      json.name(FIELD_SCM_ACCOUNTS).beginArray().values(user.scmAccounts()).endArray();
    }
    json.endObject();
  }
  json.endArray();
}
