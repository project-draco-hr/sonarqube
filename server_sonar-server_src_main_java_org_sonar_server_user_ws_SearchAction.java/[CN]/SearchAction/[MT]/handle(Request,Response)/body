{
  SearchOptions options=new SearchOptions().setPage(request.mandatoryParamAsInt(Param.PAGE),request.mandatoryParamAsInt(Param.PAGE_SIZE));
  List<String> fields=request.paramAsStrings(Param.FIELDS);
  SearchResult<UserDoc> result=userIndex.search(request.param(Param.TEXT_QUERY),options);
  JsonWriter json=response.newJsonWriter().beginObject();
  options.writeJson(json,result.getTotal());
  writeUsers(json,result,fields);
  json.endObject().close();
}
