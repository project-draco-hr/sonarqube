{
  String key1="org.codehaus.sonar:sonar-ws-client:src/main/java/org/sonar/wsclient/services/PropertyDeleteQuery.java";
  ComponentDto file1=ComponentTesting.newFileDto(project).setId(10L).setKey(key1).setLongName("PropertyDeleteQuery").setParentProjectId(5L);
  String key2="org.codehaus.sonar:sonar-ws-client:src/main/java/org/sonar/wsclient/services/PropertyUpdateQuery.java";
  ComponentDto file2=ComponentTesting.newFileDto(project).setId(11L).setQualifier("FIL").setKey(key2).setLongName("PropertyUpdateQuery").setParentProjectId(5L);
  when(componentDao.selectNullableByKey(session,key1)).thenReturn(file1);
  when(componentDao.selectNullableByKey(session,key2)).thenReturn(file2);
  when(componentDao.getNullableById(5L,session)).thenReturn(new ComponentDto().setId(5L).setKey("org.codehaus.sonar:sonar-ws-client").setLongName("SonarQube :: Web Service Client"));
  when(componentDao.getNullableByUuid(session,project.uuid())).thenReturn(project);
  List<DuplicationsParser.Block> blocks=newArrayList();
  blocks.add(new DuplicationsParser.Block(newArrayList(new DuplicationsParser.Duplication(file1,57,12),new DuplicationsParser.Duplication(file2,73,12))));
  test(blocks,"{\n" + "  \"duplications\": [\n" + "    {\n"+ "      \"blocks\": [\n"+ "        {\n"+ "          \"from\": 57, \"size\": 12, \"_ref\": \"1\"\n"+ "        },\n"+ "        {\n"+ "          \"from\": 73, \"size\": 12, \"_ref\": \"2\"\n"+ "        }\n"+ "      ]\n"+ "    },"+ "  ],\n"+ "  \"files\": {\n"+ "    \"1\": {\n"+ "      \"key\": \"org.codehaus.sonar:sonar-ws-client:src/main/java/org/sonar/wsclient/services/PropertyDeleteQuery.java\",\n"+ "      \"name\": \"PropertyDeleteQuery\",\n"+ "      \"project\": \"org.codehaus.sonar:sonar\",\n"+ "      \"projectName\": \"SonarQube\",\n"+ "      \"subProject\": \"org.codehaus.sonar:sonar-ws-client\",\n"+ "      \"subProjectName\": \"SonarQube :: Web Service Client\"\n"+ "    },\n"+ "    \"2\": {\n"+ "      \"key\": \"org.codehaus.sonar:sonar-ws-client:src/main/java/org/sonar/wsclient/services/PropertyUpdateQuery.java\",\n"+ "      \"name\": \"PropertyUpdateQuery\",\n"+ "      \"project\": \"org.codehaus.sonar:sonar\",\n"+ "      \"projectName\": \"SonarQube\",\n"+ "      \"subProject\": \"org.codehaus.sonar:sonar-ws-client\",\n"+ "      \"subProjectName\": \"SonarQube :: Web Service Client\"\n"+ "    }\n"+ "  }"+ "}");
  verify(componentDao,times(2)).selectNullableByKey(eq(session),anyString());
  verify(componentDao,times(1)).getNullableByUuid(eq(session),eq(project.uuid()));
  verify(componentDao,times(1)).getNullableById(eq(5L),eq(session));
}
