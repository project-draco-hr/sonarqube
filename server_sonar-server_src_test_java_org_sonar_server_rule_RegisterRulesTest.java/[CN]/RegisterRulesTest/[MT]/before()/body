{
  esTester.truncateIndices();
  system=mock(System2.class);
  when(system.now()).thenReturn(DATE1.getTime());
  RuleDao ruleDao=new RuleDao(system);
  ActiveRuleDao activeRuleDao=new ActiveRuleDao(new QualityProfileDao(dbTester.myBatis(),system),ruleDao,system);
  dbClient=new DbClient(dbTester.database(),dbTester.myBatis(),ruleDao,activeRuleDao,new org.sonar.db.rule.RuleDao(),new QualityProfileDao(dbTester.myBatis(),system));
  ruleIndexer=new RuleIndexer(dbClient,esTester.client());
  ruleIndexer.setEnabled(true);
  ruleIndex=new RuleIndex2(esTester.client());
}
