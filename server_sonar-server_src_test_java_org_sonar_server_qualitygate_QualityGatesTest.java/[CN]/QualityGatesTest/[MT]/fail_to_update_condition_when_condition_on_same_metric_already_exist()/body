{
  String metricKey="coverage";
  addMetric(metricKey,"Coverage");
  when(dao.selectById(QUALITY_GATE_ID)).thenReturn(new QualityGateDto().setId(QUALITY_GATE_ID));
  QualityGateConditionDto conditionNotOnLeakPeriod=insertQualityGateConditionDto(newCondition(metricKey,METRIC_ID)).setPeriod(0);
  QualityGateConditionDto conditionOnLeakPeriod=insertQualityGateConditionDto(newCondition(metricKey,METRIC_ID)).setPeriod(1);
  when(conditionDao.selectForQualityGate(QUALITY_GATE_ID)).thenReturn(asList(conditionNotOnLeakPeriod,conditionOnLeakPeriod));
  expectedException.expect(BadRequestException.class);
  expectedException.expectMessage("Condition on metric 'Coverage' over leak period already exists.");
  underTest.updateCondition(conditionNotOnLeakPeriod.getId(),metricKey,"LT",null,"60",1);
}
