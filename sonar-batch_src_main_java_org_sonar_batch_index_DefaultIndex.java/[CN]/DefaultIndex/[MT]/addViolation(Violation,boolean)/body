{
  Resource resource=violation.getResource();
  if (resource == null) {
    violation.setResource(currentProject);
  }
 else   if (!Scopes.isHigherThanOrEquals(resource,Scopes.FILE)) {
    throw new IllegalArgumentException("Violations are only supported on files, directories and project");
  }
  if (violation.getRule() == null) {
    LOG.warn("Rule is null, ignoring violation {}",violation);
    return;
  }
  Bucket bucket=checkIndexed(resource);
  if (bucket == null || bucket.isExcluded()) {
    return;
  }
  boolean isIgnored=!force && violationFilters != null && violationFilters.isIgnored(violation);
  if (!isIgnored) {
    addViolation(violation,bucket);
  }
}
