{
  Resource resource=getResource(violation.getResource());
  if (resource == null) {
    LOG.warn("Resource is not indexed. Ignoring violation {}",violation);
    return;
  }
  BatchComponent component=componentCache.get(resource);
  Rule rule=violation.getRule();
  if (rule == null) {
    LOG.warn("Rule is null. Ignoring violation {}",violation);
    return;
  }
  DefaultIssue newIssue=new DefaultIssue(sensorStorage);
  NewIssueLocation newLocation=newIssue.newLocation();
  if (component.isProjectOrModule()) {
    newLocation.onProject();
  }
 else   if (component.isDir()) {
    newLocation.onDir((InputDir)component.inputPath());
  }
 else   if (component.isFile()) {
    InputFile inputFile=(InputFile)component.inputPath();
    newLocation.onFile(inputFile);
    if (violation.hasLineId()) {
      newLocation.at(inputFile.selectLine(violation.getLineId()));
    }
  }
  newLocation.message(violation.getMessage());
  newIssue.addLocation(newLocation).forRule(RuleKey.of(violation.getRule().getRepositoryKey(),violation.getRule().getKey())).effortToFix(violation.getCost()).save();
}
