{
  Resource resource=violation.getResource();
  if (resource == null) {
    violation.setResource(currentProject);
  }
 else   if (!Scopes.isHigherThanOrEquals(resource,Scopes.FILE)) {
    throw new IllegalArgumentException("Violations are only supported on files, directories and project");
  }
  Rule rule=violation.getRule();
  if (rule == null) {
    LOG.warn("Rule is null. Ignoring violation {}",violation);
    return;
  }
  Bucket bucket=checkIndexed(resource);
  if (bucket == null || bucket.isExcluded()) {
    return;
  }
  violation.setSeverity(null);
  violation.setResource(bucket.getResource());
  scanIssues.initAndAddViolation(violation);
}
