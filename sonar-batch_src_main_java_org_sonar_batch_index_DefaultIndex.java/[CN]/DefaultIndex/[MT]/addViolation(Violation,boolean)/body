{
  Resource resource=violation.getResource();
  if (resource == null) {
    violation.setResource(currentProject);
  }
 else   if (!Scopes.isHigherThanOrEquals(resource,Scopes.FILE)) {
    throw new IllegalArgumentException("Violations are only supported on files, directories and project");
  }
  if (violation.getRule() == null || violation.getRule().getId() == null) {
    LOG.warn("Rule does not exist (it is null or its ID is null): ignoring violation {}",violation);
    return;
  }
  Bucket bucket=checkIndexed(resource);
  if (bucket == null || bucket.isExcluded()) {
    return;
  }
  addViolation(violation,bucket,force);
}
