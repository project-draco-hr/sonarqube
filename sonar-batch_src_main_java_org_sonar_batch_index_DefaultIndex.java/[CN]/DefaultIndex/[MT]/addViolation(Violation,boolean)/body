{
  Resource resource=violation.getResource();
  if (resource == null) {
    violation.setResource(currentProject);
  }
 else   if (!Scopes.isHigherThanOrEquals(resource,Scopes.FILE)) {
    throw new IllegalArgumentException("Violations are only supported on files, directories and project");
  }
  if (violation.getRule() == null) {
    LOG.warn("Rule is null, ignoring violation {}",violation);
    return;
  }
  Bucket bucket=checkIndexed(resource);
  if (bucket != null && !bucket.isExcluded()) {
    boolean isIgnored=!force && violationFilters != null && violationFilters.isIgnored(violation);
    if (!isIgnored) {
      if (violation.isManual()) {
        doAddViolation(violation,bucket);
      }
 else {
        ActiveRule activeRule=profile.getActiveRule(violation.getRule());
        if (activeRule == null) {
          if (currentProject.getReuseExistingRulesConfig()) {
            violation.setSeverity(violation.getRule().getSeverity());
            doAddViolation(violation,bucket);
          }
 else {
            LoggerFactory.getLogger(getClass()).debug("Rule is not activated, ignoring violation {}",violation);
          }
        }
 else {
          violation.setSeverity(activeRule.getSeverity());
          doAddViolation(violation,bucket);
        }
      }
    }
  }
}
