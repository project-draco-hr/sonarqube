{
  Resource resource=violationQuery.getResource();
  if (resource == null) {
    throw new IllegalArgumentException("A resource must be set on the ViolationQuery in order to search for violations.");
  }
  Bucket bucket=buckets.get(resource);
  if (bucket == null) {
    return Collections.emptyList();
  }
  List<Violation> violations=deprecatedViolations.get(bucket.getResource().getEffectiveKey());
  if (violationQuery.getSwitchMode() == ViolationQuery.SwitchMode.BOTH) {
    return violations;
  }
  List<Violation> filteredViolations=Lists.newArrayList();
  for (  Violation violation : violations) {
    if (isFiltered(violation,violationQuery.getSwitchMode())) {
      filteredViolations.add(violation);
    }
  }
  return filteredViolations;
}
