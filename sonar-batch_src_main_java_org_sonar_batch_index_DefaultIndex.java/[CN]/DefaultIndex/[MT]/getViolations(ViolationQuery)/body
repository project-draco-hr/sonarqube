{
  Resource resource=violationQuery.getResource();
  if (resource == null) {
    throw new IllegalArgumentException("A resource must be set on the ViolationQuery in order to search for violations.");
  }
  Bucket bucket=buckets.get(resource);
  if (bucket == null) {
    return Collections.emptyList();
  }
  List<Violation> filteredViolations=Lists.newArrayList();
  ViolationQuery.SwitchMode mode=violationQuery.getSwitchMode();
  for (  Violation violation : bucket.getViolations()) {
    if (mode == ViolationQuery.SwitchMode.BOTH || (mode == ViolationQuery.SwitchMode.OFF && violation.isSwitchedOff()) || (mode == ViolationQuery.SwitchMode.ON && !violation.isSwitchedOff())) {
      filteredViolations.add(violation);
    }
  }
  return filteredViolations;
}
