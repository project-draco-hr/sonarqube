{
  Resource from=getResource(dependency.getFrom());
  Preconditions.checkArgument(from != null,dependency.getFrom() + " is not indexed");
  Resource to=getResource(dependency.getTo());
  Preconditions.checkArgument(to != null,dependency.getTo() + " is not indexed");
  Dependency existingDep=getEdge(from,to);
  if (existingDep != null) {
    return existingDep;
  }
  Dependency parentDependency=dependency.getParent();
  if (parentDependency != null) {
    addDependency(parentDependency);
  }
  if (registerDependency(dependency)) {
    dependencyPersister.saveDependency(currentProject,from,to,dependency,parentDependency);
  }
  return dependency;
}
