{
  if (reference == null) {
    return null;
  }
  if (StringUtils.isNotBlank(reference.getKey())) {
    return buckets.get(reference);
  }
  if (StringUtils.isNotBlank(reference.getDeprecatedKey())) {
    Bucket bucket=bucketsByDeprecatedKey.get(reference.getDeprecatedKey());
    if (bucket != null) {
      reference.setKey(bucket.getResource().getKey());
      reference.setPath(bucket.getResource().getPath());
      LOG.debug("Resource {} was found using deprecated key. Please update your plugin.",reference);
      return bucket;
    }
  }
  return null;
}
