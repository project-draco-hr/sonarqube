{
  when(data.getMeasure(CoreMetrics.COMPLEXITY_IN_FUNCTIONS)).thenReturn(new Measure(CoreMetrics.COMPLEXITY,60.0));
  when(data.getMeasure(CoreMetrics.COMPLEXITY)).thenReturn(new Measure(CoreMetrics.COMPLEXITY,42.0));
  when(data.getMeasure(CoreMetrics.FUNCTIONS)).thenReturn(new Measure(CoreMetrics.FUNCTIONS,20.0));
  when(context.getResource()).thenReturn(new File("foo"));
  Measure measure=AverageFormula.create(CoreMetrics.COMPLEXITY_IN_FUNCTIONS,CoreMetrics.FUNCTIONS).setFallbackForMainMetric(CoreMetrics.COMPLEXITY).calculate(data,context);
  assertThat(measure.getValue()).isEqualTo(3.0);
}
