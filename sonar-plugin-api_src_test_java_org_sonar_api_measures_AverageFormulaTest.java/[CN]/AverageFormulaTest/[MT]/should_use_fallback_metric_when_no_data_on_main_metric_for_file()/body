{
  when(data.getMeasure(CoreMetrics.COMPLEXITY_IN_FUNCTIONS)).thenReturn(null);
  when(data.getMeasure(CoreMetrics.COMPLEXITY)).thenReturn(new Measure(CoreMetrics.COMPLEXITY,60.0));
  when(data.getMeasure(CoreMetrics.FUNCTIONS)).thenReturn(new Measure(CoreMetrics.FUNCTIONS,20.0));
  when(context.getResource()).thenReturn(new JavaFile("foo"));
  Measure measure=AverageFormula.create(CoreMetrics.COMPLEXITY_IN_FUNCTIONS,CoreMetrics.FUNCTIONS).setFallbackForMainMetric(CoreMetrics.COMPLEXITY).calculate(data,context);
  assertThat(measure.getValue(),is(3.0));
}
