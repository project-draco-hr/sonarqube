{
  for (  final BatchResource resource : resourceCache.all()) {
    if (!resource.isFile()) {
      continue;
    }
    DefaultInputFile inputFile=(DefaultInputFile)resource.inputPath();
    if (inputFile.type() != Type.TEST) {
      continue;
    }
    final MutableTestPlan testPlan=testPlanBuilder.get(MutableTestPlan.class,inputFile.key());
    if (testPlan == null || Iterables.isEmpty(testPlan.testCases())) {
      continue;
    }
    final Set<String> testNamesWithCoverage=new HashSet<>();
    writer.writeTests(resource.batchId(),Iterables.transform(testPlan.testCases(),new TestConverter(testNamesWithCoverage)));
    writer.writeCoverageDetails(resource.batchId(),Iterables.transform(testNamesWithCoverage,new TestCoverageConverter(testPlan)));
  }
}
