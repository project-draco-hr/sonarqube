{
  JpaPlugin pmd=new JpaPlugin("pmd");
  JpaPlugin checkstyle=new JpaPlugin("checkstyle");
  JpaPlugin checkstyleExtension=new JpaPlugin("checkstyle-ext");
  checkstyleExtension.setBasePlugin("checkstyle");
  PropertiesConfiguration conf=new PropertiesConfiguration();
  conf.setProperty(CoreProperties.EXCLUDE_PLUGINS,"checkstyle");
  BatchPluginRepository repository=new BatchPluginRepository(mock(JpaPluginDao.class),mock(ArtifactDownloader.class),conf);
  List<JpaPlugin> filteredPlugins=repository.filter(Arrays.asList(checkstyle,checkstyleExtension,pmd));
  assertThat(filteredPlugins.size(),Matchers.is(1));
  assertThat(filteredPlugins,hasItem(pmd));
}
