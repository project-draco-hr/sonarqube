{
  TempDirectories tempDirs=mock(TempDirectories.class);
  File toDir1=temp.newFolder();
  File toDir2=temp.newFolder();
  when(tempDirs.getDir("plugins/checkstyle")).thenReturn(toDir1);
  when(tempDirs.getDir("plugins/checkstyleextensions")).thenReturn(toDir2);
  RemotePlugin checkstyle=new RemotePlugin("checkstyle",true);
  RemotePlugin checkstyleExt=new RemotePlugin("checkstyleextensions",false);
  PluginDownloader downloader=mock(PluginDownloader.class);
  when(downloader.downloadPlugin(checkstyle)).thenReturn(copyFiles("sonar-checkstyle-plugin-2.8.jar"));
  when(downloader.downloadPlugin(checkstyleExt)).thenReturn(copyFiles("sonar-checkstyle-extensions-plugin-0.1-SNAPSHOT.jar"));
  repository=new BatchPluginRepository(downloader,tempDirs,new Settings(),mode);
  repository.doStart(Arrays.asList(checkstyle,checkstyleExt));
  assertThat(repository.getPlugin("checkstyle")).isNotNull();
  assertThat(repository.getPlugin("checkstyleextensions")).isNotNull();
  assertThat(repository.getMetadata()).hasSize(2);
  assertThat(repository.getMetadata("checkstyle").getName()).isEqualTo("Checkstyle");
  assertThat(repository.getMetadata("checkstyleextensions").getVersion()).isEqualTo("0.1-SNAPSHOT");
}
