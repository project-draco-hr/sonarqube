{
  RemotePlugin checkstyle=new RemotePlugin("checkstyle",true);
  DefaultPluginsReferential downloader=mock(DefaultPluginsReferential.class);
  when(downloader.pluginFile(checkstyle)).thenReturn(fileFromCache("sonar-checkstyle-plugin-2.8.jar"));
  repository=new BatchPluginRepository(downloader,new Settings(),mode,new BatchPluginJarInstaller(cache));
  repository.doStart(Arrays.asList(checkstyle));
  assertThat(repository.getPlugin("checkstyle")).isNotNull();
  assertThat(repository.getMetadata()).hasSize(1);
  assertThat(repository.getMetadata("checkstyle").getName()).isEqualTo("Checkstyle");
  assertThat(repository.getMetadata("checkstyle").getDeployedFiles()).hasSize(4);
}
