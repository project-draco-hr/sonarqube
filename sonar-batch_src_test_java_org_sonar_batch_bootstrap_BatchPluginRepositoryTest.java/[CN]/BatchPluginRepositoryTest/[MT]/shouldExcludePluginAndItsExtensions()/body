{
  RemotePlugin checkstyle=new RemotePlugin("checkstyle",true);
  RemotePlugin checkstyleExt=new RemotePlugin("checkstyleextensions",false);
  PluginDownloader downloader=mock(PluginDownloader.class);
  when(downloader.downloadPlugin(checkstyle)).thenReturn(fileFromCache("sonar-checkstyle-plugin-2.8.jar"));
  when(downloader.downloadPlugin(checkstyleExt)).thenReturn(fileFromCache("sonar-checkstyle-extensions-plugin-0.1-SNAPSHOT.jar"));
  Settings settings=new Settings();
  settings.setProperty(CoreProperties.BATCH_EXCLUDE_PLUGINS,"checkstyle");
  repository=new BatchPluginRepository(downloader,settings,mode,new BatchPluginJarInstaller(cache));
  repository.doStart(Arrays.asList(checkstyle,checkstyleExt));
  assertThat(repository.getMetadata()).isEmpty();
}
