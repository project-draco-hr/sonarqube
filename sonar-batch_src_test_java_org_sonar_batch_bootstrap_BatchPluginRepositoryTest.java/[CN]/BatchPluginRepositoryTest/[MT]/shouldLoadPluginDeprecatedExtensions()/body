{
  RemotePlugin checkstyle=new RemotePlugin("checkstyle",true).addFilename("checkstyle-ext.xml");
  PluginDownloader downloader=mock(PluginDownloader.class);
  when(downloader.downloadPlugin(checkstyle)).thenReturn(copyFiles("sonar-checkstyle-plugin-2.8.jar","checkstyle-ext.xml"));
  repository=new BatchPluginRepository(downloader,new Settings());
  repository.doStart(Arrays.asList(checkstyle));
  assertThat(repository.getPlugin("checkstyle"),not(nullValue()));
  assertThat(repository.getMetadata().size(),Matchers.is(1));
  assertThat(repository.getMetadata("checkstyle").getName(),Matchers.is("Checkstyle"));
  assertThat(repository.getMetadata("checkstyle").getDeployedFiles().size(),Matchers.is(5));
}
