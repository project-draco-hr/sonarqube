{
  ArtifactDownloader extensionDownloader=mock(ArtifactDownloader.class);
  prepareDownloader(extensionDownloader,"artifactsize","/org/sonar/batch/bootstrap/BatchPluginRepositoryTest/sonar-artifact-size-plugin-0.2.jar");
  prepareDownloader(extensionDownloader,"clirr","/org/sonar/batch/bootstrap/BatchPluginRepositoryTest/sonar-clirr-plugin-1.1.jar");
  BatchPluginRepository repository=new BatchPluginRepository(null,extensionDownloader,new PropertiesConfiguration());
  JpaPlugin pluginBase=new JpaPlugin("artifactsize");
  pluginBase.setPluginClass("org.sonar.plugins.artifactsize.ArtifactSizePlugin");
  pluginBase.createFile("sonar-artifact-size-plugin-0.2.jar");
  JpaPlugin pluginExtension=new JpaPlugin("clirr");
  pluginExtension.setBasePlugin("artifactsize");
  pluginExtension.setPluginClass("org.sonar.plugins.clirr.ClirrPlugin");
  pluginExtension.createFile("sonar-clirr-plugin-1.1.jar");
  repository.doStart(Arrays.asList(pluginBase,pluginExtension));
  Plugin entryPointBase=repository.getPlugin("artifactsize");
  Plugin entryPointExtension=repository.getPlugin("clirr");
  assertThat(entryPointBase.getClass().getClassLoader(),is(entryPointExtension.getClass().getClassLoader()));
}
