{
  String permission=wsRequest.mandatoryParam("permission");
  String selected=wsRequest.param(Param.SELECTED);
  int page=wsRequest.mandatoryParamAsInt(Param.PAGE);
  int pageSize=wsRequest.mandatoryParamAsInt(Param.PAGE_SIZE);
  String query=wsRequest.param(Param.TEXT_QUERY);
  if (query != null) {
    selected=SelectionMode.ALL.value();
  }
  PermissionQuery.Builder permissionQuery=PermissionQuery.builder().permission(permission).pageIndex(page).pageSize(pageSize).membership(toMembership(firstNonNull(selected,SelectionMode.SELECTED.value())));
  if (query != null) {
    permissionQuery.search(query);
  }
  if (project.isPresent()) {
    permissionQuery.component(project.get().getKey());
  }
  return permissionQuery.build();
}
