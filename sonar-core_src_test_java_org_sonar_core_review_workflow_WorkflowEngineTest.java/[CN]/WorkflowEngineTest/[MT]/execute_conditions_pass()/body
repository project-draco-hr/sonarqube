{
  Workflow workflow=new Workflow();
  workflow.addCommand("resolve");
  workflow.addCondition("resolve",new HasProjectPropertyCondition("foo"));
  Function function=mock(Function.class);
  workflow.addFunction("resolve",function);
  ReviewStore store=mock(ReviewStore.class);
  Settings settings=new Settings();
  settings.setProperty("foo","bar");
  WorkflowEngine engine=new WorkflowEngine(workflow,store,settings);
  MutableReview review=new DefaultReview().setViolationId(1000L);
  Map<String,String> parameters=Maps.newHashMap();
  DefaultWorkflowContext context=new DefaultWorkflowContext().setProjectId(300L);
  engine.execute("resolve",review,context,parameters);
  verify(store).completeProjectSettings(eq(300L),any(Settings.class),(List<String>)argThat(hasItem("foo")));
  verify(function).doExecute(eq(review),any(ImmutableReview.class),eq(context),eq(parameters));
}
