{
  BoolFilterBuilder filter=boolFilter().must(termFilter(ActiveRuleDocument.FIELD_PROFILE_ID,query.profileId()));
  addMustTermOrTerms(filter,ActiveRuleDocument.FIELD_SEVERITY,query.severities());
  String inheritance=query.inheritance();
  if (inheritance != null) {
    addMustTermOrTerms(filter,ActiveRuleDocument.FIELD_INHERITANCE,newArrayList(inheritance));
  }
 else   if (query.noInheritance()) {
    filter.mustNot(getTermOrTerms(ActiveRuleDocument.FIELD_INHERITANCE,newArrayList(QProfileRule.INHERITED,QProfileRule.OVERRIDES)));
  }
  return filter;
}
