{
  File projectDir=temp.newFolder();
  javaUnzip(new File("test-repos/dummy-git-nested.zip"),projectDir);
  JGitBlameCommand jGitBlameCommand=new JGitBlameCommand(new PathResolver());
  DefaultFileSystem fs=new DefaultFileSystem();
  File baseDir=new File(projectDir,"dummy-git-nested/dummy-project");
  fs.setBaseDir(baseDir);
  DefaultInputFile inputFile=new DefaultInputFile("foo",DUMMY_JAVA).setFile(new File(baseDir,DUMMY_JAVA));
  fs.add(inputFile);
  BlameResult blameResult=mock(BlameResult.class);
  jGitBlameCommand.blame(fs,Arrays.<InputFile>asList(inputFile),blameResult);
  Date revisionDate=DateUtils.parseDateTime("2012-07-17T16:12:48+0200");
  String revision="6b3aab35a3ea32c1636fee56f996e677653c48ea";
  String author="david@gageot.net";
  verify(blameResult).add(inputFile,Arrays.asList(new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author),new BlameLine(revisionDate,revision,author)));
}
