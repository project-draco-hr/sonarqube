{
  try {
    ZipFile zipFile=new ZipFile(zip);
    try {
      Enumeration<? extends ZipEntry> entries=zipFile.entries();
      while (entries.hasMoreElements()) {
        ZipEntry entry=entries.nextElement();
        File to=new File(toDir,entry.getName());
        if (entry.isDirectory()) {
          FileUtils.forceMkdir(to);
        }
 else {
          File parent=to.getParentFile();
          if (parent != null) {
            FileUtils.forceMkdir(parent);
          }
          OutputStream fos=new FileOutputStream(to);
          try {
            IOUtils.copy(zipFile.getInputStream(entry),fos);
          }
  finally {
            Closeables.closeQuietly(fos);
          }
        }
      }
    }
  finally {
      zipFile.close();
    }
  }
 catch (  Exception e) {
    throw new IllegalStateException("Fail to unzip " + zip + " to "+ toDir,e);
  }
}
