{
  DbSession dbSession=db.openSession(false);
  try {
    QualityProfileDto profile=db.qualityProfileDao().getByKey(dbSession,profileKey);
    if (profile == null) {
      throw new IllegalStateException("Quality profile does not exist: " + profileKey);
    }
    BulkChangeResult result=doReset(dbSession,profile,activations);
    dbSession.commit();
    return result;
  }
  finally {
    dbSession.close();
  }
}
