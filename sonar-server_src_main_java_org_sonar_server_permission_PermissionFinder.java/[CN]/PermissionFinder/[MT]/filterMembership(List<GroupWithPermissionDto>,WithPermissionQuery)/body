{
  return newArrayList(Iterables.filter(dtos,new Predicate<GroupWithPermissionDto>(){
    @Override public boolean apply(    GroupWithPermissionDto dto){
      if (query.membership().equals(WithPermissionQuery.IN)) {
        return dto.getPermission() != null;
      }
 else       if (query.membership().equals(WithPermissionQuery.OUT)) {
        return dto.getPermission() == null;
      }
      return true;
    }
  }
));
}
