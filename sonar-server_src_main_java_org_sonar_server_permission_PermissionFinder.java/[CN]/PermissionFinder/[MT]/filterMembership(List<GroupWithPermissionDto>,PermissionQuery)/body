{
  return newArrayList(Iterables.filter(dtos,new Predicate<GroupWithPermissionDto>(){
    @Override public boolean apply(    GroupWithPermissionDto dto){
      if (PermissionQuery.IN.equals(query.membership())) {
        return dto.getPermission() != null;
      }
 else       if (PermissionQuery.OUT.equals(query.membership())) {
        return dto.getPermission() == null;
      }
      return true;
    }
  }
));
}
