{
  setupData("shared");
  TimeMachineConfiguration timeMachineConfiguration=mock(TimeMachineConfiguration.class);
  PastSnapshot vs1=new PastSnapshot("days",DateUtils.parseDate("2009-01-25"),getSession().getSingleResult(Snapshot.class,"id",100)).setModeParameter("30").setIndex(1);
  PastSnapshot vs3=new PastSnapshot("version",DateUtils.parseDate("2008-12-13"),getSession().getSingleResult(Snapshot.class,"id",300)).setModeParameter("1.2.3").setIndex(3);
  when(timeMachineConfiguration.getProjectPastSnapshots()).thenReturn(Arrays.asList(vs1,vs3));
  Snapshot projectSnapshot=getSession().getSingleResult(Snapshot.class,"id",1000);
  BatchComponentCache resourceCache=new BatchComponentCache();
  Project project=new Project("foo");
  resourceCache.add(project,null).setSnapshot(projectSnapshot);
  TimeMachineConfigurationPersister persister=new TimeMachineConfigurationPersister(timeMachineConfiguration,resourceCache,getSession());
  persister.persistConfiguration(project);
  checkTables("shouldSaveConfigurationInSnapshotsTable","snapshots");
}
