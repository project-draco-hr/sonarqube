{
  Map<String,Long> counts=new HashMap<>();
  SearchRequestBuilder request=client.prepareSearch(this.getIndexName()).setTypes(this.getIndexType()).setQuery(QueryBuilders.filteredQuery(QueryBuilders.matchAllQuery(),filter)).setSize(0).addAggregation(AggregationBuilders.terms(indexField.field()).field(indexField.field()).order(Terms.Order.count(false)).size(Integer.MAX_VALUE).minDocCount(0));
  SearchResponse response=request.get();
  Terms values=response.getAggregations().get(indexField.field());
  for (  Terms.Bucket value : values.getBuckets()) {
    counts.put(value.getKey(),value.getDocCount());
  }
  return counts;
}
