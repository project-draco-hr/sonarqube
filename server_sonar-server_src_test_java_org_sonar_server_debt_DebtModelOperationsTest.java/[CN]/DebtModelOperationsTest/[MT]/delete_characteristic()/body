{
  DbSession batchSession=mock(DbSession.class);
  when(dbClient.openSession(true)).thenReturn(batchSession);
  when(ruleDao.selectRulesByDebtSubCharacteristicId(batchSession,subCharacteristicDto.getId())).thenReturn(newArrayList(new RuleDto().setSubCharacteristicId(subCharacteristicDto.getId()).setRemediationFunction(DebtRemediationFunction.Type.LINEAR_OFFSET.toString()).setRemediationCoefficient("2h").setRemediationOffset("5min")));
  when(dao.selectCharacteristicsByParentId(1,batchSession)).thenReturn(newArrayList(subCharacteristicDto));
  when(dao.selectById(batchSession,1)).thenReturn(characteristicDto);
  service.delete(1);
  verify(ruleDao).update(eq(batchSession),ruleCaptor.capture());
  verify(dao,times(2)).update(characteristicCaptor.capture(),eq(batchSession));
  CharacteristicDto subCharacteristicDto=characteristicCaptor.getAllValues().get(0);
  CharacteristicDto characteristicDto=characteristicCaptor.getAllValues().get(1);
  assertThat(subCharacteristicDto.getId()).isEqualTo(2);
  assertThat(subCharacteristicDto.isEnabled()).isFalse();
  assertThat(subCharacteristicDto.getUpdatedAt()).isEqualTo(now);
  assertThat(characteristicDto.getId()).isEqualTo(1);
  assertThat(characteristicDto.isEnabled()).isFalse();
  assertThat(characteristicDto.getUpdatedAt()).isEqualTo(now);
}
