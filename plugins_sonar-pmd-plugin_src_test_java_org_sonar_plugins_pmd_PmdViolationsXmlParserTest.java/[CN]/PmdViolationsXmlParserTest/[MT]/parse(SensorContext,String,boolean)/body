{
  ProjectFileSystem fileSystem=mock(ProjectFileSystem.class);
  when(fileSystem.getSourceDirs()).thenReturn(Arrays.asList(new File("/test/src/main/java")));
  Project project=mock(Project.class);
  when(project.getFileSystem()).thenReturn(fileSystem);
  RuleFinder ruleFinder=mock(RuleFinder.class);
  when(ruleFinder.findByKey(anyString(),anyString())).thenAnswer(new Answer<Rule>(){
    public Rule answer(    InvocationOnMock invocation) throws Throwable {
      Object[] args=invocation.getArguments();
      return Rule.create((String)args[0],(String)args[1],"");
    }
  }
);
  if (useIndexedResources) {
    when(context.getResource((JavaFile)any())).thenReturn(new JavaFile(""));
  }
 else {
    when(context.getResource((JavaFile)any())).thenReturn(null);
  }
  PmdViolationsXmlParser parser=new PmdViolationsXmlParser(project,ruleFinder,context);
  File xmlFile=new File(getClass().getResource(xmlPath).toURI());
  parser.parse(xmlFile);
}
