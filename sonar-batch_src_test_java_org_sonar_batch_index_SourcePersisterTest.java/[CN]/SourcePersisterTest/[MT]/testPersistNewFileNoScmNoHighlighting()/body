{
  setupData("file_sources");
  Date now=DateUtils.parseDateTime("2014-10-29T16:44:02+0100");
  when(system2.newDate()).thenReturn(now);
  String relativePathNew="src/new.java";
  java.io.File newFile=new java.io.File(basedir,relativePathNew);
  FileUtils.write(newFile,"foo\nbar\nbiz");
  DefaultInputFile inputFileNew=new DefaultInputFile(PROJECT_KEY,relativePathNew).setLines(3).setAbsolutePath(newFile.getAbsolutePath());
  when(inputPathCache.all()).thenReturn(Arrays.<InputPath>asList(inputFileNew));
  mockResourceCache(relativePathNew,PROJECT_KEY,"uuidnew");
  sourcePersister.persist();
  FileSourceDto fileSourceDto=new FileSourceDao(getMyBatis()).select("uuidnew");
  assertThat(fileSourceDto.getCreatedAt()).isEqualTo(now);
  assertThat(fileSourceDto.getUpdatedAt()).isEqualTo(now);
  assertThat(fileSourceDto.getStringData()).isEqualTo(",,,,foo\r\n,,,,bar\r\n,,,,biz\r\n");
  assertThat(fileSourceDto.getDataHash()).isEqualTo("0c43ed6418d690ee0ffc3e43e6660967");
}
