{
  Snapshot snapshot=resourcePersister.saveResource(project,resource);
  if (snapshot != null) {
    if (event.getDate() == null) {
      event.setSnapshot(snapshot);
    }
 else {
      event.setResourceId(snapshot.getResourceId());
    }
    session.save(event);
    session.commit();
  }
}
