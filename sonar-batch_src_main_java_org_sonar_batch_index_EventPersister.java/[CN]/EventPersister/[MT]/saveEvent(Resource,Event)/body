{
  BatchResource batchResource=resourceCache.get(resource.getEffectiveKey());
  checkState(batchResource != null,"Unknown component: " + resource);
  event.setCreatedAt(new Date(system2.now()));
  if (event.getDate() == null) {
    event.setSnapshot(batchResource.snapshot());
    event.setComponentUuid(batchResource.resource().getUuid());
  }
 else {
    event.setComponentUuid(batchResource.resource().getUuid());
  }
  session.save(event);
  session.commit();
}
