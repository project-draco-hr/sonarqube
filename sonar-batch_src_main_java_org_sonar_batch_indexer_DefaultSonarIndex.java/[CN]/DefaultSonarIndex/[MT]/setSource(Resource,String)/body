{
  Bucket bucket=getOrCreateBucket(resource,false);
  if (!bucket.isExcluded()) {
    if (bucket.isSourceSaved()) {
      LOG.warn("Trying to save twice the source of " + resource);
    }
 else {
      try {
        session.save(new SnapshotSource(bucket.getSnapshotId(),source));
      }
 catch (      Exception e) {
        throw new SonarException("Unable to save source [resource=" + resource + ",snapshotId="+ bucket.getSnapshotId()+ "]",e);
      }
      bucket.setSourceSaved(true);
    }
  }
}
