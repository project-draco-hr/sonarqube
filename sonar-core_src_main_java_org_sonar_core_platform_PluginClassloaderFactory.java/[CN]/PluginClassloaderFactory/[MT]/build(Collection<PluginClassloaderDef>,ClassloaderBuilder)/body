{
  Map<PluginClassloaderDef,ClassLoader> result=new HashMap<>();
  Map<String,ClassLoader> classloadersByBasePluginKey=builder.build();
  for (  PluginClassloaderDef def : defs) {
    ClassLoader classloader=classloadersByBasePluginKey.get(def.getBasePluginKey());
    if (classloader == null) {
      throw new IllegalStateException(String.format("Fail to create classloader for plugin [%s]",def.getBasePluginKey()));
    }
    result.put(def,classloader);
  }
  return result;
}
