{
  Query query=session.createQuery("SELECT s FROM " + Snapshot.class.getSimpleName() + " s "+ "WHERE s.status=:status AND s.resourceId=:resourceId AND s.createdAt<:date AND s.id <> :sid ORDER BY s.createdAt DESC");
  query.setParameter("status",Snapshot.STATUS_PROCESSED);
  query.setParameter("resourceId",snapshot.getResourceId());
  query.setParameter("date",snapshot.getCreatedAt());
  query.setParameter("sid",snapshot.getId());
  query.setMaxResults(1);
  return session.getSingleResult(query,null);
}
