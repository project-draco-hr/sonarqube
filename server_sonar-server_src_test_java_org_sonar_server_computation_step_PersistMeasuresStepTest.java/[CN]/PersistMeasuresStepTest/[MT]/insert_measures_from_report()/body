{
  metricRepository.add(1,STRING_METRIC);
  metricRepository.add(2,DOUBLE_METRIC);
  measureRepository.addRawMeasure(PROJECT_REF,STRING_METRIC_KEY,Measure.newMeasureBuilder().create("measure-data"));
  measureRepository.addRawMeasure(FILE_REF,DOUBLE_METRIC_KEY,Measure.newMeasureBuilder().create(123.123d));
  sut.execute();
  assertThat(dbTester.countRowsOfTable("project_measures")).isEqualTo(2);
  List<Map<String,Object>> dtos=selectSnapshots();
  Map<String,Object> dto=dtos.get(0);
  assertThat(dto.get("snapshotId")).isEqualTo(3L);
  assertThat(dto.get("componentId")).isEqualTo(projectDto.getId());
  assertThat(dto.get("metricId")).isEqualTo(1L);
  assertThat(dto.get("textValue")).isEqualTo("measure-data");
  assertThat(dto.get("severity")).isNull();
  dto=dtos.get(1);
  assertThat(dto.get("snapshotId")).isEqualTo(4L);
  assertThat(dto.get("componentId")).isEqualTo(fileDto.getId());
  assertThat(dto.get("metricId")).isEqualTo(2L);
  assertThat(dto.get("value")).isEqualTo(123.1d);
  assertThat(dto.get("severity")).isNull();
}
