{
  metricRepository.add(1,FUNCTION_COMPLEXITY_DISTRIBUTION);
  reportReader.putMeasures(PROJECT_REF,Arrays.asList(BatchReport.Measure.newBuilder().setValueType(MeasureValueType.STRING).setStringValue("0=1;2=10").setMetricKey(FUNCTION_COMPLEXITY_DISTRIBUTION_KEY).build()));
  reportReader.putMeasures(FILE_REF,Arrays.asList(BatchReport.Measure.newBuilder().setValueType(MeasureValueType.STRING).setStringValue("0=1;2=10").setMetricKey(FUNCTION_COMPLEXITY_DISTRIBUTION_KEY).build()));
  sut.execute();
  session.commit();
  assertThat(dbTester.countRowsOfTable("project_measures")).isEqualTo(1);
  List<Map<String,Object>> dtos=retrieveDtos();
  Map<String,Object> dto=dtos.get(0);
  assertThat(dto.get("snapshotId")).isEqualTo(3L);
  assertThat(dto.get("componentId")).isEqualTo(projectDto.getId());
  assertThat(dto.get("textValue")).isEqualTo("0=1;2=10");
}
