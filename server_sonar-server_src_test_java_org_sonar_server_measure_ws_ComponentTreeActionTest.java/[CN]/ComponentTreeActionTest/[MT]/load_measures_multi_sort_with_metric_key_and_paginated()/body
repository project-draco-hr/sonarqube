{
  ComponentDto projectDto=newProjectDto("project-uuid");
  SnapshotDto projectSnapshot=componentDb.insertProjectAndSnapshot(projectDto);
  SnapshotDto fileSnapshot9=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-9").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot8=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-8").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot7=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-7").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot6=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-6").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot5=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-5").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot4=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-4").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot3=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-3").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot2=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-2").setName("file-1"),projectSnapshot);
  SnapshotDto fileSnapshot1=componentDb.insertComponentAndSnapshot(newFileDto(projectDto,"file-uuid-1").setName("file-1"),projectSnapshot);
  MetricDto coverage=insertCoverageMetric();
  dbClient.measureDao().insert(dbSession,newMeasureDto(coverage,fileSnapshot1).setValue(1.0d),newMeasureDto(coverage,fileSnapshot2).setValue(2.0d),newMeasureDto(coverage,fileSnapshot3).setValue(3.0d),newMeasureDto(coverage,fileSnapshot4).setValue(4.0d),newMeasureDto(coverage,fileSnapshot5).setValue(5.0d),newMeasureDto(coverage,fileSnapshot6).setValue(6.0d),newMeasureDto(coverage,fileSnapshot7).setValue(7.0d),newMeasureDto(coverage,fileSnapshot8).setValue(8.0d),newMeasureDto(coverage,fileSnapshot9).setValue(9.0d));
  db.commit();
  ComponentTreeWsResponse response=call(ws.newRequest().setParam(PARAM_BASE_COMPONENT_ID,"project-uuid").setParam(Param.SORT,NAME_SORT + ", " + METRIC_SORT).setParam(PARAM_METRIC_SORT,"coverage").setParam(PARAM_METRIC_KEYS,"coverage").setParam(PARAM_STRATEGY,"leaves").setParam(PARAM_QUALIFIERS,"FIL,UTS").setParam(Param.PAGE,"2").setParam(Param.PAGE_SIZE,"3"));
  assertThat(response.getComponentsList()).extracting("id").containsExactly("file-uuid-4","file-uuid-5","file-uuid-6");
}
