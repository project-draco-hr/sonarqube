{
  Characteristic defaultRootCharacteristic=new Characteristic().setKey("PORTABILITY");
  new Characteristic().setKey("COMPILER_RELATED_PORTABILITY").setParent(defaultRootCharacteristic);
  defaultModel.addRootCharacteristic(defaultRootCharacteristic);
  CharacteristicDto dbRootCharacteristic=new CharacteristicDto().setId(1).setKey("PORTABILITY");
  CharacteristicDto dbCharacteristic=new CharacteristicDto().setId(2).setKey("COMPILER_RELATED_PORTABILITY").setParentId(1);
  CharacteristicDto requirement=new CharacteristicDto().setId(3).setRuleId(10).setParentId(2).setFactorValue(30.0).setFactorUnit("mn");
  RuleKey ruleKey1=RuleKey.of("checkstyle","import");
  Rule rule1=Rule.create();
  rule1.setId(10);
  when(ruleCache.getByRuleKey(ruleKey1)).thenReturn(rule1);
  when(ruleCache.exists(10)).thenReturn(true);
  when(dao.selectEnabledCharacteristics()).thenReturn(newArrayList(dbRootCharacteristic,dbCharacteristic,requirement));
  TechnicalDebtModel javaModel=new TechnicalDebtModel();
  Characteristic javaRootCharacteristic=new Characteristic().setKey("PORTABILITY");
  Characteristic javaCharacteristic=new Characteristic().setKey("COMPILER_RELATED_PORTABILITY").setParent(javaRootCharacteristic);
  javaModel.addRootCharacteristic(javaRootCharacteristic);
  RuleKey ruleKey2=RuleKey.of("checkstyle","export");
  Rule rule2=Rule.create();
  rule2.setId(11);
  when(ruleCache.getByRuleKey(ruleKey2)).thenReturn(rule2);
  new Requirement().setRuleKey(ruleKey2).setFunction("linear").setFactor(WorkUnit.create(1.0,WorkUnit.HOURS)).setCharacteristic(javaCharacteristic);
  Reader javaModelReader=mock(Reader.class);
  when(technicalDebtModelRepository.createReaderForXMLFile("java")).thenReturn(javaModelReader);
  when(xmlImporter.importXML(eq(javaModelReader),any(ValidationMessages.class),eq(ruleCache))).thenReturn(javaModel);
  when(technicalDebtModelRepository.getContributingPluginList()).thenReturn(newArrayList("java"));
  manager.initAndMergePlugins(ValidationMessages.create(),ruleCache);
  verify(dao).selectEnabledCharacteristics();
  ArgumentCaptor<CharacteristicDto> characteristicCaptor=ArgumentCaptor.forClass(CharacteristicDto.class);
  verify(dao).insert(characteristicCaptor.capture(),eq(session));
  assertThat(characteristicCaptor.getValue().getRuleId()).isEqualTo(11);
  verifyNoMoreInteractions(dao);
}
