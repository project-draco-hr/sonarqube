{
  LOGGER.info("Persist file sources");
  DbClient dbClient=dbTester.getDbClient();
  long start=System.currentTimeMillis();
  BatchReportDirectoryHolderImpl ScannerReportDirectoryHolder=new BatchReportDirectoryHolderImpl();
  ScannerReportDirectoryHolder.setDirectory(reportDir);
  org.sonar.server.computation.batch.BatchReportReader ScannerReportReader=new BatchReportReaderImpl(ScannerReportDirectoryHolder);
  analysisMetadataHolder.setBaseProjectSnapshot(null);
  SourceLinesRepositoryImpl sourceLinesRepository=new SourceLinesRepositoryImpl(ScannerReportReader);
  SourceHashRepositoryImpl sourceHashRepository=new SourceHashRepositoryImpl(sourceLinesRepository);
  ScmInfoRepositoryImpl scmInfoRepository=new ScmInfoRepositoryImpl(ScannerReportReader,analysisMetadataHolder,dbClient,sourceHashRepository);
  PersistFileSourcesStep step=new PersistFileSourcesStep(dbClient,System2.INSTANCE,treeRootHolder,ScannerReportReader,sourceLinesRepository,scmInfoRepository,duplicationRepository);
  step.execute();
  long end=System.currentTimeMillis();
  long duration=end - start;
  assertThat(dbTester.countRowsOfTable("file_sources")).isEqualTo(NUMBER_OF_FILES);
  LOGGER.info(String.format("File sources have been persisted in %d ms",duration));
  benchmark.expectAround("Duration to persist FILE_SOURCES",duration,40000L,Benchmark.DEFAULT_ERROR_MARGIN_PERCENTS);
}
