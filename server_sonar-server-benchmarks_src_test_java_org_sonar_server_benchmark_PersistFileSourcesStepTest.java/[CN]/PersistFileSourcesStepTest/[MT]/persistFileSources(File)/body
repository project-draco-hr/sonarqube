{
  LOGGER.info("Persist file sources");
  DbClient dbClient=dbTester.getDbClient();
  long start=System.currentTimeMillis();
  BatchReportDirectoryHolderImpl batchReportDirectoryHolder=new BatchReportDirectoryHolderImpl();
  batchReportDirectoryHolder.setDirectory(reportDir);
  org.sonar.server.computation.batch.BatchReportReader batchReportReader=new BatchReportReaderImpl(batchReportDirectoryHolder);
  analysisMetadataHolder.setIsFirstAnalysis(false);
  SourceLinesRepositoryImpl sourceLinesRepository=new SourceLinesRepositoryImpl(batchReportReader);
  SourceHashRepositoryImpl sourceHashRepository=new SourceHashRepositoryImpl(sourceLinesRepository);
  ScmInfoRepositoryImpl scmInfoRepository=new ScmInfoRepositoryImpl(batchReportReader,analysisMetadataHolder,dbClient,sourceHashRepository);
  PersistFileSourcesStep step=new PersistFileSourcesStep(dbClient,System2.INSTANCE,treeRootHolder,batchReportReader,sourceLinesRepository,scmInfoRepository,duplicationRepository);
  step.execute();
  long end=System.currentTimeMillis();
  long duration=end - start;
  assertThat(dbTester.countRowsOfTable("file_sources")).isEqualTo(NUMBER_OF_FILES);
  LOGGER.info(String.format("File sources have been persisted in %d ms",duration));
  benchmark.expectAround("Duration to persist FILE_SOURCES",duration,109000,Benchmark.DEFAULT_ERROR_MARGIN_PERCENTS);
}
