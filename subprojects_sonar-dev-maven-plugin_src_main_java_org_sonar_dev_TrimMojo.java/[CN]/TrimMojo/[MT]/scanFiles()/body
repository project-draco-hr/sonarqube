{
  String[] defaultIncludes={"**\\*"};
  DirectoryScanner ds=new DirectoryScanner();
  if (includes == null) {
    ds.setIncludes(defaultIncludes);
  }
 else {
    ds.setIncludes(includes);
  }
  ds.addDefaultExcludes();
  if (excludes != null) {
    ds.setExcludes(excludes);
  }
  ds.setBasedir(directory);
  getLog().info("Scanning directory " + directory);
  ds.scan();
  int maxFiles=ds.getIncludedFiles().length;
  File[] result=new File[maxFiles];
  for (int i=0; i < maxFiles; i++) {
    result[i]=new File(directory,ds.getIncludedFiles()[i]);
  }
  return result;
}
