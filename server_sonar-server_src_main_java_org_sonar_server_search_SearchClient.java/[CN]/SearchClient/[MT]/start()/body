{
  if (nativeClient == null) {
    ESLoggerFactory.setDefaultFactory(new Slf4jESLoggerFactory());
    org.elasticsearch.common.settings.Settings esSettings=ImmutableSettings.settingsBuilder().put("node.name",StringUtils.defaultIfEmpty(settings.getString(ProcessProperties.CLUSTER_NODE_NAME),"sq_local_client")).put("network.bind_host",StringUtils.defaultIfEmpty(settings.getString(ProcessProperties.SEARCH_HOST),"localhost")).put("node.rack_id",StringUtils.defaultIfEmpty(settings.getString(ProcessProperties.CLUSTER_NODE_NAME),"unknown")).put("cluster.name",StringUtils.defaultIfBlank(settings.getString(ProcessProperties.CLUSTER_NAME),"sonarqube")).build();
    nativeClient=new TransportClient(esSettings);
    ((TransportClient)nativeClient).addTransportAddress(new InetSocketTransportAddress(StringUtils.defaultIfEmpty(settings.getString(ProcessProperties.SEARCH_HOST),LoopbackAddress.get().getHostAddress()),settings.getInt(ProcessProperties.SEARCH_PORT)));
  }
}
