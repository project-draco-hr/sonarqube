{
  DbSession session=dbClient.openSession(false);
  try {
    for (    ComponentDto componentDto : dbClient.componentDao().getByKeys(session,componentsByKey.keySet())) {
      componentsByKey.put(componentDto.key(),componentDto);
    }
  }
  finally {
    session.close();
  }
  json.name("files").beginObject();
  for (  Map.Entry<String,Integer> entry : refByTestPlan.entrySet()) {
    String componentKey=entry.getKey();
    Integer ref=entry.getValue();
    Component file=componentsByKey.get(componentKey);
    json.name(Integer.toString(ref)).beginObject();
    json.prop("key",file.key());
    json.prop("uuid",((ComponentDto)file).uuid());
    json.prop("longName",file.longName());
    json.endObject();
  }
  json.endObject();
}
