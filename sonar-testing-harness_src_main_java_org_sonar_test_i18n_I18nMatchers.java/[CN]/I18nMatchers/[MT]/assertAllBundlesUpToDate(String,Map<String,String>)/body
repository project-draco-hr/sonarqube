{
  File bundleFolder=TestUtils.getResource(BundleSynchronizedMatcher.L10N_PATH);
  if (bundleFolder == null || !bundleFolder.isDirectory()) {
    fail("No bundle found in '" + BundleSynchronizedMatcher.L10N_PATH + "'");
  }
  Collection<File> bundles=FileUtils.listFiles(bundleFolder,new String[]{"properties"},false);
  Map<String,String> failedAssertionMessages=Maps.newHashMap();
  for (  File bundle : bundles) {
    String bundleName=bundle.getName();
    if (bundleName.indexOf('_') > 0) {
      try {
        String baseBundleName=BundleSynchronizedMatcher.extractDefaultBundleName(bundleName);
        String pluginId=StringUtils.substringBefore(baseBundleName,".");
        if (BundleSynchronizedMatcher.isCoreBundle(baseBundleName)) {
          assertThat(bundleName,isBundleUpToDate(sonarVersion));
        }
 else         if (pluginIdsToBundleUrlMap != null && pluginIdsToBundleUrlMap.get(pluginId) != null) {
          assertThat(bundleName,isBundleUpToDate(new URI(pluginIdsToBundleUrlMap.get(pluginId))));
        }
 else {
          assertThat(bundleName,isBundleUpToDate());
        }
      }
 catch (      AssertionError e) {
        failedAssertionMessages.put(bundleName,e.getMessage());
      }
    }
  }
  if (!failedAssertionMessages.isEmpty()) {
    StringBuilder message=new StringBuilder();
    message.append(failedAssertionMessages.size());
    message.append(" bundles are not up-to-date: ");
    message.append(StringUtils.join(failedAssertionMessages.keySet(),", "));
    message.append("\n\n");
    message.append(StringUtils.join(failedAssertionMessages.values(),"\n\n"));
    fail(message.toString());
  }
}
