{
  if (query.checkAuthorization()) {
    String user=query.userLogin();
    OrFilterBuilder groupsAndUser=FilterBuilders.orFilter();
    if (user != null) {
      groupsAndUser.add(FilterBuilders.termFilter(IssueIndexDefinition.FIELD_AUTHORIZATION_USERS,user));
    }
    for (    String group : query.userGroups()) {
      groupsAndUser.add(FilterBuilders.termFilter(IssueIndexDefinition.FIELD_AUTHORIZATION_GROUPS,group));
    }
    return FilterBuilders.hasParentFilter(IssueIndexDefinition.TYPE_AUTHORIZATION,QueryBuilders.filteredQuery(QueryBuilders.matchAllQuery(),FilterBuilders.boolFilter().must(groupsAndUser).cache(true)));
  }
 else {
    return FilterBuilders.matchAllFilter();
  }
}
