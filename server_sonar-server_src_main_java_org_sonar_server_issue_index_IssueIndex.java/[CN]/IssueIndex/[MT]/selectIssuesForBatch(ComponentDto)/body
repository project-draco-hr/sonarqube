{
  BoolFilterBuilder filter=FilterBuilders.boolFilter().must(createAuthorizationFilter(true,UserSession.get().login(),UserSession.get().userGroups())).mustNot(FilterBuilders.termsFilter(IssueIndexDefinition.FIELD_ISSUE_STATUS,Issue.STATUS_CLOSED));
switch (component.scope()) {
case Scopes.PROJECT:
    filter.must(FilterBuilders.termsFilter(IssueIndexDefinition.FIELD_ISSUE_MODULE_PATH,component.uuid()));
  break;
case Scopes.FILE:
filter.must(FilterBuilders.termsFilter(IssueIndexDefinition.FIELD_ISSUE_COMPONENT_UUID,component.uuid()));
break;
default :
throw new IllegalStateException(String.format("Component of scope '%s' is not allowed",component.scope()));
}
SearchRequestBuilder requestBuilder=getClient().prepareSearch(IssueIndexDefinition.INDEX).setTypes(IssueIndexDefinition.TYPE_ISSUE).setSearchType(SearchType.SCAN).setScroll(TimeValue.timeValueMinutes(EsUtils.SCROLL_TIME_IN_MINUTES)).setSize(10000).setFetchSource(new String[]{IssueIndexDefinition.FIELD_ISSUE_KEY,IssueIndexDefinition.FIELD_ISSUE_RULE_KEY,IssueIndexDefinition.FIELD_ISSUE_MODULE_UUID,IssueIndexDefinition.FIELD_ISSUE_FILE_PATH,IssueIndexDefinition.FIELD_ISSUE_SEVERITY,IssueIndexDefinition.FIELD_ISSUE_MANUAL_SEVERITY,IssueIndexDefinition.FIELD_ISSUE_RESOLUTION,IssueIndexDefinition.FIELD_ISSUE_STATUS,IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE,IssueIndexDefinition.FIELD_ISSUE_LINE,IssueIndexDefinition.FIELD_ISSUE_MESSAGE,IssueIndexDefinition.FIELD_ISSUE_CHECKSUM,IssueIndexDefinition.FIELD_ISSUE_FUNC_CREATED_AT},null).setQuery(QueryBuilders.filteredQuery(QueryBuilders.matchAllQuery(),filter));
SearchResponse response=requestBuilder.get();
return EsUtils.scroll(getClient(),response.getScrollId(),DOC_CONVERTER);
}
