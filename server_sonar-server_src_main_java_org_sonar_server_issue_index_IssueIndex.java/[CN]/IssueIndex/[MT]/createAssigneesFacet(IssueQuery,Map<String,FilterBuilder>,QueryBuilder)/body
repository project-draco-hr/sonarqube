{
  String fieldName=IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE;
  String facetName=IssueFilterParameters.ASSIGNEES;
  Map<String,FilterBuilder> assigneeFilters=Maps.newHashMap(filters);
  assigneeFilters.remove("__isAssigned");
  assigneeFilters.remove(fieldName);
  StickyFacetBuilder assigneeFacetBuilder=new StickyFacetBuilder(queryBuilder,assigneeFilters);
  BoolFilterBuilder facetFilter=assigneeFacetBuilder.getStickyFacetFilter(fieldName);
  FilterAggregationBuilder facetTopAggregation=assigneeFacetBuilder.buildTopFacetAggregation(fieldName,facetName,facetFilter,DEFAULT_FACET_SIZE);
  List<String> assignees=Lists.newArrayList(query.assignees());
  UserSession session=UserSession.get();
  if (session.isLoggedIn()) {
    assignees.add(session.login());
  }
  facetTopAggregation=assigneeFacetBuilder.addSelectedItemsToFacet(fieldName,facetName,facetTopAggregation,assignees.toArray());
  facetTopAggregation.subAggregation(AggregationBuilders.missing(facetName + FACET_SUFFIX_MISSING).field(fieldName));
  return AggregationBuilders.global(facetName).subAggregation(facetTopAggregation);
}
