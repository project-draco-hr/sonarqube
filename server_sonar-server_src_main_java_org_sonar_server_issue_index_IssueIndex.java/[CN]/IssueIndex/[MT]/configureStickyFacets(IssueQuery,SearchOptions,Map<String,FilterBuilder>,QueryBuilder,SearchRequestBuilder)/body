{
  if (!options.getFacets().isEmpty()) {
    StickyFacetBuilder stickyFacetBuilder=newStickyFacetBuilder(query,filters,esQuery);
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.SEVERITIES,IssueIndexDefinition.FIELD_ISSUE_SEVERITY,Severity.ALL.toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.STATUSES,IssueIndexDefinition.FIELD_ISSUE_STATUS,Issue.STATUSES.toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.PROJECT_UUIDS,IssueIndexDefinition.FIELD_ISSUE_PROJECT_UUID,query.projectUuids().toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.MODULE_UUIDS,IssueIndexDefinition.FIELD_ISSUE_MODULE_UUID,query.moduleUuids().toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.DIRECTORIES,IssueIndexDefinition.FIELD_ISSUE_DIRECTORY_PATH,query.directories().toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.FILE_UUIDS,IssueIndexDefinition.FIELD_ISSUE_COMPONENT_UUID,query.fileUuids().toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.LANGUAGES,IssueIndexDefinition.FIELD_ISSUE_LANGUAGE,query.languages().toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.RULES,IssueIndexDefinition.FIELD_ISSUE_RULE_KEY,query.rules().toArray());
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.REPORTERS,IssueIndexDefinition.FIELD_ISSUE_REPORTER);
    addSimpleStickyFacetIfNeeded(options,stickyFacetBuilder,esSearch,IssueFilterParameters.AUTHORS,IssueIndexDefinition.FIELD_ISSUE_AUTHOR_LOGIN,query.authors().toArray());
    if (options.getFacets().contains(IssueFilterParameters.TAGS)) {
      esSearch.addAggregation(stickyFacetBuilder.buildStickyFacet(IssueIndexDefinition.FIELD_ISSUE_TAGS,IssueFilterParameters.TAGS,query.tags().toArray()));
    }
    if (options.getFacets().contains(IssueFilterParameters.RESOLUTIONS)) {
      esSearch.addAggregation(createResolutionFacet(query,filters,esQuery));
    }
    if (options.getFacets().contains(IssueFilterParameters.ASSIGNEES)) {
      esSearch.addAggregation(createAssigneesFacet(query,filters,esQuery));
    }
    addAssignedToMeFacetIfNeeded(esSearch,options,query,filters,esQuery);
    if (options.getFacets().contains(IssueFilterParameters.ACTION_PLANS)) {
      esSearch.addAggregation(createActionPlansFacet(query,filters,esQuery));
    }
    if (options.getFacets().contains(IssueFilterParameters.CREATED_AT)) {
      esSearch.addAggregation(getCreatedAtFacet(query,filters,esQuery));
    }
  }
  if (IssueFilterParameters.FACET_MODE_DEBT.equals(query.facetMode())) {
    esSearch.addAggregation(DEBT_AGGREGATION);
  }
}
