{
  if (!options.getFacets().contains(IssueFilterParameters.ASSIGNED_TO_ME)) {
    return;
  }
  String login=UserSession.get().login();
  if (StringUtils.isEmpty(login)) {
    return;
  }
  String fieldName=IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE;
  String facetName=IssueFilterParameters.ASSIGNED_TO_ME;
  Map<String,FilterBuilder> assigneeFilters=Maps.newHashMap(filters);
  StickyFacetBuilder assignedToMeFacetBuilder=new StickyFacetBuilder(queryBuilder,assigneeFilters);
  BoolFilterBuilder facetFilter=assignedToMeFacetBuilder.getStickyFacetFilter("__assigned_to_me");
  builder.addAggregation(AggregationBuilders.filter(facetName).filter(facetFilter).subAggregation(AggregationBuilders.terms(facetName + "__terms").field(fieldName).include(login)));
}
