{
  QueryContext queryContext=new QueryContext().setPage(1,0);
  SearchRequestBuilder esSearch=getClient().prepareSearch(this.getIndexName()).setTypes(this.getIndexType()).setIndices(this.getIndexName());
  QueryBuilder esQuery=QueryBuilders.matchAllQuery();
  BoolFilterBuilder esFilter=getFilter(query,queryContext);
  if (esFilter.hasClauses()) {
    esSearch.setQuery(QueryBuilders.filteredQuery(esQuery,esFilter));
  }
 else {
    esSearch.setQuery(esQuery);
  }
  esSearch.addAggregation(AggregationBuilders.terms(IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE).size(Integer.MAX_VALUE).field(IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE));
  esSearch.addAggregation(AggregationBuilders.missing("notAssigned").field(IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE));
  SearchResponse response=esSearch.get();
  Terms aggregation=(Terms)response.getAggregations().getAsMap().get(IssueIndexDefinition.FIELD_ISSUE_ASSIGNEE);
  List<FacetValue> facetValues=newArrayList();
  for (  Terms.Bucket value : aggregation.getBuckets()) {
    facetValues.add(new FacetValue(value.getKey(),value.getDocCount()));
  }
  facetValues.add(new FacetValue("_notAssigned_",((InternalMissing)response.getAggregations().get("notAssigned")).getDocCount()));
  return facetValues;
}
