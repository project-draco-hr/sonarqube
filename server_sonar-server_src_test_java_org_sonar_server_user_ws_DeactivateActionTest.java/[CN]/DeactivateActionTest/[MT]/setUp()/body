{
  esTester.truncateIndices();
  System2 system2=new System2();
  UserDao userDao=new UserDao(db.myBatis(),system2);
  dbClient=new DbClient(db.database(),db.myBatis(),userDao,new GroupMembershipDao(db.myBatis()),new UserTokenDao());
  dbSession=db.getSession();
  dbSession.commit();
  userIndexer=(UserIndexer)new UserIndexer(dbClient,esTester.client()).setEnabled(true);
  index=new UserIndex(esTester.client());
  ws=new WsTester(new UsersWs(new DeactivateAction(new UserUpdater(mock(NewUserNotifier.class),settings,dbClient,userIndexer,system2,mock(SecurityRealmFactory.class)),userSessionRule,new UserJsonWriter(userSessionRule),dbClient)));
  controller=ws.controller("api/users");
}
