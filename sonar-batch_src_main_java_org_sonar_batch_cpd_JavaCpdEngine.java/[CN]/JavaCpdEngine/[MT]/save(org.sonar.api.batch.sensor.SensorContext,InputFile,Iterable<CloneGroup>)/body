{
  if (duplications == null || Iterables.isEmpty(duplications)) {
    return;
  }
  Set<Integer> duplicatedLines=new HashSet<Integer>();
  int duplicatedBlocks=computeBlockAndLineCount(duplications,duplicatedLines);
  Map<Integer,Integer> duplicationByLine=new HashMap<Integer,Integer>();
  for (int i=1; i <= inputFile.lines(); i++) {
    duplicationByLine.put(i,duplicatedLines.contains(i) ? 1 : 0);
  }
  ((DefaultMeasure<String>)context.<String>newMeasure().forMetric(CoreMetrics.DUPLICATION_LINES_DATA).onFile(inputFile).withValue(KeyValueFormat.format(duplicationByLine))).setFromCore().save();
  ((DefaultMeasure<Integer>)context.<Integer>newMeasure().forMetric(CoreMetrics.DUPLICATED_FILES).onFile(inputFile).withValue(1)).setFromCore().save();
  ((DefaultMeasure<Integer>)context.<Integer>newMeasure().forMetric(CoreMetrics.DUPLICATED_LINES).onFile(inputFile).withValue(duplicatedLines.size())).setFromCore().save();
  ((DefaultMeasure<Integer>)context.<Integer>newMeasure().forMetric(CoreMetrics.DUPLICATED_BLOCKS).onFile(inputFile).withValue(duplicatedBlocks)).setFromCore().save();
  int cloneGroupCount=0;
  for (  CloneGroup duplication : duplications) {
    cloneGroupCount++;
    if (cloneGroupCount > MAX_CLONE_GROUP_PER_FILE) {
      LOG.warn("Too many duplication groups on file " + inputFile.relativePath() + ". Keep only the first "+ MAX_CLONE_GROUP_PER_FILE+ " groups.");
      break;
    }
    NewDuplication builder=context.newDuplication();
    ClonePart originPart=duplication.getOriginPart();
    builder.originBlock(inputFile,originPart.getStartLine(),originPart.getEndLine());
    int clonePartCount=0;
    for (    ClonePart part : duplication.getCloneParts()) {
      if (!part.equals(originPart)) {
        clonePartCount++;
        if (clonePartCount > MAX_CLONE_PART_PER_GROUP) {
          LOG.warn("Too many duplication references on file " + inputFile.relativePath() + " for block at line "+ originPart.getStartLine()+ ". Keep only the first "+ MAX_CLONE_PART_PER_GROUP+ " references.");
          break;
        }
        ((DefaultDuplication)builder).isDuplicatedBy(part.getResourceId(),part.getStartLine(),part.getEndLine());
      }
    }
    builder.save();
  }
}
