{
  dbTester.truncateTables();
  esTester.truncateIndices();
  System2 system=mock(System2.class);
  db=new DbClient(dbTester.database(),dbTester.myBatis(),new RuleDao(system),new QualityProfileDao(dbTester.myBatis(),system),new UserDao(dbTester.myBatis(),system));
  dbSession=db.openSession(false);
  RuleDto xooRule1=RuleTesting.newXooX1().setSeverity("MINOR");
  db.ruleDao().insert(dbSession,xooRule1);
  db.qualityProfileDao().insert(dbSession,QProfileTesting.newXooP1(),QProfileTesting.newXooP2());
  login="david";
  UserDto user=new UserDto().setLogin(login).setName("David").setEmail("dav@id.com").setCreatedAt(System.currentTimeMillis()).setUpdatedAt(System.currentTimeMillis());
  db.userDao().insert(dbSession,user);
  dbSession.commit();
  dbSession.clearCache();
  wsTester=new WsTester(new QProfilesWs(mock(RuleActivationActions.class),mock(BulkRuleActivationActions.class),mock(ProjectAssociationActions.class),new QProfileChangelogAction(db,new ActivityIndex(esTester.client()),new QProfileFactory(db),LanguageTesting.newLanguages("xoo"))));
}
