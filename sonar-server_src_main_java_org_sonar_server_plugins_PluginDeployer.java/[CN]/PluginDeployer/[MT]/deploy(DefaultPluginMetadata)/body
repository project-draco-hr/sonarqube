{
  LOG.info("Deploy plugin {}",Joiner.on(" / ").skipNulls().join(plugin.getName(),plugin.getVersion(),plugin.getImplementationBuild()));
  Preconditions.checkState(plugin.isCompatibleWith(server.getVersion()),"Plugin %s needs a more recent version of SonarQube than %s. At least %s is expected",plugin.getKey(),server.getVersion(),plugin.getSonarVersion());
  try {
    File pluginDeployDir=new File(fileSystem.getDeployedPluginsDir(),plugin.getKey());
    FileUtils.forceMkdir(pluginDeployDir);
    FileUtils.cleanDirectory(pluginDeployDir);
    List<File> deprecatedExtensions=fileSystem.getExtensions(plugin.getKey());
    for (    File deprecatedExtension : deprecatedExtensions) {
      plugin.addDeprecatedExtension(deprecatedExtension);
    }
    installer.install(plugin,pluginDeployDir);
  }
 catch (  IOException e) {
    throw new RuntimeException("Fail to deploy the plugin " + plugin,e);
  }
}
