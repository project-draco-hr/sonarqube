{
  DefaultPluginMetadata metadata=installer.extractMetadata(file,isCore);
  if (StringUtils.isBlank(metadata.getKey())) {
    return;
  }
  PluginMetadata existing=pluginByKeys.put(metadata.getKey(),metadata);
  if ((existing != null) && !canDelete) {
    throw new IllegalStateException("Found two plugins with the same key '" + metadata.getKey() + "': "+ metadata.getFile().getName()+ " and "+ existing.getFile().getName());
  }
  if (existing != null) {
    FileUtils.deleteQuietly(existing.getFile());
    LOG.info("Plugin " + metadata.getKey() + " replaced by new version");
  }
}
