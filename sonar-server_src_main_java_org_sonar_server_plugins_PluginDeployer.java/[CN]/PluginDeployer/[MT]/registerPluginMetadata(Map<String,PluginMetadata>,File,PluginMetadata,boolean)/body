{
  String pluginKey=metadata.getKey();
  PluginMetadata existing=map.get(pluginKey);
  if (existing != null) {
    if (canDeleteOld) {
      FileUtils.deleteQuietly(existing.getSourceFile());
      map.remove(pluginKey);
      Logs.INFO.info("Old plugin " + existing.getFilename() + " replaced by new "+ metadata.getFilename());
    }
 else {
      throw new ServerStartException("Found two plugins with the same key '" + pluginKey + "': "+ metadata.getFilename()+ " and "+ existing.getFilename());
    }
  }
  map.put(metadata.getKey(),metadata);
}
