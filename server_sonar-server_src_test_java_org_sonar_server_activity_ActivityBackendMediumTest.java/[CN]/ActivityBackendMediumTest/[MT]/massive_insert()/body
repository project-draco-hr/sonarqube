{
  dbSession.setImplicitCommitSize(20);
  assertThat(dao.findAll(dbSession)).hasSize(0);
  int max=35;
  final String testValue="hello world";
  for (int i=0; i < max; i++) {
    service.write(dbSession,Activity.Type.QPROFILE,testValue + "_" + i);
  }
  dbSession.commit();
  assertThat(dao.findAll(dbSession)).hasSize(max);
  assertThat(index.findAll().getHits()).hasSize(max);
  int count=0;
  SearchResponse result=index.search(new ActivityQuery(),new QueryContext().setScroll(true));
  Iterator<Activity> logs=new Result<Activity>(index,result).scroll();
  while (logs.hasNext()) {
    logs.next();
    count++;
  }
  assertThat(count).isEqualTo(max);
  tester.clearIndexes();
  tester.get(Platform.class).executeStartupTasks();
  result=index.search(new ActivityQuery(),new QueryContext().setScroll(true));
  logs=new Result<Activity>(index,result).scroll();
  count=0;
  while (logs.hasNext()) {
    logs.next();
    count++;
  }
  assertThat(count).isEqualTo(max);
}
