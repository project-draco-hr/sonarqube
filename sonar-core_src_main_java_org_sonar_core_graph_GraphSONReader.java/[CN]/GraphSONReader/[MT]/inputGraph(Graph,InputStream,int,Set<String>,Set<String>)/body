{
  JSONParser parser=new JSONParser();
  JSONObject json=(JSONObject)parser.parse(new InputStreamReader(jsonInputStream));
  final BatchGraph graph=BatchGraph.wrap(inputGraph,bufferSize);
  final ElementFactory elementFactory=new GraphElementFactory(graph);
  final GraphSONMode mode=GraphSONMode.valueOf(json.get(GraphSONTokens.MODE).toString());
  GraphSONUtility graphson=new GraphSONUtility(mode,elementFactory,vertexPropertyKeys,edgePropertyKeys);
  JSONArray vertices=(JSONArray)json.get(GraphSONTokens.VERTICES);
  for (  Object vertice : vertices) {
    graphson.vertexFromJson((JSONObject)vertice);
  }
  JSONArray edges=(JSONArray)json.get(GraphSONTokens.EDGES);
  for (  Object edgeObject : edges) {
    JSONObject edge=(JSONObject)edgeObject;
    final Vertex inV=graph.getVertex(edge.get(GraphSONTokens._IN_V));
    final Vertex outV=graph.getVertex(edge.get(GraphSONTokens._OUT_V));
    graphson.edgeFromJson(edge,outV,inV);
  }
  graph.shutdown();
}
