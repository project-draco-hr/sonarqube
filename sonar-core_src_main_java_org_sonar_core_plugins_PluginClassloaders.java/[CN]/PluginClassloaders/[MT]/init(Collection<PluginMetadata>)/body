{
  List<PluginMetadata> children=Lists.newArrayList();
  for (  PluginMetadata plugin : plugins) {
    if (StringUtils.isBlank(plugin.getBasePlugin())) {
      add(plugin);
    }
 else {
      children.add(plugin);
    }
  }
  for (  PluginMetadata child : children) {
    extend(child);
  }
  done();
  Map<String,Plugin> pluginsByKey=Maps.newHashMap();
  for (  PluginMetadata metadata : plugins) {
    pluginsByKey.put(metadata.getKey(),instantiatePlugin(metadata));
  }
  return pluginsByKey;
}
