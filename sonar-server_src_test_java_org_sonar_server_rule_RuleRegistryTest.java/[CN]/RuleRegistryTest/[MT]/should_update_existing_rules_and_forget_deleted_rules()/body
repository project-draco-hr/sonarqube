{
  int ruleId1=1;
  RuleDto rule1=new RuleDto();
  rule1.setRepositoryKey("xoo");
  rule1.setRuleKey("key1");
  rule1.setId(ruleId1);
  rule1.setSeverity(1);
  int ruleId2=2;
  RuleDto rule2=new RuleDto();
  rule2.setRepositoryKey("xoo");
  rule2.setRuleKey("key2");
  rule2.setId(ruleId2);
  rule2.setParentId(ruleId1);
  rule2.setSeverity(1);
  List<RuleDto> rules=ImmutableList.of(rule1,rule2);
  assertThat(esSetup.exists("rules","rule","3")).isTrue();
  when(ruleDao.selectNonManual()).thenReturn(rules);
  registry.bulkRegisterRules();
  assertThat(registry.findIds(ImmutableMap.of("repositoryKey","xoo"))).hasSize(2).containsOnly((int)ruleId1,(int)ruleId2);
  assertThat(esSetup.exists("rules","rule","3")).isFalse();
}
