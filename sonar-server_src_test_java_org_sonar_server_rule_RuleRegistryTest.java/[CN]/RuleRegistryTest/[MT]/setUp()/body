{
  ruleDao=mock(RuleDao.class);
  esSetup=new EsSetup();
  esSetup.execute(EsSetup.deleteAll());
  SearchNode node=mock(SearchNode.class);
  when(node.client()).thenReturn(esSetup.client());
  Settings settings=new Settings();
  settings.setProperty("sonar.log.profilingLevel","FULL");
  Profiling profiling=new Profiling(settings);
  searchIndex=new SearchIndex(node,profiling);
  searchIndex.start();
  registry=new RuleRegistry(searchIndex,ruleDao);
  registry.start();
  String source1=IOUtils.toString(TestUtils.getResource(getClass(),"rules/rule1.json").toURI());
  String source2=IOUtils.toString(TestUtils.getResource(getClass(),"rules/rule2.json").toURI());
  String source3=IOUtils.toString(TestUtils.getResource(getClass(),"rules/rule3.json").toURI());
  esSetup.execute(EsSetup.index("rules","rule","1").withSource(source1),EsSetup.index("rules","rule","2").withSource(source2),EsSetup.index("rules","rule","3").withSource(source3));
}
