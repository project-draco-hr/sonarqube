{
  int ruleId1=3;
  RuleDto rule1=new RuleDto();
  rule1.setRepositoryKey("repo");
  rule1.setRuleKey("key1");
  rule1.setId(ruleId1);
  rule1.setNoteData("noteData");
  rule1.setNoteUserLogin("userLogin");
  int ruleId2=4;
  RuleDto rule2=new RuleDto();
  rule2.setRepositoryKey("repo");
  rule2.setRuleKey("key2");
  rule2.setId(ruleId2);
  rule2.setParentId(ruleId1);
  List<RuleDto> rules=ImmutableList.of(rule1,rule2);
  RuleParamDto paramRule2=new RuleParamDto();
  paramRule2.setName("name");
  paramRule2.setRuleId(ruleId2);
  List<RuleParamDto> params=ImmutableList.of(paramRule2);
  when(ruleDao.selectNonManual()).thenReturn(rules);
  when(ruleDao.selectParameters()).thenReturn(params);
  registry.bulkRegisterRules();
  assertThat(registry.findIds(ImmutableMap.of("repositoryKey","repo"))).hasSize(2);
}
