{
  if (!messages.hasErrors()) {
    for (    DefaultRequirement pluginRequirement : pluginModel.requirements()) {
      Rule rule=rulesCache.getByRuleKey(pluginRequirement.ruleKey());
      if (!isRequirementExists(existingModel,rule)) {
        CharacteristicDto characteristicDto=findCharacteristic(existingModel,pluginRequirement.characteristic().key());
        if (characteristicDto != null) {
          Integer rootId=characteristicDto.getRootId();
          if (rootId == null) {
            throw new IllegalArgumentException("Requirement on rule '" + pluginRequirement.ruleKey() + "' should not be linked on a root characteristic.");
          }
          CharacteristicDto requirementDto=CharacteristicDto.toDto(pluginRequirement,characteristicDto.getId(),rootId,rule.getId());
          dao.insert(requirementDto,session);
        }
      }
    }
  }
}
