{
  Map<String,Long> neededTagIds=Maps.newHashMap();
  Set<String> unknownTags=Sets.newHashSet();
  for (  String tag : newTags) {
    Long tagId=ruleTagDao.selectId(tag,session);
    if (tagId == null) {
      unknownTags.add(tag);
    }
 else {
      neededTagIds.put(tag,tagId);
    }
  }
  if (!unknownTags.isEmpty()) {
    throw new NotFoundException("The following tags are unknown and must be created before association: " + StringUtils.join(unknownTags,", "));
  }
  return neededTagIds;
}
