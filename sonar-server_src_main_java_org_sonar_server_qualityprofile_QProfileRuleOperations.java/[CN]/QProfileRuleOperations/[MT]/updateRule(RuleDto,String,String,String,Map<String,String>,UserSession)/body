{
  checkPermission(userSession);
  SqlSession session=myBatis.openSession();
  try {
    rule.setName(name).setDescription(description).setSeverity(getSeverityOrdinal(severity)).setUpdatedAt(new Date(system.now()));
    ruleDao.update(rule,session);
    List<RuleParamDto> ruleParams=ruleDao.selectParameters(rule.getId(),session);
    for (    RuleParamDto ruleParam : ruleParams) {
      String value=paramsByKey.get(ruleParam.getName());
      ruleParam.setDefaultValue(Strings.emptyToNull(value));
      ruleDao.update(ruleParam,session);
    }
    List<RuleRuleTagDto> ruleTags=ruleDao.selectTags(rule.getId(),session);
    session.commit();
    reindexRule(rule,ruleParams,ruleTags);
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
