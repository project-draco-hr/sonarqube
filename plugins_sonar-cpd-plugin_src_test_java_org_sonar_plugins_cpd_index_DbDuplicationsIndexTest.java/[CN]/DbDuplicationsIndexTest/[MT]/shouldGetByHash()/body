{
  Resource resource=new JavaFile("foo");
  index=spy(new DbDuplicationsIndex(getSession(),null,9,7));
  doReturn(10).when(index).getSnapshotIdFor(resource);
  setupData("shouldGetByHash");
  index.prepareCache(resource);
  Collection<Block> blocks=index.getByHash(new ByteArray("aa"));
  Iterator<Block> blocksIterator=blocks.iterator();
  assertThat(blocks.size(),is(1));
  Block block=blocksIterator.next();
  assertThat("block resourceId",block.getResourceId(),is("bar-last"));
  assertThat("block hash",block.getBlockHash(),is(new ByteArray("aa")));
  assertThat("block index in file",block.getIndexInFile(),is(0));
  assertThat("block start line",block.getFirstLineNumber(),is(1));
  assertThat("block end line",block.getLastLineNumber(),is(2));
}
