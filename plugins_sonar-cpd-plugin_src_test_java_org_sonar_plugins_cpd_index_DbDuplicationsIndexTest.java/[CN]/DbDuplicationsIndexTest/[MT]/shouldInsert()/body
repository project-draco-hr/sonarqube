{
  Resource resource=new JavaFile("foo");
  index=spy(new DbDuplicationsIndex(dao,null,1,null));
  doReturn(2).when(index).getSnapshotIdFor(resource);
  setupData("shouldInsert");
  index.insert(resource,Arrays.asList(new Block("foo",new ByteArray("bb"),0,1,2)));
  checkTables("shouldInsert","duplications_index");
}
