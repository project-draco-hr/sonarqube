{
  String fileKey="src/Foo.java";
  MockUserSession.set().addComponentPermission(UserRole.CODEVIEWER,"polop",fileKey);
  when(componentDao.getByKey(session,fileKey)).thenReturn(file);
  when(sourceService.countLines(file.uuid())).thenReturn(1000L);
  WsTester.TestRequest request=tester.newGetRequest("api/sources","show").setParam("key",fileKey).setParam("from","1000").setParam("to","5000");
  request.execute();
  verify(sourceService,never()).getLinesAsTxt(eq(file.uuid()),anyInt(),anyInt());
  verify(sourceService).getLinesAsHtml(eq(file.uuid()),anyInt(),anyInt());
}
