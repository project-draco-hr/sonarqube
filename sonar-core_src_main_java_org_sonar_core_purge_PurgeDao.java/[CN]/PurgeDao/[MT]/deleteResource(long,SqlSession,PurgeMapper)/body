{
  session.select("org.sonar.core.purge.PurgeMapper.selectSnapshotIdsByResource",resourceId,new ResultHandler(){
    public void handleResult(    ResultContext context){
      Long snapshotId=(Long)context.getResultObject();
      deleteSnapshot(snapshotId,mapper);
    }
  }
);
  mapper.deleteResourceLinks(resourceId);
  mapper.deleteResourceProperties(resourceId);
  mapper.deleteResourceIndex(resourceId);
  mapper.deleteResourceGroupRoles(resourceId);
  mapper.deleteResourceUserRoles(resourceId);
  mapper.deleteResourceManualMeasures(resourceId);
  mapper.deleteResourceReviews(resourceId);
  mapper.deleteResourceReviewComments(resourceId);
  mapper.deleteResourceActionPlansReviews(resourceId);
  mapper.deleteResourceActionPlans(resourceId);
  mapper.deleteResourceEvents(resourceId);
  mapper.deleteResource(resourceId);
}
