{
  session.select("org.sonar.core.purge.PurgeMapper.selectSnapshotIds",query,new ResultHandler(){
    public void handleResult(    ResultContext context){
      Long snapshotId=(Long)context.getResultObject();
      if (snapshotId != null) {
        deleteSnapshot(snapshotId,mapper);
      }
    }
  }
);
}
