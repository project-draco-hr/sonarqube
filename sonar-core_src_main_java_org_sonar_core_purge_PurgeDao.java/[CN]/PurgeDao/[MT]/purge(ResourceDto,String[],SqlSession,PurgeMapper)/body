{
  List<Long> projectSnapshotIds=purgeMapper.selectSnapshotIds(PurgeSnapshotQuery.create().setResourceId(project.getId()).setIslast(false).setNotPurged(true));
  for (  final Long projectSnapshotId : projectSnapshotIds) {
    LOG.info("<- Clean snapshot " + projectSnapshotId);
    if (!ArrayUtils.isEmpty(scopesWithoutHistoricalData)) {
      PurgeSnapshotQuery query=PurgeSnapshotQuery.create().setIslast(false).setScopes(scopesWithoutHistoricalData).setRootSnapshotId(projectSnapshotId);
      PurgeCommands.deleteSnapshots(query,session,purgeMapper);
      session.commit();
    }
    PurgeSnapshotQuery query=PurgeSnapshotQuery.create().setRootSnapshotId(projectSnapshotId).setNotPurged(true);
    PurgeCommands.purgeSnapshots(query,session,purgeMapper);
    session.commit();
    PurgeCommands.purgeSnapshots(PurgeSnapshotQuery.create().setId(projectSnapshotId).setNotPurged(true),session,purgeMapper);
    session.commit();
  }
}
