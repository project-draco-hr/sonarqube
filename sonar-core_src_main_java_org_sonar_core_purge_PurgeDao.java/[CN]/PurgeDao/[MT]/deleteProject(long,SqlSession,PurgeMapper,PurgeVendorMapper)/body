{
  List<Long> childrenIds=mapper.selectProjectIdsByRootId(rootProjectId);
  for (  Long childId : childrenIds) {
    deleteProject(childId,session,mapper,vendorMapper);
  }
  session.select("org.sonar.core.purge.PurgeMapper.selectResourceTreeIdsByRootId",rootProjectId,new ResultHandler(){
    public void handleResult(    ResultContext context){
      Long resourceId=(Long)context.getResultObject();
      if (resourceId != null) {
        deleteResource(resourceId,mapper,vendorMapper);
      }
    }
  }
);
}
