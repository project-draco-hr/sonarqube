{
  SqlSession session=mybatis.openBatchSession();
  PurgeMapper purgeMapper=session.getMapper(PurgeMapper.class);
  try {
    List<Long> projectIds=Lists.newArrayList(rootProjectId);
    projectIds.addAll(resourceDao.getDescendantProjectIds(rootProjectId,session));
    for (    Long projectId : projectIds) {
      purgeProject(projectId,session,purgeMapper);
    }
    for (    Long projectId : projectIds) {
      disableOrphanResources(projectId,session,purgeMapper);
    }
  }
  finally {
    MyBatis.closeQuietly(session);
  }
  return this;
}
