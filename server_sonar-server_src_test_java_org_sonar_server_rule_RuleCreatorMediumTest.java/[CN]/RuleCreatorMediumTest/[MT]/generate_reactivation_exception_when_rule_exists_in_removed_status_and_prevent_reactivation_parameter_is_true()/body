{
  String key="CUSTOM_RULE";
  RuleDto templateRule=createTemplateRule();
  RuleDto rule=RuleTesting.newCustomRule(templateRule).setRuleKey(key).setStatus(RuleStatus.REMOVED).setName("Old name").setDescription("Old description").setSeverity(Severity.INFO);
  dao.insert(dbSession,rule);
  dao.insertRuleParam(dbSession,rule,dao.selectRuleParamsByRuleKey(dbSession,templateRule.getKey()).get(0).setDefaultValue("a.*"));
  dbSession.commit();
  dbSession.clearCache();
  NewRule newRule=NewRule.createForCustomRule(key,templateRule.getKey()).setName("New name").setHtmlDescription("New description").setSeverity(Severity.MAJOR).setStatus(RuleStatus.READY).setParameters(ImmutableMap.of("regex","c.*")).setPreventReactivation(true);
  try {
    creator.create(newRule);
    fail();
  }
 catch (  Exception e) {
    assertThat(e).isInstanceOf(ReactivationException.class);
    ReactivationException reactivationException=(ReactivationException)e;
    assertThat(reactivationException.ruleKey()).isEqualTo(rule.getKey());
  }
}
