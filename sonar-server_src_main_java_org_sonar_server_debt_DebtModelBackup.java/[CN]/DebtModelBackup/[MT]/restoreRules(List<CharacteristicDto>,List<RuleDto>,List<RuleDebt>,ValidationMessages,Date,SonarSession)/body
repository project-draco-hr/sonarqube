{
  for (  RuleDto rule : rules) {
    RuleDebt ruleDebt=ruleDebt(rule.getRepositoryKey(),rule.getRuleKey(),ruleDebts);
    String subCharacteristicKey=ruleDebt != null ? ruleDebt.subCharacteristicKey() : null;
    CharacteristicDto subCharacteristicDto=subCharacteristicKey != null ? characteristicByKey(ruleDebt.subCharacteristicKey(),allCharacteristicDtos,true) : null;
    ruleOperations.updateRule(rule,subCharacteristicDto,ruleDebt != null ? ruleDebt.function() : null,ruleDebt != null ? ruleDebt.coefficient() : null,ruleDebt != null ? ruleDebt.offset() : null,updateDate,session);
    rule.setUpdatedAt(updateDate);
    ruleDebts.remove(ruleDebt);
  }
  ruleRegistry.reindex(rules,session);
  for (  RuleDebt ruleDebt : ruleDebts) {
    validationMessages.addWarningText(String.format("The rule '%s' does not exist.",ruleDebt.ruleKey()));
  }
}
