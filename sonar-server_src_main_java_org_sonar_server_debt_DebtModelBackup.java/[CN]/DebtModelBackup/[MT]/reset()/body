{
  checkPermission();
  Date updateDate=new Date(system2.now());
  SonarSession session=mybatis.openSession();
  try {
    List<CharacteristicDto> allCharacteristicDtos=restoreCharacteristics(loadModelFromPlugin(DebtModelPluginRepository.DEFAULT_MODEL),updateDate,session);
    List<RuleDto> ruleDtos=ruleDao.selectEnablesAndNonManual(session);
    if (!ruleDtos.isEmpty()) {
      RulesDefinition.Context context=defLoader.load();
      List<RulesDefinition.Rule> rules=newArrayList();
      for (      RulesDefinition.Repository repoDef : context.repositories()) {
        rules.addAll(repoDef.rules());
      }
      resetRules(ruleDtos,rules,allCharacteristicDtos,updateDate,session);
    }
    session.commit();
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
