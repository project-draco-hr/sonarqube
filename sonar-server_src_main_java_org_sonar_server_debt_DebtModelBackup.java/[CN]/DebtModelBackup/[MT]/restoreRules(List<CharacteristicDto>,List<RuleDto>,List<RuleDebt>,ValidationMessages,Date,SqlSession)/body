{
  for (  RuleDto rule : rules) {
    RuleDebt ruleDebt=ruleDebtByRule(rule,ruleDebts);
    if (ruleDebt == null) {
      disabledRuleDebt(rule,updateDate,session);
    }
 else {
      CharacteristicDto subCharacteristicDto=characteristicByKey(ruleDebt.subCharacteristicKey(),allCharacteristicDtos);
      if (subCharacteristicDto == null) {
        disabledRuleDebt(rule,updateDate,session);
      }
 else {
        boolean isSameCharacteristicAsDefault=subCharacteristicDto.getId().equals(rule.getDefaultSubCharacteristicId());
        boolean isSameFunctionAsDefault=isSameRemediationFunction(ruleDebt,rule);
        rule.setSubCharacteristicId(!isSameCharacteristicAsDefault ? subCharacteristicDto.getId() : null);
        rule.setRemediationFunction(!isSameFunctionAsDefault ? ruleDebt.function().name() : null);
        rule.setRemediationCoefficient(!isSameFunctionAsDefault ? ruleDebt.coefficient() : null);
        rule.setRemediationOffset(!isSameFunctionAsDefault ? ruleDebt.offset() : null);
        rule.setUpdatedAt(updateDate);
        ruleDao.update(rule,session);
      }
    }
    ruleDebts.remove(ruleDebt);
  }
  for (  RuleDebt ruleDebt : ruleDebts) {
    validationMessages.addWarningText(String.format("The rule '%s' does not exist.",ruleDebt.ruleKey()));
  }
}
