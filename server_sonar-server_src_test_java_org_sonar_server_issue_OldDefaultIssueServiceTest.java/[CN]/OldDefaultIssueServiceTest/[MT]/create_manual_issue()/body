{
  RuleKey ruleKey=RuleKey.of("manual","manualRuleKey");
  when(ruleFinder.findByKey(ruleKey)).thenReturn(Rule.create("manual","manualRuleKey"));
  when(resourceDao.getResource(any(ResourceQuery.class))).thenReturn(resource);
  when(resourceDao.getRootProjectByComponentKey(anyString())).thenReturn(project);
  Issue result=issueService.createManualIssue("org.sonar.Sample",RuleKey.of("manual","manualRuleKey"),null,"Fix it",null,null);
  assertThat(result).isNotNull();
  assertThat(result.message()).isEqualTo("Fix it");
  assertThat(result.creationDate()).isNotNull();
  assertThat(result.updateDate()).isNotNull();
  verify(issueStorage).save(any(DefaultIssue.class));
  verify(authorizationDao).isAuthorizedComponentKey(anyString(),anyInt(),eq(UserRole.USER));
}
