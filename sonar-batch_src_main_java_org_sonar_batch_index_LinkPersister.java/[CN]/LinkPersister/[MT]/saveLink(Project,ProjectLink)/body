{
  BatchResource batchResource=resourceCache.get(project.getEffectiveKey());
  ResourceModel projectDao=session.reattach(ResourceModel.class,batchResource.resource().getId());
  ProjectLink dbLink=projectDao.getProjectLink(link.getKey());
  if (dbLink == null) {
    link.setResource(projectDao);
    projectDao.getProjectLinks().add(link);
    session.save(link);
  }
 else {
    dbLink.copyFieldsFrom(link);
    session.save(dbLink);
  }
  session.commit();
}
