{
  Snapshot snapshot=resourcePersister.getSnapshot(project);
  if (snapshot != null) {
    ResourceModel projectDao=session.reattach(ResourceModel.class,snapshot.getResourceId());
    ProjectLink dbLink=projectDao.getProjectLink(link.getKey());
    if (dbLink == null) {
      link.setResource(projectDao);
      projectDao.getProjectLinks().add(link);
      session.save(link);
    }
 else {
      dbLink.copyFieldsFrom(link);
      session.save(dbLink);
    }
    session.commit();
  }
}
