{
  when(resourceDao.getResource(any(ResourceQuery.class))).thenReturn(new ResourceDto().setKey("org.sonar.Sample").setId(1l));
  when(actionPlanDao.findOpenByProjectId(1l)).thenReturn(newArrayList(new ActionPlanDto().setKey("ABCD")));
  Collection<ActionPlan> results=actionPlanService.findOpenByProjectKey("org.sonar.Sample",userSession);
  assertThat(results).hasSize(1);
  assertThat(results.iterator().next().key()).isEqualTo("ABCD");
  verify(authorizationDao).isAuthorizedComponentId(anyLong(),anyInt(),eq(UserRole.USER));
}
