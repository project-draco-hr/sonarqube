{
  Map<String,ClassloaderDef> classloadersByBasePlugin=new HashMap<>();
  for (  PluginInfo info : infoByKeys.values()) {
    String baseKey=basePluginKey(info,infoByKeys);
    ClassloaderDef def=classloadersByBasePlugin.get(baseKey);
    if (def == null) {
      def=new ClassloaderDef(baseKey);
      classloadersByBasePlugin.put(baseKey,def);
    }
    UnzippedPlugin unzippedPlugin=unzipper.unzip(info);
    def.files.add(unzippedPlugin.getMain());
    def.files.addAll(unzippedPlugin.getLibs());
    def.mainClassesByPluginKey.put(info.getKey(),info.getMainClass());
    for (    String defaultSharedResource : DEFAULT_SHARED_RESOURCES) {
      def.mask.addInclusion(defaultSharedResource + info.getKey() + "/");
    }
    if (Strings.isNullOrEmpty(info.getBasePlugin())) {
      def.selfFirstStrategy=info.isUseChildFirstClassLoader();
    }
  }
  return classloadersByBasePlugin;
}
