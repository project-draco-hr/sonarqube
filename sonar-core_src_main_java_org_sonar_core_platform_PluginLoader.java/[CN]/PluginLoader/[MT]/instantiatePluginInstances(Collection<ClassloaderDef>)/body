{
  Map<String,Plugin> instancesByPluginKey=new HashMap<>();
  for (  ClassloaderDef def : defs) {
    for (    Map.Entry<String,String> entry : def.mainClassesByPluginKey.entrySet()) {
      String pluginKey=entry.getKey();
      String mainClass=entry.getValue();
      try {
        instancesByPluginKey.put(pluginKey,(Plugin)def.classloader.loadClass(mainClass).newInstance());
      }
 catch (      UnsupportedClassVersionError e) {
        throw new IllegalStateException(String.format("The plugin [%s] does not support Java %s",pluginKey,SystemUtils.JAVA_VERSION_TRIMMED),e);
      }
catch (      Exception e) {
        throw new IllegalStateException(String.format("Fail to instantiate class [%s] of plugin [%s]",mainClass,pluginKey),e);
      }
    }
  }
  return instancesByPluginKey;
}
