{
  ExecutorService executor=Executors.newSingleThreadExecutor();
  ConnectorCallable callable=new ConnectorCallable(command,processRef.getProcess());
  try {
    Future<ProcessMXBean> future=executor.submit(callable);
    ProcessMXBean mxBean=future.get(timeouts.getJmxConnectionTimeout(),TimeUnit.MILLISECONDS);
    if (mxBean != null) {
      mbeans.put(processRef,mxBean);
    }
  }
 catch (  Exception e) {
    if (callable.latestException != null) {
      throw callable.latestException;
    }
    throw new IllegalStateException("Fail to connect to JMX",e);
  }
 finally {
    executor.shutdownNow();
  }
}
