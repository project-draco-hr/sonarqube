{
  Rule rule=ruleBuilder.build();
  when(rules.find(any(RuleQuery.class))).thenReturn(new PagedResult<Rule>(ImmutableList.of(rule),PagingResult.create(10,1,1)));
  MockUserSession.set();
  WsTester.TestRequest request=tester.newRequest("list").setParam("language","java");
  request.execute().assertJson("{'more':false,'total':1,'results':[" + "{'key':'squid:AvoidCycle','name':'Avoid cycle','language':'java'}" + "]}");
  ArgumentCaptor<RuleQuery> ruleQueryCaptor=ArgumentCaptor.forClass(RuleQuery.class);
  verify(rules).find(ruleQueryCaptor.capture());
  assertThat(ruleQueryCaptor.getValue().language()).isEqualTo("java");
}
