{
  DbSession dbSession=dbClient.openSession(false);
  RulesProfile target=new RulesProfile(profile.getName(),profile.getLanguage());
  try {
    for (    ActiveRuleDto activeRule : dbClient.activeRuleDao().selectByProfileKey(dbSession,profile.getKey())) {
      Rule rule=ruleFinder.findByKey(activeRule.getKey().ruleKey());
      org.sonar.api.rules.ActiveRule wrappedActiveRule=target.activateRule(rule,RulePriority.valueOf(activeRule.getSeverityString()));
      List<ActiveRuleParamDto> paramDtos=dbClient.activeRuleDao().selectParamsByActiveRuleId(dbSession,activeRule.getId());
      for (      ActiveRuleParamDto activeRuleParamDto : paramDtos) {
        wrappedActiveRule.setParameter(activeRuleParamDto.getKey(),activeRuleParamDto.getValue());
      }
    }
  }
  finally {
    dbClient.closeSession(dbSession);
  }
  return target;
}
