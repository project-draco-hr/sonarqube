{
  ComponentDto project=createProject();
  ComponentDto module=ComponentTesting.newModuleDto(project).setKey("sample:root:module");
  dbClient.componentDao().insert(session,module);
  ComponentDto file=ComponentTesting.newFileDto(module).setKey("sample:root:module:src/File.xoo");
  dbClient.componentDao().insert(session,file);
  session.commit();
  userSessionRule.login("john").addProjectUuidPermissions(UserRole.ADMIN,project.uuid());
  service.updateKey(module.key(),"sample:root2:module");
  session.commit();
  assertThat(service.getNullableByKey(project.key())).isNotNull();
  assertThat(service.getNullableByKey(module.key())).isNull();
  assertThat(service.getNullableByKey("sample:root2:module")).isNotNull();
  assertThat(service.getNullableByKey(file.key())).isNull();
  assertThat(service.getNullableByKey("sample:root2:module:src/File.xoo")).isNotNull();
}
