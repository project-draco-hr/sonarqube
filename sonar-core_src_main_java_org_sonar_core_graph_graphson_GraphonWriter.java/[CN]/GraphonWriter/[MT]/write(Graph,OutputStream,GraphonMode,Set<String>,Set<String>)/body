{
  try {
    JSONObject root=new JSONObject();
    GraphsonUtil graphson=new GraphsonUtil(mode,null,vertexPropertyKeys,edgePropertyKeys);
    root.put(GraphonTokens.MODE,mode.toString());
    JSONArray verticesArray=new JSONArray();
    for (    Vertex v : graph.getVertices()) {
      verticesArray.add(graphson.objectNodeFromElement(v));
    }
    root.put(GraphonTokens.VERTICES,verticesArray);
    JSONArray edgesArray=new JSONArray();
    for (    Edge e : graph.getEdges()) {
      edgesArray.add(graphson.objectNodeFromElement(e));
    }
    root.put(GraphonTokens.EDGES,edgesArray);
    jsonOutputStream.write(root.toString().getBytes("UTF-8"));
  }
 catch (  Exception e) {
    throw new GraphonException("Fail to generate GraphSON",e);
  }
}
