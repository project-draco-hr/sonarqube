{
  Settings settings=new Settings().setProperties(Maps.fromProperties(System.getProperties()));
  if (settings.hasKey("orchestrator.configUrl")) {
    loadOrchestratorSettings(settings);
  }
  for (  String key : settings.getKeysStartingWith("sonar.jdbc")) {
    LOG.info(key + ": " + settings.getString(key));
  }
  boolean hasDialect=settings.hasKey("sonar.jdbc.dialect");
  if (hasDialect) {
    db=new DefaultDatabase(settings);
  }
 else {
    db=new H2Database("h2Tests" + DigestUtils.md5Hex(StringUtils.defaultString(schemaPath)),schemaPath == null);
  }
  db.start();
  if (schemaPath != null) {
    if (db.getDialect().getId().equals("h2")) {
      ((H2Database)db).executeScript(schemaPath);
    }
 else {
      db.stop();
      throw new AssumptionViolatedException("Test disabled because it supports only H2");
    }
  }
  LOG.info("Test Database: " + db);
  commands=DatabaseCommands.forDialect(db.getDialect());
  tester=new DataSourceDatabaseTester(db.getDataSource());
  myBatis=new MyBatis(db,new Logback(),queue);
  myBatis.start();
  commands.truncateDatabase(db.getDataSource());
}
