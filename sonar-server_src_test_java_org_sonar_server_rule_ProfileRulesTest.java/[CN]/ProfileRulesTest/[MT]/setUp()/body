{
  esSetup=new EsSetup();
  esSetup.execute(EsSetup.deleteAll());
  SearchNode searchNode=mock(SearchNode.class);
  when(searchNode.client()).thenReturn(esSetup.client());
  Settings settings=new Settings();
  settings.setProperty("sonar.log.profilingLevel","FULL");
  SearchIndex index=new SearchIndex(searchNode,new Profiling(settings));
  index.start();
  RuleRegistry registry=new RuleRegistry(index,null,null);
  registry.start();
  profileRules=new ProfileRules(index);
}
