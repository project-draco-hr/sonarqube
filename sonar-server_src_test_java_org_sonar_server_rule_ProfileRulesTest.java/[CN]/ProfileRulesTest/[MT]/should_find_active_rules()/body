{
  esSetup.client().prepareBulk().add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("should_find_active_rules/rule25.json"))).add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("should_find_active_rules/rule759.json"))).add(Requests.indexRequest().index("rules").type("active_rule").parent("25").source(testFileAsString("should_find_active_rules/active_rule25.json"))).add(Requests.indexRequest().index("rules").type("active_rule").parent("759").source(testFileAsString("should_find_active_rules/active_rule391.json"))).add(Requests.indexRequest().index("rules").type("active_rule").parent("759").source(testFileAsString("should_find_active_rules/active_rule523.json"))).setRefresh(true).execute().actionGet();
  Paging paging=Paging.create(10,1);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(1),paging)).hasSize(2);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(2),paging)).hasSize(1);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(3),paging)).hasSize(0);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(1).setNameOrKey("polop"),paging)).hasSize(0);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(1).setNameOrKey("DM_CONVERT_CASE"),paging)).hasSize(1);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(1).setNameOrKey("Unused Check"),paging)).hasSize(1);
  assertThat(profileRules.searchActiveRules(ProfileRuleQuery.create(1).addRepositoryKeys("findbugs"),paging)).hasSize(1);
}
