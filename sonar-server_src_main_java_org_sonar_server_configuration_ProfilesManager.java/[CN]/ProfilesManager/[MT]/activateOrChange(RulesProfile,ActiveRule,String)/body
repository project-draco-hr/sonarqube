{
  ActiveRule oldActiveRule=profile.getActiveRule(parentActiveRule.getRule());
  if (oldActiveRule != null) {
    if (oldActiveRule.isInherited()) {
      removeActiveRule(oldActiveRule);
    }
 else {
      oldActiveRule.setInheritance(ActiveRule.OVERRIDES);
      getSession().saveWithoutFlush(oldActiveRule);
      return;
    }
  }
  ActiveRule newActiveRule=(ActiveRule)parentActiveRule.clone();
  newActiveRule.setRulesProfile(profile);
  newActiveRule.setInheritance(ActiveRule.INHERITED);
  profile.addActiveRule(newActiveRule);
  getSession().saveWithoutFlush(newActiveRule);
  if (oldActiveRule != null) {
    ruleChanged(profile,oldActiveRule,newActiveRule,userName);
  }
 else {
    ruleEnabled(profile,newActiveRule,userName);
  }
  for (  RulesProfile child : getChildren(profile)) {
    activateOrChange(child,newActiveRule,userName);
  }
}
