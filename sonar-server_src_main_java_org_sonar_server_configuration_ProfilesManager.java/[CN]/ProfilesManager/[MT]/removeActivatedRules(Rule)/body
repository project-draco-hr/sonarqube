{
  List<ActiveRule> activeRules=getSession().createQuery("FROM " + ActiveRule.class.getSimpleName() + " WHERE rule=:rule").setParameter("rule",rule).getResultList();
  List<ActiveRule> activeRulesToRemove=Lists.newArrayList();
  for (  ActiveRule activeRule : activeRules) {
    if (!activeRule.isInherited()) {
      RulesProfile profile=activeRule.getRulesProfile();
      incrementProfileVersionIfNeeded(profile);
      ruleDisabled(profile,activeRule,null);
      for (      RulesProfile child : getChildren(profile.getId())) {
        deactivate(child,activeRule.getRule(),null);
      }
      activeRulesToRemove.add(activeRule);
    }
  }
  for (  ActiveRule activeRule : activeRulesToRemove) {
    ActiveRule activeRuleToRemove=getSession().getSingleResult(ActiveRule.class,"id",activeRule.getId());
    removeActiveRule(activeRuleToRemove);
  }
  getSession().commit();
}
