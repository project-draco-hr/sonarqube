{
  setupData("with-previous-version");
  PastSnapshotFinderByPreviousVersion finder=new PastSnapshotFinderByPreviousVersion(getSession());
  Snapshot currentProjectSnapshot=getSession().getSingleResult(Snapshot.class,"id",1010);
  PastSnapshot foundSnapshot=finder.findByPreviousVersion(currentProjectSnapshot);
  assertThat(foundSnapshot.getProjectSnapshotId()).isEqualTo(1009);
  assertThat(foundSnapshot.getMode()).isEqualTo(CoreProperties.TIMEMACHINE_MODE_PREVIOUS_VERSION);
  assertThat(foundSnapshot.getModeParameter()).isEqualTo("1.1");
  currentProjectSnapshot=getSession().getSingleResult(Snapshot.class,"id",1009);
  assertThat(finder.findByPreviousVersion(currentProjectSnapshot).getProjectSnapshotId()).isEqualTo(1003);
}
