{
  SqlSession mybatisSession=mock(SqlSession.class);
  WorkQueue<?> queue=mock(WorkQueue.class);
  BatchSession session=new BatchSession(queue,mybatisSession,10);
  ClusterAction action=new ClusterAction(){
    @Override public Object call() throws Exception {
      return null;
    }
  }
;
  for (int i=0; i < 9; i++) {
    session.enqueue(action);
    verify(mybatisSession,never()).commit();
    verify(mybatisSession,never()).commit(anyBoolean());
  }
  session.enqueue(action);
  verify(mybatisSession).commit();
  session.close();
}
