{
  ComponentDto project=createProject("sample:root");
  ComponentDto module=ComponentTesting.newModuleDto(project).setKey("sample:root:module");
  tester.get(ComponentDao.class).insert(session,module);
  ComponentDto module2=ComponentTesting.newModuleDto(project).setKey("foo:module");
  tester.get(ComponentDao.class).insert(session,module2);
  session.commit();
  userSessionRule.login("john").addProjectUuidPermissions(UserRole.ADMIN,project.uuid());
  Map<String,String> result=service.checkModuleKeysBeforeRenaming(project.key(),"sample:root","foo");
  assertThat(result).hasSize(2);
  assertThat(result.get("sample:root")).isEqualTo("foo");
  assertThat(result.get("sample:root:module")).isEqualTo("#duplicate_key#");
}
