{
  OrchestratorBuilder builder=Orchestrator.builderEnv();
  org.sonar.updatecenter.common.Version sonarVersion=org.sonar.updatecenter.common.Version.create(builder.getSonarVersion());
  Version sonarVersionWithoutPatch=Version.create(sonarVersion.getMajor() + "." + sonarVersion.getMinor());
  builder.getUpdateCenter().setInstalledSonarVersion(sonarVersionWithoutPatch);
  for (  Plugin plugin : builder.getUpdateCenter().findAllCompatiblePlugins()) {
    if (!DISABLED_PLUGINS.contains(plugin.getKey())) {
      Release release=plugin.getLastCompatibleRelease(sonarVersionWithoutPatch);
      if (release != null) {
        builder.setOrchestratorProperty(plugin.getKey() + "Version",release.getVersion().toString());
        builder.addPlugin(plugin.getKey());
      }
    }
  }
  activateLicenses(builder);
  orchestrator=builder.build();
  orchestrator.start();
}
