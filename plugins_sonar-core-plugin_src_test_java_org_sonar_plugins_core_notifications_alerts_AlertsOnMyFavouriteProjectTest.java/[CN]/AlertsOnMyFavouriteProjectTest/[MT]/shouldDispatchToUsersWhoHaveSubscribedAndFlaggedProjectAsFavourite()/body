{
  Multimap<String,NotificationChannel> recipients=HashMultimap.create();
  recipients.put("user1",emailChannel);
  recipients.put("user2",twitterChannel);
  when(notificationManager.findSubscribedRecipientsForDispatcher(dispatcher,null)).thenReturn(recipients);
  when(propertiesDao.findUserIdsForFavouriteResource(34L)).thenReturn(Lists.newArrayList("user2","user3"));
  Notification notification=new Notification("alerts").setFieldValue("projectId","34");
  dispatcher.performDispatch(notification,context);
  verify(context).addUser("user2",twitterChannel);
  verifyNoMoreInteractions(context);
}
