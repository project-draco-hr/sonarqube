{
  ActivityQuery query=new ActivityQuery();
  query.setTypes(request.paramAsStrings(PARAM_TYPE));
  SearchOptions options=new SearchOptions();
  options.setPage(request.mandatoryParamAsInt(WebService.Param.PAGE),request.mandatoryParamAsInt(WebService.Param.PAGE_SIZE));
  SearchResult<ActivityDoc> results=activityIndex.search(query,options);
  JsonWriter json=response.newJsonWriter().beginObject();
  options.writeJson(json,results.getTotal());
  writeActivities(results,json,new QueryContext(userSession).setFieldsToReturn(request.paramAsStrings(WebService.Param.FIELDS)));
  json.endObject().close();
}
