{
  qualityProfileDao=new QualityProfileDao(db.myBatis(),mock(System2.class));
  dbClient=new DbClient(db.database(),db.myBatis(),qualityProfileDao);
  session=dbClient.openSession(false);
  backuper=mock(QProfileBackuper.class);
  db.truncateTables();
  ProfileExporter exporter1=newExporter("polop");
  ProfileExporter exporter2=newExporter("palap");
  IndexClient indexClient=mock(IndexClient.class);
  ActiveRuleIndex activeRuleIndex=mock(ActiveRuleIndex.class);
  when(activeRuleIndex.findByProfile(Matchers.anyString())).thenReturn(Sets.<ActiveRule>newHashSet().iterator());
  when(indexClient.get(ActiveRuleIndex.class)).thenReturn(activeRuleIndex);
  exporters=new QProfileExporters(new QProfileLoader(dbClient,indexClient,userSessionRule),null,null,new ProfileExporter[]{exporter1,exporter2},null);
  wsTester=new WsTester(new QProfilesWs(mock(RuleActivationActions.class),mock(BulkRuleActivationActions.class),mock(ProjectAssociationActions.class),new QProfileExportAction(dbClient,new QProfileFactory(dbClient),backuper,exporters,LanguageTesting.newLanguages("xoo"))));
}
