{
  DoPrivileged.execute(new DoPrivileged.Task(threadLocalUserSession){
    @Override protected void doPrivileged(){
      UserSession userSession=threadLocalUserSession.get();
      assertThat(userSession.isLoggedIn()).isFalse();
      assertThat(userSession.hasGlobalPermission("any permission")).isTrue();
      assertThat(userSession.hasProjectPermission("any permission","any project")).isTrue();
    }
  }
);
  assertThat(threadLocalUserSession.isLoggedIn()).isFalse();
}
