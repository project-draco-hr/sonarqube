{
  if (Iterables.any(activeRules,new Predicate<ActiveRule>(){
    @Override public boolean apply(    ActiveRule input){
      return input.getRule().equals(rule);
    }
  }
)) {
    throw new IllegalStateException(String.format("The rule '%s:%s' is already activated on the profile '%s' (language '%s')",rule.getRepositoryKey(),rule.getKey(),getName(),getLanguage()));
  }
  ActiveRule activeRule=new ActiveRule();
  activeRule.setRule(rule);
  activeRule.setRulesProfile(this);
  activeRule.setSeverity(optionalSeverity == null ? rule.getSeverity() : optionalSeverity);
  activeRules.add(activeRule);
  return activeRule;
}
