{
  List<InputFile> result=Lists.newArrayList();
  if (directories == null) {
    return result;
  }
  IOFileFilter suffixFilter=getFileSuffixFilter(langs);
  WildcardPattern[] exclusionPatterns=WildcardPattern.create(patterns);
  IOFileFilter initialFilesFilter=TrueFileFilter.TRUE;
  if (initialFiles != null && !initialFiles.isEmpty()) {
    initialFilesFilter=new FileSelectionFilter(initialFiles);
  }
  for (  File dir : directories) {
    if (dir.exists()) {
      IOFileFilter exclusionFilter=new ExclusionFilter(dir,exclusionPatterns);
      IOFileFilter visibleFileFilter=HiddenFileFilter.VISIBLE;
      List<IOFileFilter> fileFilters=Lists.newArrayList(visibleFileFilter,suffixFilter,exclusionFilter,initialFilesFilter);
      fileFilters.addAll(this.filters);
      IOFileFilter dotPrefixDirFilter=FileFilterUtils.notFileFilter(FileFilterUtils.prefixFileFilter("."));
      List<File> files=(List<File>)FileUtils.listFiles(dir,new AndFileFilter(fileFilters),FileFilterUtils.and(HiddenFileFilter.VISIBLE,dotPrefixDirFilter));
      for (      File file : files) {
        String relativePath=DefaultProjectFileSystem.getRelativePath(file,dir);
        result.add(InputFileUtils.create(dir,relativePath));
      }
    }
  }
  return result;
}
