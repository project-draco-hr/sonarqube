{
  SqlSession session=mybatis.openSession();
  AuthorMapper mapper=session.getMapper(AuthorMapper.class);
  try {
    mapper.insert(authorDto);
    session.commit();
  }
 catch (  RuntimeException e) {
    session.rollback();
    AuthorDto persistedAuthor=mapper.selectByLogin(authorDto.getLogin());
    if (persistedAuthor != null) {
      authorDto.setId(persistedAuthor.getId());
      authorDto.setPersonId(persistedAuthor.getPersonId());
    }
 else {
      throw e;
    }
  }
 finally {
    MyBatis.closeQuietly(session);
  }
}
