{
  LOG.debug("ComponentQuery : {}",query);
  long start=System.currentTimeMillis();
  try {
    List<Component> components=resourceDao.selectComponentsByQualifiers(query.qualifiers());
    Collection<Component> foundComponents=search(query,components);
    Collection<? extends Component> sortedComponents=new ComponentsFinderSort(foundComponents,query).sort();
    if (ComponentQuery.NO_PAGINATION == query.pageSize()) {
      return new DefaultComponentQueryResult(sortedComponents).setQuery(query);
    }
 else {
      Paging paging=Paging.create(query.pageSize(),query.pageIndex(),foundComponents.size());
      Collection<? extends Component> pagedComponents=pagedComponents(sortedComponents,paging);
      return new DefaultComponentQueryResult(pagedComponents).setPaging(paging).setQuery(query);
    }
  }
  finally {
    LOG.debug("ComponentQuery execution time : {} ms",System.currentTimeMillis() - start);
  }
}
