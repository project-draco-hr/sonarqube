{
  BatchResource rootProject=resourceCache.get(reactor.getRoot().getKeyWithBranch());
  BatchReport.Metadata.Builder builder=BatchReport.Metadata.newBuilder().setAnalysisDate(((Project)rootProject.resource()).getAnalysisDate().getTime()).setProjectKey(((Project)rootProject.resource()).key()).setRootComponentRef(rootProject.batchId());
  Integer sid=rootProject.snapshotId();
  if (sid != null) {
    builder.setSnapshotId(sid);
  }
  writer.writeMetadata(builder.build());
  recursiveWriteComponent(rootProject,writer);
}
