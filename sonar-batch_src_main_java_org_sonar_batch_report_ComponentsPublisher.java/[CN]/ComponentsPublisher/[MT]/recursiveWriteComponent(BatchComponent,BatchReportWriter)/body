{
  Resource r=batchResource.resource();
  BatchReport.Component.Builder builder=BatchReport.Component.newBuilder();
  builder.setRef(batchResource.batchId());
  builder.setType(getType(r));
  if (ResourceUtils.isProject(r)) {
    builder.setKey(r.getKey());
  }
  Integer sid=batchResource.snapshotId();
  if (sid != null) {
    builder.setSnapshotId(sid);
  }
  if (batchResource.isFile()) {
    builder.setIsTest(ResourceUtils.isUnitTestFile(r));
    builder.setLines(((InputFile)batchResource.inputPath()).lines());
  }
  String name=getName(r);
  if (name != null) {
    builder.setName(name);
  }
  String path=r.getPath();
  if (path != null) {
    builder.setPath(path);
  }
  String lang=getLanguageKey(r);
  if (lang != null) {
    builder.setLanguage(lang);
  }
  for (  BatchComponent child : batchResource.children()) {
    builder.addChildRef(child.batchId());
  }
  writeLinks(r,builder);
  writeVersion(r,builder);
  writeEvents(batchResource,builder);
  writer.writeComponent(builder.build());
  for (  BatchComponent child : batchResource.children()) {
    recursiveWriteComponent(child,writer);
  }
}
