{
  startServer(fromVersion,false);
  scanProject();
  int files=countFiles(PROJECT_KEY);
  assertThat(files).isGreaterThan(0);
  stopServer();
  startServer(Version.create(Orchestrator.builderEnv().getSonarVersion()),true);
  checkSystemStatus(ServerStatusResponse.Status.DB_MIGRATION_NEEDED);
  checkUrlsBeforeUpgrade();
  upgradeDatabase();
  checkSystemStatus(ServerStatusResponse.Status.UP);
  checkUrlsAfterUpgrade();
  assertThat(countFiles(PROJECT_KEY)).isEqualTo(files);
  scanProject();
  assertThat(countFiles(PROJECT_KEY)).isEqualTo(files);
  browseWebapp();
}
