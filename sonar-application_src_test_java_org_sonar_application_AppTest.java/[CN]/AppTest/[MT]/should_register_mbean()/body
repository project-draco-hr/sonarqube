{
  Installation installation=mock(Installation.class);
  when(installation.detectHomeDir()).thenReturn(sonarHome.getRoot());
  MBeanServer mbeanServer=ManagementFactory.getPlatformMBeanServer();
  App server=new App(installation);
  assertThat(server).isNotNull();
  ObjectName serverObjectName=Process.objectNameFor(App.PROCESS_NAME);
  assertThat(mbeanServer.isRegistered(serverObjectName)).isTrue();
  Long now=System.currentTimeMillis();
  Long ping=(Long)mbeanServer.invoke(serverObjectName,ProcessMXBean.PING,null,null);
  assertThat(ping).isNotNull();
  assertThat(ping - now).isLessThanOrEqualTo(3000L);
  mbeanServer.invoke(serverObjectName,ProcessMXBean.TERMINATE,null,null);
  try {
    mbeanServer.invoke(serverObjectName,"xoxo",null,null);
    fail();
  }
 catch (  Exception e) {
    assertThat(e.getMessage()).isEqualTo("No such operation: xoxo");
  }
}
