{
  when(actionPlanService.findByKey("ABCD")).thenReturn(DefaultActionPlan.create("Long term"));
  Map<String,String> parameters=newHashMap();
  parameters.put("name","New Long term");
  parameters.put("description","New Long term issues");
  parameters.put("deadLine","13/05/2113");
  parameters.put("project","org.sonar.MultiSample");
  ArgumentCaptor<ActionPlan> actionPlanCaptor=ArgumentCaptor.forClass(ActionPlan.class);
  Result result=internalRubyIssueService.updateActionPlan("ABCD",parameters);
  assertThat(result.ok()).isTrue();
  verify(actionPlanService).update(actionPlanCaptor.capture());
  ActionPlan actionPlan=actionPlanCaptor.getValue();
  assertThat(actionPlan).isNotNull();
  assertThat(actionPlan.key()).isNotNull();
  assertThat(actionPlan.name()).isEqualTo("New Long term");
  assertThat(actionPlan.description()).isEqualTo("New Long term issues");
  assertThat(actionPlan.deadLine()).isNotNull();
  assertThat(actionPlan.projectKey()).isEqualTo("org.sonar.MultiSample");
}
