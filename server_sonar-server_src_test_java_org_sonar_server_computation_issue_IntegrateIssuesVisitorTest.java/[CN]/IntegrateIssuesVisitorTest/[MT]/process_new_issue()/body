{
  componentsWithUnprocessedIssues.setUuids(Collections.<String>emptySet());
  BatchReport.Issue reportIssue=BatchReport.Issue.newBuilder().setMsg("the message").setRuleRepository("xoo").setRuleKey("S001").setSeverity(Constants.Severity.BLOCKER).build();
  reportReader.putIssues(FILE_REF,asList(reportIssue));
  fileSourceRepository.addLine(FILE_REF,"line1");
  underTest.visitAny(FILE);
  verify(issueLifecycle).initNewOpenIssue(defaultIssueCaptor.capture());
  assertThat(defaultIssueCaptor.getValue().ruleKey().rule()).isEqualTo("S001");
  verify(issueLifecycle).doAutomaticTransition(defaultIssueCaptor.capture());
  assertThat(defaultIssueCaptor.getValue().ruleKey().rule()).isEqualTo("S001");
  assertThat(newArrayList(issueCache.traverse())).hasSize(1);
  assertThat(componentsWithUnprocessedIssues.getUuids()).isEmpty();
}
