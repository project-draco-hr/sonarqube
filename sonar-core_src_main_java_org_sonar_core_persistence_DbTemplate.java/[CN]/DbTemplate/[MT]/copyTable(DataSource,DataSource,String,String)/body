{
  LOG.debug("Copy table %s",table);
  String selectQuery=selectQuery(table,whereClauses);
  truncate(dest,table);
  Connection sourceConnection=null;
  Statement sourceStatement=null;
  ResultSet sourceResultSet=null;
  Connection destConnection=null;
  ResultSet destResultSet=null;
  PreparedStatement destStatement=null;
  try {
    sourceConnection=source.getConnection();
    sourceStatement=sourceConnection.createStatement();
    sourceResultSet=sourceStatement.executeQuery(selectQuery);
    if (sourceResultSet.next()) {
      List<String> columnNames=columnNames(sourceResultSet);
      int colCount=columnNames.size();
      destConnection=dest.getConnection();
      destConnection.setAutoCommit(false);
      String insertSql=new StringBuilder().append("INSERT INTO ").append(table).append("(").append(Joiner.on(",").join(columnNames)).append(") VALUES(").append(StringUtils.repeat("?",",",colCount)).append(")").toString();
      destStatement=destConnection.prepareStatement(insertSql);
      do {
        for (int col=1; col <= colCount; col++) {
          Object value=sourceResultSet.getObject(columnNames.get(col - 1));
          destStatement.setObject(col,value);
        }
        destStatement.addBatch();
      }
 while (sourceResultSet.next());
      destStatement.executeBatch();
      destConnection.commit();
    }
  }
 catch (  SQLException e) {
    LOG.error("Fail to copy table " + table,e);
    throw new IllegalStateException("Fail to copy table " + table,e);
  }
 finally {
    DatabaseUtils.closeQuietly(destStatement);
    DatabaseUtils.closeQuietly(destResultSet);
    DatabaseUtils.closeQuietly(destConnection);
    DatabaseUtils.closeQuietly(sourceResultSet);
    DatabaseUtils.closeQuietly(sourceStatement);
    DatabaseUtils.closeQuietly(sourceConnection);
  }
  return this;
}
