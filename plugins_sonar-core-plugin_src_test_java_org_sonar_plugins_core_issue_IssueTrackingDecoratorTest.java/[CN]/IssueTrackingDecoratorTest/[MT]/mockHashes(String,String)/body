{
  DefaultInputFile inputFile=mock(DefaultInputFile.class);
  byte[][] hashes=computeHashes(newSource);
  when(inputFile.lineHashes()).thenReturn(hashes);
  when(inputFile.key()).thenReturn("foo:Action.java");
  when(inputPathCache.getFile("foo","Action.java")).thenReturn(inputFile);
  when(lastSnapshots.getLineHashes("foo:Action.java")).thenReturn(computeHexHashes(originalSource));
  Resource file=File.create("Action.java");
  return file;
}
