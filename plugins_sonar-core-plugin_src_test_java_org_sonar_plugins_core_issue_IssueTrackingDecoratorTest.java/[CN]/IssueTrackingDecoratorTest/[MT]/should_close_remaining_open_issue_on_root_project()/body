{
  when(scanIssues.issues(anyString())).thenReturn(Collections.<Issue>emptyList());
  when(initialOpenIssuesStack.selectAndRemove(anyInt())).thenReturn(Collections.<IssueDto>emptyList());
  when(initialOpenIssuesStack.getAllIssues()).thenReturn(newArrayList(new IssueDto().setKey("100").setRuleId(1).setRuleKey_unit_test_only("squid","AvoidCycle")));
  Resource resource=mock(Resource.class);
  when(resource.getQualifier()).thenReturn(Qualifiers.PROJECT);
  decorator.decorate(resource,null);
  ArgumentCaptor<DefaultIssue> argument=ArgumentCaptor.forClass(DefaultIssue.class);
  verify(scanIssues).addOrUpdate(argument.capture());
  assertThat(argument.getValue().status()).isEqualTo(Issue.STATUS_CLOSED);
  assertThat(argument.getValue().updatedAt()).isEqualTo(loadedDate);
  assertThat(argument.getValue().closedAt()).isEqualTo(loadedDate);
}
