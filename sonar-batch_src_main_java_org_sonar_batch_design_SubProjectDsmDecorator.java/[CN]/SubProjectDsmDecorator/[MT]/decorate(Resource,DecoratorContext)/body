{
  if (shouldDecorateResource(resource,context)) {
    List<DecoratorContext> directoryContexts=context.getChildren();
    List<Resource> directories=new ArrayList<Resource>(directoryContexts.size());
    for (    DecoratorContext decoratorContext : directoryContexts) {
      directories.add(decoratorContext.getResource());
    }
    IncrementalCyclesAndFESSolver<Resource> cycleDetector=new IncrementalCyclesAndFESSolver<Resource>(index,directories);
    Set<Cycle> cycles=cycleDetector.getCycles();
    MinimumFeedbackEdgeSetSolver solver=new MinimumFeedbackEdgeSetSolver(cycles);
    Set<Edge> feedbackEdges=solver.getEdges();
    int tangles=solver.getWeightOfFeedbackEdgeSet();
    savePositiveMeasure(context,CoreMetrics.DIRECTORY_CYCLES,cycles.size());
    savePositiveMeasure(context,CoreMetrics.DIRECTORY_FEEDBACK_EDGES,feedbackEdges.size());
    savePositiveMeasure(context,CoreMetrics.DIRECTORY_TANGLES,tangles);
    savePositiveMeasure(context,CoreMetrics.DIRECTORY_EDGES_WEIGHT,getEdgesWeight(directories));
    Dsm<Resource> dsm=getDsm(directories,feedbackEdges);
    saveDsm(context,dsm);
  }
}
