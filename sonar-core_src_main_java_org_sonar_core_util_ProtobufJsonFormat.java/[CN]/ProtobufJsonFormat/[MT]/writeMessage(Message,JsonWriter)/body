{
  MessageJsonDescriptor fields=MessageJsonDescriptor.of(message);
  for (  MessageField field : fields.getFields()) {
    if (field.hasValue(message)) {
      writer.name(field.getName());
      if (field.isRepeated()) {
        writer.beginArray();
        for (        Object o : (Collection)field.getValue(message)) {
          writeFieldValue(field,o,writer);
        }
        writer.endArray();
      }
 else {
        writeFieldValue(field,field.getValue(message),writer);
      }
    }
  }
}
