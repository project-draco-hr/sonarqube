{
  when(dryRun.isEnabled()).thenReturn(true);
  when(violation.getResource()).thenReturn(resource);
  when(violation.getLineId()).thenReturn(1);
  when(violation.getMessage()).thenReturn("VIOLATION");
  when(violation.getRule()).thenReturn(Rule.create("pmd","RULE_KEY").setName("RULE_NAME"));
  when(violation.getSeverity()).thenReturn(RulePriority.INFO);
  doReturn(Arrays.asList(violation)).when(dryRunExporter).getViolations(resource);
  String json=dryRunExporter.getResultsAsJson(ImmutableSet.of(resource));
  assertThat(json).isEqualTo("[{\"resource\":\"KEY\",\"violations\":[{\"line\":1,\"message\":\"VIOLATION\",\"severity\":\"INFO\",\"rule_key\":\"RULE_KEY\",\"rule_name\":\"RULE_NAME\"}]}]");
}
