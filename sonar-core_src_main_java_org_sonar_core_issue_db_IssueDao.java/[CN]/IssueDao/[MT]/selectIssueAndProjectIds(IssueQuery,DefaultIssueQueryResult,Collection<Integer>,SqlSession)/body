{
  final List<IssueDto> authorizedIssues=newArrayList();
  ResultHandler resultHandler=new ResultHandler(){
    @Override public void handleResult(    ResultContext context){
      IssueDto issueDto=(IssueDto)context.getResultObject();
      if (authorizedRootProjectIds.contains(issueDto.getProjectId())) {
        authorizedIssues.add(issueDto);
      }
 else {
        defaultIssueQueryResult.setSecurityExclusions(true);
      }
      if (authorizedIssues.size() >= query.maxResults()) {
        defaultIssueQueryResult.setMaxResultsReached(true);
        context.stop();
      }
    }
  }
;
  sqlSession.select("selectIssueAndProjectIds",query,resultHandler);
  return authorizedIssues;
}
