{
  report.setCreatedAt(system2.newDate());
  report.setUpdatedAt(system2.newDate());
  Connection connection=session.getConnection();
  PreparedStatement ps=null;
  try {
    ps=connection.prepareStatement("insert into analysis_reports " + " (project_key, snapshot_id, report_status, report_data, created_at, updated_at, started_at, finished_at)" + " values (?, ?, ?, ?, ?, ?, ?, ?)");
    ps.setString(1,report.getProjectKey());
    ps.setLong(2,report.getSnapshotId());
    ps.setString(3,report.getStatus().toString());
    setData(ps,4,report.getData());
    ps.setTimestamp(5,dateToTimestamp(report.getCreatedAt()));
    ps.setTimestamp(6,dateToTimestamp(report.getUpdatedAt()));
    ps.setTimestamp(7,dateToTimestamp(report.getStartedAt()));
    ps.setTimestamp(8,dateToTimestamp(report.getFinishedAt()));
    ps.executeUpdate();
    connection.commit();
  }
 catch (  SQLException|IOException e) {
    throw new IllegalStateException(String.format("Failed to insert %s in the database",report),e);
  }
 finally {
    DatabaseUtils.closeQuietly(ps);
  }
  return report;
}
