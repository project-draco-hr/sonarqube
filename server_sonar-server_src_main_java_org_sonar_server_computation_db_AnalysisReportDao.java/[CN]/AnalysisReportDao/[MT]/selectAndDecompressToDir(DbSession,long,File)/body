{
  Connection connection=session.getConnection();
  InputStream stream=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    ps=connection.prepareStatement("select report_data from analysis_reports where id=?");
    ps.setLong(1,id);
    rs=ps.executeQuery();
    if (rs.next()) {
      stream=rs.getBinaryStream(1);
      if (stream != null) {
        ZipUtils.unzip(stream,toDir);
      }
    }
  }
 catch (  SQLException e) {
    throw new IllegalStateException(String.format("Failed to read report '%d' in the database",id),e);
  }
catch (  IOException e) {
    throw new IllegalStateException(String.format("Failed to decompress report '%d'",id),e);
  }
 finally {
    IOUtils.closeQuietly(stream);
    DatabaseUtils.closeQuietly(rs);
    DatabaseUtils.closeQuietly(ps);
  }
}
