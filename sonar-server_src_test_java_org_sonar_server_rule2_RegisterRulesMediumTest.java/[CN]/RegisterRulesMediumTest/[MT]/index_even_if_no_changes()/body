{
  RuleIndex index=tester.get(RuleIndex.class);
  verifyRulesInDb();
  tester.clearIndexes();
  verifyRulesInDb();
  RuleResult searchResult=index.search(new RuleQuery(),new QueryOptions());
  assertThat(searchResult.getTotal()).isEqualTo(0);
  assertThat(searchResult.getHits()).hasSize(0);
  tester.get(Platform.class).restart();
  index=tester.get(RuleIndex.class);
  index.refresh();
  verifyRulesInDb();
  searchResult=index.search(new RuleQuery().setKey("xoo:x1"),new QueryOptions());
  assertThat(searchResult.getTotal()).isEqualTo(1);
  assertThat(searchResult.getHits()).hasSize(1);
  assertThat(searchResult.getHits().get(0).params()).hasSize(1);
}
