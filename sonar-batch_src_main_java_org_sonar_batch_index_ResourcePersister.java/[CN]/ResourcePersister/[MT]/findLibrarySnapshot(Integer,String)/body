{
  Query query=session.createQuery("from " + Snapshot.class.getSimpleName() + " s WHERE s.resourceId=:resourceId AND s.version=:version AND s.scope=:scope AND s.qualifier<>:qualifier AND s.last=:last");
  query.setParameter(RESOURCE_ID,resourceId);
  query.setParameter(VERSION,version);
  query.setParameter(SCOPE,Scopes.PROJECT);
  query.setParameter(QUALIFIER,Qualifiers.LIBRARY);
  query.setParameter(LAST,Boolean.TRUE);
  List<Snapshot> snapshots=query.getResultList();
  if (snapshots.isEmpty()) {
    snapshots=session.getResults(Snapshot.class,RESOURCE_ID,resourceId,VERSION,version,SCOPE,Scopes.PROJECT,QUALIFIER,Qualifiers.LIBRARY);
  }
  return snapshots.isEmpty() ? null : snapshots.get(0);
}
