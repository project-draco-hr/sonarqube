{
  try {
    JSONParser parser=new JSONParser();
    JSONObject json=(JSONObject)parser.parse(input);
    ElementFactory elementFactory=new ElementFactory(toGraph);
    GraphsonMode mode=GraphsonMode.valueOf(json.get(GraphsonTokens.MODE).toString());
    GraphsonUtil graphson=new GraphsonUtil(mode,elementFactory,vertexPropertyKeys,edgePropertyKeys);
    JSONArray vertices=(JSONArray)json.get(GraphsonTokens.VERTICES);
    for (    Object vertice : vertices) {
      graphson.vertexFromJson((JSONObject)vertice);
    }
    JSONArray edges=(JSONArray)json.get(GraphsonTokens.EDGES);
    for (    Object edgeObject : edges) {
      JSONObject edge=(JSONObject)edgeObject;
      Vertex inV=toGraph.getVertex(edge.get(GraphsonTokens._IN_V));
      Vertex outV=toGraph.getVertex(edge.get(GraphsonTokens._OUT_V));
      graphson.edgeFromJson(edge,outV,inV);
    }
    toGraph.shutdown();
    return toGraph;
  }
 catch (  Exception e) {
    throw new GraphsonException("Unable to parse GraphSON",e);
  }
}
