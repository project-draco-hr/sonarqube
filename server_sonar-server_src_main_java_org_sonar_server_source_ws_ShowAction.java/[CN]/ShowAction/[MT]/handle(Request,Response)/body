{
  String fileKey=request.mandatoryParam("key");
  int from=Math.max(request.paramAsInt("from"),1);
  int to=(Integer)ObjectUtils.defaultIfNull(request.paramAsInt("to"),Integer.MAX_VALUE);
  DbSession dbSession=dbClient.openSession(false);
  try {
    ComponentDto file=componentFinder.getByKey(dbSession,fileKey);
    userSession.checkProjectUuidPermission(UserRole.CODEVIEWER,file.projectUuid());
    Optional<Iterable<String>> linesHtml=sourceService.getLinesAsHtml(dbSession,file.uuid(),from,to);
    if (linesHtml.isPresent()) {
      JsonWriter json=response.newJsonWriter().beginObject();
      writeSource(linesHtml.get(),from,json);
      json.endObject().close();
    }
 else {
      throw new NotFoundException();
    }
  }
  finally {
    dbClient.closeSession(dbSession);
  }
}
