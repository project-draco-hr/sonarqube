{
  Snapshot currentSnapshot=resourcePersister.getSnapshot(resource);
  if (currentSnapshot != null) {
    int resourceId=currentSnapshot.getResourceId();
    int snapshotId=currentSnapshot.getId();
    Query query=databaseSession.createNativeQuery("UPDATE reviews SET status='closed' " + "WHERE resource_id = " + resourceId + " AND rule_failure_permanent_id NOT IN "+ "(SELECT permanent_id FROM rule_failures WHERE snapshot_id = "+ snapshotId+ ")");
    int rowUpdated=query.executeUpdate();
    LOG.debug("- {} reviews set to 'closed' on resource #{}",rowUpdated,resourceId);
    databaseSession.commit();
  }
}
