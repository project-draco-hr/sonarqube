{
  RuleActivation activation=new RuleActivation(RuleTesting.XOO_X1);
  activation.setSeverity("MAJOR");
  activate(activation,XOO_P1_KEY);
  verifyOneActiveRule(XOO_P1_KEY,RuleTesting.XOO_X1,Severity.MAJOR,null,ImmutableMap.of("max","10"));
  db.qualityProfileDao().insert(dbSession,QProfileTesting.newXooP2());
  dbSession.commit();
  dbSession.clearCache();
  ruleActivator.setParent(XOO_P2_KEY,XOO_P1_KEY);
  verifyOneActiveRule(XOO_P2_KEY,RuleTesting.XOO_X1,Severity.MAJOR,ActiveRuleDto.INHERITED,ImmutableMap.of("max","10"));
  activation=new RuleActivation(RuleTesting.XOO_X1);
  activation.setSeverity("BLOCKER").setParameter("max","333");
  activate(activation,XOO_P2_KEY);
  verifyOneActiveRule(XOO_P2_KEY,RuleTesting.XOO_X1,Severity.BLOCKER,ActiveRuleDto.OVERRIDES,ImmutableMap.of("max","333"));
  ruleActivator.setParent(XOO_P2_KEY,null);
  dbSession.clearCache();
  assertThat(db.qualityProfileDao().selectByKey(dbSession,XOO_P2_KEY).getParentKee()).isNull();
  verifyOneActiveRule(XOO_P2_KEY,RuleTesting.XOO_X1,Severity.BLOCKER,null,ImmutableMap.of("max","333"));
}
