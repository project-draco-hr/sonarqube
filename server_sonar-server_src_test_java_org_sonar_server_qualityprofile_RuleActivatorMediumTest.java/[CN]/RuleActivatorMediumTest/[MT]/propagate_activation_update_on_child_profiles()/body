{
  createChildProfiles();
  userSessionRule.login();
  RuleActivation activation=new RuleActivation(XOO_X1);
  activation.setSeverity(BLOCKER);
  activation.setParameter("max","7");
  activate(activation,XOO_P1_KEY);
  verifyOneActiveRuleInDb(XOO_P1_KEY,XOO_X1,BLOCKER,null,ImmutableMap.of("max","7"));
  verifyOneActiveRuleInDb(XOO_P2_KEY,XOO_X1,BLOCKER,INHERITED,ImmutableMap.of("max","7"));
  verifyOneActiveRuleInDb(XOO_P3_KEY,XOO_X1,BLOCKER,INHERITED,ImmutableMap.of("max","7"));
  activation=new RuleActivation(XOO_X1);
  activation.setSeverity(INFO);
  activation.setParameter("max","8");
  activate(activation,XOO_P1_KEY);
  verifyOneActiveRuleInDb(XOO_P1_KEY,XOO_X1,INFO,null,ImmutableMap.of("max","8"));
  verifyOneActiveRuleInDb(XOO_P2_KEY,XOO_X1,INFO,INHERITED,ImmutableMap.of("max","8"));
  verifyOneActiveRuleInDb(XOO_P3_KEY,XOO_X1,INFO,INHERITED,ImmutableMap.of("max","8"));
  activation=new RuleActivation(XOO_X1);
  activation.setSeverity(MINOR);
  activation.setParameter("max","9");
  activate(activation,XOO_P2_KEY);
  verifyOneActiveRuleInDb(XOO_P1_KEY,XOO_X1,INFO,null,ImmutableMap.of("max","8"));
  verifyOneActiveRuleInDb(XOO_P2_KEY,XOO_X1,MINOR,OVERRIDES,ImmutableMap.of("max","9"));
  verifyOneActiveRuleInDb(XOO_P3_KEY,XOO_X1,MINOR,INHERITED,ImmutableMap.of("max","9"));
  activation=new RuleActivation(XOO_X1);
  activation.setSeverity(BLOCKER);
  activation.setParameter("max","10");
  activate(activation,XOO_P3_KEY);
  verifyOneActiveRuleInDb(XOO_P1_KEY,XOO_X1,INFO,null,ImmutableMap.of("max","8"));
  verifyOneActiveRuleInDb(XOO_P2_KEY,XOO_X1,MINOR,OVERRIDES,ImmutableMap.of("max","9"));
  verifyOneActiveRuleInDb(XOO_P3_KEY,XOO_X1,BLOCKER,OVERRIDES,ImmutableMap.of("max","10"));
  assertProfileHasBeenUpdatedManually(XOO_P1_KEY);
  assertProfileHasBeenUpdatedManually(XOO_P2_KEY);
  assertProfileHasBeenUpdatedManually(XOO_P3_KEY);
}
