{
  Integer lastAnalysisPeriodIndex=timeMachineConfiguration.getLastAnalysisPeriodIndex();
  if (lastAnalysisPeriodIndex != null) {
    PastSnapshot pastSnapshot=timeMachineConfiguration.getProjectPastSnapshots().get(lastAnalysisPeriodIndex - 1);
    Double newViolationsCount=context.getMeasure(CoreMetrics.NEW_VIOLATIONS).getVariation(lastAnalysisPeriodIndex);
    if (pastSnapshot.getTargetDate() != null && newViolationsCount != null && newViolationsCount > 0) {
      DateFormat dateformat=new SimpleDateFormat("yyyy-MM-dd");
      Notification notification=new Notification("new-violations").setFieldValue("count",String.valueOf(newViolationsCount.intValue())).setFieldValue("projectName",project.getLongName()).setFieldValue("projectKey",project.getKey()).setFieldValue("projectId",String.valueOf(project.getId())).setFieldValue("period",lastAnalysisPeriodIndex.toString()).setFieldValue("fromDate",dateformat.format(pastSnapshot.getTargetDate())).setFieldValue("toDate",dateformat.format(new Date()));
      notificationManager.scheduleForSending(notification);
    }
  }
}
