{
  ListMultimap<RulePriority,Violation> violationsPerSeverities=ArrayListMultimap.create();
  for (  Violation violation : context.getViolations()) {
    violationsPerSeverities.put(violation.getSeverity(),violation);
  }
  for (  RulePriority severity : RulePriority.values()) {
    Metric metric=severityToMetric(severity);
    Measure measure=new Measure(metric);
    for (    PastSnapshot pastSnapshot : timeMachineConfiguration.getProjectPastSnapshots()) {
      int variationIndex=pastSnapshot.getIndex();
      int count=countViolations(violationsPerSeverities.get(severity),pastSnapshot.getTargetDate());
      Collection<Measure> children=context.getChildrenMeasures(MeasuresFilters.metric(metric));
      double sum=MeasureUtils.sumOnVariation(true,variationIndex,children) + count;
      measure.setVariation(variationIndex,sum);
    }
    context.saveMeasure(measure);
  }
}
