{
  MetricDto duplicationMetric=saveDuplicationMetric();
  initReportWithProjectAndFile();
  duplicationRepository.addDuplication(FILE_1_REF,new TextBlock(1,5),new TextBlock(6,10));
  underTest.execute();
  assertThat(dbTester.countRowsOfTable("project_measures")).isEqualTo(1);
  Map<String,Object> dto=dbTester.selectFirst("select snapshot_id as \"snapshotId\", metric_id as \"metricId\", text_value as \"textValue\" from project_measures");
  assertThat(dto.get("snapshotId")).isEqualTo(11L);
  assertThat(dto.get("metricId")).isEqualTo(duplicationMetric.getId().longValue());
  assertThat(dto.get("textValue")).isEqualTo("<duplications><g><b s=\"1\" l=\"5\" r=\"PROJECT_KEY:file\"/><b s=\"6\" l=\"5\" r=\"PROJECT_KEY:file\"/></g></duplications>");
}
