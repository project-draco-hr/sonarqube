{
  Component file=DumbComponent.builder(Component.Type.FILE,10).setUuid("DEFG").setKey("PROJECT_KEY:file").build();
  Component directory1=DumbComponent.builder(Component.Type.DIRECTORY,3).setUuid("CDEF").setKey("PROJECT_KEY:dir1").addChildren(file).build();
  Component directory2=DumbComponent.builder(Component.Type.DIRECTORY,2).setUuid("BCDE").setKey("PROJECT_KEY:dir2").addChildren(directory1).build();
  Component project=DumbComponent.builder(Component.Type.PROJECT,1).setUuid("ABCD").setKey(PROJECT_KEY).addChildren(directory2).build();
  treeRootHolder.setRoot(project);
  dbIdsRepository.setComponentId(project,1);
  dbIdsRepository.setSnapshotId(project,10);
  dbIdsRepository.setComponentId(directory1,2);
  dbIdsRepository.setSnapshotId(directory1,11);
  dbIdsRepository.setComponentId(directory2,3);
  dbIdsRepository.setSnapshotId(directory2,12);
  dbIdsRepository.setComponentId(file,10);
  dbIdsRepository.setSnapshotId(file,20);
  saveDuplicationMetric();
  BatchReport.Duplication duplication=BatchReport.Duplication.newBuilder().setOriginPosition(BatchReport.TextRange.newBuilder().setStartLine(1).setEndLine(5).build()).addDuplicate(BatchReport.Duplicate.newBuilder().setOtherFileRef(10).setRange(BatchReport.TextRange.newBuilder().setStartLine(6).setEndLine(10).build()).build()).build();
  reportReader.putDuplications(10,newArrayList(duplication));
  underTest.execute();
  assertThat(dbTester.countRowsOfTable("project_measures")).isEqualTo(1);
  Map<String,Object> dto=dbTester.selectFirst("select snapshot_id as \"snapshotId\", text_value as \"textValue\" from project_measures");
  assertThat(dto.get("textValue")).isEqualTo("<duplications><g><b s=\"1\" l=\"5\" r=\"PROJECT_KEY:file\"/><b s=\"6\" l=\"5\" r=\"PROJECT_KEY:file\"/></g></duplications>");
}
