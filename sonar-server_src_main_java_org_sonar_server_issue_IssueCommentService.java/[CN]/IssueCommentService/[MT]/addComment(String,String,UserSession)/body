{
  verifyLoggedIn(userSession);
  IssueQueryResult queryResult=loadIssue(issueKey);
  if (StringUtils.isBlank(text)) {
    throw new BadRequestException("Cannot add empty comments to an issue");
  }
  DefaultIssue issue=(DefaultIssue)queryResult.first();
  IssueChangeContext context=IssueChangeContext.createUser(new Date(),userSession.login());
  updater.addComment(issue,text,context);
  storage.save(issue);
  issueNotifications.sendChanges(issue,context,queryResult,text);
  return issue.comments().get(issue.comments().size() - 1);
}
