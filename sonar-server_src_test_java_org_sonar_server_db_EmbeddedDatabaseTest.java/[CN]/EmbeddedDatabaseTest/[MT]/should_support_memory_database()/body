{
  int port=freeServerPort();
  EmbeddedDatabase database=new EmbeddedDatabase(settings(port).setProperty(DatabaseProperties.PROP_URL,"jdbc:h2:tcp://localhost:" + port + "/mem:sonarIT;USER=sonar;PASSWORD=sonar"));
  database.start();
  try {
    String driverUrl=String.format("jdbc:h2:tcp://localhost:%d/mem:sonarIT;USER=sonar;PASSWORD=sonar",port);
    DriverManager.registerDriver(new Driver());
    DriverManager.getConnection(driverUrl).close();
  }
 catch (  Exception ex) {
    fail("Unable to connect after start");
  }
  database.stop();
}
