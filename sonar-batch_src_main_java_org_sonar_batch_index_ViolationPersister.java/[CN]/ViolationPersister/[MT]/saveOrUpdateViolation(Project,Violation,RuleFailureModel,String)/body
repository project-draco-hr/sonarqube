{
  Snapshot snapshot=resourcePersister.saveResource(project,violation.getResource());
  if (model != null) {
    model=session.reattach(RuleFailureModel.class,model.getId());
    model=mergeModel(violation,model);
  }
 else {
    model=createModel(violation);
    model.setCreatedAt(snapshot.getCreatedAt());
  }
  model.setSnapshotId(snapshot.getId());
  model.setChecksum(checksum);
  session.save(model);
  violation.setMessage(model.getMessage());
  violation.setCreatedAt(model.getCreatedAt());
}
