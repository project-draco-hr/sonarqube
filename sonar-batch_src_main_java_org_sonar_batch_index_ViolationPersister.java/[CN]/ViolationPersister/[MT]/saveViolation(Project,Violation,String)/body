{
  Snapshot snapshot=resourcePersister.saveResource(project,violation.getResource());
  if (violation.getCreatedAt() == null) {
    violation.setCreatedAt(snapshot.getCreatedAt());
  }
  RuleFailureModel model=createModel(violation);
  model.setSnapshotId(snapshot.getId());
  model.setChecksum(checksum);
  session.save(model);
  violation.setMessage(model.getMessage());
}
