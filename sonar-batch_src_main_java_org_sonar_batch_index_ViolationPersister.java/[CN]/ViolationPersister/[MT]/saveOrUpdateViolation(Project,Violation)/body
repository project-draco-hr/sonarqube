{
  Snapshot snapshot=resourcePersister.saveResource(project,violation.getResource());
  RuleFailureModel model=selectPreviousViolation(violation);
  if (model != null) {
    model=mergeModel(violation,model);
  }
 else {
    model=createModel(violation);
  }
  model.setSnapshotId(snapshot.getId());
  session.save(model);
}
