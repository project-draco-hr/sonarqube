{
  Properties props=new Properties();
  props.put("hibernate.hbm2ddl.auto",StringUtils.defaultString(configuration.getString(DatabaseProperties.PROP_HIBERNATE_HBM2DLL),"validate"));
  props.put(Environment.DIALECT,getDialectClass());
  props.put("hibernate.generate_statistics",configuration.getBoolean(DatabaseProperties.PROP_HIBERNATE_GENERATE_STATISTICS));
  props.put("hibernate.show_sql",Boolean.valueOf(LOG_SQL.isDebugEnabled()).toString());
  List<String> hibernateKeys=configuration.getKeysStartingWith("sonar.hibernate.");
  for (  String hibernateKey : hibernateKeys) {
    props.put(StringUtils.removeStart(hibernateKey,"sonar."),configuration.getString(hibernateKey));
  }
  setupEntityManagerFactory(props);
  return props;
}
