{
  Enumeration<NetworkInterface> ifaces=NetworkInterface.getNetworkInterfaces();
  while (ifaces.hasMoreElements()) {
    NetworkInterface iface=ifaces.nextElement();
    Enumeration<InetAddress> addresses=iface.getInetAddresses();
    while (addresses.hasMoreElements()) {
      InetAddress addr=addresses.nextElement();
      if (addr.isLoopbackAddress()) {
        return addr.getHostAddress();
      }
    }
  }
  throw new IllegalStateException("Can not find loopback address");
}
