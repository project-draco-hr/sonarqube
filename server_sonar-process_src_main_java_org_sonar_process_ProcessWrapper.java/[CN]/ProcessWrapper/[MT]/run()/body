{
  ProcessBuilder processBuilder=new ProcessBuilder("java","-cp",StringUtils.join(classPath,":"),className);
  processBuilder.environment().putAll(properties);
  processBuilder.environment().put(Process.NAME_PROPERTY,this.getName());
  processBuilder.environment().put(Process.HEARTBEAT_PROPERTY,Integer.toString(port));
  try {
    process=processBuilder.start();
    StreamGobbler errorGobbler=new StreamGobbler(process.getErrorStream(),"ERROR");
    StreamGobbler outputGobbler=new StreamGobbler(process.getInputStream(),"OUTPUT");
    outputGobbler.start();
    errorGobbler.start();
    while (!currentThread().isInterrupted()) {
      process.wait(100);
    }
  }
 catch (  IOException e) {
    throw new IllegalStateException("Io Exception in ProcessWrapper",e);
  }
catch (  InterruptedException e) {
    LOGGER.warn("Process has been shutdown");
  }
}
