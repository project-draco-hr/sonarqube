{
  MockUserSession.set().setLogin("john").setGlobalPermissions(GlobalPermissions.SYSTEM_ADMIN);
  GroupDto userGroup=new GroupDto().setName(CoreProperties.CORE_DEFAULT_GROUP_DEFAULT_VALUE);
  dbClient.groupDao().insert(session,userGroup);
  session.commit();
  boolean result=service.create(NewUser.create().setLogin("user").setName("User").setEmail("user@mail.com").setPassword("password").setPasswordConfirmation("password").setScmAccounts(newArrayList("u1","u_1")));
  assertThat(result).isFalse();
  assertThat(dbClient.userDao().selectNullableByLogin(session,"user")).isNotNull();
  assertThat(esClient.prepareGet(UserIndexDefinition.INDEX,UserIndexDefinition.TYPE_USER,"user").get().isExists()).isTrue();
}
