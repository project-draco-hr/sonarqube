{
  List<SnapshotDto> snapshots=dbClient.snapshotDao().selectSnapshotAndChildrenOfProjectScope(session,reportSnapshotId);
  for (  SnapshotDto snapshot : snapshots) {
    SnapshotDto previousLastSnapshot=dbClient.snapshotDao().selectLastSnapshotByComponentId(session,snapshot.getComponentId());
    if (previousLastSnapshot != null) {
      dbClient.snapshotDao().updateSnapshotAndChildrenLastFlag(session,previousLastSnapshot,false);
      session.commit();
    }
  }
}
