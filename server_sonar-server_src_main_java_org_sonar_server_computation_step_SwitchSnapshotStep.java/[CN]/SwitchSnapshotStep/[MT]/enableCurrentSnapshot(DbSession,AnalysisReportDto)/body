{
  SnapshotDao dao=dbClient.snapshotDao();
  SnapshotDto snapshot=dao.getByKey(session,report.getSnapshotId());
  SnapshotDto previousLastSnapshot=dao.getLastSnapshot(session,snapshot);
  boolean isLast=dao.isLast(snapshot,previousLastSnapshot);
  dao.updateSnapshotAndChildrenLastFlagAndStatus(session,snapshot,isLast,SnapshotDto.STATUS_PROCESSED);
  session.commit();
}
