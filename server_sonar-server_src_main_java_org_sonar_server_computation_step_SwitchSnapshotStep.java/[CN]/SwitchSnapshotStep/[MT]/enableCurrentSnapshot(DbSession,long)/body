{
  SnapshotDao dao=dbClient.snapshotDao();
  SnapshotDto snapshot=dao.selectOrFailById(session,reportSnapshotId);
  SnapshotDto previousLastSnapshot=dao.selectLastSnapshotByComponentId(session,snapshot.getComponentId());
  boolean isLast=isLast(snapshot,previousLastSnapshot);
  dao.updateSnapshotAndChildrenLastFlagAndStatus(session,snapshot,isLast,SnapshotDto.STATUS_PROCESSED);
  session.commit();
}
