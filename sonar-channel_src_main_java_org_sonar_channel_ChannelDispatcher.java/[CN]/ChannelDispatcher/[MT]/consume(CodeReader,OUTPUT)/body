{
  int nextChar=code.peek();
  while (nextChar != -1) {
    boolean characterConsumed=false;
    for (    Channel<OUTPUT> channel : channels) {
      if (channel.consume(code,output)) {
        characterConsumed=true;
        break;
      }
    }
    if (!characterConsumed) {
      if (logger.isDebugEnabled() || failIfNoChannelToConsumeOneCharacter) {
        String message="None of the channel has been able to handle character '" + (char)code.peek() + "' (decimal value "+ code.peek()+ ") at line "+ code.getLinePosition()+ ", column "+ code.getColumnPosition();
        if (failIfNoChannelToConsumeOneCharacter) {
          throw new IllegalStateException(message);
        }
        logger.debug(message);
      }
      code.pop();
    }
    nextChar=code.peek();
  }
  return true;
}
