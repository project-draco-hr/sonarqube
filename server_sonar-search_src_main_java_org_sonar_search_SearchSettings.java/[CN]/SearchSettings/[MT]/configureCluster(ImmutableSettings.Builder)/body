{
  int replicationFactor=0;
  if (inCluster()) {
    replicationFactor=1;
    if (props.valueAsBoolean(ProcessConstants.CLUSTER_MASTER,false)) {
      builder.put("node.master",true);
    }
 else     if (!masterHosts.isEmpty()) {
      LoggerFactory.getLogger(SearchServer.class).info("Joining ES cluster with master: {}",masterHosts);
      builder.put("discovery.zen.ping.unicast.hosts",StringUtils.join(masterHosts,","));
      builder.put("node.master",false);
      builder.put("discovery.zen.minimum_master_nodes",1);
    }
 else {
      throw new MessageException(String.format("Not a master nor a slave. Please check properties %s and %s",ProcessConstants.CLUSTER_MASTER,ProcessConstants.CLUSTER_MASTER_HOST));
    }
  }
  builder.put("index.number_of_replicas",replicationFactor);
  builder.put("cluster.name",clusterName);
  builder.put("cluster.routing.allocation.awareness.attributes","rack_id");
  builder.put("node.rack_id",props.value(ProcessConstants.CLUSTER_NODE_NAME,"unknown"));
  builder.put("node.name",props.value(ProcessConstants.CLUSTER_NODE_NAME));
}
