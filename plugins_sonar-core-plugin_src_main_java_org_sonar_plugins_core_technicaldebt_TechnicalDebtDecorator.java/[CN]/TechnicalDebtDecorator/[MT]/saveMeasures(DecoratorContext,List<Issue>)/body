{
  ListMultimap<RuleKey,Issue> issuesByRule=issuesByRule(issues);
  double total=0.0;
  Map<Characteristic,Double> characteristicCosts=newHashMap();
  Map<org.sonar.api.rules.Rule,Double> ruleDebtCosts=newHashMap();
  for (  Rule newRule : rules.findWithDebt()) {
    String characteristicKey=newRule.characteristic();
    if (characteristicKey != null) {
      org.sonar.api.rules.Rule rule=ruleFinder.findByKey(newRule.key());
      double value=computeTechnicalDebt(CoreMetrics.TECHNICAL_DEBT,context,rule,issuesByRule.get(newRule.key()));
      ruleDebtCosts.put(rule,value);
      total+=value;
      Characteristic characteristic=model.characteristicByKey(characteristicKey);
      propagateTechnicalDebtInParents(characteristic,value,characteristicCosts);
    }
  }
  context.saveMeasure(CoreMetrics.TECHNICAL_DEBT,total);
  saveOnCharacteristic(context,characteristicCosts);
  saveOnRule(context,ruleDebtCosts);
}
