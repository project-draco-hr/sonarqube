{
  T ref=componentToKey.apply(component);
  Long existingSnapshotId=snapshotIdsByRef.get(ref);
  checkState(existingSnapshotId == null,format("Component ref '%s' has already a snapshot id",ref));
  snapshotIdsByRef.put(ref,snapshotId);
  return this;
}
