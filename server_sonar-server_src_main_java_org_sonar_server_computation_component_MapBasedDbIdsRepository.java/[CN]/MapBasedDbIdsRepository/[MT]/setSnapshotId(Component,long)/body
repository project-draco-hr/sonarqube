{
  T ref=componentToKey.apply(component);
  Long existingSnapshotId=snapshotIdsByRef.get(ref);
  checkState(existingSnapshotId == null,format("Snapshot id '%s' is already registered in repository for Component '%s', can not set new id '%s'",existingSnapshotId,component.getKey(),snapshotId));
  snapshotIdsByRef.put(ref,snapshotId);
  return this;
}
