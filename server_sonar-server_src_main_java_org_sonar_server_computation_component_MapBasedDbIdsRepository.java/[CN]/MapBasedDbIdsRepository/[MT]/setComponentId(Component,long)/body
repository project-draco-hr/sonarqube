{
  T ref=componentToKey.apply(component);
  Long existingComponentId=componentIdsByRef.get(ref);
  checkState(existingComponentId == null,format("Component ref '%s' has already a component id",ref));
  componentIdsByRef.put(ref,componentId);
  return this;
}
