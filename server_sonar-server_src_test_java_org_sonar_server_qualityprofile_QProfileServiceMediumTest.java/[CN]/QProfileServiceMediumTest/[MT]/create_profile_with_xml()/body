{
  MockUserSession.set().setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN).setLogin("me");
  db.ruleDao().insert(dbSession,RuleTesting.newDto(RuleKey.of("xoo","R1")).setLanguage("xoo").setSeverity("MINOR"));
  dbSession.commit();
  QProfileResult result=service.create(QProfileName.createFor("xoo","New Profile"),ImmutableMap.of("XooProfileImporter","<xml/>"));
  QualityProfileDto profile=result.profile();
  assertThat(loader.getByKey(profile.getKey())).isNotNull();
  assertThat(loader.getByKey(profile.getKey()).getLanguage()).isEqualTo("xoo");
  assertThat(loader.getByKey(profile.getKey()).getName()).isEqualTo("New Profile");
  List<ActiveRule> activeRules=Lists.newArrayList(loader.findActiveRulesByProfile(profile.getKey()));
  assertThat(activeRules).hasSize(1);
}
