{
  checkPermission(UserSession.get());
  QProfileResult result=new QProfileResult();
  DbSession session=myBatis.openSession(false);
  try {
    ListMultimap<String,RulesProfile> profilesByName=profilesByName(language,result);
    for (    Map.Entry<String,Collection<RulesProfile>> entry : profilesByName.asMap().entrySet()) {
      String name=entry.getKey();
      QProfile profile=qProfileOperations.newProfile(name,language,true,UserSession.get(),session);
      for (      RulesProfile currentRulesProfile : entry.getValue()) {
        restoreFromActiveRules(QualityProfileKey.of(name,language),currentRulesProfile,session);
      }
      esActiveRule.bulkIndexProfile(profile.id(),session);
    }
    dryRunCache.reportGlobalModification(session);
    session.commit();
  }
  finally {
    MyBatis.closeQuietly(session);
  }
  return result;
}
