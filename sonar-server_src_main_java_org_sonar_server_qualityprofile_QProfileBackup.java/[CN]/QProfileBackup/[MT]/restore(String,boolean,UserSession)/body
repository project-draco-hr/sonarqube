{
  checkPermission(userSession);
  Result result=new Result();
  ValidationMessages messages=ValidationMessages.create();
  RulesProfile importedProfile=xmlProfileParser.parse(new StringReader(xmlBackup),messages);
  processValidationMessages(messages,result);
  if (importedProfile != null) {
    DatabaseSession hibernateSession=sessionFactory.getSession();
    checkProfileDoesNotExists(importedProfile,deleteExisting,hibernateSession);
    hibernateSession.saveWithoutFlush(importedProfile);
    hibernateSession.commit();
    SqlSession session=myBatis.openSession();
    try {
      QProfile profile=qProfileLookup.profile(importedProfile.getId());
      ruleRegistry.bulkIndexProfile(profile.id(),session);
      result.setProfile(profile);
    }
  finally {
      MyBatis.closeQuietly(session);
    }
    dryRunCache.reportGlobalModification();
  }
  return result;
}
