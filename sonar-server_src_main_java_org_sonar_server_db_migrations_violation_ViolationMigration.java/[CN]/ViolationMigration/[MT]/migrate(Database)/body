{
  Referentials referentials=new Referentials(db);
  if (referentials.totalViolations() > 0) {
    ViolationConverters converters=new ViolationConverters(db,referentials);
    Connection readConnection=db.getDataSource().getConnection();
    try {
      new QueryRunner().query(readConnection,"select id from rule_failures",new ViolationIdHandler(converters));
    }
  finally {
      DbUtils.closeQuietly(readConnection);
    }
    converters.waitForFinished();
  }
}
