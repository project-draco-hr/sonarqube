{
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).setKey(PROJECT_KEY).setName("Project").setDescription("Project description").addChildRef(2).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(2).setType(Constants.ComponentType.MODULE).setKey("MODULE_KEY").setPath("module").setName("Module").setDescription("Module description").addChildRef(3).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(3).setType(Constants.ComponentType.DIRECTORY).setPath("src/main/java/dir").addChildRef(4).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(4).setType(Constants.ComponentType.FILE).setPath("src/main/java/dir/Foo.java").setLanguage("java").build());
  Component file=DumbComponent.builder(Component.Type.FILE,4).setUuid("DEFG").setKey("MODULE_KEY:src/main/java/dir/Foo.java").build();
  Component directory=DumbComponent.builder(Component.Type.DIRECTORY,3).setUuid("CDEF").setKey("MODULE_KEY:src/main/java/dir").addChildren(file).build();
  Component module=DumbComponent.builder(Component.Type.MODULE,2).setUuid("BCDE").setKey("MODULE_KEY").addChildren(directory).build();
  Component project=DumbComponent.builder(Component.Type.PROJECT,1).setUuid("ABCD").setKey(PROJECT_KEY).addChildren(module).build();
  treeRootHolder.setRoot(project);
  sut.execute();
  dbTester.getSession().commit();
  assertThat(dbTester.countRowsOfTable("projects")).isEqualTo(4);
  ComponentDto projectDto=dbClient.componentDao().selectByKey(dbTester.getSession(),PROJECT_KEY).get();
  assertThat(projectDto.name()).isEqualTo("Project");
  assertThat(projectDto.description()).isEqualTo("Project description");
  assertThat(projectDto.path()).isNull();
  assertThat(projectDto.uuid()).isEqualTo("ABCD");
  assertThat(projectDto.moduleUuid()).isNull();
  assertThat(projectDto.moduleUuidPath()).isEqualTo("." + projectDto.uuid() + ".");
  assertThat(projectDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(projectDto.qualifier()).isEqualTo("TRK");
  assertThat(projectDto.scope()).isEqualTo("PRJ");
  assertThat(projectDto.parentProjectId()).isNull();
  assertThat(projectDto.getCreatedAt()).isEqualTo(now);
  ComponentDto moduleDto=dbClient.componentDao().selectByKey(dbTester.getSession(),"MODULE_KEY").get();
  assertThat(moduleDto.name()).isEqualTo("Module");
  assertThat(moduleDto.description()).isEqualTo("Module description");
  assertThat(moduleDto.path()).isEqualTo("module");
  assertThat(moduleDto.uuid()).isEqualTo("BCDE");
  assertThat(moduleDto.moduleUuid()).isEqualTo(projectDto.uuid());
  assertThat(moduleDto.moduleUuidPath()).isEqualTo(projectDto.moduleUuidPath() + moduleDto.uuid() + ".");
  assertThat(moduleDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(moduleDto.qualifier()).isEqualTo("BRC");
  assertThat(moduleDto.scope()).isEqualTo("PRJ");
  assertThat(moduleDto.parentProjectId()).isEqualTo(projectDto.getId());
  assertThat(moduleDto.getCreatedAt()).isEqualTo(now);
  ComponentDto directoryDto=dbClient.componentDao().selectByKey(dbTester.getSession(),"MODULE_KEY:src/main/java/dir").get();
  assertThat(directoryDto.name()).isEqualTo("src/main/java/dir");
  assertThat(directoryDto.description()).isNull();
  assertThat(directoryDto.path()).isEqualTo("src/main/java/dir");
  assertThat(directoryDto.uuid()).isEqualTo("CDEF");
  assertThat(directoryDto.moduleUuid()).isEqualTo(moduleDto.uuid());
  assertThat(directoryDto.moduleUuidPath()).isEqualTo(moduleDto.moduleUuidPath());
  assertThat(directoryDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(directoryDto.qualifier()).isEqualTo("DIR");
  assertThat(directoryDto.scope()).isEqualTo("DIR");
  assertThat(directoryDto.parentProjectId()).isEqualTo(moduleDto.getId());
  assertThat(directoryDto.getCreatedAt()).isEqualTo(now);
  ComponentDto fileDto=dbClient.componentDao().selectByKey(dbTester.getSession(),"MODULE_KEY:src/main/java/dir/Foo.java").get();
  assertThat(fileDto.name()).isEqualTo("Foo.java");
  assertThat(fileDto.description()).isNull();
  assertThat(fileDto.path()).isEqualTo("src/main/java/dir/Foo.java");
  assertThat(fileDto.language()).isEqualTo("java");
  assertThat(fileDto.uuid()).isEqualTo("DEFG");
  assertThat(fileDto.moduleUuid()).isEqualTo(moduleDto.uuid());
  assertThat(fileDto.moduleUuidPath()).isEqualTo(moduleDto.moduleUuidPath());
  assertThat(fileDto.projectUuid()).isEqualTo(projectDto.uuid());
  assertThat(fileDto.qualifier()).isEqualTo("FIL");
  assertThat(fileDto.scope()).isEqualTo("FIL");
  assertThat(fileDto.parentProjectId()).isEqualTo(moduleDto.getId());
  assertThat(fileDto.getCreatedAt()).isEqualTo(now);
  assertThat(dbIdsRepository.getComponentId(project)).isEqualTo(projectDto.getId());
  assertThat(dbIdsRepository.getComponentId(module)).isEqualTo(moduleDto.getId());
  assertThat(dbIdsRepository.getComponentId(directory)).isEqualTo(directoryDto.getId());
  assertThat(dbIdsRepository.getComponentId(file)).isEqualTo(fileDto.getId());
}
