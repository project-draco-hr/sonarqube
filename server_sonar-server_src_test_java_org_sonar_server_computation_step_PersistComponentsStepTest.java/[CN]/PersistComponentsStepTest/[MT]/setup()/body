{
  dbTester.truncateTables();
  session=dbTester.myBatis().openSession(false);
  dbClient=new DbClient(dbTester.database(),dbTester.myBatis(),new ComponentDao(),new SnapshotDao());
  dbIdsRepository=new DbIdsRepository();
  now=DATE_FORMAT.parse("2015-06-02");
  when(system2.now()).thenReturn(now.getTime());
  sut=new PersistComponentsStep(dbClient,treeRootHolder,reportReader,dbIdsRepository,system2);
}
