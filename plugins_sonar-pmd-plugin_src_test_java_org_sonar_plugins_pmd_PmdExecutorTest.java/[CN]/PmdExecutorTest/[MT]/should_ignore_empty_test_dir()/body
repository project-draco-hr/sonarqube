{
  InputFile srcFile=file("src/Class.java");
  doReturn(pmdTemplate).when(pmdExecutor).createPmdTemplate();
  when(pmdProfileExporter.exportProfile(PmdConstants.REPOSITORY_KEY,rulesProfile)).thenReturn(TestUtils.getResourceContent("/org/sonar/plugins/pmd/simple.xml"));
  when(projectFileSystem.getSourceCharset()).thenReturn(Charsets.UTF_8);
  when(projectFileSystem.mainFiles(Java.KEY)).thenReturn(Arrays.asList(srcFile));
  when(projectFileSystem.testFiles(Java.KEY)).thenReturn(Collections.<InputFile>emptyList());
  pmdExecutor.execute();
  verify(pmdTemplate).process(eq(new File("src/Class.java")),eq(Charsets.UTF_8),any(RuleSets.class),any(RuleContext.class));
  verifyNoMoreInteractions(pmdTemplate);
}
