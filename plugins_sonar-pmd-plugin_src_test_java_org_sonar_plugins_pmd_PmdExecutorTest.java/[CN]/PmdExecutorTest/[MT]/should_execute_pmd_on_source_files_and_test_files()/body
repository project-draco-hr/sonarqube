{
  InputFile srcFile=file("src/Class.java");
  InputFile tstFile=file("test/ClassTest.java");
  when(pmdProfileExporter.exportProfile(PmdConstants.REPOSITORY_KEY,rulesProfile)).thenReturn(TestUtils.getResourceContent("/org/sonar/plugins/pmd/simple.xml"));
  when(pmdProfileExporter.exportProfile(PmdConstants.TEST_REPOSITORY_KEY,rulesProfile)).thenReturn(TestUtils.getResourceContent("/org/sonar/plugins/pmd/junit.xml"));
  when(projectFileSystem.getSourceCharset()).thenReturn(Charsets.UTF_8);
  when(projectFileSystem.mainFiles(Java.KEY)).thenReturn(Arrays.asList(srcFile));
  when(projectFileSystem.testFiles(Java.KEY)).thenReturn(Arrays.asList(tstFile));
  Report report=pmdExecutor.execute();
  verify(pmdTemplate).process(eq(srcFile),eq(Charsets.UTF_8),any(RuleSets.class),any(RuleContext.class));
  verify(pmdTemplate).process(eq(tstFile),eq(Charsets.UTF_8),any(RuleSets.class),any(RuleContext.class));
  assertThat(report).isNotNull();
}
