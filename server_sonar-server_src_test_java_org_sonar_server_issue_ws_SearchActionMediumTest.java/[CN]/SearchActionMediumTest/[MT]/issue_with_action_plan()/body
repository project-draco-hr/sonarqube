{
  ComponentDto project=insertComponent(ComponentTesting.newProjectDto("PROJECT_ID").setKey("MyProject"));
  setDefaultProjectPermission(project);
  ComponentDto file=insertComponent(ComponentTesting.newFileDto(project,"FILE_ID").setKey("MyComponent"));
  tester.get(ActionPlanDao.class).save(new ActionPlanDto().setKey("AP-ABCD").setName("1.0").setStatus("OPEN").setProjectId(project.getId()).setUserLogin("simon").setDeadLine(DateUtils.parseDateTime("2014-01-24T19:10:03+0000")).setCreatedAt(DateUtils.parseDateTime("2014-01-22T19:10:03+0000")).setUpdatedAt(DateUtils.parseDateTime("2014-01-23T19:10:03+0000")));
  IssueDto issue=IssueTesting.newDto(newRule(),file,project).setKee("82fd47d4-b650-4037-80bc-7b112bd4eac2").setActionPlanKey("AP-ABCD");
  db.issueDao().insert(session,issue);
  session.commit();
  tester.get(IssueIndexer.class).indexAll();
  WsTester.Result result=wsTester.newGetRequest(IssuesWs.API_ENDPOINT,Search2Action.SEARCH_ACTION).setParam("additionalFields","actionPlans").execute();
  result.assertJson(this.getClass(),"issue_with_action_plan.json");
}
