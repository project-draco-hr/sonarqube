{
  ComponentDto project=insertComponent(ComponentTesting.newProjectDto("PROJECT_ID").setKey("PROJECT_KEY"));
  setDefaultProjectPermission(project);
  ComponentDto file=insertComponent(ComponentTesting.newFileDto(project,"FILE_ID").setKey("FILE_KEY"));
  IssueDto issue=IssueTesting.newDto(newRule(),file,project);
  db.issueDao().insert(session,issue);
  session.commit();
  tester.get(IssueIndexer.class).indexAll();
  WsTester.Result result=wsTester.newGetRequest(IssuesWs.API_ENDPOINT,SearchAction.SEARCH_ACTION).execute();
  assertThat(result.outputAsString()).contains("\"componentId\":" + file.getId() + ",");
}
