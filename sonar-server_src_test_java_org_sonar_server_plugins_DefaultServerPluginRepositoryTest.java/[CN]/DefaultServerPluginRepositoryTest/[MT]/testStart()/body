{
  PluginDeployer deployer=mock(PluginDeployer.class);
  File pluginFile=TestUtils.getResource("/org/sonar/server/plugins/DefaultServerPluginRepositoryTest/sonar-artifact-size-plugin-0.2.jar");
  PluginMetadata plugin=DefaultPluginMetadata.create(pluginFile).setKey("artifactsize").setMainClass("org.sonar.plugins.artifactsize.ArtifactSizePlugin").addDeployedFile(pluginFile);
  when(deployer.getMetadata()).thenReturn(Arrays.asList(plugin));
  repository=new DefaultServerPluginRepository(deployer);
  repository.start();
  assertThat(repository.getPlugins().size(),Is.is(1));
  assertThat(repository.getPlugin("artifactsize"),not(nullValue()));
  assertThat(repository.getClassLoader("artifactsize"),not(nullValue()));
  assertThat(repository.getClass("artifactsize","org.sonar.plugins.artifactsize.ArtifactSizeMetrics"),not(nullValue()));
  assertThat(repository.getClass("artifactsize","org.Unknown"),nullValue());
  assertThat(repository.getClass("other","org.sonar.plugins.artifactsize.ArtifactSizeMetrics"),nullValue());
}
