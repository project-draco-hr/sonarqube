{
  HttpRequestFactory requestFactory=mock(HttpRequestFactory.class);
  when(requestFactory.post(eq("/api/server/setup"),anyMap())).thenReturn(RUNNING_JSON,DONE_JSON);
  DefaultSystemClient client=new DefaultSystemClient(requestFactory);
  Migration migration=client.migrate(500L,5L);
  assertThat(migration.status()).isEqualTo(Migration.Status.MIGRATION_SUCCEEDED);
  assertThat(migration.operationalWebapp()).isTrue();
  assertThat(migration.message()).isEqualTo("done");
  assertThat(migration.startedAt()).isNull();
}
