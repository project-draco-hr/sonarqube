{
  if (shouldDecorateResource(resource)) {
    resetQuery(context.getProject(),resource);
    List<Object[]> fields=timeMachine.getMeasuresFields(query);
    ListMultimap<Metric,Double> valuesPerMetric=ArrayListMultimap.create();
    for (    Object[] field : fields) {
      valuesPerMetric.put((Metric)field[1],(Double)field[2]);
    }
    for (    Metric metric : query.getMetrics()) {
      Measure measure=context.getMeasure(metric);
      if (measure != null) {
        List<Double> values=valuesPerMetric.get(metric);
        values.add(measure.getValue());
        measure.setTendency(analyser.analyseLevel(valuesPerMetric.get(metric)));
        context.saveMeasure(measure);
      }
    }
  }
}
