{
  Period period=newPeriod(3,1500000000000L);
  periodsHolder.setPeriods(period);
  sut.beforeComponent(FILE1,tracking);
  sut.onIssue(FILE1,createIssueAt(null,STATUS_OPEN,BLOCKER,period.getSnapshotDate() - 1000000L));
  sut.onIssue(FILE1,createIssueAt(null,STATUS_OPEN,BLOCKER,period.getSnapshotDate()));
  sut.onIssue(FILE1,createIssueAt(null,STATUS_OPEN,CRITICAL,period.getSnapshotDate() + 100000L));
  sut.onIssue(FILE1,createIssueAt(RESOLUTION_FIXED,STATUS_CLOSED,MAJOR,period.getSnapshotDate() + 200000L));
  sut.afterComponent(FILE1);
  sut.beforeComponent(FILE2,tracking);
  sut.afterComponent(FILE2);
  sut.beforeComponent(PROJECT,tracking);
  sut.afterComponent(PROJECT);
  assertVariation(FILE1,NEW_ISSUES_METRIC,period.getIndex(),1);
  assertVariation(FILE1,NEW_CRITICAL_ISSUES_METRIC,period.getIndex(),1);
  assertThat(measureRepository.getRawMeasure(FILE1,NEW_BLOCKER_ISSUES_METRIC).isPresent()).isFalse();
  assertThat(measureRepository.getRawMeasure(FILE1,NEW_MAJOR_ISSUES_METRIC).isPresent()).isFalse();
  assertVariation(PROJECT,NEW_ISSUES_METRIC,period.getIndex(),1);
  assertVariation(PROJECT,NEW_CRITICAL_ISSUES_METRIC,period.getIndex(),1);
  assertThat(measureRepository.getRawMeasure(PROJECT,NEW_BLOCKER_ISSUES_METRIC).isPresent()).isFalse();
  assertThat(measureRepository.getRawMeasure(PROJECT,NEW_MAJOR_ISSUES_METRIC).isPresent()).isFalse();
}
