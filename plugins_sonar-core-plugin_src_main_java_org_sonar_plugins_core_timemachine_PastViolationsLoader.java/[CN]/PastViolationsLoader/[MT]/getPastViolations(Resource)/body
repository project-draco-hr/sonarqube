{
  if (resource == null) {
    return Collections.emptyList();
  }
  Snapshot snapshot=resourcePersister.getSnapshot(resource);
  if (snapshot == null) {
    throw new SonarException("This resource has no snapshot ???" + resource);
  }
  Snapshot previousLastSnapshot=resourcePersister.getLastSnapshot(snapshot,true);
  if (previousLastSnapshot == null) {
    return Collections.emptyList();
  }
  return session.getResults(RuleFailureModel.class,"snapshotId",previousLastSnapshot.getId());
}
