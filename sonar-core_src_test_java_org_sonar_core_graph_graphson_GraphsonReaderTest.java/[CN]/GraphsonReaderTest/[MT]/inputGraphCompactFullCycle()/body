{
  TinkerGraph graph=TinkerGraphFactory.createTinkerGraph();
  ByteArrayOutputStream stream=new ByteArrayOutputStream();
  Set<String> edgeKeys=new HashSet<String>();
  edgeKeys.add(GraphonTokens._ID);
  edgeKeys.add(GraphonTokens._IN_V);
  edgeKeys.add(GraphonTokens._OUT_V);
  edgeKeys.add(GraphonTokens._LABEL);
  Set<String> vertexKeys=new HashSet<String>();
  vertexKeys.add(GraphonTokens._ID);
  GraphonWriter writer=new GraphonWriter();
  writer.write(graph,stream,GraphonMode.EXTENDED,vertexKeys,edgeKeys);
  stream.flush();
  stream.close();
  String jsonString=new String(stream.toByteArray());
  byte[] bytes=jsonString.getBytes();
  InputStream inputStream=new ByteArrayInputStream(bytes);
  TinkerGraph emptyGraph=new TinkerGraph();
  new GraphonReader().read(inputStream,emptyGraph);
  Assert.assertEquals(6,getIterableCount(emptyGraph.getVertices()));
  Assert.assertEquals(6,getIterableCount(emptyGraph.getEdges()));
  for (  Vertex v : graph.getVertices()) {
    Vertex found=emptyGraph.getVertex(v.getId());
    Assert.assertNotNull(v);
    for (    String key : found.getPropertyKeys()) {
      Assert.assertEquals(v.getProperty(key),found.getProperty(key));
    }
    Assert.assertEquals(null,found.getProperty("name"));
  }
  for (  Edge e : graph.getEdges()) {
    Edge found=emptyGraph.getEdge(e.getId());
    Assert.assertNotNull(e);
    for (    String key : found.getPropertyKeys()) {
      Assert.assertEquals(e.getProperty(key),found.getProperty(key));
    }
    Assert.assertEquals(null,found.getProperty("weight"));
  }
}
