{
  setServerProperty(orchestrator,"sonar.security.savePassword","true");
  String login=USER_LOGIN;
  String oldPassword="1234567";
  Map<String,String> users=Maps.newHashMap();
  users.put(login + ".password",oldPassword);
  updateUsersInExtAuth(users);
  assertThat(loginAttempt(login,oldPassword)).isEqualTo(AUTHORIZED);
  String newPassword="7654321";
  users.put(login + ".password",newPassword);
  updateUsersInExtAuth(users);
  assertThat(loginAttempt(login,newPassword)).isEqualTo(AUTHORIZED);
  assertThat(loginAttempt(login,oldPassword)).isEqualTo(NOT_AUTHORIZED);
  assertThat(loginAttempt(login,"wrong")).isEqualTo(NOT_AUTHORIZED);
  users.remove(login + ".password");
  updateUsersInExtAuth(users);
  assertThat(loginAttempt(login,newPassword)).isEqualTo(AUTHORIZED);
  assertThat(loginAttempt(login,oldPassword)).isEqualTo(NOT_AUTHORIZED);
  assertThat(loginAttempt(login,"wrong")).isEqualTo(NOT_AUTHORIZED);
}
