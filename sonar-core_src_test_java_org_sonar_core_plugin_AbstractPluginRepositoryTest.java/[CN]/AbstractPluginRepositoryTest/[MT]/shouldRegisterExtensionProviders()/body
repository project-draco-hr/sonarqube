{
  MutablePicoContainer pico=IocContainer.buildPicoContainer();
  AbstractPluginRepository repository=new AbstractPluginRepository(){
    @Override protected boolean shouldRegisterExtension(    String pluginKey,    Object extension){
      return isType(extension,ServerExtension.class);
    }
  }
;
  Plugin plugin=mock(Plugin.class);
  BProvider bProvider=new BProvider();
  when(plugin.getExtensions()).thenReturn(Arrays.asList(A.class,bProvider,C.class,D.class));
  repository.registerPlugin(pico,plugin,"foo");
  pico.start();
  assertThat(pico.getComponent(A.class),is(A.class));
  assertThat(pico.getComponent(C.class),is(C.class));
  assertThat(pico.getComponent(D.class),is(D.class));
  assertThat(pico.getComponent(C.class).getBees().length,is(2));
  assertThat(pico.getComponent(D.class).getBees().length,is(2));
  assertThat(bProvider.calls,is(1));
}
