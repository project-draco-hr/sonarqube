{
  DbSession dbSession=dbClient.openSession(false);
  try {
    ComponentDto project=searchProject(dbSession,dbClient,request);
    checkPermissions(userSession,project);
    List<MetricDto> metrics=searchMetrics(dbSession,project);
    writeResponse(response.newJsonWriter(),metrics);
  }
  finally {
    MyBatis.closeQuietly(dbSession);
  }
}
