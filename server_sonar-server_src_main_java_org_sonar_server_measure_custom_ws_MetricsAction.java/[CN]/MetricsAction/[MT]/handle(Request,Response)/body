{
  DbSession dbSession=dbClient.openSession(false);
  try {
    ComponentDto project=componentFinder.getByKeyOrUuid(dbSession,request.param(CreateAction.PARAM_PROJECT_ID),request.param(CreateAction.PARAM_PROJECT_KEY));
    checkPermissions(userSession,project);
    List<MetricDto> metrics=searchMetrics(dbSession,project);
    writeResponse(response.newJsonWriter(),metrics);
  }
  finally {
    MyBatis.closeQuietly(dbSession);
  }
}
