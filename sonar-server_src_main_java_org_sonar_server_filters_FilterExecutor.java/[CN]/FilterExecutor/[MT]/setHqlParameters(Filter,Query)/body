{
  query.setParameter("status",Snapshot.STATUS_PROCESSED);
  query.setParameter("islast",true);
  if (filter.hasScopes()) {
    query.setParameter("scopes",filter.getScopes());
  }
  if (filter.hasQualifiers()) {
    query.setParameter("qualifiers",filter.getQualifiers());
  }
  if (filter.hasLanguages()) {
    query.setParameter("languages",filter.getLanguages());
  }
  if (filter.hasFavouriteIds()) {
    query.setParameter("favourites",filter.getFavouriteIds());
  }
  if (filter.getDateCriterion() != null) {
    query.setParameter("date",filter.getDateCriterion().getDate());
  }
  if (filter.hasBaseSnapshot()) {
    if (filter.isOnDirectChildren()) {
      query.setParameter("parent_sid",filter.getBaseSnapshotId());
    }
 else {
      query.setParameter("root_sid",filter.getRootSnapshotId());
      query.setParameter("path",new StringBuilder().append(filter.getBaseSnapshotPath()).append(filter.getBaseSnapshotId()).append(".%").toString());
    }
  }
  if (StringUtils.isNotBlank(filter.getKeyRegexp())) {
    query.setParameter("kee",StringUtils.upperCase(StringUtils.replaceChars(filter.getKeyRegexp(),'*','%')));
  }
  if (StringUtils.isNotBlank(filter.getNameRegexp())) {
    query.setParameter("name",StringUtils.upperCase(StringUtils.replaceChars(filter.getNameRegexp(),'*','%')));
  }
}
