{
  UserSession.get().checkComponentPermission(UserRole.ADMIN,projectOrModuleKey);
  DbSession session=dbClient.openSession(false);
  try {
    AuthorizedComponentDto projectOrModule=getByKey(projectOrModuleKey);
    ResourceDto oldRootProject=dbClient.resourceDao().getRootProjectByComponentKey(session,projectOrModuleKey);
    resourceKeyUpdaterDao.updateKey(projectOrModule.getId(),newKey);
    session.commit();
    String newRootProjectKey=getRootProjectKeyByComponentKey(session,newKey);
    updateIssuesIndex(session,oldRootProject.getKey(),newRootProjectKey);
    previewCache.reportResourceModification(newRootProjectKey);
    session.commit();
  }
  finally {
    session.close();
  }
}
