{
  ResourceIndexerDao indexerDao=mock(ResourceIndexerDao.class);
  ServerUpgradeStatus status=mock(ServerUpgradeStatus.class);
  when(status.isUpgraded()).thenReturn(true);
  when(status.isFreshInstall()).thenReturn(false);
  when(status.getInitialDbVersion()).thenReturn(SchemaMigration.VERSION_2_13 - 10);
  new IndexProjects(status,indexerDao).start();
  verify(indexerDao).index(argThat(new BaseMatcher<ResourceIndexerFilter>(){
    public boolean matches(    Object o){
      ResourceIndexerFilter filter=(ResourceIndexerFilter)o;
      return filter.getScopes().length == 1 && filter.getScopes()[0].equals(Scopes.PROJECT);
    }
    public void describeTo(    Description description){
    }
  }
));
}
