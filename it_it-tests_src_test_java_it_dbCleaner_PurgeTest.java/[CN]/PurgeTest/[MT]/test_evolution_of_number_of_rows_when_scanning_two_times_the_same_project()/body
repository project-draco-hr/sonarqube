{
  Date today=new Date();
  Date yesterday=DateUtils.addDays(today,-1);
  scan(PROJECT_SAMPLE_PATH,DateFormatUtils.ISO_DATE_FORMAT.format(yesterday));
  collector.checkThat("Wrong number of projects",count("projects where qualifier in ('TRK','BRC')"),equalTo(7));
  collector.checkThat("Wrong number of directories",count("projects where qualifier in ('DIR')"),equalTo(4));
  collector.checkThat("Wrong number of files",count("projects where qualifier in ('FIL')"),equalTo(4));
  collector.checkThat("Wrong number of unit test files",count("projects where qualifier in ('UTS')"),equalTo(0));
  int measuresOnTrk=47;
  int measuresOnBrc=234;
  int measuresOnDir=117;
  int measuresOnFil=69;
  logMeasures("First analysis - TRK measures","TRK");
  logMeasures("First analysis - BRC measures","BRC");
  assertMeasuresCountForQualifier("TRK",measuresOnTrk);
  assertMeasuresCountForQualifier("BRC",measuresOnBrc);
  assertMeasuresCountForQualifier("DIR",measuresOnDir);
  assertMeasuresCountForQualifier("FIL",measuresOnFil);
  collector.checkThat("Wrong number of measure of new_ metrics",count("project_measures, metrics where metrics.id = project_measures.metric_id and metrics.name like 'new_%'"),equalTo(0));
  int expectedMeasures=measuresOnTrk + measuresOnBrc + measuresOnDir+ measuresOnFil;
  collector.checkThat("Wrong number of measures",count("project_measures"),equalTo(expectedMeasures));
  collector.checkThat("Wrong number of measure data",count("project_measures where measure_data is not null"),equalTo(0));
  int expectedIssues=52;
  collector.checkThat("Wrong number of issues",count("issues"),equalTo(expectedIssues));
  scan(PROJECT_SAMPLE_PATH,DateFormatUtils.ISO_DATE_FORMAT.format(today));
  int newMeasuresOnTrk=53;
  int newMeasuresOnBrc=274;
  int newMeasuresOnDir=32;
  int newMeasuresOnFil=0;
  logMeasures("Second analysis - TRK measures","TRK");
  logMeasures("Second analysis - BRC measures","BRC");
  logMeasures("Second analysis ??? DIR measures","DIR");
  assertMeasuresCountForQualifier("TRK",measuresOnTrk + newMeasuresOnTrk);
  assertMeasuresCountForQualifier("BRC",measuresOnBrc + newMeasuresOnBrc);
  assertMeasuresCountForQualifier("DIR",measuresOnDir + newMeasuresOnDir);
  assertMeasuresCountForQualifier("FIL",measuresOnFil + newMeasuresOnFil);
  collector.checkThat("Wrong number of measure of new_ metrics",count("project_measures, metrics where metrics.id = project_measures.metric_id and metrics.name like 'new_%'"),equalTo(88));
  expectedMeasures+=newMeasuresOnTrk + newMeasuresOnBrc + newMeasuresOnDir+ newMeasuresOnFil;
  collector.checkThat("Wrong number of measures after second analysis",count("project_measures"),equalTo(expectedMeasures));
  collector.checkThat("Wrong number of measure data",count("project_measures where measure_data is not null"),equalTo(0));
  collector.checkThat("Wrong number of issues",count("issues"),equalTo(expectedIssues));
}
