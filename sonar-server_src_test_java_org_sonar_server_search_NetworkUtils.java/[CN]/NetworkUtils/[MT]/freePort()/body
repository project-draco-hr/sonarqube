{
  for (int index=0; index < 5; index++) {
    try {
      ServerSocket socket=new ServerSocket(0);
      int unusedPort=socket.getLocalPort();
      socket.close();
      if (isValidPort(unusedPort)) {
        return unusedPort;
      }
    }
 catch (    IOException e) {
      throw new IllegalStateException("Can not find an open network port",e);
    }
  }
  throw new IllegalStateException("Can not find an open network port");
}
