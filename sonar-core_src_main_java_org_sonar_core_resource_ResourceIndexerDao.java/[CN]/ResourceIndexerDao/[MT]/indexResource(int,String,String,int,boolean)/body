{
  boolean indexed=false;
  if (force || isIndexableQualifier(qualifier)) {
    SqlSession session=mybatis.openSession();
    try {
      String key=nameToKey(name);
      if (key.length() >= MINIMUM_KEY_SIZE) {
        indexed=true;
        ResourceIndexerMapper mapper=session.getMapper(ResourceIndexerMapper.class);
        boolean toBeIndexed=sanitizeIndex(id,key,mapper);
        if (toBeIndexed) {
          ResourceIndexDto dto=new ResourceIndexDto().setResourceId(id).setQualifier(qualifier).setRootProjectId(rootId).setNameSize(name.length());
          for (int position=0; position <= key.length() - MINIMUM_KEY_SIZE; position++) {
            dto.setPosition(position);
            dto.setKey(StringUtils.substring(key,position));
            mapper.insert(dto);
          }
          session.commit();
        }
      }
    }
  finally {
      MyBatis.closeQuietly(session);
    }
  }
  return indexed;
}
