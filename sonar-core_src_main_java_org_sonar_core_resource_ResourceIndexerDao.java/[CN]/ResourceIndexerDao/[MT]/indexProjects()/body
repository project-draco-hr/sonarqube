{
  final DbSession session=mybatis.openSession(true);
  try {
    final ResourceIndexerMapper mapper=session.getMapper(ResourceIndexerMapper.class);
    session.select("org.sonar.core.resource.ResourceIndexerMapper.selectRootProjectIds",ResourceIndexerQuery.create(),new ResultHandler(){
      public void handleResult(      ResultContext context){
        Integer rootProjectId=(Integer)context.getResultObject();
        doIndexProject(rootProjectId,session,mapper);
        session.commit();
      }
    }
);
    return this;
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
