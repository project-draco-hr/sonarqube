{
  Date oldDate=DateUtils.parseDate("2014-01-01");
  characteristics.addRootCharacteristic(new DefaultDebtCharacteristic().setKey("PORTABILITY").setName("Portability").setOrder(1)).addSubCharacteristic(new DefaultDebtCharacteristic().setKey("COMPILER").setName("Compiler"),"PORTABILITY");
  when(dao.selectEnabledCharacteristics()).thenReturn(newArrayList(new CharacteristicDto().setId(1).setKey("PORTABILITY").setName("Portability").setOrder(1).setCreatedAt(oldDate),new CharacteristicDto().setId(2).setKey("COMPILER").setName("Compiler").setParentId(1).setCreatedAt(oldDate)));
  rules.add(new DebtRulesXMLImporter.RuleDebt().setRuleKey(RuleKey.of("squid","UselessImportCheck")).setCharacteristicKey("COMPILER").setFunction(DebtRemediationFunction.Type.LINEAR).setFactor("2h"));
  when(ruleDao.selectEnablesAndNonManual(session)).thenReturn(newArrayList(new RuleDto().setId(1).setRepositoryKey("squid").setRuleKey("UselessImportCheck").setDefaultCharacteristicId(10).setDefaultRemediationFunction("LINEAR").setDefaultRemediationFactor("2h").setCreatedAt(oldDate).setUpdatedAt(oldDate),new RuleDto().setId(2).setRepositoryKey("checkstyle").setCharacteristicId(3).setRemediationFunction("LINEAR").setRemediationFactor("2h").setCreatedAt(oldDate).setUpdatedAt(oldDate)));
  RuleRepositories.Repository squid=mock(RuleRepositories.Repository.class);
  when(squid.getKey()).thenReturn("squid");
  when(ruleRepositories.repositoriesForLang("java")).thenReturn(newArrayList(squid));
  debtModelRestore.restoreFromXml("<xml/>","java");
  verify(ruleDao).selectEnablesAndNonManual(session);
  ArgumentCaptor<RuleDto> ruleArgument=ArgumentCaptor.forClass(RuleDto.class);
  verify(ruleDao).update(ruleArgument.capture(),eq(session));
  verifyNoMoreInteractions(ruleDao);
  RuleDto rule=ruleArgument.getValue();
  assertThat(rule.getId()).isEqualTo(1);
  verify(session).commit();
}
