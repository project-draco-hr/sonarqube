{
  DbSession session=db.openSession(false);
  try {
    int i=0;
    Migration44Mapper mapper=session.getMapper(Migration44Mapper.class);
    for (    ProfileMeasure profileMeasure : mapper.selectProfileMeasures()) {
      int version=mapper.selectProfileVersion(profileMeasure.getSnapshotId());
      QProfileDto44 profile=mapper.selectProfileById(profileMeasure.getProfileId());
      if (profile != null) {
        Date date=(Date)ObjectUtils.defaultIfNull(mapper.selectProfileVersionDate(profileMeasure.getProfileId(),version),new Date());
        StringWriter writer=new StringWriter();
        JsonWriter json=JsonWriter.of(writer);
        json.beginArray().beginObject().prop("key",profile.getKee()).prop("language",profile.getLanguage()).prop("name",profile.getName()).prop("rulesUpdatedAt",UtcDateUtils.formatDateTime(date)).endObject().endArray().close();
        mapper.updateProfileMeasure(profileMeasure.getId(),writer.toString());
        if (i % 100 == 0) {
          session.commit();
          i++;
        }
      }
    }
    session.commit();
  }
  finally {
    session.close();
  }
}
