{
  QualityProfileDto profileDto=QProfileTesting.newXooP1();
  db.qualityProfileDao().insert(dbSession,profileDto);
  int nb=100;
  for (int i=0; i < nb; i++) {
    RuleDto rule=newRuleDto(RuleKey.of("xoo","S00" + i));
    db.deprecatedRuleDao().insert(dbSession,rule);
    ActiveRuleDto activeRule=ActiveRuleDto.createFor(profileDto,rule).setSeverity(Severity.MAJOR);
    db.deprecatedActiveRuleDao().insert(dbSession,activeRule);
  }
  dbSession.commit();
  dbSession.clearCache();
  Collection<ActiveRule> activeRules=Lists.newArrayList(index.get(ActiveRuleIndex.class).findByProfile(profileDto.getKey()));
  assertThat(activeRules).hasSize(nb);
}
