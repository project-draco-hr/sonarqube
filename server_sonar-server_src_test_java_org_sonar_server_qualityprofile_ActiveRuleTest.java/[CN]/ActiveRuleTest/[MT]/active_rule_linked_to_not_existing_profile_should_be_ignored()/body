{
  QualityProfileDto profile=QProfileTesting.newXooP1();
  db.qualityProfileDao().insert(dbSession,profile);
  RuleDto rule=RuleDto.createFor(RuleTesting.XOO_X1).setSeverity(Severity.MAJOR);
  db.deprecatedRuleDao().insert(dbSession,rule);
  ActiveRuleDto activeRule=ActiveRuleDto.createFor(profile,rule).setSeverity("BLOCKER");
  db.activeRuleDao().insert(dbSession,activeRule);
  dbSession.commit();
  executeSql(String.format("DELETE FROM rules_profiles WHERE id=%s",profile.getId()));
  dbSession.commit();
  tester.clearIndexes();
  db.activeRuleDao().synchronizeAfter(dbSession,new Date(0L));
  dbSession.commit();
  assertThat(index.get(ActiveRuleIndex.class).getNullableByKey(activeRule.getKey())).isNull();
}
