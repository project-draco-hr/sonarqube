{
  setupData("sharedFixture");
  ServerUpgradeStatus upgradeStatus=mock(ServerUpgradeStatus.class);
  final DeleteDeprecatedMeasures purge=new DeleteDeprecatedMeasures(getSessionFactory(),upgradeStatus);
  purge.doPurge();
  List rowsToDelete=getSession().createQuery("from " + MeasureModel.class.getSimpleName() + " where ruleId is null and rulePriority is not null").getResultList();
  assertThat(rowsToDelete.size(),is(0));
  List<Long> rowIdsToKeep=getSession().createQuery("select id from " + MeasureModel.class.getSimpleName()).getResultList();
  assertThat(rowIdsToKeep,hasItems(1L,2L,4L,6L));
}
