{
  Rule rule=SQUID_RULE;
  ActiveRule activeRule=mock(ActiveRule.class);
  when(activeRule.getRule()).thenReturn(rule);
  when(activeRule.getSeverity()).thenReturn(RulePriority.INFO);
  when(qProfile.getActiveRule("squid","AvoidCycle")).thenReturn(activeRule);
  when(ruleFinder.findByKey(SQUID_RULE_KEY)).thenReturn(rule);
  Date analysisDate=new Date();
  when(project.getAnalysisDate()).thenReturn(analysisDate);
  DefaultIssue issue=new DefaultIssue().setKey("ABCDE").setRuleKey(SQUID_RULE_KEY).setSeverity(Severity.CRITICAL);
  WorkDuration debt=WorkDuration.createFromValueAndUnit(10,WorkDuration.UNIT.DAYS,8);
  when(technicalDebtCalculator.calculateTechnicalDebt(issue.ruleKey(),issue.effortToFix())).thenReturn(debt);
  when(filters.accept(issue,null)).thenReturn(true);
  moduleIssues.initAndAddIssue(issue);
  ArgumentCaptor<DefaultIssue> argument=ArgumentCaptor.forClass(DefaultIssue.class);
  verify(cache).put(argument.capture());
  assertThat(argument.getValue().technicalDebt()).isEqualTo(debt);
}
