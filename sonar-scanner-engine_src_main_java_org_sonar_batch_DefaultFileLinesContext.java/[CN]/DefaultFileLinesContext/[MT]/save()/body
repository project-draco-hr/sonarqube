{
  for (  Map.Entry<String,Map<Integer,Object>> entry : map.entrySet()) {
    String metricKey=entry.getKey();
    Map<Integer,Object> lines=entry.getValue();
    if (shouldSave(lines)) {
      String data=KeyValueFormat.format(optimizeStorage(metricKey,lines));
      context.newMeasure().on(inputFile).forMetric(metricFinder.findByKey(metricKey)).withValue(data).save();
      entry.setValue(ImmutableMap.copyOf(lines));
    }
  }
}
