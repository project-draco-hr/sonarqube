{
  String projectKey=issue.projectKey();
  if (projectKey == null) {
    throw new IllegalStateException(String.format("Issue '%s' has no project key",issue.key()));
  }
  issueStorage.save(session,issue);
  Rule rule=getNullableRuleByKey(issue.ruleKey());
  notificationService.scheduleForSending(new IssueChangeNotification().setIssue(issue).setChangeAuthorLogin(context.login()).setRuleName(rule != null ? rule.getName() : null).setProject(dbClient.componentDao().getByKey(session,projectKey)).setComponent(dbClient.componentDao().getNullableByKey(session,issue.componentKey())).setComment(comment));
}
