{
  String projectKey=issue.projectKey();
  if (projectKey == null) {
    throw new IllegalStateException(String.format("Issue '%s' has no project key",issue.key()));
  }
  issueStorage.save(session,issue);
  Rule rule=getNullableRuleByKey(issue.ruleKey());
  ComponentDto project=dbClient.componentDao().selectByKey(session,projectKey);
  notificationService.scheduleForSending(new IssueChangeNotification().setIssue(issue).setChangeAuthorLogin(context.login()).setRuleName(rule != null ? rule.getName() : null).setProject(project.getKey(),project.name()).setComponent(dbClient.componentDao().selectNullableByKey(session,issue.componentKey())).setComment(comment));
}
