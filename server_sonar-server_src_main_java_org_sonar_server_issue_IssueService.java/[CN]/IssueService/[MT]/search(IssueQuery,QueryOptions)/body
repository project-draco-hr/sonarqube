{
  IssueIndex issueIndex=indexClient.get(IssueIndex.class);
  SearchResponse esResults=issueIndex.search(query,options);
  IssueResult result=new IssueResult(issueIndex,esResults);
  result.setPaging(Paging.create(options.getLimit(),(options.getOffset() * options.getLimit()) + 1,new Long(esResults.getHits().getTotalHits()).intValue()));
  DbSession session=dbClient.openSession(false);
  try {
    for (    Issue issue : result.getHits()) {
      result.addProject(issue.key(),dbClient.componentDao().getByKey(session,issue.projectKey()));
      result.addComponent(issue.key(),dbClient.componentDao().getByKey(session,issue.componentKey()));
    }
  }
  finally {
    session.close();
  }
  return result;
}
