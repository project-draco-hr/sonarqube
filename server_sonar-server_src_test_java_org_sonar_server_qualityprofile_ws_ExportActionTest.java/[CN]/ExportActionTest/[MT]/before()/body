{
  qualityProfileDao=new QualityProfileDao(db.myBatis(),mock(System2.class));
  dbClient=new DbClient(db.database(),db.myBatis(),qualityProfileDao);
  session=dbClient.openSession(false);
  backuper=mock(QProfileBackuper.class);
  db.truncateTables();
  ProfileExporter exporter1=newExporter("polop");
  ProfileExporter exporter2=newExporter("palap");
  ActiveRuleIndex2 activeRuleIndex=mock(ActiveRuleIndex2.class);
  when(activeRuleIndex.findByProfile(Matchers.anyString())).thenReturn(Sets.<ActiveRuleDoc>newHashSet().iterator());
  exporters=new QProfileExporters(new QProfileLoader(dbClient,activeRuleIndex,mock(RuleIndex2.class)),null,null,new ProfileExporter[]{exporter1,exporter2},null);
  wsTester=new WsTester(new QProfilesWs(mock(RuleActivationActions.class),mock(BulkRuleActivationActions.class),mock(ProjectAssociationActions.class),new ExportAction(dbClient,new QProfileFactory(dbClient),backuper,exporters,LanguageTesting.newLanguages("xoo"))));
}
