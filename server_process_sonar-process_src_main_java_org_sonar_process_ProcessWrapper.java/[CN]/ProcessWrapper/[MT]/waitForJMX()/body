{
  String loopbackAddress=localAddress();
  String path="/jndi/rmi://" + loopbackAddress + ":"+ jmxPort+ "/jmxrmi";
  JMXServiceURL jmxUrl=null;
  try {
    jmxUrl=new JMXServiceURL("rmi",loopbackAddress,jmxPort,path);
  }
 catch (  MalformedURLException e) {
    throw new IllegalStateException("JMX url does not look well formed",e);
  }
  for (int i=0; i < 5; i++) {
    try {
      Thread.sleep(1000L);
      LOGGER.debug("Try #{} to connect to JMX server for process '{}'",i,processName);
      JMXConnector jmxConnector=JMXConnectorFactory.connect(jmxUrl,null);
      jmxConnector.addConnectionNotificationListener(new NotificationListener(){
        @Override public void handleNotification(        Notification notification,        Object handback){
          LOGGER.info("JMX Connection Notification:{}",notification.getMessage());
        }
      }
,null,null);
      MBeanServerConnection mBeanServer=jmxConnector.getMBeanServerConnection();
      ProcessMXBean bean=JMX.newMBeanProxy(mBeanServer,JmxUtils.objectName(processName),ProcessMXBean.class);
      return bean;
    }
 catch (    Exception ignored) {
      LOGGER.trace("Could not connect JMX yet",ignored);
    }
  }
  return null;
}
