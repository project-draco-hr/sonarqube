{
  referenceViolationsMap.clear();
  ViolationQuery violationQuery=ViolationQuery.create().forResource(resource).setSwitchMode(ViolationQuery.SwitchMode.BOTH);
  if (!context.getViolations(violationQuery).isEmpty()) {
    return;
  }
  String source=index.getSource(resource);
  String referenceSource=referenceAnalysis.getSource(resource);
  List<Violation> newViolations=prepareNewViolations(context,source);
  List<RuleFailureModel> referenceViolations=referenceAnalysis.getViolations(resource);
  ViolationTrackingBlocksRecognizer rec=null;
  if (source != null && referenceSource != null) {
    rec=new ViolationTrackingBlocksRecognizer(referenceSource,source);
  }
  mapViolations(newViolations,referenceViolations,rec);
}
