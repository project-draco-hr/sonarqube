{
  String selectEventsSql="SELECT e.id FROM " + Event.class.getSimpleName() + " e WHERE (";
  selectEventsSql+="e.resourceId IS NOT NULL AND NOT EXISTS(FROM " + ResourceModel.class.getSimpleName() + " r WHERE r.id=e.resourceId)";
  selectEventsSql+=") OR (";
  selectEventsSql+="e.snapshot IS NULL";
  selectEventsSql+=") OR (";
  selectEventsSql+="e.snapshot IS NOT NULL AND NOT EXISTS(FROM " + Snapshot.class.getSimpleName() + " s WHERE s.id=e.snapshot)";
  selectEventsSql+=")";
  Query query=getSession().createQuery(selectEventsSql);
  final List<Integer> eventIds=query.getResultList();
  PurgeUtils.executeQuery(getSession(),"",eventIds,"DELETE FROM " + Event.class.getSimpleName() + " WHERE id in (:ids)");
}
