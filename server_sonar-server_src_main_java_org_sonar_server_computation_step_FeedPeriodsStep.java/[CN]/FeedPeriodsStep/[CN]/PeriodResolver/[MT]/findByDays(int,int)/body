{
  List<SnapshotDto> snapshots=dbClient.snapshotDao().selectSnapshotsByQuery(session,createCommonQuery(projectId).setCreatedBefore(analysisDate).setSort(BY_DATE,ASC));
  long targetDate=DateUtils.addDays(new Date(analysisDate),-days).getTime();
  SnapshotDto snapshot=findNearestSnapshotToTargetDate(snapshots,targetDate);
  if (snapshot == null) {
    return null;
  }
  LOG.debug(String.format("Compare over %s days (%s, analysis of %s)",String.valueOf(days),formatDate(targetDate),formatDate(snapshot.getCreatedAt())));
  return new Period(index,CoreProperties.TIMEMACHINE_MODE_DAYS,String.valueOf(days),snapshot.getCreatedAt());
}
