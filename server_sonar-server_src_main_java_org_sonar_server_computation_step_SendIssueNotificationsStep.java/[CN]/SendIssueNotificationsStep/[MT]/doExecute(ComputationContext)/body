{
  NewIssuesNotification.Stats newIssueStats=new NewIssuesNotification.Stats();
  CloseableIterator<DefaultIssue> issues=issueCache.traverse();
  try {
    while (issues.hasNext()) {
      DefaultIssue issue=issues.next();
      if (issue.isNew() && issue.resolution() == null) {
        newIssueStats.add(issue);
      }
 else       if (issue.isChanged() && issue.mustSendNotifications()) {
        IssueChangeNotification changeNotification=new IssueChangeNotification();
        changeNotification.setRuleName(rules.ruleName(issue.ruleKey()));
        changeNotification.setIssue(issue);
        changeNotification.setProject(context.getProject());
        service.deliver(changeNotification);
      }
    }
  }
  finally {
    issues.close();
  }
  sendNewIssuesStatistics(context,newIssueStats);
}
