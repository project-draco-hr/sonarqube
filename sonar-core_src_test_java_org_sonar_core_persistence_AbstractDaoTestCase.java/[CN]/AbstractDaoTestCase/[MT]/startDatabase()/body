{
  if (database == null) {
    Settings settings=new Settings().setProperties(Maps.fromProperties(System.getProperties()));
    if (settings.hasKey("orchestrator.configUrl")) {
      loadOrchestratorSettings(settings);
    }
    for (    String key : settings.getKeysStartingWith("sonar.jdbc")) {
      LOG.info(key + ": " + settings.getString(key));
    }
    boolean hasDialect=settings.hasKey("sonar.jdbc.dialect");
    if (hasDialect) {
      database=new DefaultDatabase(settings);
    }
 else {
      database=new H2Database("h2Tests",true);
    }
    database.start();
    LOG.info("Test Database: " + database);
    databaseCommands=DatabaseCommands.forDialect(database.getDialect());
    databaseTester=new DataSourceDatabaseTester(database.getDataSource());
    myBatis=new MyBatis(database,new Logback());
    myBatis.start();
  }
  databaseCommands.truncateDatabase(database.getDataSource());
}
