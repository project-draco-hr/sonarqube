{
  IssueDto issue1=newIssue().setActionPlanKey("P1");
  IssueDto issue2=newIssue().setActionPlanKey("P2").setResolution("NONE");
  tester.get(IssueDao.class).insert(session,issue1,issue2);
  session.commit();
  org.sonar.server.search.Result<Issue> result=service.search(IssueQuery.builder().build(),new QueryContext());
  assertThat(result.getHits()).hasSize(2);
  assertThat(result.getFacets()).isEmpty();
  result=service.search(IssueQuery.builder().build(),new QueryContext().addFacets(Arrays.asList("actionPlans","assignees")));
  assertThat(result.getFacets().keySet()).hasSize(2);
  assertThat(result.getFacetKeys("actionPlans")).hasSize(2);
  assertThat(result.getFacetKeys("assignees")).hasSize(1);
}
