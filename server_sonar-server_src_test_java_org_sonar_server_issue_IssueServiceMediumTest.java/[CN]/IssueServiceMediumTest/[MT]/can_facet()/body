{
  RuleDto rule=newRule();
  ComponentDto project=newProject();
  ComponentDto file=newFile(project);
  saveIssue(IssueTesting.newDto(rule,file,project).setActionPlanKey("P1"));
  saveIssue(IssueTesting.newDto(rule,file,project).setActionPlanKey("P2").setResolution("NONE"));
  SearchResult<IssueDoc> result=service.search(IssueQuery.builder().build(),new SearchOptions());
  assertThat(result.getDocs()).hasSize(2);
  assertThat(result.getFacets().getNames()).isEmpty();
  result=service.search(IssueQuery.builder().build(),new SearchOptions().addFacets("actionPlans","assignees"));
  assertThat(result.getFacets().getNames()).hasSize(2);
  assertThat(result.getFacets().get("actionPlans")).hasSize(2);
  assertThat(result.getFacets().get("assignees")).hasSize(1);
}
