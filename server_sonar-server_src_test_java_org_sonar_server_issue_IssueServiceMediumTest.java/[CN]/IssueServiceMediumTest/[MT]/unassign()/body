{
  RuleDto rule=newRule();
  ComponentDto project=newProject();
  ComponentDto file=newFile(project);
  MockUserSession.set().setLogin("john");
  IssueDto issue=saveIssue(IssueTesting.newDto(rule,file,project).setAssignee("perceval"));
  UserDto user=new UserDto().setLogin("perceval").setName("Perceval");
  db.userDao().insert(session,user);
  session.commit();
  index();
  assertThat(indexClient.get(IssueIndex.class).getByKey(issue.getKey()).assignee()).isEqualTo("perceval");
  service.assign(issue.getKey(),"");
  assertThat(indexClient.get(IssueIndex.class).getByKey(issue.getKey()).assignee()).isNull();
}
