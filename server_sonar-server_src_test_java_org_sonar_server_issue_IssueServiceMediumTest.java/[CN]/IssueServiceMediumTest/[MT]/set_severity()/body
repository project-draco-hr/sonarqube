{
  RuleDto rule=newRule();
  ComponentDto project=newProject();
  ComponentDto file=newFile(project);
  MockUserSession.set().setLogin("john").addProjectPermissions(UserRole.ISSUE_ADMIN,project.key());
  IssueDto issue=saveIssue(IssueTesting.newDto(rule,file,project).setSeverity(Severity.BLOCKER));
  assertThat(indexClient.get(IssueIndex.class).getByKey(issue.getKey()).severity()).isEqualTo(Severity.BLOCKER);
  service.setSeverity(issue.getKey(),Severity.MINOR);
  assertThat(indexClient.get(IssueIndex.class).getByKey(issue.getKey()).severity()).isEqualTo(Severity.MINOR);
}
