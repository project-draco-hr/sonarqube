{
  Map<String,Map<String,Collection<PropertyDef>>> byCategory=new HashMap<String,Map<String,Collection<PropertyDef>>>();
  for (  PropertyDef definition : getAll()) {
    if (qualifier == null ? definition.global() : definition.qualifiers().contains(qualifier)) {
      String category=getCategory(definition.key());
      if (!byCategory.containsKey(category)) {
        byCategory.put(category,new HashMap<String,Collection<PropertyDef>>());
      }
      String subCategory=getSubCategory(definition.key());
      if (!byCategory.get(category).containsKey(subCategory)) {
        byCategory.get(category).put(subCategory,new ArrayList<PropertyDef>());
      }
      byCategory.get(category).get(subCategory).add(definition);
    }
  }
  return byCategory;
}
