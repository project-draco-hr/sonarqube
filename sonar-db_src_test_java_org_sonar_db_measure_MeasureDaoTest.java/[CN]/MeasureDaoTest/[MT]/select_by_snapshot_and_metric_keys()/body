{
  db.prepareDbUnit(getClass(),"select_by_snapshot_and_metric_keys.xml");
  List<MeasureDto> results=underTest.selectBySnapshotIdAndMetricKeys(5,newHashSet("ncloc","authors_by_line"),db.getSession());
  assertThat(results).hasSize(2);
  results=underTest.selectBySnapshotIdAndMetricKeys(5,newHashSet("ncloc"),db.getSession());
  assertThat(results).hasSize(1);
  MeasureDto result=results.get(0);
  assertThat(result.getId()).isEqualTo(22);
  assertThat(result.getValue()).isEqualTo(10d);
  assertThat(result.getVariation(1)).isEqualTo(1d);
  assertThat(result.getVariation(2)).isEqualTo(2d);
  assertThat(result.getVariation(3)).isEqualTo(3d);
  assertThat(result.getVariation(4)).isEqualTo(4d);
  assertThat(result.getVariation(5)).isEqualTo(-5d);
  assertThat(underTest.selectBySnapshotIdAndMetricKeys(123,newHashSet("ncloc"),db.getSession())).isEmpty();
  assertThat(underTest.selectBySnapshotIdAndMetricKeys(5,Collections.<String>emptySet(),db.getSession())).isEmpty();
}
