{
  MetricDto metric=dbClient.metricDao().insert(dbSession,MetricTesting.newMetricDto());
  ComponentDto project=newProjectDto();
  SnapshotDto projectSnapshot=componentDb.insertProjectAndSnapshot(project);
  SnapshotDto fileSnapshot=componentDb.insertComponentAndSnapshot(newFileDto(project,"file-uuid"),projectSnapshot);
  ComponentDto developer=newDeveloper("Ray Bradbury");
  SnapshotDto developerSnapshot=componentDb.insertDeveloperAndSnapshot(developer);
  componentDb.insertComponentAndSnapshot(newDevProjectCopy("project-copy-uuid",project,developer),developerSnapshot);
  underTest.insert(dbSession,newMeasureDto(metric,developerSnapshot.getId()).setDeveloperId(developer.getId()),newMeasureDto(metric,projectSnapshot.getId()).setDeveloperId(developer.getId()),newMeasureDto(metric,projectSnapshot.getId()).setDeveloperId(null),newMeasureDto(metric,fileSnapshot.getId()).setDeveloperId(developer.getId()));
  dbSession.commit();
  List<MeasureDto> result=underTest.selectByDeveloperAndSnapshotIdsAndMetricIds(dbSession,developer.getId(),newArrayList(developerSnapshot.getId(),projectSnapshot.getId(),fileSnapshot.getId()),singletonList(metric.getId()));
  assertThat(result).hasSize(3).extracting("snapshotId").containsOnly(developerSnapshot.getId(),projectSnapshot.getId(),fileSnapshot.getId());
  assertThat(result).extracting("developerId").containsOnly(developer.getId());
}
