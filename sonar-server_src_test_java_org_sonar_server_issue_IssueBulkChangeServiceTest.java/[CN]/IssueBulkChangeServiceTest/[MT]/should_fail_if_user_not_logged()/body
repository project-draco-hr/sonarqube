{
  when(userSession.isLoggedIn()).thenReturn(false);
  Map<String,Object> properties=newHashMap();
  properties.put("issues","ABCD");
  properties.put("actions","assign");
  properties.put("assign.assignee","fred");
  IssueBulkChangeQuery issueBulkChangeQuery=new IssueBulkChangeQuery(properties);
  try {
    service.execute(issueBulkChangeQuery,userSession);
    fail();
  }
 catch (  Exception e) {
    assertThat(e).isInstanceOf(IllegalStateException.class).hasMessage("User is not logged in");
  }
  verifyZeroInteractions(issueUpdater);
  verifyZeroInteractions(issueStorage);
  verifyZeroInteractions(issueNotifications);
}
