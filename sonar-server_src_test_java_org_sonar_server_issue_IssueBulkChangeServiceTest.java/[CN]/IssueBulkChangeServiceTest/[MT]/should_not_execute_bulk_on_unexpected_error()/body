{
  Map<String,Object> properties=newHashMap();
  properties.put("issues","ABCD");
  properties.put("actions","assign");
  properties.put("assign.assignee","fred");
  Action action=mock(Action.class);
  when(action.key()).thenReturn("assign");
  when(action.supports(any(Issue.class))).thenReturn(true);
  when(action.verify(anyMap(),anyListOf(Issue.class),any(UserSession.class))).thenReturn(true);
  doThrow(new RuntimeException("Error")).when(action).execute(anyMap(),any(IssueBulkChangeService.ActionContext.class));
  actions.add(action);
  IssueBulkChangeQuery issueBulkChangeQuery=new IssueBulkChangeQuery(properties,true);
  IssueBulkChangeResult result=service.execute(issueBulkChangeQuery,userSession);
  assertThat(result.issuesChanged()).isEmpty();
  assertThat(result.issuesNotChanged()).hasSize(1);
  verifyZeroInteractions(issueStorage);
  verifyZeroInteractions(issueNotifications);
}
