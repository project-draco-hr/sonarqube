{
  String actionPlanKey="EFGH";
  when(actionPlanService.findByKey(actionPlanKey,userSession)).thenReturn(new DefaultActionPlan());
  IssueBulkChangeQuery issueBulkChangeQuery=IssueBulkChangeQuery.builder().issueKeys(newArrayList(issue.key())).plan(actionPlanKey).build();
  List<Issue> result=service.execute(issueBulkChangeQuery,userSession);
  assertThat(result).hasSize(1);
  verify(issueUpdater).plan(eq(issue),eq(actionPlanKey),any(IssueChangeContext.class));
  verifyNoMoreInteractions(issueUpdater);
  verify(issueStorage).save(eq(issue));
  verifyNoMoreInteractions(issueStorage);
  verify(issueNotifications).sendChanges(eq(issue),any(IssueChangeContext.class),eq(issueQueryResult));
  verifyNoMoreInteractions(issueNotifications);
}
