{
  Plugin test1=new Plugin("test1");
  Release test1R=new Release(test1,"1.0").setDownloadUrl("http://server/test1-1.0.jar");
  test1.addRelease(test1R);
  Plugin test2=new Plugin("test2");
  Release test2R=new Release(test2,"1.0").setDownloadUrl("http://server/test2-1.0.jar");
  test2.addRelease(test2R);
  Plugin testDep=new Plugin("testdep");
  Release testDepR=new Release(testDep,"1.0").setDownloadUrl("http://server/testdep-1.0.jar");
  testDep.addRelease(testDepR);
  when(updateCenter.findInstallablePlugins("test1",Version.create("1.0"))).thenReturn(newArrayList(test1R,testDepR));
  when(updateCenter.findInstallablePlugins("test2",Version.create("1.0"))).thenReturn(newArrayList(test2R,testDepR));
  pluginDownloader.start();
  pluginDownloader.download("test1",Version.create("1.0"));
  pluginDownloader.download("test2",Version.create("1.0"));
  assertThat(new File(downloadDir,"test1-1.0.jar")).exists();
  assertThat(new File(downloadDir,"test2-1.0.jar")).exists();
  assertThat(new File(downloadDir,"testdep-1.0.jar")).exists();
}
