{
  Plugin test=new Plugin("plugin-test");
  Release test10=new Release(test,"1.0").setDownloadUrl("http://server/redirect?r=release&g=test&a=test&v=1.0&e=jar");
  test.addRelease(test10);
  when(updateCenter.findInstallablePlugins("foo",Version.create("1.0"))).thenReturn(newArrayList(test10));
  pluginDownloader.start();
  pluginDownloader.download("foo",Version.create("1.0"));
  verify(httpDownloader).download(any(URI.class),argThat(new HasFileName("plugin-test-1.0.jar.tmp")));
  assertThat(new File(downloadDir,"plugin-test-1.0.jar")).exists();
  assertThat(new File(downloadDir,"plugin-test-1.0.jar.tmp")).doesNotExist();
}
