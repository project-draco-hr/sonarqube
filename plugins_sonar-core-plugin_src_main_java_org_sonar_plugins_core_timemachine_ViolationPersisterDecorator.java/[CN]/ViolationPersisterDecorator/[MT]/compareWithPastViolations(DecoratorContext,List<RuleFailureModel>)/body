{
  Multimap<Rule,RuleFailureModel> pastViolationsByRule=LinkedHashMultimap.create();
  for (  RuleFailureModel pastViolation : pastViolations) {
    Rule rule=ruleFinder.findById(pastViolation.getRuleId());
    pastViolationsByRule.put(rule,pastViolation);
  }
  for (  Violation violation : context.getViolations()) {
    RuleFailureModel pastViolation=selectPastViolation(violation,pastViolationsByRule);
    if (pastViolation != null) {
      pastViolationsByRule.remove(violation.getRule(),pastViolation);
    }
    String checksum=getChecksumForLine(checksums,violation.getLineId());
    violationPersister.saveOrUpdateViolation(context.getProject(),violation,pastViolation,checksum);
  }
}
