{
  if (criterias == null && raiseError) {
    throw new IllegalStateException("criterias parameter must be provided");
  }
  startTransaction();
  StringBuilder hql=new StringBuilder("SELECT o FROM ").append(entityClass.getSimpleName()).append(" o");
  if (criterias != null) {
    hql.append(" WHERE ");
    Map<String,Object> mappedCriterias=new HashMap<String,Object>();
    for (int i=0; i < criterias.length; i+=2) {
      mappedCriterias.put((String)criterias[i],criterias[i + 1]);
    }
    buildCriteriasHQL(hql,mappedCriterias);
    Query query=getEntityManager().createQuery(hql.toString());
    for (    Map.Entry<String,Object> entry : mappedCriterias.entrySet()) {
      query.setParameter(entry.getKey(),entry.getValue());
    }
    return query;
  }
  return getEntityManager().createQuery(hql.toString());
}
