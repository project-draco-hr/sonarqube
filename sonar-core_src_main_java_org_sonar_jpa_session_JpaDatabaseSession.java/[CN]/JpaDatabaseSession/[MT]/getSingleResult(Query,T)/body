{
  List<T> result=query.getResultList();
  if (result.size() == 1) {
    return result.get(0);
  }
 else   if (result.isEmpty()) {
    return defaultValue;
  }
 else {
    Set<T> uniqueResult=new HashSet<T>(result);
    if (uniqueResult.size() > 1) {
      throw new NonUniqueResultException("Expected single result, but got : " + result.toString());
    }
 else {
      return uniqueResult.iterator().next();
    }
  }
}
