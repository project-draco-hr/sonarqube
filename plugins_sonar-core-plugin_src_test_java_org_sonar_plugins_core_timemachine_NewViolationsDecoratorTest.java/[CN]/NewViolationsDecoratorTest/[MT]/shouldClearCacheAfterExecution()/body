{
  Violation violation1=Violation.create(rule1,resource).setSeverity(RulePriority.CRITICAL).setCreatedAt(rightNow);
  Violation violation2=Violation.create(rule2,resource).setSeverity(RulePriority.CRITICAL).setCreatedAt(rightNow);
  when(context.getViolations()).thenReturn(Arrays.asList(violation1)).thenReturn(Arrays.asList(violation2));
  decorator.decorate(resource,context);
  decorator.decorate(resource,context);
  verify(context,times(2)).saveMeasure(argThat(new IsVariationMeasure(CoreMetrics.NEW_CRITICAL_VIOLATIONS,1.0,1.0)));
  verify(context,never()).saveMeasure(argThat(new IsVariationMeasure(CoreMetrics.NEW_CRITICAL_VIOLATIONS,2.0,2.0)));
}
