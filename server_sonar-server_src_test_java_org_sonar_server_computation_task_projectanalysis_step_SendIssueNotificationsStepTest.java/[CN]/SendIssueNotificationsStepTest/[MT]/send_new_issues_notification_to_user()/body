{
  issueCache.newAppender().append(new DefaultIssue().setSeverity(Severity.BLOCKER).setEffort(ISSUE_DURATION).setAssignee(ISSUE_ASSIGNEE)).close();
  when(notificationService.hasProjectSubscribersForTypes(PROJECT_UUID,SendIssueNotificationsStep.NOTIF_TYPES)).thenReturn(true);
  underTest.execute();
  verify(notificationService,times(2)).deliver(any(Notification.class));
  verify(myNewIssuesNotificationMock).setAssignee(ISSUE_ASSIGNEE);
  verify(myNewIssuesNotificationMock).setProject(PROJECT_KEY,PROJECT_UUID,PROJECT_NAME);
  verify(myNewIssuesNotificationMock).setAnalysisDate(new Date(ANALYSE_DATE));
  verify(myNewIssuesNotificationMock).setStatistics(eq(PROJECT_NAME),any(NewIssuesStatistics.Stats.class));
  verify(myNewIssuesNotificationMock).setDebt(ISSUE_DURATION);
}
