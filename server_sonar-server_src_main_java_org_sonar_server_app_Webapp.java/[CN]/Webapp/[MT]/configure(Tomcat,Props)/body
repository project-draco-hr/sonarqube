{
  try {
    new WebDeployContext().configureTomcat(tomcat,props);
    StandardContext context=(StandardContext)tomcat.addWebapp(ROOT_CONTEXT_PATH,webappPath(props));
    context.setClearReferencesHttpClientKeepAliveThread(false);
    context.setClearReferencesStatic(false);
    context.setClearReferencesStopThreads(false);
    context.setClearReferencesStopTimerThreads(false);
    context.setClearReferencesStopTimerThreads(false);
    context.setAntiResourceLocking(false);
    context.setReloadable(false);
    context.setUseHttpOnly(true);
    context.setTldValidation(false);
    context.setXmlValidation(false);
    context.setXmlNamespaceAware(false);
    context.setUseNaming(false);
    context.setDelegate(true);
    context.setJarScanner(new NullJarScanner());
    configureRails(props,context);
    for (    Map.Entry<Object,Object> entry : props.rawProperties().entrySet()) {
      String key=entry.getKey().toString();
      context.addParameter(key,entry.getValue().toString());
    }
    return context;
  }
 catch (  Exception e) {
    throw new IllegalStateException("Fail to configure webapp",e);
  }
}
