{
  int bulkSize=QueryOptions.MAX_LIMIT + 10;
  for (int i=0; i < bulkSize; i++) {
    db.ruleDao().insert(dbSession,RuleTesting.newDto(RuleKey.of("bulk","r_" + i)).setLanguage("xoo"));
  }
  dbSession.commit();
  verifyZeroActiveRules(XOO_PROFILE_KEY);
  assertThat(tester.get(RuleIndex.class).search(new RuleQuery().setRepositories(Arrays.asList("bulk")),new QueryOptions()).getTotal()).isEqualTo(bulkSize);
  BulkChangeResult result=ruleActivator.bulkActivate(new RuleQuery().setRepositories(Arrays.asList("bulk")),XOO_PROFILE_KEY,"MINOR");
  dbSession.clearCache();
  assertThat(db.activeRuleDao().findByProfileKey(dbSession,XOO_PROFILE_KEY)).hasSize(bulkSize);
  assertThat(index.findByProfile(XOO_PROFILE_KEY)).hasSize(bulkSize);
  assertThat(result.countSucceeded()).isEqualTo(bulkSize);
  assertThat(result.countFailed()).isEqualTo(0);
}
