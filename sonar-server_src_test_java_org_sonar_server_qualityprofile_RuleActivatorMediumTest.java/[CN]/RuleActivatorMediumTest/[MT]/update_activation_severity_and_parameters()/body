{
  grantPermission();
  RuleActivation activation=new RuleActivation(ActiveRuleKey.of(PROFILE_KEY,RuleKey.of("xoo","x1")));
  activation.setSeverity(Severity.BLOCKER);
  ruleActivator.activate(activation);
  RuleActivation update=new RuleActivation(ActiveRuleKey.of(PROFILE_KEY,RuleKey.of("xoo","x1")));
  update.setSeverity(Severity.CRITICAL);
  update.setParameter("max","42");
  ruleActivator.activate(update);
  List<ActiveRuleDto> activeRuleDtos=db.activeRuleDao().findByProfileKey(dbSession,PROFILE_KEY);
  assertThat(activeRuleDtos).hasSize(1);
  assertThat(activeRuleDtos.get(0).getSeverityString()).isEqualTo(Severity.CRITICAL);
  assertThat(activeRuleDtos.get(0).getInheritance()).isNull();
  List<ActiveRuleParamDto> params=db.activeRuleDao().findParamsByActiveRule(dbSession,activeRuleDtos.get(0));
  assertThat(params).hasSize(1);
  assertThat(params.get(0).getValue()).isEqualTo("42");
  ActiveRule activeRule=index.getByKey(activation.getKey());
  assertThat(activeRule).isNotNull();
  assertThat(activeRule.severity()).isEqualTo(Severity.CRITICAL);
  assertThat(activeRule.inheritance()).isEqualTo(ActiveRule.Inheritance.NONE);
  assertThat(activeRule.params()).hasSize(1);
  assertThat(activeRule.params().get("max")).isEqualTo("42");
}
