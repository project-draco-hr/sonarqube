{
  grantPermission();
  createChildProfiles();
  RuleActivation activation=new RuleActivation(ActiveRuleKey.of(XOO_PROFILE_KEY,RuleKey.of("xoo","x1")));
  activation.setSeverity(Severity.BLOCKER);
  activation.setParameter("max","7");
  ruleActivator.activate(activation);
  verifyOneActiveRule(XOO_PROFILE_KEY,Severity.BLOCKER,null,ImmutableMap.of("max","7"));
  verifyOneActiveRule(XOO_CHILD_PROFILE_KEY,Severity.BLOCKER,ActiveRuleDto.INHERITED,ImmutableMap.of("max","7"));
  verifyOneActiveRule(XOO_GRAND_CHILD_PROFILE_KEY,Severity.BLOCKER,ActiveRuleDto.INHERITED,ImmutableMap.of("max","7"));
  activation=new RuleActivation(ActiveRuleKey.of(XOO_CHILD_PROFILE_KEY,RuleKey.of("xoo","x1")));
  activation.setSeverity(Severity.INFO);
  activation.setParameter("max","10");
  ruleActivator.activate(activation);
  dbSession.clearCache();
  verifyOneActiveRule(XOO_PROFILE_KEY,Severity.BLOCKER,null,ImmutableMap.of("max","7"));
  verifyOneActiveRule(XOO_CHILD_PROFILE_KEY,Severity.INFO,ActiveRuleDto.OVERRIDES,ImmutableMap.of("max","10"));
  verifyOneActiveRule(XOO_GRAND_CHILD_PROFILE_KEY,Severity.INFO,ActiveRuleDto.INHERITED,ImmutableMap.of("max","10"));
  activation=new RuleActivation(ActiveRuleKey.of(XOO_CHILD_PROFILE_KEY,RuleKey.of("xoo","x1")));
  ruleActivator.reset(activation);
  dbSession.clearCache();
  verifyOneActiveRule(XOO_PROFILE_KEY,Severity.BLOCKER,null,ImmutableMap.of("max","7"));
  verifyOneActiveRule(XOO_CHILD_PROFILE_KEY,Severity.BLOCKER,ActiveRuleDto.INHERITED,ImmutableMap.of("max","7"));
  verifyOneActiveRule(XOO_GRAND_CHILD_PROFILE_KEY,Severity.BLOCKER,ActiveRuleDto.INHERITED,ImmutableMap.of("max","7"));
}
