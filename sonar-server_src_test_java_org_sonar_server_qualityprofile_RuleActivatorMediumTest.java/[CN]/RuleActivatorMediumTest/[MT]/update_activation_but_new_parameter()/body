{
  grantPermission();
  ActiveRuleKey activeRuleKey=ActiveRuleKey.of(XOO_PROFILE_KEY,RuleKey.of("xoo","x1"));
  RuleActivation activation=new RuleActivation(activeRuleKey);
  activation.setSeverity(Severity.BLOCKER);
  ruleActivator.activate(activation);
  assertThat(db.activeRuleDao().getParamByKeyAndName(activeRuleKey,"max",dbSession)).isNotNull();
  db.activeRuleDao().removeParamByKeyAndName(dbSession,activeRuleKey,"max");
  dbSession.commit();
  assertThat(db.activeRuleDao().getParamByKeyAndName(activeRuleKey,"max",dbSession)).isNull();
  dbSession.clearCache();
  RuleActivation update=new RuleActivation(ActiveRuleKey.of(XOO_PROFILE_KEY,RuleKey.of("xoo","x1")));
  update.setSeverity(Severity.CRITICAL);
  update.setParameter("max","42");
  ruleActivator.activate(update);
  verifyOneActiveRule(XOO_PROFILE_KEY,Severity.CRITICAL,null,ImmutableMap.of("max","42"));
}
