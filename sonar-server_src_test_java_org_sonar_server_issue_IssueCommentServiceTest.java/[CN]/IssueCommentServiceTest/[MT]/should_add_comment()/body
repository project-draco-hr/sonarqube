{
  DefaultIssue issue=mock(DefaultIssue.class);
  when(issue.comments()).thenReturn(Lists.<IssueComment>newArrayList(new DefaultIssueComment()));
  IssueQueryResult issueQueryResult=new DefaultIssueQueryResult(Lists.<Issue>newArrayList(issue));
  when(finder.find(any(IssueQuery.class))).thenReturn(issueQueryResult);
  issueCommentService.addComment("myIssue","my comment",MockUserSession.get());
  verify(updater).addComment(eq(issue),eq("my comment"),any(IssueChangeContext.class));
  verify(storage).save(eq(issue));
  verify(issueNotifications).sendChanges(eq(issue),any(IssueChangeContext.class),eq(issueQueryResult),eq("my comment"));
}
