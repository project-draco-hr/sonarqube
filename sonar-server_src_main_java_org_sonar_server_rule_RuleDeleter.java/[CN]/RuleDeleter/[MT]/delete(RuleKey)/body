{
  DbSession dbSession=dbClient.openSession(false);
  try {
    RuleDto rule=dbClient.ruleDao().getByKey(dbSession,ruleKey);
    if (rule.getTemplateId() == null) {
      throw new IllegalStateException("Only custom rules can be deleted");
    }
    ruleActivator.deactivate(dbSession,rule);
    rule.setStatus(RuleStatus.REMOVED);
    dbClient.ruleDao().update(dbSession,rule);
    dbSession.commit();
  }
  finally {
    dbSession.close();
  }
}
