{
  Writer writer=null;
  FileOutputStream fos=null;
  try {
    freemarker.log.Logger.selectLoggerLibrary(freemarker.log.Logger.LIBRARY_NONE);
    freemarker.template.Configuration cfg=new freemarker.template.Configuration();
    cfg.setClassForTemplateLoading(HtmlReport.class,"");
    Map<String,Object> root=Maps.newHashMap();
    root.put("report",report);
    root.put("ruleNameProvider",ruleNameProvider);
    root.put("sourceProvider",sourceProvider);
    root.put("complete",complete);
    Template template=cfg.getTemplate("issuesreport.ftl");
    fos=new FileOutputStream(toFile);
    writer=new OutputStreamWriter(fos,fs.encoding());
    template.process(root,writer);
    writer.flush();
  }
 catch (  Exception e) {
    throw new IllegalStateException("Fail to generate HTML Issues Report to: " + toFile,e);
  }
 finally {
    IOUtils.closeQuietly(writer);
    IOUtils.closeQuietly(fos);
  }
}
