{
  LoggerFactory.getLogger(SearchServer.class).info("Starting Elasticsearch[{}] on port {}",settings.clusterName(),settings.tcpPort());
  node=new InternalNode(settings.build(),true);
  node.start();
  if (settings.inCluster()) {
    for (    ObjectCursor<Settings> settingCursor : node.client().admin().indices().prepareGetSettings().get().getIndexToSettings().values()) {
      Settings settings=settingCursor.value;
      String clusterReplicationFactor=settings.get("index.number_of_replicas","-1");
      if (Integer.parseInt(clusterReplicationFactor) <= 0) {
        node.stop();
        throw new MessageException("Index configuration is not set to cluster. Please start the master node with " + "property " + ProcessConstants.CLUSTER_ACTIVATE + "=true");
      }
    }
  }
}
