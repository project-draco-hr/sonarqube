{
  JsonWriter json=null;
  try {
    json=new JsonWriter(output);
    json.setSerializeNulls(false);
    json.beginObject().name("version").value(server.getVersion()).name("violations_per_resource").beginObject();
    for (    Resource resource : resources) {
      List<Violation> violations=getViolations(resource);
      if (violations.isEmpty()) {
        continue;
      }
      json.name(resource.getKey()).beginArray();
      for (      Violation violation : violations) {
        json.beginObject().name("line").value(violation.getLineId()).name("message").value(violation.getMessage()).name("severity").value(violation.getSeverity().name()).name("rule_key").value(violation.getRule().getKey()).name("rule_repository").value(violation.getRule().getRepositoryKey()).name("rule_name").value(name(violation.getRule())).name("is_new").value(violation.isNew());
        if (violation.getCreatedAt() != null) {
          json.name("created_at").value(DateUtils.formatDateTime(violation.getCreatedAt()));
        }
        json.endObject();
      }
      json.endArray();
    }
    json.endObject().endObject().flush();
  }
 catch (  IOException e) {
    throw new SonarException("Unable to export results",e);
  }
 finally {
    Closeables.closeQuietly(json);
  }
}
