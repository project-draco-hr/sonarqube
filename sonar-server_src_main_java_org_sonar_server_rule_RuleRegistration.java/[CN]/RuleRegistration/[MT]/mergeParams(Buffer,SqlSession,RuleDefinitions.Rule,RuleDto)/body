{
  Collection<RuleParamDto> paramDtos=buffer.paramsForRuleId(dto.getId());
  Set<String> persistedParamKeys=Sets.newHashSet();
  for (  RuleParamDto paramDto : paramDtos) {
    RuleDefinitions.Param paramDef=ruleDef.param(paramDto.getName());
    if (paramDef == null) {
      activeRuleDao.deleteParametersWithParamId(paramDto.getId(),sqlSession);
      ruleDao.deleteParam(paramDto,sqlSession);
    }
 else {
      if (mergeParam(paramDto,paramDef)) {
        ruleDao.update(paramDto,sqlSession);
      }
      persistedParamKeys.add(paramDto.getName());
    }
  }
  for (  RuleDefinitions.Param param : ruleDef.params()) {
    if (!persistedParamKeys.contains(param.key())) {
      RuleParamDto paramDto=new RuleParamDto().setRuleId(dto.getId()).setName(param.key()).setDescription(param.description()).setDefaultValue(param.defaultValue()).setType(param.type().toString());
      ruleDao.insert(paramDto,sqlSession);
      buffer.add(paramDto);
    }
  }
}
