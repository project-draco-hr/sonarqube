{
  RuleDto ruleDto=new RuleDto().setCardinality(ruleDef.template() ? Cardinality.MULTIPLE : Cardinality.SINGLE).setConfigKey(ruleDef.internalKey()).setDescription(ruleDef.htmlDescription()).setLanguage(ruleDef.repository().language()).setName(ruleDef.name()).setRepositoryKey(ruleDef.repository().key()).setRuleKey(ruleDef.key()).setSeverity(ruleDef.severity()).setCreatedAt(buffer.now()).setUpdatedAt(buffer.now()).setStatus(ruleDef.status().name());
  CharacteristicDto characteristic=findCharacteristic(characteristicDtos,ruleDef);
  ruleDto.setDefaultCharacteristicId(characteristic != null ? characteristic.getId() : null).setEffortToFixL10nKey(ruleDef.effortToFixL10nKey());
  DebtRemediationFunction remediationFunction=ruleDef.debtRemediationFunction();
  if (remediationFunction != null) {
    ruleDto.setDefaultRemediationFunction(remediationFunction.type().name());
    ruleDto.setDefaultRemediationFactor(remediationFunction.factor());
    ruleDto.setDefaultRemediationOffset(remediationFunction.offset());
  }
  ruleDao.insert(ruleDto,sqlSession);
  buffer.add(ruleDto);
  for (  RulesDefinition.Param param : ruleDef.params()) {
    RuleParamDto paramDto=new RuleParamDto().setRuleId(ruleDto.getId()).setDefaultValue(param.defaultValue()).setDescription(param.description()).setName(param.name()).setType(param.type().toString());
    ruleDao.insert(paramDto,sqlSession);
    buffer.add(paramDto);
  }
  mergeTags(buffer,sqlSession,ruleDef,ruleDto);
  return ruleDto;
}
