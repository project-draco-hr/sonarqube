{
  TimeProfiler profiler=new TimeProfiler().start("Register rules");
  SqlSession sqlSession=myBatis.openSession();
  try {
    Buffer buffer=new Buffer(system.now());
    selectRulesFromDb(buffer,sqlSession);
    enableRuleDefinitions(buffer,sqlSession);
    processRemainingDbRules(buffer,sqlSession);
    index(buffer);
    ruleTagOperations.deleteUnusedTags(sqlSession);
    sqlSession.commit();
  }
  finally {
    sqlSession.close();
    profiler.stop();
  }
}
