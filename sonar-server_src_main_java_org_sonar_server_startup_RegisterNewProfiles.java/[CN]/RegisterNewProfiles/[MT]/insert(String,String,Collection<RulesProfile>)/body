{
  RulesProfile persisted=RulesProfile.create(name,language);
  for (  RulesProfile profile : profiles) {
    for (    ActiveRule activeRule : profile.getActiveRules()) {
      Rule rule=persistedRule(activeRule);
      ActiveRule persistedActiveRule=persisted.activateRule(rule,activeRule.getSeverity());
      for (      RuleParam param : rule.getParams()) {
        String value=StringUtils.defaultString(activeRule.getParameter(param.getKey()),param.getDefaultValue());
        if (value != null) {
          persistedActiveRule.setParameter(param.getKey(),value);
        }
      }
    }
  }
  session.saveWithoutFlush(persisted);
}
