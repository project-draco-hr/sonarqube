{
  Rule rule=activeRule.getRule();
  if (rule != null && rule.getId() == null) {
    if (rule.getKey() != null) {
      rule=ruleFinder.findByKey(rule.getRepositoryKey(),rule.getKey());
    }
 else     if (rule.getConfigKey() != null) {
      rule=ruleFinder.find(RuleQuery.create().withRepositoryKey(rule.getRepositoryKey()).withConfigKey(rule.getConfigKey()));
    }
  }
  if (rule == null) {
    throw new IllegalStateException(String.format("Rule '%s' has not been found.",activeRule.getRule()));
  }
  return rule;
}
