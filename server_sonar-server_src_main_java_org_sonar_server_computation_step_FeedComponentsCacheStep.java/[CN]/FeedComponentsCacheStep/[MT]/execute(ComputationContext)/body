{
  DbSession session=dbClient.openSession(false);
  try {
    List<ComponentDto> components=dbClient.componentDao().selectComponentsFromProjectKey(session,context.getProjectKey());
    Map<String,ComponentDto> componentDtosByKey=componentDtosByKey(components);
    int rootComponentRef=context.getReportMetadata().getRootComponentRef();
    recursivelyProcessComponent(context,rootComponentRef,context.getReportReader().readComponent(rootComponentRef),componentDtosByKey);
  }
  finally {
    session.close();
  }
}
