{
  addJwtCookie();
  UserDto user=addUser();
  Claims claims=createToken(TEN_DAYS_AGO);
  claims.put("lastRefreshTime",SIX_MINUTES_AGO);
  when(jwtSerializer.decode(JWT_TOKEN)).thenReturn(Optional.of(claims));
  underTest.validateToken(request,response);
  verify(httpSession).setAttribute("user_id",user.getId());
  verify(jwtSerializer).refresh(any(Claims.class),eq(3 * 24 * 60* 60));
}
