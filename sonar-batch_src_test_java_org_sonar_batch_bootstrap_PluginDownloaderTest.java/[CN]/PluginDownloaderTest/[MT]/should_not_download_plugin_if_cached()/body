{
  SonarCache cache=mock(SonarCache.class);
  BatchSonarCache batchCache=mock(BatchSonarCache.class);
  when(batchCache.getCache()).thenReturn(cache);
  File fileInCache=temp.newFile();
  when(cache.getFileFromCache(Mockito.anyString(),Mockito.anyString())).thenReturn(fileInCache).thenReturn(fileInCache);
  ServerClient server=mock(ServerClient.class);
  PluginDownloader downloader=new PluginDownloader(batchCache,server);
  RemotePlugin plugin=new RemotePlugin("checkstyle",true).addFile("checkstyle-plugin.jar","fakemd51").addFile("checkstyle-extensions.jar","fakemd52");
  List<File> files=downloader.downloadPlugin(plugin);
  assertThat(files).hasSize(2);
  verify(server,never()).download(Mockito.anyString(),Mockito.any(File.class));
  verify(cache,never()).cacheFile(Mockito.any(File.class),Mockito.anyString());
}
