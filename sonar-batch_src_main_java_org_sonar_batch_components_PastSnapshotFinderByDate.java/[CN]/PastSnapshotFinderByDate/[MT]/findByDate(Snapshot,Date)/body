{
  String hql="from " + Snapshot.class.getSimpleName() + " where createdAt>=:date AND resourceId=:resourceId AND status=:status AND qualifier<>:lib order by createdAt asc";
  List<Snapshot> snapshots=session.createQuery(hql).setParameter("date",date).setParameter("resourceId",projectSnapshot.getResourceId()).setParameter("status",Snapshot.STATUS_PROCESSED).setParameter("lib",Project.QUALIFIER_LIB).setMaxResults(1).getResultList();
  if (snapshots.isEmpty()) {
    return null;
  }
  SimpleDateFormat format=new SimpleDateFormat("yyyy-MM-dd");
  return new PastSnapshot(MODE,date,snapshots.get(0)).setModeParameter(format.format(date));
}
