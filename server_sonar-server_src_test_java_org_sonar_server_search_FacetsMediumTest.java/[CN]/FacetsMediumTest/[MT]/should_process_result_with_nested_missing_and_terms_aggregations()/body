{
  esTester.putDocuments(INDEX,TYPE,newTagsDocument("noTags"),newTagsDocument("oneTag","tag1"),newTagsDocument("twoTags","tag1","tag2"),newTagsDocument("twoTags","tag1","tag2","tag3"),newTagsDocument("twoTags","tag1","tag2","tag3","tag4"));
  SearchRequestBuilder search=esTester.client().prepareSearch(INDEX).setTypes(TYPE).addAggregation(AggregationBuilders.global("tags__global").subAggregation(AggregationBuilders.missing("tags_missing").field(FIELD_TAGS)).subAggregation(AggregationBuilders.terms("tags").field(FIELD_TAGS).size(2)).subAggregation(AggregationBuilders.terms("tags__selected").field(FIELD_TAGS).include("tag4")).subAggregation(AggregationBuilders.terms("__ignored").field(FIELD_TAGS).include("tag3")));
  Facets facets=new Facets(search.get());
  assertThat(facets.getFacets()).isNotEmpty();
  assertThat(facets.getFacetKeys(FIELD_TAGS)).containsOnly("","tag1","tag2","tag4");
  assertThat(facets.getFacetKeys(FIELD_CREATED_AT)).isEmpty();
  assertThat(facets.toString()).isEqualTo("{" + "tags=[" + "FacetValue{key='tag1', value=2}, "+ "FacetValue{key='tag2', value=1}, "+ "FacetValue{key='tag4', value=1}, "+ "FacetValue{key='', value=1}"+ "], "+ "__ignored=[FacetValue{key='tag3', value=1}]"+ "}");
}
