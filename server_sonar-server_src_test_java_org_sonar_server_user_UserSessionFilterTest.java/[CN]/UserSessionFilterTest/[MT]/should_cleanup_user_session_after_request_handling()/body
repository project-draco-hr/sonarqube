{
  when(componentContainer.getComponentByType(ThreadLocalUserSession.class)).thenReturn(threadLocalUserSession);
  threadLocalUserSession.set(new MockUserSession("karadoc").setUserId(123));
  assertThat(threadLocalUserSession.hasSession()).isTrue();
  UserSessionFilter filter=new UserSessionFilter(platform);
  filter.doFilter(httpRequest,httpResponse,chain);
  verify(chain).doFilter(httpRequest,httpResponse);
  assertThat(threadLocalUserSession.hasSession()).isFalse();
}
