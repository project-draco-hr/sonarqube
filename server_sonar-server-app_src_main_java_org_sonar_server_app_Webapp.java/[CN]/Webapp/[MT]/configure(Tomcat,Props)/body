{
  try {
    String webDir=props.of("sonar.path.web");
    Context context=tomcat.addWebapp(getContextPath(props),webDir);
    context.setConfigFile(new File(webDir,"META-INF/context.xml").toURI().toURL());
    context.addParameter(PROPERTY_LOG_PROFILING_LEVEL,props.of(PROPERTY_LOG_PROFILING_LEVEL,"NONE"));
    context.addParameter(PROPERTY_LOG_CONSOLE,props.of(PROPERTY_LOG_CONSOLE,"false"));
    for (    Map.Entry<Object,Object> entry : props.cryptedProperties().entrySet()) {
      String key=entry.getKey().toString();
      if (key.startsWith("sonar.")) {
        context.addParameter(key,entry.getValue().toString());
      }
    }
    configureRailsMode(props,context);
    context.setJarScanner(new NullJarScanner());
  }
 catch (  Exception e) {
    throw new IllegalStateException("Fail to configure webapp",e);
  }
}
