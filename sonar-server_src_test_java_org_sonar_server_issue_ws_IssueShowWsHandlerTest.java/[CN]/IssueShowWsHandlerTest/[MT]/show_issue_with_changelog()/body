{
  Issue issue=createStandardIssue();
  issues.add(issue);
  List<User> users=Lists.<User>newArrayList(new DefaultUser().setLogin("john").setName("John"));
  FieldDiffs userChange=new FieldDiffs().setUserLogin("john").setDiff("actionPlan",null,"1.0").setCreationDate(DateUtils.parseDateTime("2014-01-22T19:10:03+0100"));
  FieldDiffs scanChange=new FieldDiffs().setDiff("severity","INFO","BLOCKER").setDiff("status","REOPEN","RESOLVED").setCreationDate(DateUtils.parseDateTime("2014-01-23T19:10:03+0100"));
  when(issueChangelogService.changelog(issue)).thenReturn(new IssueChangelog(newArrayList(userChange,scanChange),users));
  when(issueChangelogService.formatDiffs(userChange)).thenReturn(newArrayList("Action plan updated to 1.0"));
  when(issueChangelogService.formatDiffs(scanChange)).thenReturn(newArrayList("Severity updated from Info to Blocker","Status updated from Reopen to Resolved"));
  MockUserSession.set();
  SimpleRequest request=new SimpleRequest().setParam("key",issue.key());
  tester.execute("show",request).assertJson(getClass(),"show_issue_with_changelog.json");
}
