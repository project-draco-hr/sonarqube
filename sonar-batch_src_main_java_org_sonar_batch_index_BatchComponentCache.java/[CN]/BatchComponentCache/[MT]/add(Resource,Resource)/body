{
  String componentKey=resource.getEffectiveKey();
  Preconditions.checkState(!Strings.isNullOrEmpty(componentKey),"Missing resource effective key");
  BatchComponent parent=parentResource != null ? get(parentResource.getEffectiveKey()) : null;
  BatchComponent batchResource=new BatchComponent(components.size() + 1,resource,parent);
  components.put(componentKey,batchResource);
  if (parent == null) {
    root=batchResource;
  }
  return batchResource;
}
