{
  AverageFormula sut=Builder.newBuilder().setOutputMetricKey(FUNCTION_COMPLEXITY_KEY).setMainMetricKey(COMPLEXITY_IN_FUNCTIONS_KEY).setByMetricKey(FUNCTIONS_KEY).setFallbackMetricKey(CoreMetrics.COMPLEXITY_KEY).build();
  AverageFormula.AverageCounter counter=sut.createNewCounter();
  addMeasure(COMPLEXITY_IN_FUNCTIONS_KEY,10d);
  addMeasure(COMPLEXITY_KEY,12d);
  addMeasure(FUNCTIONS_KEY,2d);
  counter.aggregate(counterContext);
  assertThat(sut.createMeasure(counter,Component.Type.PROJECT).get().getDoubleValue()).isEqualTo(5d);
}
