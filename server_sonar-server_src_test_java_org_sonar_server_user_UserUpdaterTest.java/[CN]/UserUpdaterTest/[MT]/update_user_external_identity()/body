{
  db.prepareDbUnit(getClass(),"update_user.xml");
  when(system2.now()).thenReturn(1418215735486L);
  createDefaultGroup();
  userUpdater.update(UpdateUser.create(DEFAULT_LOGIN).setName("Marius2").setPassword("password2").setExternalIdentity(new ExternalIdentity("github","john")));
  session.commit();
  session.clearCache();
  UserDto dto=userDao.selectByLogin(session,DEFAULT_LOGIN);
  assertThat(dto.getExternalIdentity()).isEqualTo("john");
  assertThat(dto.getExternalIdentityProvider()).isEqualTo("github");
}
