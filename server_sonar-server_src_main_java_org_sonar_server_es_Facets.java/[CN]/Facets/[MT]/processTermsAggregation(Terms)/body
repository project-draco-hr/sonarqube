{
  String facetName=aggregation.getName();
  if (facetName.contains("__") && !facetName.startsWith("__")) {
    facetName=facetName.substring(0,facetName.indexOf("__"));
  }
  facetName=facetName.replace("_selected","");
  LinkedHashMap<String,Long> facet=getOrCreateFacet(facetName);
  for (  Terms.Bucket value : aggregation.getBuckets()) {
    if (value.getAggregations().getAsMap().containsKey(FACET_MODE_EFFORT)) {
      facet.put(value.getKey(),Math.round(((Sum)value.getAggregations().get(FACET_MODE_EFFORT)).getValue()));
    }
 else {
      facet.put(value.getKey(),value.getDocCount());
    }
  }
}
