{
  if (!shouldDecorateResource(data,context)) {
    return null;
  }
  if (ResourceUtils.isFile(context.getResource())) {
    Double byMeasure=MeasureUtils.getValue(data.getMeasure(byMetric),null);
    Double complexity=MeasureUtils.getValue(data.getMeasure(CoreMetrics.COMPLEXITY),null);
    if (complexity != null && byMeasure != null && byMeasure > 0.0) {
      return new Measure(context.getTargetMetric(),(complexity / byMeasure));
    }
  }
 else {
    double totalByMeasure=0;
    double totalComplexity=0;
    boolean hasApplicableChildren=false;
    for (    FormulaData childrenData : data.getChildren()) {
      Double childrenByMeasure=MeasureUtils.getValue(childrenData.getMeasure(byMetric),null);
      Double childrenComplexity=MeasureUtils.getValue(childrenData.getMeasure(CoreMetrics.COMPLEXITY),null);
      if (childrenComplexity != null && childrenByMeasure != null && childrenByMeasure > 0.0) {
        totalByMeasure+=childrenByMeasure;
        totalComplexity+=childrenComplexity;
        hasApplicableChildren=true;
      }
    }
    if (hasApplicableChildren) {
      return new Measure(context.getTargetMetric(),(totalComplexity / totalByMeasure));
    }
  }
  return null;
}
