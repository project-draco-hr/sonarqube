{
  for (int index=processes.size() - 1; index >= 0; index--) {
    ProcessRef ref=processes.get(index);
    if (!ref.isStopped()) {
      LoggerFactory.getLogger(getClass()).info(String.format("%s is stopping",ref));
      ref.askForGracefulAsyncStop();
      long killAt=System.currentTimeMillis() + timeouts.getTerminationTimeout();
      while (!ref.isStopped() && System.currentTimeMillis() < killAt) {
        try {
          Thread.sleep(100L);
        }
 catch (        InterruptedException e) {
          return;
        }
      }
      if (!ref.isStopped()) {
        LoggerFactory.getLogger(getClass()).info(String.format("%s failed to stop in a timely fashion. Killing it.",ref));
      }
      ref.stop();
    }
  }
}
