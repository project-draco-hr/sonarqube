{
  IssueAuthorizationIndexer indexer=new IssueAuthorizationIndexer(new DbClient(dbTester.database(),dbTester.myBatis()),esTester.client());
  IssueAuthorizationDao.Dto authorization=new IssueAuthorizationDao.Dto("ABC",System.currentTimeMillis());
  authorization.addUser("guy");
  authorization.addGroup("dev");
  indexer.index(Arrays.asList(authorization));
  assertThat(esTester.countDocuments("issues","issueAuthorization")).isEqualTo(1);
  authorization=new IssueAuthorizationDao.Dto("ABC",System.currentTimeMillis());
  indexer.index(Arrays.asList(authorization));
  assertThat(esTester.countDocuments("issues","issueAuthorization")).isZero();
}
