{
  InputStream input=getClass().getResourceAsStream("/org/sonar/plugins/pmd/test_module_tree.xml");
  Ruleset ruleset=repository.buildModuleTreeFromXml(IOUtils.toString(input));
  assertThat(ruleset.getRules().size(),is(3));
  Rule rule1=ruleset.getRules().get(0);
  assertThat(rule1.getRef(),is("rulesets/coupling.xml/CouplingBetweenObjects"));
  assertThat(rule1.getPriority(),is("2"));
  assertThat(rule1.getProperties().size(),is(1));
  Property module1Property=rule1.getProperties().get(0);
  assertThat(module1Property.getName(),is("threshold"));
  assertThat(module1Property.getValue(),is("20"));
  Rule rule2=ruleset.getRules().get(1);
  assertThat(rule2.getRef(),is("rulesets/coupling.xml/ExcessiveImports"));
  assertThat(rule2.getPriority(),is("3"));
  assertThat(rule2.getProperties().size(),is(1));
  Property module2Property=rule2.getProperties().get(0);
  assertThat(module2Property.getName(),is("max"));
  assertThat(module2Property.getValue(),is("30"));
  Rule rule3=ruleset.getRules().get(2);
  assertThat(rule3.getRef(),is("rulesets/design.xml/UseNotifyAllInsteadOfNotify"));
  assertThat(rule3.getPriority(),is("4"));
  assertNull(rule3.getProperties());
}
