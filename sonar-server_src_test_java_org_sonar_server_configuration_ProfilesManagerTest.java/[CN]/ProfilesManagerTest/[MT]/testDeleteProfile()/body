{
  RulesProfile testDefaultProfile=RulesProfile.create("default","java");
  testDefaultProfile.setDefaultProfile(true);
  testDefaultProfile.setProvided(true);
  RulesProfile testProfile=RulesProfile.create("not default","java");
  ResourceModel testResourceWithProfile=new ResourceModel(ResourceModel.SCOPE_PROJECT,"withProfile","qual",null,"test");
  testResourceWithProfile.setRulesProfile(testProfile);
  getSession().save(testDefaultProfile,testProfile,testResourceWithProfile);
  getSession().commit();
  getSession().getEntityManager().clear();
  manager.deleteProfile(testDefaultProfile.getId());
  assertNotNull(getSession().getEntity(RulesProfile.class,testDefaultProfile.getId()));
  manager.deleteProfile(testProfile.getId());
  assertNull(getSession().getEntity(RulesProfile.class,testProfile.getId()));
  testResourceWithProfile=getSession().getEntity(ResourceModel.class,testResourceWithProfile.getId());
  assertNull(testResourceWithProfile.getRulesProfile());
}
