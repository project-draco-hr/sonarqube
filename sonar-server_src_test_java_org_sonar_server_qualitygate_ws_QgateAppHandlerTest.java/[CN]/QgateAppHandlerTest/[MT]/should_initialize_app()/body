{
  doAnswer(new Answer<String>(){
    @Override public String answer(    InvocationOnMock invocation) throws Throwable {
      return (String)invocation.getArguments()[1];
    }
  }
).when(i18n).message(any(Locale.class),any(String.class),any(String.class));
  Metric metric=mock(Metric.class);
  when(metric.getId()).thenReturn(42);
  when(metric.getKey()).thenReturn("metric");
  when(metric.getName()).thenReturn("Metric");
  when(metric.getType()).thenReturn(ValueType.BOOL);
  when(metric.getDomain()).thenReturn("General");
  when(qGates.gateMetrics()).thenReturn(ImmutableList.of(metric));
  String json=tester.newRequest("app").execute().outputAsString();
  Map responseJson=(Map)JSONValue.parse(json);
  assertThat((Boolean)responseJson.get("edit")).isFalse();
  Collection<Map> periods=(Collection<Map>)responseJson.get("periods");
  assertThat(periods).hasSize(3);
  Map messages=(Map)responseJson.get("messages");
  assertThat(messages).isNotNull().isNotEmpty().hasSize(46);
  for (  Entry message : (Set<Entry>)messages.entrySet()) {
    assertThat(message.getKey()).isEqualTo(message.getValue());
  }
  Collection<Map> metrics=(Collection<Map>)responseJson.get("metrics");
  assertThat(metrics).hasSize(1);
  assertThat(metrics.iterator().next().get("key")).isEqualTo("metric");
}
