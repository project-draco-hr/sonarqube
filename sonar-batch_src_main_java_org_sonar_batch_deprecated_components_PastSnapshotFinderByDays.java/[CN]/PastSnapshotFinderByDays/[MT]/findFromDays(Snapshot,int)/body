{
  Date targetDate=DateUtils.addDays(longToDate(projectSnapshot.getCreatedAtMs()),-days);
  String hql="from " + Snapshot.class.getSimpleName() + " where resourceId=:resourceId AND status=:status AND createdAt<:date AND qualifier<>:lib order by createdAt asc";
  List<Snapshot> snapshots=session.createQuery(hql).setParameter("date",projectSnapshot.getCreatedAtMs()).setParameter("resourceId",projectSnapshot.getResourceId()).setParameter("status",Snapshot.STATUS_PROCESSED).setParameter("lib",Qualifiers.LIBRARY).getResultList();
  Snapshot snapshot=getNearestToTarget(snapshots,targetDate);
  return new PastSnapshot(CoreProperties.TIMEMACHINE_MODE_DAYS,targetDate,snapshot).setModeParameter(String.valueOf(days));
}
