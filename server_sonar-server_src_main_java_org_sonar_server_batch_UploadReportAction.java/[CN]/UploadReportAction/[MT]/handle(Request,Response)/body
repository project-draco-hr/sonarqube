{
  UserSession.get().checkGlobalPermission(GlobalPermissions.SCAN_EXECUTION);
  if (settings.getString("sonar.issues.use_es_backend") != null) {
    String projectKey=request.mandatoryParam(PARAM_PROJECT);
    DbSession session=dbClient.openSession(false);
    try {
      dbClient.componentDao().getAuthorizedComponentByKey(projectKey,session);
      computationService.create(projectKey);
    }
  finally {
      MyBatis.closeQuietly(session);
    }
    session=dbClient.openSession(true);
    try {
      if (index.get(IssueAuthorizationIndex.class).getNullableByKey(projectKey) == null) {
        permissionService.synchronizePermissions(session,projectKey);
        session.commit();
      }
      dbClient.issueDao().synchronizeAfter(session,index.get(IssueIndex.class).getLastSynchronization(),ImmutableMap.of("project",projectKey));
      session.commit();
    }
  finally {
      MyBatis.closeQuietly(session);
    }
  }
}
