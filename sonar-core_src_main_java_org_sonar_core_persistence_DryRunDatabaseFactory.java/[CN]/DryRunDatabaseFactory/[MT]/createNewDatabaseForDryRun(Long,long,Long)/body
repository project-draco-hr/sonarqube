{
  String tmpName=getTemporaryH2DBName(dryRunCache.getCacheLocation(projectId),lastTimestampInCache);
  String finalName=getH2DBName(dryRunCache.getCacheLocation(projectId),lastTimestampInCache);
  try {
    DataSource source=database.getDataSource();
    BasicDataSource destination=create(DIALECT,DRIVER,USER,PASSWORD,URL + tmpName);
    copy(source,destination,projectId);
    close(destination);
    File tempDbFile=new File(tmpName + H2_FILE_SUFFIX);
    File dbFile=new File(finalName + H2_FILE_SUFFIX);
    Files.move(tempDbFile,dbFile);
    if (LOG.isDebugEnabled()) {
      long size=dbFile.length();
      long duration=System.currentTimeMillis() - startup;
      if (projectId == null) {
        LOG.debug("Dry Run Database created in " + duration + " ms, size is "+ size+ " bytes");
      }
 else {
        LOG.debug("Dry Run Database for project " + projectId + " created in "+ duration+ " ms, size is "+ size+ " bytes");
      }
    }
  }
 catch (  SQLException e) {
    throw new SonarException("Unable to create database for DryRun",e);
  }
catch (  IOException e) {
    throw new SonarException("Unable to cache database for DryRun",e);
  }
}
