{
  boolean hasLastScan=false;
  Multimap<Integer,IssueDto> lastIssuesByRule=LinkedHashMultimap.create();
  if (lastIssues != null) {
    hasLastScan=true;
    mapLastIssues(newIssues,lastIssues,lastIssuesByRule);
  }
  if (referenceIssuesMap.size() != newIssues.size()) {
    if (source != null && resource != null && hasLastScan) {
      String referenceSource=lastSnapshots.getSource(resource);
      if (referenceSource != null) {
        mapNewissues(referenceSource,newIssues,lastIssuesByRule,source);
      }
    }
    mapIssuesOnSameRule(newIssues,lastIssuesByRule);
  }
  unmappedLastIssues.clear();
  return referenceIssuesMap;
}
