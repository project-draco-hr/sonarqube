{
  Collection<DefaultIssue> issues=Lists.newArrayList();
  for (  Issue issue : issueCache.byComponent(resource.getEffectiveKey())) {
    issues.add((DefaultIssue)issue);
  }
  issueCache.clear(resource.getEffectiveKey());
  Collection<IssueDto> dbOpenIssues=initialOpenIssues.selectAndRemoveIssues(resource.getEffectiveKey());
  SourceHashHolder sourceHashHolder=new SourceHashHolder(index,lastSnapshots,resource);
  IssueTrackingResult trackingResult=tracking.track(sourceHashHolder,dbOpenIssues,issues);
  addUnmatched(trackingResult.unmatched(),sourceHashHolder,issues);
  mergeMatched(trackingResult);
  if (ResourceUtils.isProject(resource)) {
    addIssuesOnDeletedComponents(issues);
  }
  for (  DefaultIssue issue : issues) {
    workflow.doAutomaticTransition(issue,changeContext);
    handlers.execute(issue,changeContext);
    issueCache.put(issue);
  }
}
