{
  try {
    JsonWriter json=JsonWriter.of(writer);
    json.beginObject();
    json.prop("version",server.getVersion());
    Set<RuleKey> ruleKeys=newHashSet();
    Set<String> userLogins=newHashSet();
    writeJsonIssues(json,ruleKeys,userLogins);
    writeJsonComponents(json);
    writeJsonRules(json,ruleKeys);
    List<User> users=userFinder != null ? userFinder.findByLogins(new ArrayList<String>(userLogins)) : Collections.<User>emptyList();
    writeUsers(json,users);
    json.endObject().close();
  }
 catch (  IOException e) {
    throw new SonarException("Unable to write JSON report",e);
  }
}
