{
  JsonWriter json=null;
  try {
    json=new JsonWriter(writer);
    json.setSerializeNulls(false);
    json.beginObject();
    json.name("version").value(server.getVersion());
    Set<RuleKey> ruleKeys=newHashSet();
    Set<String> userLogins=newHashSet();
    componentSelector.init();
    writeJsonIssues(json,ruleKeys,userLogins);
    writeJsonComponents(json);
    writeJsonRules(json,ruleKeys);
    List<User> users=userFinder.findByLogins(new ArrayList<String>(userLogins));
    writeUsers(json,users);
    json.endObject().flush();
  }
 catch (  IOException e) {
    throw new SonarException("Unable to write JSON report",e);
  }
 finally {
    Closeables.closeQuietly(json);
  }
}
