{
  if (isMetricFoundInDb(metricInDb) || isMetricDisabled(metricInDb) || isMetricNonCustom(metricInDb)) {
    throw new ServerException(HttpURLConnection.HTTP_CONFLICT,String.format("No active custom metric has been found for id '%d'. Maybe you want to create a metric ?",template.getId()));
  }
  if (haveMetricTypeChanged(metricInDb,template)) {
    List<CustomMeasureDto> customMeasures=dbClient.customMeasureDao().selectByMetricId(dbSession,metricInDb.getId());
    if (haveAssociatedCustomMeasures(customMeasures)) {
      throw new ServerException(HttpURLConnection.HTTP_CONFLICT,String.format("You're trying to change the type '%s' while there are associated custom measures.",metricInDb.getValueType()));
    }
  }
}
