{
  String fileKey=request.mandatoryParam(KEY);
  coverageService.checkPermission(fileKey);
  int from=Math.max(request.mandatoryParamAsInt(FROM),1);
  int to=(Integer)ObjectUtils.defaultIfNull(request.paramAsInt(TO),Integer.MAX_VALUE);
  CoverageService.TYPE type=CoverageService.TYPE.valueOf(request.param(TYPE));
  JsonWriter json=response.newJsonWriter().beginObject();
  Map<Integer,Integer> hits=coverageService.getHits(fileKey,type);
  if (!hits.isEmpty()) {
    Map<Integer,Integer> testCases=coverageService.getTestCases(fileKey,type);
    Map<Integer,Integer> conditions=coverageService.getConditions(fileKey,type);
    Map<Integer,Integer> coveredConditions=coverageService.getCoveredConditions(fileKey,type);
    writeCoverage(fileKey,hits,testCases,conditions,coveredConditions,from,to,json);
  }
  json.endObject().close();
}
