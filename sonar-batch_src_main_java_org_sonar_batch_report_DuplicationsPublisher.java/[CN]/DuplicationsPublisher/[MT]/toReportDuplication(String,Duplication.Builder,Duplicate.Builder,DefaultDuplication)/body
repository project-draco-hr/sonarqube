{
  dupBuilder.clear();
  Block originBlock=input.originBlock();
  blockBuilder.clear();
  dupBuilder.setOriginPosition(BatchReport.TextRange.newBuilder().setStartLine(originBlock.startLine()).setEndLine(originBlock.startLine() + originBlock.length() - 1).build());
  for (  Block duplicate : input.duplicates()) {
    blockBuilder.clear();
    String componentKey=duplicate.resourceKey();
    if (!currentComponentKey.equals(componentKey)) {
      BatchComponent sameProjectComponent=resourceCache.get(componentKey);
      if (sameProjectComponent != null) {
        blockBuilder.setOtherFileRef(sameProjectComponent.batchId());
      }
 else {
        throw new IllegalStateException("No cross project duplication supported on batch side: " + componentKey);
      }
    }
    dupBuilder.addDuplicate(blockBuilder.setRange(BatchReport.TextRange.newBuilder().setStartLine(duplicate.startLine()).setEndLine(duplicate.startLine() + duplicate.length() - 1).build()).build());
  }
  return dupBuilder.build();
}
