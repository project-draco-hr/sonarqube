{
  db.truncateTables();
  session=db.myBatis().openSession(false);
  dbClient=new DbClient(db.database(),db.myBatis(),new FileSourceDao(db.myBatis()));
  projectSettings=new Settings();
  languageRepository=mock(LanguageRepository.class);
  system2=mock(System2.class);
  when(system2.now()).thenReturn(now);
  dbComponentsRefCache=new DbComponentsRefCache();
  sut=new PersistTestsStep(dbClient,system2,dbComponentsRefCache);
  initBasicReport();
  root=new DumbComponent(Component.Type.PROJECT,1,PROJECT_UUID,PROJECT_KEY,new DumbComponent(Component.Type.MODULE,2,"MODULE","MODULE_KEY",new DumbComponent(Component.Type.FILE,3,TEST_FILE_UUID_1,"TEST_FILE1_KEY"),new DumbComponent(Component.Type.FILE,4,TEST_FILE_UUID_2,"TEST_FILE2_KEY"),new DumbComponent(Component.Type.FILE,5,MAIN_FILE_UUID_1,"MAIN_FILE1_KEY"),new DumbComponent(Component.Type.FILE,6,MAIN_FILE_UUID_2,"MAIN_FILE2_KEY")));
}
