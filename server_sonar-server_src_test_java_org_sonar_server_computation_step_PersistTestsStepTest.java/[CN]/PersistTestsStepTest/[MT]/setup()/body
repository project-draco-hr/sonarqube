{
  db.truncateTables();
  session=db.myBatis().openSession(false);
  dbClient=new DbClient(db.database(),db.myBatis(),new FileSourceDao(db.myBatis()));
  reportDir=temp.newFolder();
  projectSettings=new Settings();
  languageRepository=mock(LanguageRepository.class);
  system2=mock(System2.class);
  when(system2.now()).thenReturn(now);
  dbComponentsRefCache=new DbComponentsRefCache();
  sut=new PersistTestsStep(dbClient,system2,dbComponentsRefCache);
  initBasicReport();
}
