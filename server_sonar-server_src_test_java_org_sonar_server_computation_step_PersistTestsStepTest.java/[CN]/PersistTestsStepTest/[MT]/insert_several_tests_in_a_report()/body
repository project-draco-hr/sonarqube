{
  List<ScannerReport.Test> batchTests=Arrays.asList(newTest(1),newTest(2));
  reportReader.putTests(TEST_FILE_REF_1,batchTests);
  List<CoverageDetail> coverageDetails=Arrays.asList(newCoverageDetail(1,MAIN_FILE_REF_1));
  reportReader.putCoverageDetails(TEST_FILE_REF_1,coverageDetails);
  underTest.execute();
  assertThat(db.countRowsOfTable("file_sources")).isEqualTo(1);
  FileSourceDto dto=dbClient.fileSourceDao().selectTest(TEST_FILE_UUID_1);
  assertThat(dto.getCreatedAt()).isEqualTo(now);
  assertThat(dto.getUpdatedAt()).isEqualTo(now);
  assertThat(dto.getProjectUuid()).isEqualTo(PROJECT_UUID);
  assertThat(dto.getFileUuid()).isEqualTo(TEST_FILE_UUID_1);
  assertThat(dto.getTestData()).hasSize(2);
  assertThat(dto.getTestData()).extracting("name","coveredFileCount").containsOnly(tuple("name#1",1),tuple("name#2",0));
  assertThat(log.logs()).isEmpty();
}
