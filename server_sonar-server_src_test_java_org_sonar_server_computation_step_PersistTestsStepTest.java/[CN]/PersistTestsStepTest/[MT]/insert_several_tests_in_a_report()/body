{
  BatchReportWriter writer=new BatchReportWriter(reportDir);
  List<BatchReport.Test> batchTests=Arrays.asList(newTest(1),newTest(2));
  writer.writeTests(TEST_FILE_REF_1,batchTests);
  List<CoverageDetail> coverageDetails=Arrays.asList(newCoverageDetail(1,MAIN_FILE_REF_1));
  writer.writeCoverageDetails(TEST_FILE_REF_1,coverageDetails);
  sut.execute(new ComputationContext(new BatchReportReader(reportDir),PROJECT_KEY,projectSettings));
  assertThat(db.countRowsOfTable("file_sources")).isEqualTo(1);
  FileSourceDto dto=dbClient.fileSourceDao().selectTest(TEST_FILE_UUID_1);
  assertThat(dto.getCreatedAt()).isEqualTo(now);
  assertThat(dto.getUpdatedAt()).isEqualTo(now);
  assertThat(dto.getProjectUuid()).isEqualTo(PROJECT_UUID);
  assertThat(dto.getFileUuid()).isEqualTo(TEST_FILE_UUID_1);
  assertThat(dto.getTestData()).hasSize(2);
  assertThat(dto.getTestData()).extracting("name","coveredFileCount").containsOnly(tuple("name#1",1),tuple("name#2",0));
  assertThat(log.logs()).isEmpty();
}
