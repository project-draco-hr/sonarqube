{
  ComponentDto module=ComponentTesting.newModuleDto(project);
  ComponentDto subModule=ComponentTesting.newModuleDto(module);
  ComponentDto file=ComponentTesting.newFileDto(subModule);
  tester.get(ComponentDao.class).insert(session,module,subModule,file);
  db.issueDao().insert(session,IssueTesting.newDto(rule,module,project),IssueTesting.newDto(rule,subModule,project),IssueTesting.newDto(rule,file,project));
  session.commit();
  index();
  assertThat(index.search(IssueQuery.builder().moduleUuids(newArrayList(file.uuid())).build(),new QueryContext()).getHits()).isEmpty();
  assertThat(index.search(IssueQuery.builder().moduleUuids(newArrayList(module.uuid())).build(),new QueryContext()).getHits()).hasSize(1);
  assertThat(index.search(IssueQuery.builder().moduleUuids(newArrayList(subModule.uuid())).build(),new QueryContext()).getHits()).hasSize(1);
  assertThat(index.search(IssueQuery.builder().moduleUuids(newArrayList(project.uuid())).build(),new QueryContext()).getHits()).hasSize(1);
  assertThat(index.search(IssueQuery.builder().moduleUuids(newArrayList("unknown")).build(),new QueryContext()).getHits()).isEmpty();
}
