{
  tester.clearDbAndIndexes();
  db=tester.get(DbClient.class);
  session=db.openSession(false);
  index=tester.get(IssueIndex.class);
  tester.get(RuleDao.class).insert(session,rule);
  tester.get(ComponentDao.class).insert(session,project);
  file=ComponentTesting.newFileDto(project,"F1").setPath("src/main/xoo/org/sonar/samples/File.xoo");
  file2=ComponentTesting.newFileDto(project,"F2").setPath("src/main/xoo/org/sonar/samples/File2.xoo");
  tester.get(ComponentDao.class).insert(session,file,file2);
  session.commit();
  MockUserSession.set().setLogin("admin").setGlobalPermissions(GlobalPermissions.SYSTEM_ADMIN);
  tester.get(InternalPermissionService.class).addPermission(new PermissionChange().setComponentKey(project.getKey()).setGroup(DefaultGroups.ANYONE).setPermission(UserRole.USER));
  MockUserSession.set();
  session.commit();
  session.clearCache();
}
