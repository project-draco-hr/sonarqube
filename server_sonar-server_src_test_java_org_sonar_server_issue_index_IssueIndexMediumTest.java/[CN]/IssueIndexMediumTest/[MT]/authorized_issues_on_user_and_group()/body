{
  ComponentDto project1=ComponentTesting.newProjectDto().setKey("project1");
  ComponentDto project2=ComponentTesting.newProjectDto().setKey("project2");
  ComponentDto file1=ComponentTesting.newFileDto(project1).setKey("file1");
  ComponentDto file2=ComponentTesting.newFileDto(project2).setKey("file2");
  indexIssue(IssueTesting.newDoc("ISSUE1",file1),"sonar-users","john");
  indexIssue(IssueTesting.newDoc("ISSUE2",file2),null,"max");
  IssueQuery.Builder query=IssueQuery.builder();
  MockUserSession.set().setLogin("john").setUserGroups("sonar-users");
  assertThat(index.search(query.build(),new QueryContext()).getHits()).hasSize(1);
}
