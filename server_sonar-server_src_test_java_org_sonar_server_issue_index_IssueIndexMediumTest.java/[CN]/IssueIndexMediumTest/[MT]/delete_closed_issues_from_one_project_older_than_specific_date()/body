{
  Date today=new Date();
  Date yesterday=org.apache.commons.lang.time.DateUtils.addDays(today,-1);
  Date beforeYesterday=org.apache.commons.lang.time.DateUtils.addDays(yesterday,-1);
  ComponentDto project=ComponentTesting.newProjectDto();
  ComponentDto file=ComponentTesting.newFileDto(project);
  indexIssues(IssueTesting.newDoc("ISSUE1",file).setFuncCloseDate(today),IssueTesting.newDoc("ISSUE2",file).setFuncCloseDate(beforeYesterday),IssueTesting.newDoc("ISSUE3",file).setFuncCloseDate(null));
  index.deleteClosedIssuesOfProjectBefore(project.uuid(),yesterday);
  List<Issue> issues=index.search(IssueQuery.builder().projectUuids(newArrayList(project.uuid())).build(),new QueryContext()).getHits();
  List<Date> dates=newArrayList();
  for (  Issue issue : issues) {
    dates.add(issue.closeDate());
  }
  assertThat(index.countAll()).isEqualTo(2);
  assertThat(dates).containsOnly(null,today);
}
