{
  QualityProfileDto p1=factory.create(dbSession,new QProfileName("xoo","P1"));
  db.propertiesDao().setProperty(new PropertyDto().setKey("sonar.profile.xoo").setValue("P1"),dbSession);
  db.propertiesDao().setProperty(new PropertyDto().setKey("sonar.profile.java").setValue("P1"),dbSession);
  db.propertiesDao().setProperty(new PropertyDto().setKey("sonar.profile.js").setValue("JS1"),dbSession);
  dbSession.commit();
  dbSession.clearCache();
  factory.rename(p1.getKey(),"P2");
  dbSession.clearCache();
  assertThat(db.propertiesDao().selectGlobalProperty("sonar.profile.xoo").getValue()).isEqualTo("P2");
  assertThat(db.propertiesDao().selectGlobalProperty("sonar.profile.java").getValue()).isEqualTo("P1");
  assertThat(db.propertiesDao().selectGlobalProperty("sonar.profile.js").getValue()).isEqualTo("JS1");
}
