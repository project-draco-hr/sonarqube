{
  ComponentDto project=new ComponentDto().setId(1L).setUuid("ABCD").setKey("org.codehaus.sonar:sonar").setName("SonarQube").setLongName("SonarQube").setQualifier("TRK").setScope("TRK").setEnabled(true);
  db.componentDao().insert(dbSession,project);
  QualityProfileDto profileDto=QProfileTesting.newXooP1();
  db.qualityProfileDao().insert(dbSession,profileDto);
  dbSession.commit();
  dbSession.clearCache();
  assertThat(factory.getByProjectAndLanguage("org.codehaus.sonar:sonar","xoo")).isNull();
  tester.get(QProfileProjectOperations.class).addProject(profileDto.getKey(),project.uuid(),new MockUserSession("me").setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN),dbSession);
  dbSession.commit();
  dbSession.clearCache();
  assertThat(factory.getByProjectAndLanguage("org.codehaus.sonar:sonar","xoo").getKey()).isEqualTo(XOO_P1_KEY);
}
