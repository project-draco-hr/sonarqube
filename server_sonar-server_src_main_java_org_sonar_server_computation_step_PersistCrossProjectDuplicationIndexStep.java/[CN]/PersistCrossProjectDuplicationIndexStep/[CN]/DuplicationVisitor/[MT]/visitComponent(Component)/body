{
  int indexInFile=0;
  CloseableIterator<ScannerReport.CpdTextBlock> blocks=reportReader.readCpdTextBlocks(component.getReportAttributes().getRef());
  try {
    while (blocks.hasNext()) {
      ScannerReport.CpdTextBlock block=blocks.next();
      dbClient.duplicationDao().insert(session,new DuplicationUnitDto().setHash(block.getHash()).setStartLine(block.getStartLine()).setEndLine(block.getEndLine()).setIndexInFile(indexInFile).setSnapshotId(dbIdsRepository.getSnapshotId(component)).setProjectSnapshotId(projectSnapshotId));
      indexInFile++;
    }
  }
  finally {
    blocks.close();
  }
}
