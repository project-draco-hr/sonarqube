{
  when(uuidFactory.create()).thenReturn(AN_ID);
  when(system.now()).thenReturn(A_DATE);
  SonarRuntime runtime=SonarRuntimeImpl.forSonarQube(Version.create(6,1),SonarQubeSide.SERVER);
  cluster.setStartupLeader(true);
  StartupMetadata metadata=underTest.provide(uuidFactory,system,runtime,cluster,dbTester.getDbClient());
  assertThat(metadata.getStartedAt()).isEqualTo(A_DATE);
  assertThat(metadata.getStartupId()).isEqualTo(AN_ID);
  assertNotPersistedProperty(CoreProperties.SERVER_ID);
  assertNotPersistedProperty("sonar.core.startedAt");
  StartupMetadata secondMetadata=underTest.provide(uuidFactory,system,runtime,cluster,dbTester.getDbClient());
  assertThat(secondMetadata).isSameAs(metadata);
}
