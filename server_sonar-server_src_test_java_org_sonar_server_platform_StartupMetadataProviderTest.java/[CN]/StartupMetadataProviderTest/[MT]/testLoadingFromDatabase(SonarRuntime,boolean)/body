{
  PersistentSettings persistentSettings=new PersistentSettings(dbTester.getDbClient(),new ServerSettingsImpl(new PropertyDefinitions(),new Properties()));
  new StartupMetadataPersister(new StartupMetadata(AN_ID,A_DATE),persistentSettings).start();
  cluster.setStartupLeader(isStartupLeader);
  StartupMetadata metadata=underTest.provide(uuidFactory,system,runtime,cluster,dbTester.getDbClient());
  assertThat(metadata.getStartedAt()).isEqualTo(A_DATE);
  assertThat(metadata.getStartupId()).isEqualTo(AN_ID);
  assertPersistedProperty(CoreProperties.SERVER_ID,AN_ID);
  assertPersistedProperty(CoreProperties.SERVER_STARTTIME,DateUtils.formatDateTime(A_DATE));
  StartupMetadata secondMetadata=underTest.provide(uuidFactory,system,runtime,cluster,dbTester.getDbClient());
  assertThat(secondMetadata).isSameAs(metadata);
  verifyZeroInteractions(uuidFactory,system);
}
