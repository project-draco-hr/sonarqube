{
  if (StringUtils.isEmpty(name.getName())) {
    throw new BadRequestException("quality_profiles.profile_name_cant_be_blank");
  }
  Date now=new Date();
  for (int i=0; i < 20; i++) {
    String key=Slug.slugify(String.format("%s %s %s",name.getLanguage(),name.getName(),RandomStringUtils.randomNumeric(5)));
    QualityProfileDto dto=QualityProfileDto.createFor(key).setName(name.getName()).setLanguage(name.getLanguage()).setRulesUpdatedAtAsDate(now);
    if (db.qualityProfileDao().selectByKey(dbSession,dto.getKey()) == null) {
      db.qualityProfileDao().insert(dbSession,dto);
      return dto;
    }
  }
  throw new IllegalStateException("Failed to create an unique quality profile for " + name);
}
