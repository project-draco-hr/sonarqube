{
  String fileKey="src/Foo.java";
  userSessionRule.addComponentPermission(UserRole.CODEVIEWER,"polop",fileKey);
  when(componentDao.getByKey(session,fileKey)).thenReturn(file);
  when(sourceService.getLinesAsTxt(file.uuid(),null,null)).thenReturn(newArrayList("public class HelloWorld {","}"));
  WsTester.TestRequest request=tester.newGetRequest("api/sources","raw").setParam("key",fileKey);
  String result=request.execute().outputAsString();
  assertThat(result).isEqualTo("public class HelloWorld {\n}\n");
}
