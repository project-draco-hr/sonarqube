{
  ComponentDto project1=ComponentTesting.newProjectDto("BCDE").setKey("project1").setName("project1").setLongName("project1");
  ComponentDto project2=ComponentTesting.newProjectDto("CDEF").setKey("project2").setName("project2").setLongName("project2");
  db.componentDao().insert(dbSession,project1);
  db.componentDao().insert(dbSession,project2);
  UserDto user=new UserDto().setLogin("john").setName("John").setEmail("jo@hn.com").setCreatedAt(System.currentTimeMillis()).setUpdatedAt(System.currentTimeMillis());
  db.userDao().insert(dbSession,user);
  tester.get(PermissionRepository.class).insertUserPermission(project1.getId(),user.getId(),UserRole.USER,dbSession);
  tester.get(PermissionRepository.class).insertUserPermission(project2.getId(),user.getId(),UserRole.USER,dbSession);
  UserSession userSession=userSessionRule.login("john").setUserId(user.getId().intValue()).setName("John").setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN);
  dbSession.commit();
  projectOperations.addProject(profile.getKey(),project1.uuid(),userSession);
  projectOperations.addProject(profile.getKey(),project2.uuid(),userSession);
  assertThat(tester.get(QProfileProjectLookup.class).projects(profile.getId())).hasSize(2);
  projectOperations.removeAllProjects(profile.getKey(),userSession);
  assertThat(tester.get(QProfileProjectLookup.class).projects(profile.getId())).isEmpty();
}
