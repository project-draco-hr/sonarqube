{
  dbTester.prepareDbUnit(getClass(),"empty.xml");
  dbComponentsRefCache.addComponent(1,new DbComponentsRefCache.DbComponent(1L,PROJECT_KEY,"ABCD"));
  File reportDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(reportDir);
  writer.writeMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).setProjectKey(PROJECT_KEY).build());
  writer.writeComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).addLink(BatchReport.ComponentLink.newBuilder().setType(Constants.ComponentLinkType.HOME).setHref("http://www.sonarqube.org").build()).addLink(BatchReport.ComponentLink.newBuilder().setType(Constants.ComponentLinkType.HOME).setHref("http://www.sonarqube.org").build()).build());
  try {
    step.execute(new ComputationContext(new BatchReportReader(reportDir),PROJECT_KEY,projectSettings));
    failBecauseExceptionWasNotThrown(IllegalArgumentException.class);
  }
 catch (  IllegalArgumentException e) {
    assertThat(e).hasMessage("Link of type 'homepage' has already been declared on component 'ABCD'");
  }
}
