{
  Map<Integer,Rule> rulesById=rulesById(ruleFinder.findAll(RuleQuery.create()));
  for (  CharacteristicDto dto : dtos) {
    Integer ruleId=dto.getRuleId();
    if (ruleId != null) {
      DefaultCharacteristic characteristic=characteristicsById.get(dto.getParentId());
      DefaultCharacteristic rootCharacteristic=characteristicsById.get(dto.getRootId());
      Rule rule=rulesById.get(ruleId);
      RuleKey ruleKey=RuleKey.of(rule.getRepositoryKey(),rule.getKey());
      dto.toRequirement(ruleKey,characteristic,rootCharacteristic);
    }
  }
}
