{
  TimeProfiler profiler=new TimeProfiler().start("Clean provided profiles");
  List<RulesProfile> existingProfiles=session.getResults(RulesProfile.class,"provided",true);
  for (  RulesProfile existingProfile : existingProfiles) {
    boolean isDeprecated=true;
    for (    RulesProfile profile : profiles) {
      if (StringUtils.equals(existingProfile.getName(),profile.getName()) && StringUtils.equals(existingProfile.getLanguage(),profile.getLanguage())) {
        isDeprecated=false;
        break;
      }
    }
    if (isDeprecated) {
      session.removeWithoutFlush(existingProfile);
    }
 else {
      for (      ActiveRule activeRule : existingProfile.getActiveRules()) {
        session.removeWithoutFlush(activeRule);
      }
      existingProfile.setActiveRules(new ArrayList<ActiveRule>());
      session.saveWithoutFlush(existingProfile);
    }
  }
  profiler.stop();
}
