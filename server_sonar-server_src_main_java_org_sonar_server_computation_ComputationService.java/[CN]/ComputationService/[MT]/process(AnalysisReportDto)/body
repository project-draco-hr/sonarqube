{
  TimeProfiler profiler=new TimeProfiler(LOG).start(String.format("#%s - %s - processing analysis report",report.getId(),report.getProjectKey()));
  DbSession session=dbClient.openSession(true);
  ComponentDto project=findProject(report,session);
  File reportDir=tempFolder.newDir();
  try {
    ComputationContext context=new ComputationContext(report,project,reportDir);
    dbClient.analysisReportDao().selectAndDecompressToDir(session,report.getId(),reportDir);
    for (    ComputationStep step : stepRegistry.steps()) {
      TimeProfiler stepProfiler=new TimeProfiler(LOG).start(step.getDescription());
      step.execute(session,context);
      stepProfiler.stop();
    }
    report.succeed();
  }
 catch (  Exception e) {
    report.fail();
    throw Throwables.propagate(e);
  }
 finally {
    FileUtils.deleteQuietly(reportDir);
    logActivity(session,report,project);
    session.commit();
    MyBatis.closeQuietly(session);
    profiler.stop();
  }
}
