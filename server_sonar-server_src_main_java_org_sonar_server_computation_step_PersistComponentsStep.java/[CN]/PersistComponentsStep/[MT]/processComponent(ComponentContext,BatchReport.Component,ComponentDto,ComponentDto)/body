{
  ComputeComponentsRefCache.ComputeComponent cacheComputeComponent=computeComponentsRefCache.getByRef(reportComponent.getRef());
  String componentKey=cacheComputeComponent.getKey();
  String componentUuid=cacheComputeComponent.getUuid();
  ComponentDto existingComponent=componentContext.componentDtosByKey.get(componentKey);
  if (existingComponent == null) {
    ComponentDto component=createComponent(reportComponent,componentKey,componentUuid,parentModule,project);
    dbClient.componentDao().insert(componentContext.dbSession,component);
    return component;
  }
 else {
    ComponentDto component=createComponent(reportComponent,componentKey,existingComponent.uuid(),parentModule,project);
    if (updateComponent(existingComponent,component)) {
      dbClient.componentDao().update(componentContext.dbSession,existingComponent);
    }
    return existingComponent;
  }
}
