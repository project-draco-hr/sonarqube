{
  ComponentDto existingComponent=componentDtosByKey.get(componentDto.getKey());
  if (existingComponent == null) {
    dbClient.componentDao().insert(session,componentDto);
  }
 else {
    componentDto.setId(existingComponent.getId());
    componentDto.setParentProjectId(existingComponent.parentProjectId());
    if (updateComponent(existingComponent,componentDto)) {
      dbClient.componentDao().update(session,componentDto);
    }
  }
  dbComponentsRefCache.addComponent(componentRef,new DbComponentsRefCache.DbComponent(componentDto.getId(),componentDto.getKey(),componentDto.uuid()));
}
