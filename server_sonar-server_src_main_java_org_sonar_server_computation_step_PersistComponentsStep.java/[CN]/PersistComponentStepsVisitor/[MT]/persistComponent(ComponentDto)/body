{
  ComponentDto existingComponent=existingComponentDtosByKey.get(componentDto.getKey());
  if (existingComponent == null) {
    dbClient.componentDao().insert(dbSession,componentDto);
    return componentDto;
  }
 else {
    if (shouldUpdate(existingComponent,componentDto)) {
      dbClient.componentDao().update(dbSession,existingComponent);
    }
    return existingComponent;
  }
}
