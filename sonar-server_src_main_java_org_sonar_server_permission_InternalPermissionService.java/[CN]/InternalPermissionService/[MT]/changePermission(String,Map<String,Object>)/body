{
  UserSession.get().checkPermission(Permissions.SYSTEM_ADMIN);
  PermissionChangeQuery permissionChangeQuery=PermissionChangeQuery.buildFromParams(params);
  if (permissionChangeQuery.isValid()) {
    if (Permissions.SYSTEM_ADMIN.equals(permissionChangeQuery.getRole()) && REMOVE.equals(permissionChange)) {
      checkThatAtLeastOneAdminRemains(permissionChangeQuery);
    }
    applyPermissionChange(permissionChange,permissionChangeQuery);
  }
 else {
    String errorMsg=String.format("Request '%s permission %s' is invalid",permissionChange,permissionChangeQuery.getRole());
    LOG.error(errorMsg);
    throw new IllegalArgumentException(errorMsg);
  }
}
