{
  ActiveRuleKey key=ActiveRuleKey.of(QualityProfileKey.of("profile","java"),RuleKey.of("repository","rule"));
  ActiveRuleChange change=ActiveRuleChange.createFor(ActiveRuleChange.Type.ACTIVATED,key).setInheritance(ActiveRule.Inheritance.INHERITED).setSeverity("BLOCKER").setParameter("param1","value1");
  service.write(dbSession,Activity.Type.QPROFILE,change);
  dbSession.commit();
  assertThat(index.findAll().getHits()).hasSize(1);
  Activity activity=Iterables.getFirst(index.findAll().getHits(),null);
  assertThat(activity).isNotNull();
  assertThat(activity.details().get("key")).isEqualTo(key.toString());
}
