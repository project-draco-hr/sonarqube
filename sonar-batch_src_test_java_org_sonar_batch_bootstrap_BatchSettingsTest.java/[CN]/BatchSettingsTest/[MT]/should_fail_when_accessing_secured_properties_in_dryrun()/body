{
  when(client.request("/batch_bootstrap/properties?dryRun=true")).thenReturn(JSON_RESPONSE_WITH_SECURED);
  when(client.request("/batch_bootstrap/properties?project=struts&dryRun=true")).thenReturn(REACTOR_JSON_RESPONSE);
  bootstrapSettings.properties().put(CoreProperties.DRY_RUN,"true");
  BatchSettings batchSettings=new BatchSettings(bootstrapSettings,new PropertyDefinitions(),client,deprecatedConf);
  batchSettings.init(new ProjectReactor(project));
  assertThat(batchSettings.getString("sonar.foo.license.secured")).isEqualTo("bar2");
  thrown.expect(SonarException.class);
  thrown.expectMessage("Access to the secured property 'sonar.foo.secured' is not possible in local (dry run) SonarQube analysis. The SonarQube plugin which requires this property must be deactivated in dry run mode.");
  batchSettings.getString("sonar.foo.secured");
}
