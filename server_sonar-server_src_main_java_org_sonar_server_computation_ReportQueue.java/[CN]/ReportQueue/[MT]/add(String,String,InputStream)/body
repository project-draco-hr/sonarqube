{
  String uuid=Uuids.create();
  File file=reportFileForUuid(uuid);
  DbSession session=dbClient.openSession(false);
  try {
    checkThatProjectExistsInDatabase(projectKey,session);
    saveReportOnDisk(reportData,file);
    AnalysisReportDto dto=saveReportMetadataInDatabase(projectKey,projectName,uuid,session);
    return new Item(dto,file);
  }
 catch (  Exception e) {
    FileUtils.deleteQuietly(file);
    throw new IllegalStateException("Fail to store analysis report of project " + projectKey,e);
  }
 finally {
    MyBatis.closeQuietly(session);
  }
}
