{
  Measure measure1=new Measure<>(CoreMetrics.COVERAGE).setValue(2.0);
  when(measureCache.byResource(sampleFile)).thenReturn(Arrays.asList(measure1));
  DefaultDuplication dup1=new DefaultDuplication().setOriginBlock(new Duplication.Block("foo:src/Foo.php",1,10)).isDuplicatedBy("foo:src/Foo.php",20,50);
  DefaultDuplication dup2=new DefaultDuplication().setOriginBlock(new Duplication.Block("foo:src/Foo.php",1,10)).isDuplicatedBy("another",20,50);
  when(duplicationCache.byComponent("foo:src/Foo.php")).thenReturn(Arrays.asList(dup1,dup2));
  File outputDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(outputDir);
  publisher.publish(writer);
  BatchReportReader reader=new BatchReportReader(outputDir);
  assertThat(reader.readComponentMeasures(1)).hasSize(0);
  List<org.sonar.batch.protocol.output.BatchReport.Measure> componentMeasures=reader.readComponentMeasures(2);
  assertThat(componentMeasures).hasSize(2);
  assertThat(componentMeasures.get(0).getStringValue()).isEqualTo("<duplications><g><b s=\"1\" l=\"10\" r=\"foo:src/Foo.php\"/><b s=\"20\" l=\"31\" r=\"foo:src/Foo.php\"/></g><g><b s=\"1\" l=\"10\" r=\"foo:src/Foo.php\"/><b s=\"20\" l=\"31\" r=\"another\"/></g></duplications>");
}
