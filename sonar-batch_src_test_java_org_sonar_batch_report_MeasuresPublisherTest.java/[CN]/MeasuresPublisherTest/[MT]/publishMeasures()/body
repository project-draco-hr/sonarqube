{
  Measure measure=new Measure<>(CoreMetrics.COVERAGE).setValue(2.0).setPersonId(2);
  Measure manual=new Measure<>(new Metric<>("manual_metric",ValueType.BOOL)).setValue(1.0);
  Measure rating=new Measure<>(CoreMetrics.SQALE_RATING).setValue(2.0).setData("A");
  Measure longMeasure=new Measure<>(CoreMetrics.TECHNICAL_DEBT).setValue(1.0);
  Measure stringMeasure=new Measure<>(CoreMetrics.NCLOC_LANGUAGE_DISTRIBUTION).setData("foo bar");
  when(measureCache.byResource(sampleFile)).thenReturn(asList(measure,manual,rating,longMeasure,stringMeasure));
  File outputDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(outputDir);
  publisher.publish(writer);
  BatchReportReader reader=new BatchReportReader(outputDir);
  assertThat(reader.readComponentMeasures(1)).hasSize(0);
  try (CloseableIterator<BatchReport.Measure> componentMeasures=reader.readComponentMeasures(2)){
    assertThat(componentMeasures).hasSize(5);
  }
 }
