{
  ComponentContainer parentContainer=new ComponentContainer();
  BatchSettings settings=mock(BatchSettings.class);
  parentContainer.add(settings);
  ProjectTree projectTree=mock(ProjectTree.class);
  Project project=mock(Project.class);
  when(project.getModules()).thenReturn(Lists.<Project>newArrayList());
  when(projectTree.getRootProject()).thenReturn(project);
  ProjectDefinition definition=mock(ProjectDefinition.class);
  when(projectTree.getProjectDefinition(project)).thenReturn(definition);
  parentContainer.add(projectTree);
  ProjectScanContainer container=new ProjectScanContainer(parentContainer);
  container.add(mock(ExtensionInstaller.class));
  container.doBeforeStart();
  container=spy(container);
  doNothing().when(container).scan(any(Project.class));
  container.doAfterStart();
  verify(settings).init(definition);
  container.stop();
  verify(settings).restore();
}
