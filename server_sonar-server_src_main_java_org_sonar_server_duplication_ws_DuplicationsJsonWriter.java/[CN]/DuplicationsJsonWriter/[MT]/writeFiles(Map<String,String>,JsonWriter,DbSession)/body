{
  Map<Long,ComponentDto> projectsById=newHashMap();
  Map<Long,ComponentDto> subProjectsById=newHashMap();
  for (  Map.Entry<String,String> entry : refByComponentKey.entrySet()) {
    String componentKey=entry.getKey();
    String ref=entry.getValue();
    ComponentDto file=componentDao.getNullableByKey(session,componentKey);
    if (file != null) {
      json.name(ref).beginObject();
      addFile(json,file);
      ComponentDto project=getProject(file.projectId(),projectsById,session);
      ComponentDto subProject=getProject(file.subProjectId(),subProjectsById,session);
      addProject(json,project,subProject);
      json.endObject();
    }
  }
}
