{
  Long componentId=componentId(query.component());
  int limit=query.pageSize();
  DbSession dbSession=dbClient.openSession(false);
  try {
    int total=permissionDao.countUsers(dbSession,query,componentId);
    return toUserQueryResult(permissionDao.selectUsers(dbSession,query,componentId,offset(query),limit),total);
  }
  finally {
    dbClient.closeSession(dbSession);
  }
}
