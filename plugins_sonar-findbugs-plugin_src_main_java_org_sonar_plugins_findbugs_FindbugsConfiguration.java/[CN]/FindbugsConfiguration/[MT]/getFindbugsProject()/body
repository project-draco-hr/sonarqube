{
  File classesDir=project.getFileSystem().getBuildOutputDir();
  if (classesDir == null || !classesDir.exists()) {
    throw new SonarException("Findbugs needs sources to be compiled. " + "Please build project or edit pom.xml to set the <outputDirectory> property before executing sonar.");
  }
  edu.umd.cs.findbugs.Project findbugsProject=new edu.umd.cs.findbugs.Project();
  for (  File dir : project.getFileSystem().getSourceDirs()) {
    findbugsProject.addSourceDir(dir.getAbsolutePath());
  }
  findbugsProject.addFile(classesDir.getAbsolutePath());
  for (  File file : projectClasspath.getElements()) {
    if (!file.equals(classesDir)) {
      findbugsProject.addAuxClasspathEntry(file.getAbsolutePath());
    }
  }
  findbugsProject.addAuxClasspathEntry(annotationsLib.getAbsolutePath());
  findbugsProject.addAuxClasspathEntry(jsr305Lib.getAbsolutePath());
  findbugsProject.setCurrentWorkingDirectory(project.getFileSystem().getBuildDir());
  return findbugsProject;
}
