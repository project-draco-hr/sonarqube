{
  Date date=new SimpleDateFormat("yyyy-MM-dd HH:mm").parse("2010-05-18 17:59");
  Server server=mock(Server.class);
  when(server.getPermanentServerId()).thenReturn("1abcdef");
  when(server.getId()).thenReturn("123");
  when(server.getVersion()).thenReturn("3.2");
  when(server.getStartedAt()).thenReturn(date);
  ServerMetadataPersister persister=new ServerMetadataPersister(server,persistentSettings);
  persister.start();
  verify(persistentSettings).saveProperties(argThat(new ArgumentMatcher<Map<String,String>>(){
    @Override public boolean matches(    Object o){
      Map<String,String> map=(Map<String,String>)o;
      return map.get(CoreProperties.SERVER_ID).equals("123") && map.get(CoreProperties.SERVER_VERSION).equals("3.2") && map.get(CoreProperties.SERVER_STARTTIME).equals("2010-05-18T17:59:00+0000")&& map.size() == 3;
    }
  }
));
}
