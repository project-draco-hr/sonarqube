{
  Date date=new SimpleDateFormat("yyyy-MM-dd HH:mm").parse("2010-05-18 17:59");
  Server server=mock(Server.class);
  when(server.getPermanentServerId()).thenReturn("1abcdef");
  when(server.getId()).thenReturn("123");
  when(server.getVersion()).thenReturn("3.2");
  when(server.getStartedAt()).thenReturn(date);
  ServerMetadataPersister persister=new ServerMetadataPersister(server,persistentSettings);
  persister.start();
  verify(persistentSettings).saveProperties(ImmutableMap.of(CoreProperties.SERVER_ID,"123",CoreProperties.SERVER_VERSION,"3.2",CoreProperties.SERVER_STARTTIME,"2010-05-18T17:59:00+0000"));
  persister.stop();
}
