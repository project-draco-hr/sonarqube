{
  Date date=new SimpleDateFormat("yyyy-MM-dd HH:mm").parse("2010-05-18 17:59");
  Server server=mock(Server.class);
  when(server.getPermanentServerId()).thenReturn("1abcdef");
  when(server.getId()).thenReturn("123");
  when(server.getVersion()).thenReturn("3.2");
  when(server.getStartedAt()).thenReturn(date);
  ServerMetadataPersister persister=new ServerMetadataPersister(server,persistentSettings);
  persister.start();
  verify(persistentSettings).saveProperties(argThat(new ArgumentMatcher<Map<String,String>>(){
    @Override public boolean matches(    Object argument){
      Map<String,String> props=(Map<String,String>)argument;
      return props.get(CoreProperties.SERVER_ID).equals("123") && props.get(CoreProperties.SERVER_VERSION).equals("3.2") && props.get(CoreProperties.SERVER_STARTTIME).startsWith("2010-05-18T");
    }
  }
));
  persister.stop();
}
