{
  CharacteristicDto rootCharacteristicDto=new CharacteristicDto().setId(1).setKey("MEMORY_EFFICIENCY").setName("Memory use");
  CharacteristicDto characteristicDto=new CharacteristicDto().setId(2).setKey("EFFICIENCY").setName("Efficiency").setParentId(1);
  CharacteristicDto requirementDto=new CharacteristicDto().setId(3).setParentId(2).setRuleId(100).setFunction("linear").setFactorValue(2d).setFactorUnit(WorkUnit.DAYS).setOffsetValue(0d).setOffsetUnit(WorkUnit.DEFAULT_UNIT);
  RuleKey ruleKey=RuleKey.of("checkstyle","Regexp");
  Rule rule=Rule.create(ruleKey.repository(),ruleKey.rule());
  rule.setId(100);
  when(ruleFinder.findAll(any(RuleQuery.class))).thenReturn(newArrayList(rule));
  when(dao.selectEnabledCharacteristics()).thenReturn(newArrayList(rootCharacteristicDto,characteristicDto,requirementDto));
  TechnicalDebtModel result=finder.findAll();
  assertThat(result.rootCharacteristics()).hasSize(1);
  Characteristic rootCharacteristic=result.characteristicByKey("MEMORY_EFFICIENCY");
  assertThat(rootCharacteristic.key()).isEqualTo("MEMORY_EFFICIENCY");
  assertThat(rootCharacteristic.name()).isEqualTo("Memory use");
  assertThat(rootCharacteristic.parent()).isNull();
  assertThat(rootCharacteristic.requirements()).isEmpty();
  assertThat(rootCharacteristic.children()).hasSize(1);
  assertThat(rootCharacteristic.children().get(0).key()).isEqualTo("EFFICIENCY");
  Characteristic characteristic=result.characteristicByKey("EFFICIENCY");
  assertThat(characteristic.key()).isEqualTo("EFFICIENCY");
  assertThat(characteristic.name()).isEqualTo("Efficiency");
  assertThat(characteristic.parent().key()).isEqualTo("MEMORY_EFFICIENCY");
  assertThat(characteristic.children()).isEmpty();
  assertThat(characteristic.requirements()).hasSize(1);
  assertThat(characteristic.requirements().get(0).ruleKey()).isEqualTo(ruleKey);
  Requirement requirement=result.requirementsByRule(ruleKey);
  assertThat(requirement.ruleKey()).isEqualTo(ruleKey);
  assertThat(requirement.function()).isEqualTo("linear");
  assertThat(requirement.factor()).isEqualTo(WorkUnit.create(2d,WorkUnit.DAYS));
  assertThat(requirement.offset()).isEqualTo(WorkUnit.create(0d,WorkUnit.DEFAULT_UNIT));
}
