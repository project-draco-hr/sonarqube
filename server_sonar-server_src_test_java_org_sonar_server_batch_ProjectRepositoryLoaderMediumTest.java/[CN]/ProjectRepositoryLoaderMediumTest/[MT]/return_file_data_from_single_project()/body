{
  ComponentDto project=ComponentTesting.newProjectDto();
  MockUserSession.set().setLogin("john").setGlobalPermissions(GlobalPermissions.SCAN_EXECUTION).addComponentPermission(UserRole.USER,project.getKey(),project.getKey());
  tester.get(DbClient.class).componentDao().insert(dbSession,project);
  addDefaultProfile();
  ComponentDto file=ComponentTesting.newFileDto(project,"file");
  tester.get(DbClient.class).componentDao().insert(dbSession,file);
  tester.get(FileSourceDao.class).insert(newFileSourceDto(file).setSrcHash("123456"));
  dbSession.commit();
  ProjectRepositories ref=loader.load(ProjectRepositoryQuery.create().setModuleKey(project.key()));
  assertThat(ref.fileDataByPath(project.key())).hasSize(1);
  FileData fileData=ref.fileData(project.key(),file.path());
  assertThat(fileData.hash()).isEqualTo("123456");
}
