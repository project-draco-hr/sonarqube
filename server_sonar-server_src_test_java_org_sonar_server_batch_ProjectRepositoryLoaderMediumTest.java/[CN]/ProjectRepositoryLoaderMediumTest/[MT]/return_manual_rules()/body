{
  MockUserSession.set().setLogin("john").setGlobalPermissions(GlobalPermissions.SCAN_EXECUTION);
  ComponentDto project=ComponentTesting.newProjectDto();
  tester.get(DbClient.class).componentDao().insert(dbSession,project);
  addDefaultProfile();
  RuleDto rule=RuleTesting.newManualRule("manualRuleKey").setName("Name manualRuleKey");
  tester.get(DbClient.class).ruleDao().insert(dbSession,rule);
  dbSession.commit();
  ProjectRepository ref=loader.load(ProjectRepositoryQuery.create().setModuleKey(project.key()));
  List<ActiveRule> activeRules=newArrayList(ref.activeRules());
  assertThat(activeRules).extracting("repositoryKey").containsOnly(RuleKey.MANUAL_REPOSITORY_KEY);
  assertThat(activeRules).extracting("ruleKey").containsOnly("manualRuleKey");
  assertThat(activeRules).extracting("name").containsOnly("Name manualRuleKey");
  assertThat(activeRules).extracting("language").containsNull();
  assertThat(activeRules).extracting("severity").containsNull();
}
