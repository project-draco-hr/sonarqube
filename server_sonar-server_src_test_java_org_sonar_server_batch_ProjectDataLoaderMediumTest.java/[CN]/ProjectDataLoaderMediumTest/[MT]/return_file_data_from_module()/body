{
  ComponentDto project=ComponentTesting.newProjectDto();
  tester.get(DbClient.class).componentDao().insert(dbSession,project);
  addDefaultProfile();
  ComponentDto projectFile=ComponentTesting.newFileDto(project,null,"projectFile");
  tester.get(DbClient.class).componentDao().insert(dbSession,projectFile);
  tester.get(FileSourceDao.class).insert(newFileSourceDto(projectFile).setSrcHash("123456").setRevision("987654321"));
  ComponentDto module=ComponentTesting.newModuleDto(project);
  userSessionRule.login("john").setGlobalPermissions(SCAN_EXECUTION);
  tester.get(DbClient.class).componentDao().insert(dbSession,module);
  ComponentDto moduleFile=ComponentTesting.newFileDto(module,null,"moduleFile");
  tester.get(DbClient.class).componentDao().insert(dbSession,moduleFile);
  tester.get(FileSourceDao.class).insert(newFileSourceDto(moduleFile).setSrcHash("789456").setRevision("123456789"));
  dbSession.commit();
  ProjectRepositories ref=underTest.load(ProjectDataQuery.create().setModuleKey(module.key()));
  assertThat(ref.fileData(module.key(),moduleFile.path()).hash()).isEqualTo("789456");
  assertThat(ref.fileData(module.key(),moduleFile.path()).revision()).isEqualTo("123456789");
  assertThat(ref.fileData(project.key(),projectFile.path())).isNull();
}
