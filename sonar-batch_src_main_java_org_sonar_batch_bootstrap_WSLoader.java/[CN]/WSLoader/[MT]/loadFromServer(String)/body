{
  if (isOffline()) {
    throw new IllegalStateException("Server is not accessible");
  }
  try {
    InputStream is=client.load(id,REQUEST_METHOD,true,CONNECT_TIMEOUT,READ_TIMEOUT);
    switchToOnline();
    byte[] value=IOUtils.toByteArray(is);
    if (cacheEnabled) {
      cache.put(client.getURI(id).toString(),value);
    }
    return value;
  }
 catch (  IllegalStateException e) {
    switchToOffline();
    throw e;
  }
catch (  Exception e) {
    switchToOffline();
    throw new IllegalStateException(e);
  }
}
