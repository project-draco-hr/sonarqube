{
  if (isOffline()) {
    throw new NotAvailableException("Server not available");
  }
  try {
    InputStream is=client.load(id,REQUEST_METHOD,true,CONNECT_TIMEOUT,READ_TIMEOUT);
    switchToOnline();
    byte[] value=IOUtils.toByteArray(is);
    updateCache(id,value);
    return new WSLoaderResult<byte[]>(value,false);
  }
 catch (  IllegalStateException e) {
    if (e.getCause() instanceof HttpDownloader.HttpException) {
      throw e;
    }
    switchToOffline();
    throw new NotAvailableException(e);
  }
catch (  Exception e) {
    throw new IllegalStateException(e);
  }
}
