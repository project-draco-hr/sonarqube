{
  List<Long> metricIds=context.prepareSelect("SELECT m.id FROM metrics m WHERE m.name IN ( " + "'blocker_violations', 'critical_violations', 'major_violations', 'minor_violations', 'info_violations', " + "'new_blocker_violations', 'new_critical_violations', 'new_major_violations', 'new_minor_violations', 'new_info_violations')").list(Select.LONG_READER);
  if (!metricIds.isEmpty()) {
    String sql="DELETE FROM project_measures WHERE rule_id IS NOT NULL AND metric_id IN (";
    String[] parameters=new String[metricIds.size()];
    Arrays.fill(parameters,"?");
    sql+=Joiner.on(",").join(parameters);
    sql+=")";
    Upsert delete=context.prepareUpsert(sql);
    for (int index=0; index < metricIds.size(); index++) {
      delete.setLong(index + 1,metricIds.get(index));
    }
    delete.execute().commit();
  }
}
