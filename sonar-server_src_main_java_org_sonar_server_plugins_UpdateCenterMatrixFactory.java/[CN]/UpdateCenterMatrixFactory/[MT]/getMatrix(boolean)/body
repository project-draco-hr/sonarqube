{
  UpdateCenter center=centerClient.getCenter(refresh);
  UpdateCenterMatrix matrix=null;
  if (center != null) {
    matrix=new UpdateCenterMatrix(center,sonarVersion);
    matrix.setDate(centerClient.getLastRefreshDate());
    for (    JpaPlugin plugin : dao.getPlugins()) {
      matrix.registerInstalledPlugin(plugin.getKey(),Version.create(plugin.getVersion()));
    }
    for (    String filename : downloader.getDownloads()) {
      matrix.registerPendingPluginsByFilename(filename);
    }
  }
  return matrix;
}
