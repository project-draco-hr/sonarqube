{
  UpdateCenter center=centerClient.getCenter(refresh);
  org.sonar.updatecenter.common.UpdateCenterMatrix matrix=null;
  if (center != null) {
    matrix=new org.sonar.updatecenter.common.UpdateCenterMatrix(center,sonarVersion);
    matrix.setDate(centerClient.getLastRefreshDate());
    for (    PluginMetadata metadata : pluginRepository.getMetadata()) {
      if (!metadata.isCore()) {
        matrix.registerInstalledPlugin(metadata.getKey(),Version.create(metadata.getVersion()));
      }
    }
    for (    String filename : downloader.getDownloads()) {
      matrix.registerPendingPluginsByFilename(filename);
    }
  }
  return matrix;
}
