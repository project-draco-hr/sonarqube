{
  UpdateCenter center=centerClient.getCenter(refresh);
  UpdateCenterMatrix matrix=null;
  if (center != null) {
    matrix=new UpdateCenterMatrix(center,sonarVersion);
    matrix.setDate(centerClient.getLastRefreshDate());
    for (    PluginMetadata metadata : pluginRepository.getMetadata()) {
      matrix.registerInstalledPlugin(metadata.getKey(),Version.create(metadata.getVersion()));
    }
    for (    String filename : downloader.getDownloads()) {
      matrix.registerPendingPluginsByFilename(filename);
    }
  }
  return matrix;
}
