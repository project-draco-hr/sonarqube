{
  try {
    ClassWorld world=new ClassWorld();
    ClassRealm realm=world.newRealm("squid.project",null);
    for (    File bytecode : bytecodeFilesOrDirectories) {
      URL url=getURL(bytecode);
      if (bytecode.isFile() && url.toString().endsWith(".class")) {
        LOG.info("Sonar Squid ClassLoader was expecting a JAR file instead of CLASS file : '" + bytecode.getAbsolutePath() + "'");
      }
 else {
        realm.addConstituent(url);
      }
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("----- Classpath analyzed by Squid:");
      for (      URL url : realm.getConstituents()) {
        LOG.debug(url.toString());
      }
      LOG.debug("-----");
    }
    return realm.getClassLoader();
  }
 catch (  Exception e) {
    throw new IllegalStateException("Can not create classloader",e);
  }
}
