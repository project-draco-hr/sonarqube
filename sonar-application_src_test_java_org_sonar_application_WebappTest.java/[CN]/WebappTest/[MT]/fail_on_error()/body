{
  Env env=mock(Env.class);
  File webDir=temp.newFolder("web");
  when(env.file("web")).thenReturn(webDir);
  Tomcat tomcat=mock(Tomcat.class,RETURNS_DEEP_STUBS);
  when(tomcat.addContext("",webDir.getAbsolutePath())).thenThrow(new NullPointerException());
  try {
    Webapp.configure(tomcat,env,new Props(new Properties()));
    fail();
  }
 catch (  IllegalStateException e) {
    assertThat(e).hasMessage("Fail to configure webapp");
  }
}
