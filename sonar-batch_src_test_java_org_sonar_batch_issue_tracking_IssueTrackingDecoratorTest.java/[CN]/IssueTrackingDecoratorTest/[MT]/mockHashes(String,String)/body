{
  DefaultInputFile inputFile=mock(DefaultInputFile.class);
  java.io.File f=temp.newFile();
  when(inputFile.path()).thenReturn(f.toPath());
  when(inputFile.charset()).thenReturn(Charsets.UTF_8);
  when(inputFile.lines()).thenReturn(newSource.split("\n").length);
  FileUtils.write(f,newSource,Charsets.UTF_8);
  when(inputFile.key()).thenReturn("foo:Action.java");
  when(inputPathCache.getFile("foo","Action.java")).thenReturn(inputFile);
  when(lastSnapshots.getLineHashes("foo:Action.java")).thenReturn(computeHexHashes(originalSource));
  Resource file=File.create("Action.java");
  return file;
}
