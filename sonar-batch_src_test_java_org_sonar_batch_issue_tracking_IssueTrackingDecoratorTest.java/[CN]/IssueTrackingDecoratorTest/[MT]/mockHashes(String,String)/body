{
  DefaultInputFile inputFile=mock(DefaultInputFile.class);
  java.io.File f=temp.newFile();
  when(inputFile.path()).thenReturn(f.toPath());
  when(inputFile.file()).thenReturn(f);
  when(inputFile.charset()).thenReturn(StandardCharsets.UTF_8);
  when(inputFile.lines()).thenReturn(StringUtils.countMatches(newSource,"\n") + 1);
  FileUtils.write(f,newSource,StandardCharsets.UTF_8);
  when(inputFile.key()).thenReturn("foo:Action.java");
  when(inputPathCache.getFile("foo","Action.java")).thenReturn(inputFile);
  when(lastSnapshots.getLineHashes("foo:Action.java")).thenReturn(computeHexHashes(originalSource));
  Resource file=File.create("Action.java");
  return file;
}
