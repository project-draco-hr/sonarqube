{
  when(upgradeStatus.isFreshInstall()).thenReturn(false);
  FileUtils.copyFileToDirectory(jar("foo-plugin-1.0.jar"),pluginsDir);
  jarsInstaller.install();
  assertThat(jarsInstaller.getMetadata()).hasSize(1);
  PluginMetadata plugin=jarsInstaller.getMetadata("foo");
  assertThat(plugin.getName()).isEqualTo("Foo");
  assertThat(plugin.getDeployedFiles()).hasSize(1);
  assertThat(plugin.isCore()).isFalse();
  assertThat(plugin.isUseChildFirstClassLoader()).isFalse();
  assertThat(FileUtils.listFiles(pluginsDir,new String[]{"jar"},false)).hasSize(1);
  assertThat(new File(pluginsDir,"foo-plugin-1.0.jar")).exists().isFile();
}
