{
  if (!lifecycle.tryToMoveTo(State.STARTING)) {
    throw new IllegalStateException("Already started");
  }
  monitoredProcess=mp;
  JmxUtils.registerMBean(this,props.nonNullValue(PROPERTY_PROCESS_KEY));
  Runtime.getRuntime().addShutdownHook(shutdownHook);
  if (!props.valueAsBoolean(PROPERTY_AUTOKILL_DISABLED,false)) {
    scheduleAutokill();
  }
  try {
    monitoredProcess.start();
    boolean ready=false;
    while (!ready) {
      ready=monitoredProcess.isReady();
      Thread.sleep(200L);
    }
    if (lifecycle.tryToMoveTo(State.STARTED)) {
      monitoredProcess.awaitTermination();
    }
  }
 catch (  Exception e) {
    LoggerFactory.getLogger(getClass()).warn("Fail to start",e);
  }
 finally {
    terminate();
  }
}
