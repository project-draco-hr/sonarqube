{
  if (!lifecycle.tryToMoveTo(Lifecycle.State.STARTING)) {
    throw new IllegalStateException("Already started");
  }
  monitored=mp;
  try {
    LoggerFactory.getLogger(getClass()).info("Starting " + getKey());
    Runtime.getRuntime().addShutdownHook(shutdownHook);
    stopWatcher.start();
    monitored.start();
    boolean ready=false;
    while (!ready) {
      ready=monitored.isReady();
      Thread.sleep(20L);
    }
    commands.setReady();
    if (lifecycle.tryToMoveTo(Lifecycle.State.STARTED)) {
      monitored.awaitStop();
    }
  }
 catch (  Exception e) {
    LoggerFactory.getLogger(getClass()).warn("Fail to start " + getKey(),e);
  }
 finally {
    stop();
  }
}
