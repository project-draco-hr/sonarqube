{
  ServerFileSystem fileSystem=mock(ServerFileSystem.class);
  PmdRuleRepository repository=new PmdRuleRepository(fileSystem,new XMLRuleParser());
  List<Rule> rules=repository.createRules();
  RuleFinder ruleFinder=new PmdRuleFinder(rules);
  PmdProfileImporter importer=new PmdProfileImporter(ruleFinder);
  Reader reader=new StringReader(TestUtils.getResourceContent("/org/sonar/plugins/pmd/simple.xml"));
  RulesProfile rulesProfile=importer.importProfile(reader,ValidationMessages.create());
  StringWriter xmlOutput=new StringWriter();
  exporter.exportProfile(rulesProfile,xmlOutput);
  assertEquals(TestUtils.getResourceContent("/org/sonar/plugins/pmd/export_simple.xml"),StringUtils.remove(xmlOutput.toString(),'\r'));
}
