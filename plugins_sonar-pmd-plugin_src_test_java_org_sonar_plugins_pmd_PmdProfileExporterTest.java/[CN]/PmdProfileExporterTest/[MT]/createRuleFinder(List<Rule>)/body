{
  RuleFinder ruleFinder=mock(RuleFinder.class);
  when(ruleFinder.find(any(RuleQuery.class))).then(new Answer<Rule>(){
    public Rule answer(    InvocationOnMock invocation){
      RuleQuery query=(RuleQuery)invocation.getArguments()[0];
      for (      Rule rule : rules) {
        if (query.getConfigKey().equals(rule.getConfigKey())) {
          return rule.setRepositoryKey(PmdConstants.REPOSITORY_KEY);
        }
      }
      return null;
    }
  }
);
  return ruleFinder;
}
