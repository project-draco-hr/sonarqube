{
  Integer currentVersion=databaseVersion.getVersion();
  if (currentVersion == null) {
    throw new IllegalStateException("Version can not be retrieved from Database. Database is either blank or corrupted");
  }
  if (currentVersion >= DatabaseVersion.LAST_VERSION) {
    writeResponse(response,databaseMigration);
  }
 else   if (!database.getDialect().supportsMigration()) {
    writeNotSupportedResponse(response);
  }
 else {
switch (databaseMigration.status()) {
case RUNNING:
case FAILED:
case SUCCEEDED:
      writeResponse(response,databaseMigration);
    break;
case NONE:
  databaseMigration.startIt();
writeNoneResponse(response,databaseMigration);
break;
default :
throw new IllegalArgumentException(UNSUPPORTED_DATABASE_MIGRATION_STATUS);
}
}
}
