{
  db.truncateTables();
  dbClient=new DbClient(db.database(),db.myBatis(),new MeasureDao());
  sourceLineIndex=mock(SourceLineIndex.class);
  metricRepository=mock(MetricRepository.class);
  projectSettings=new Settings();
  languageRepository=mock(LanguageRepository.class);
  when(metricRepository.getByKey(anyString())).thenReturn(new MetricImpl(10,"key","name",Metric.MetricType.STRING));
  sut=new PersistNumberOfDaysSinceLastCommitStep(System2.INSTANCE,dbClient,sourceLineIndex,metricRepository,treeRootHolder,reportReader,dbIdsRepository);
}
