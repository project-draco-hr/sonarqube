{
  panel.add(new Loading());
  ResourceQuery query=ResourceQuery.createForMetrics(resource.getId().toString(),"lcom4","lcom4_blocks");
  Sonar.getInstance().find(query,new AbstractCallback<Resource>(){
    @Override protected void doOnResponse(    Resource resource){
      panel.clear();
      panel.add(new Header(resource));
      if (resource != null && resource.getMeasure("lcom4_blocks") != null) {
        String json=resource.getMeasure("lcom4_blocks").getData();
        Data.Blocks blocks=Data.parse(json);
        Grid grid=new Grid(blocks.size(),2);
        grid.setStyleName("lcom4blocks");
        grid.getColumnFormatter().setStyleName(0,"index");
        for (int indexBlock=0; indexBlock < blocks.size(); indexBlock++) {
          Data.Block block=blocks.get(indexBlock);
          grid.setHTML(indexBlock,0,"<div class='index'>" + (indexBlock + 1) + "</div>");
          VerticalPanel blockPanel=new VerticalPanel();
          blockPanel.setStyleName("lcom4block");
          for (int indexEntity=0; indexEntity < block.size(); indexEntity++) {
            Data.Entity entity=block.get(indexEntity);
            HTML row=new HTML(Icons.forQualifier(entity.getQualifier()).getHTML() + " " + entity.getName());
            row.setStyleName("lcom4row");
            blockPanel.add(row);
          }
          grid.setWidget(indexBlock,1,blockPanel);
        }
        panel.add(grid);
      }
    }
  }
);
}
