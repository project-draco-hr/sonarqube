{
  File basedir=temp.newFolder();
  Settings settings=new Settings();
  DefaultModuleFileSystem fileSystem=new DefaultModuleFileSystem(mock(FileHashCache.class)).setBaseDir(basedir).setWorkingDir(temp.newFolder()).addSourceDir(new File(basedir,"src/main/java")).setSettings(settings);
  settings.setProperty(CoreProperties.INCREMENTAL_PREVIEW,true);
  thrown.expect(SonarException.class);
  thrown.expectMessage("Incremental preview is only supported with preview mode");
  fileSystem.files(FileQuery.onSource());
}
