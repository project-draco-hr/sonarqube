{
  IssueQuery query=createQuery(request);
  SearchOptions searchOptions=SearchOptions.create(request);
  QueryContext queryContext=new QueryContext();
  queryContext.setPage(searchOptions.page(),searchOptions.pageSize());
  queryContext.setFacet(request.mandatoryParamAsBoolean(PARAM_FACETS));
  IssueResult results=service.search(query,queryContext);
  JsonWriter json=response.newJsonWriter();
  json.beginObject();
  writePaging(results,json);
  writeIssues(results,request.paramAsStrings(EXTRA_FIELDS_PARAM),json);
  writeComponents(results,json);
  writeProjects(results,json);
  if (queryContext.isFacet()) {
    writeFacets(results,json);
  }
  json.endObject().close();
}
