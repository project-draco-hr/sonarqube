{
  SearchOptions options=new SearchOptions();
  options.setPage(request.mandatoryParamAsInt(WebService.Param.PAGE),request.mandatoryParamAsInt(WebService.Param.PAGE_SIZE));
  options.addFacets(request.paramAsStrings(WebService.Param.FACETS));
  IssueQuery query=issueQueryService.createFromRequest(request);
  SearchResult<IssueDoc> result=execute(query,options);
  JsonWriter json=response.newJsonWriter().beginObject();
  options.writeJson(json,result.getTotal());
  options.writeDeprecatedJson(json,result.getTotal());
  writeResponse(request,result,json);
  if (!options.getFacets().isEmpty()) {
    writeFacets(request,options,result,json);
  }
  json.endObject().close();
}
