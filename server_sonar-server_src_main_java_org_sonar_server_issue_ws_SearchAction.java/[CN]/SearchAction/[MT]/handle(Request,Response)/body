{
  IssueQuery query=createQuery(request);
  SearchOptions searchOptions=SearchOptions.create(request);
  QueryOptions queryOptions=new QueryOptions();
  queryOptions.setPage(searchOptions.page(),searchOptions.pageSize());
  queryOptions.setFacet(request.mandatoryParamAsBoolean(PARAM_FACETS));
  IssueResult results=service.search(query,queryOptions);
  JsonWriter json=response.newJsonWriter();
  json.beginObject();
  writePaging(results,json);
  writeIssues(results,request.paramAsStrings(EXTRA_FIELDS_PARAM),json);
  writeComponents(results,json);
  writeProjects(results,json);
  writeRules(results,json);
  writeUsers(results,json);
  writeActionPlans(results,json);
  json.endObject().close();
}
