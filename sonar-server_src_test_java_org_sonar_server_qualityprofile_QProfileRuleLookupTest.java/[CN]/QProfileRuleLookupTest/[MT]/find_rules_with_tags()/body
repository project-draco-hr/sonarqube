{
  esSetup.client().prepareBulk().add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("find_inactive_rules_with_tags/tags_empty.json"))).add(Requests.indexRequest().index("rules").type("active_rule").parent("2303").source(testFileAsString("find_inactive_rules_with_tags/active_rule_empty.json"))).add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("find_inactive_rules_with_tags/tags_a.json"))).add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("find_inactive_rules_with_tags/tags_ab.json"))).add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("find_inactive_rules_with_tags/tags_bc.json"))).add(Requests.indexRequest().index("rules").type("rule").source(testFileAsString("find_inactive_rules_with_tags/tags_ace.json"))).add(Requests.indexRequest().index("rules").type("active_rule").parent("2307").source(testFileAsString("find_inactive_rules_with_tags/active_rule_ace.json"))).setRefresh(true).execute().actionGet();
  Paging paging=Paging.create(10,1);
  List<QProfileRule> rules=profileRules.searchInactives(ProfileRuleQuery.create(1).setLanguage("xoo"),paging).rules();
  assertThat(rules).hasSize(5);
  assertThat(rules.get(0).systemTags()).containsOnly("taga");
  assertThat(rules.get(0).adminTags()).isEmpty();
  assertThat(rules.get(1).systemTags()).containsOnly("tagb");
  assertThat(rules.get(1).adminTags()).containsOnly("taga");
  assertThat(rules.get(2).systemTags()).containsOnly("taga","tagc");
  assertThat(rules.get(2).adminTags()).containsOnly("tage");
  assertThat(rules.get(3).systemTags()).containsOnly("tagb","tagc");
  assertThat(rules.get(3).adminTags()).isEmpty();
  assertThat(rules.get(4).systemTags()).isEmpty();
  assertThat(rules.get(4).adminTags()).isEmpty();
  assertThat(profileRules.searchInactiveProfileRuleIds(ProfileRuleQuery.create(2).setLanguage("xoo").addTags("taga"))).hasSize(2).containsOnly(2304,2305);
  assertThat(profileRules.searchInactiveProfileRuleIds(ProfileRuleQuery.create(2).setLanguage("xoo").addTags("taga","tagb"))).hasSize(1).containsOnly(2305);
  assertThat(profileRules.searchProfileRuleIds(ProfileRuleQuery.create(2).setLanguage("xoo").addTags("taga"))).hasSize(1).containsOnly(2307);
  assertThat(profileRules.searchProfileRuleIds(ProfileRuleQuery.create(2).setLanguage("xoo").addTags("tagb"))).isEmpty();
}
