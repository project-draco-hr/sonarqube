{
  try (DbSession session=dbClient.openSession(false)){
    final String componentKey=request.mandatoryParam("key");
    UserSession.get().checkComponentPermission(UserRole.CODEVIEWER,componentKey);
    final ComponentDto component=dbClient.componentDao().getByKey(session,componentKey);
    response.stream().setMediaType("text/plain");
    OutputStreamWriter writer=new OutputStreamWriter(response.stream().output(),Charsets.UTF_8);
    try {
      HashFunction hashFunction=new HashFunction(writer,componentKey);
      dbClient.fileSourceDao().readLineHashesStream(session,component.uuid(),hashFunction);
      if (!hashFunction.hasData()) {
        response.noContent();
      }
    }
  finally {
      writer.close();
    }
  }
 }
