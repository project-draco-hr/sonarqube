{
  if (o == this) {
    return (true);
  }
 else   if (!(o instanceof Map)) {
    return (false);
  }
  Map mo=(Map)o;
  if (fast) {
    if (mo.size() != map.size()) {
      return (false);
    }
    Iterator i=map.entrySet().iterator();
    while (i.hasNext()) {
      Map.Entry e=(Map.Entry)i.next();
      Object key=e.getKey();
      Object value=e.getValue();
      if (value == null) {
        if (!(mo.get(key) == null && mo.containsKey(key))) {
          return (false);
        }
      }
 else {
        if (!value.equals(mo.get(key))) {
          return (false);
        }
      }
    }
    return (true);
  }
 else {
synchronized (map) {
      if (mo.size() != map.size()) {
        return (false);
      }
      Iterator i=map.entrySet().iterator();
      while (i.hasNext()) {
        Map.Entry e=(Map.Entry)i.next();
        Object key=e.getKey();
        Object value=e.getValue();
        if (value == null) {
          if (!(mo.get(key) == null && mo.containsKey(key))) {
            return (false);
          }
        }
 else {
          if (!value.equals(mo.get(key))) {
            return (false);
          }
        }
      }
      return (true);
    }
  }
}
