{
  if (!query.hasParentRuleCriteria()) {
    return FilterBuilders.matchAllFilter();
  }
  BoolFilterBuilder result=boolFilter();
  addMustTermOrTerms(result,RuleDocument.FIELD_REPOSITORY_KEY,query.repositoryKeys());
  addMustTermOrTerms(result,RuleDocument.FIELD_STATUS,query.statuses());
  if (StringUtils.isNotBlank(query.nameOrKey())) {
    result.must(queryFilter(multiMatchQuery(query.nameOrKey(),RuleDocument.FIELD_NAME,RuleDocument.FIELD_KEY).operator(Operator.AND)));
  }
  return result;
}
