{
  SearchHits hits=index.client().prepareSearch("rules").setTypes("active_rule").setFilter(boolFilter().must(termFilter("profileId",profile.id()))).addFields("_source","_parent").setSize(paging.pageSize()).setFrom(paging.offset()).execute().actionGet().getHits();
  String[] activeRuleSources=new String[hits.getHits().length];
  String[] parentIds=new String[hits.getHits().length];
  int hitCounter=0;
  List<QProfileRule> result=Lists.newArrayList();
  for (  SearchHit hit : hits.getHits()) {
    activeRuleSources[hitCounter]=hit.sourceAsString();
    parentIds[hitCounter]=hit.field("_parent").value();
    hitCounter++;
  }
  MultiGetItemResponse[] responses=index.client().prepareMultiGet().add("rules","rule",parentIds).execute().actionGet().getResponses();
  for (int i=0; i < hitCounter; i++) {
    result.add(new QProfileRule(responses[i].getResponse().getSourceAsString(),activeRuleSources[i]));
  }
  return result;
}
