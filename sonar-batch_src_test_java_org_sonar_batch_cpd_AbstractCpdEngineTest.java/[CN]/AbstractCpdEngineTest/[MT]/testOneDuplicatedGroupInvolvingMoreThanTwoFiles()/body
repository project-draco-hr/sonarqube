{
  List<CloneGroup> groups=Arrays.asList(newCloneGroup(new ClonePart(batchComponent1.key(),0,5,204),new ClonePart(batchComponent2.key(),0,15,214),new ClonePart(batchComponent3.key(),0,25,224)));
  engine.saveDuplications(inputFile1,groups);
  assertThat(reader.readComponentDuplications(batchComponent1.batchId())).hasSize(1);
  CloseableIterator<Duplication> dups=reader.readComponentDuplications(batchComponent1.batchId());
  Duplication duplication=dups.next();
  dups.close();
  assertThat(duplication.getOriginPosition().getStartLine()).isEqualTo(5);
  assertThat(duplication.getOriginPosition().getEndLine()).isEqualTo(204);
  assertThat(duplication.getDuplicateList()).hasSize(2);
  assertThat(duplication.getDuplicate(0).getOtherFileRef()).isEqualTo(batchComponent2.batchId());
  assertThat(duplication.getDuplicate(0).getRange().getStartLine()).isEqualTo(15);
  assertThat(duplication.getDuplicate(0).getRange().getEndLine()).isEqualTo(214);
  assertThat(duplication.getDuplicate(1).getOtherFileRef()).isEqualTo(batchComponent3.batchId());
  assertThat(duplication.getDuplicate(1).getRange().getStartLine()).isEqualTo(25);
  assertThat(duplication.getDuplicate(1).getRange().getEndLine()).isEqualTo(224);
}
