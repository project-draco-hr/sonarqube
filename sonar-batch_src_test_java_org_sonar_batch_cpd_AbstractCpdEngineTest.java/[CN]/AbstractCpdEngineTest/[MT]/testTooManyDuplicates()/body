{
  List<ClonePart> parts=new ArrayList<>(AbstractCpdEngine.MAX_CLONE_PART_PER_GROUP + 2);
  for (int i=0; i < AbstractCpdEngine.MAX_CLONE_PART_PER_GROUP + 2; i++) {
    parts.add(new ClonePart(batchComponent1.key(),i,i,i + 1));
  }
  List<CloneGroup> groups=Arrays.asList(CloneGroup.builder().setLength(0).setOrigin(parts.get(0)).setParts(parts).build());
  engine.saveDuplications(inputFile1,groups);
  assertThat(reader.readComponentDuplications(batchComponent1.batchId())).hasSize(1);
  CloseableIterator<Duplication> dups=reader.readComponentDuplications(batchComponent1.batchId());
  Duplication duplication=dups.next();
  dups.close();
  assertThat(duplication.getDuplicateList()).hasSize(AbstractCpdEngine.MAX_CLONE_PART_PER_GROUP);
  assertThat(logTester.logs(LoggerLevel.WARN)).contains("Too many duplication references on file " + inputFile1.relativePath() + " for block at line 0. Keep only the first "+ AbstractCpdEngine.MAX_CLONE_PART_PER_GROUP+ " references.");
}
