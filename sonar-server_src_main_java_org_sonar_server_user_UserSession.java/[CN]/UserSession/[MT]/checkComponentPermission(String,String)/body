{
  String projectKey=projectKeyByComponentKey.get(componentKey);
  if (projectKey == null) {
    ResourceDto project=resourceDao().getRootProjectByComponentKey(componentKey);
    if (project == null) {
      throw new NotFoundException(String.format("Component '%s' does not exist",componentKey));
    }
    projectKey=project.getKey();
  }
  UserSession userSession=checkProjectPermission(projectPermission,projectKey);
  projectKeyByComponentKey.put(componentKey,projectKey);
  return userSession;
}
