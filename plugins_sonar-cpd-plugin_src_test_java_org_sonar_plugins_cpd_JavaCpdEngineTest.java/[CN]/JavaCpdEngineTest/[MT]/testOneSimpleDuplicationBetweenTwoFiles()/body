{
  inputFile.setLines(300);
  List<CloneGroup> groups=Arrays.asList(newCloneGroup(new ClonePart("key1",0,5,204),new ClonePart("key2",0,15,214)));
  JavaCpdEngine.save(context,inputFile,groups,contextFactory);
  verify(persister).store(new DefaultMeasure().forMetric(CoreMetrics.DUPLICATED_FILES).onFile(inputFile).withValue(1));
  verify(persister).store(new DefaultMeasure().forMetric(CoreMetrics.DUPLICATED_BLOCKS).onFile(inputFile).withValue(1));
  verify(persister).store(new DefaultMeasure().forMetric(CoreMetrics.DUPLICATED_LINES).onFile(inputFile).withValue(200));
  InOrder inOrder=Mockito.inOrder(duplicationBuilder);
  inOrder.verify(duplicationBuilder).originBlock(5,204);
  inOrder.verify(duplicationBuilder).isDuplicatedBy("key2",15,214);
  inOrder.verify(duplicationBuilder).build();
  verify(linesContext).setIntValue(CoreMetrics.DUPLICATION_LINES_DATA_KEY,1,0);
  verify(linesContext).setIntValue(CoreMetrics.DUPLICATION_LINES_DATA_KEY,4,0);
  verify(linesContext).setIntValue(CoreMetrics.DUPLICATION_LINES_DATA_KEY,5,1);
  verify(linesContext).setIntValue(CoreMetrics.DUPLICATION_LINES_DATA_KEY,204,1);
  verify(linesContext).setIntValue(CoreMetrics.DUPLICATION_LINES_DATA_KEY,205,0);
}
