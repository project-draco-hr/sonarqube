{
  String fileKey=request.mandatoryParam(KEY);
  UserSession.get().checkComponentPermission(UserRole.CODEVIEWER,fileKey);
  String testData=findTestData(fileKey);
  JsonWriter json=response.newJsonWriter().beginObject();
  if (testData != null) {
    writeFromTestData(testData,json);
  }
 else {
    MutableTestPlan testPlan=snapshotPerspectives.as(MutableTestPlan.class,fileKey);
    if (testPlan != null) {
      writeFromTestable(testPlan,json);
    }
  }
  json.endObject().close();
}
