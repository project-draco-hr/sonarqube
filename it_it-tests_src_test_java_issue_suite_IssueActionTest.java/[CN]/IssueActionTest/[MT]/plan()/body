{
  assertThat(issue.actionPlan()).isNull();
  ActionPlan newActionPlan=adminActionPlanClient().create(NewActionPlan.create().name("Short term").project("sample").description("Short term issues").deadLine(toDate("2113-01-31")));
  assertThat(newActionPlan.key()).isNotNull();
  adminIssueClient().plan(issue.key(),newActionPlan.key());
  assertThat(search(IssueQuery.create().actionPlans(newActionPlan.key())).list()).hasSize(1);
  projectAnalysis.run();
  Issue reloaded=searchIssueByKey(issue.key());
  assertThat(reloaded.actionPlan()).isEqualTo(newActionPlan.key());
  assertThat(reloaded.creationDate()).isEqualTo(issue.creationDate());
  ActionPlan actionPlan=search(IssueQuery.create().actionPlans(newActionPlan.key())).actionPlans(reloaded);
  assertThat(actionPlan.name()).isEqualTo(newActionPlan.name());
  assertThat(actionPlan.deadLine()).isEqualTo(newActionPlan.deadLine());
}
