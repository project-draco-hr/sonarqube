{
  QualityProfileDto profile;
  DbSession dbSession=db.openSession(false);
  try {
    profile=db.qualityProfileDao().selectOrFailByKey(dbSession,key);
  }
  finally {
    dbSession.close();
  }
  List<ActiveRuleDoc> activeRules=Lists.newArrayList(activeRuleIndex.findByProfile(profile.getKey()));
  Collections.sort(activeRules,BackupActiveRuleComparator.INSTANCE);
  writeXml(writer,profile,activeRules.iterator());
}
