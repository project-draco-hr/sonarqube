{
  QualityProfileDto profile;
  DbSession dbSession=db.openSession(false);
  try {
    profile=db.qualityProfileDao().getNonNullByKey(dbSession,key);
  }
  finally {
    dbSession.close();
  }
  List<ActiveRule> activeRules=Lists.newArrayList(index.get(ActiveRuleIndex.class).findByProfile(profile.getKey()));
  Collections.sort(activeRules,BackupActiveRuleComparator.INSTANCE);
  writeXml(writer,profile,activeRules.iterator());
}
