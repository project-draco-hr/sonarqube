{
  try {
    if (datasource != null) {
      datasource.close();
      datasource=null;
    }
    DriverManager.getConnection("jdbc:derby:;shutdown=true");
  }
 catch (  SQLException e) {
    if (!"XJ015".equals(e.getSQLState())) {
      throw new IllegalStateException("Fail to stop Derby",e);
    }
  }
}
