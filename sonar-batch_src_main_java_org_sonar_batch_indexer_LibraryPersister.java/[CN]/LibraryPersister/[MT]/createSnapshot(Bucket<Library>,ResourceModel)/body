{
  Snapshot snapshot=getSession().getSingleResult(Snapshot.class,"resourceId",resourceModel.getId(),"version",bucket.getResource().getVersion(),"scope",Resource.SCOPE_SET,"qualifier",Resource.QUALIFIER_LIB);
  if (snapshot == null) {
    snapshot=new Snapshot(resourceModel,null);
    snapshot.setCreatedAt(now);
    snapshot.setVersion(bucket.getResource().getVersion());
    snapshot.setStatus(Snapshot.STATUS_PROCESSED);
  }
  return snapshot;
}
