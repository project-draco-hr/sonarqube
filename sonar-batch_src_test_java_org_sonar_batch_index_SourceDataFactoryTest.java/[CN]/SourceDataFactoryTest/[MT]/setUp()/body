{
  ReportPublisher reportPublisher=mock(ReportPublisher.class);
  reportDir=temp.newFolder();
  batchReportWriter=new BatchReportWriter(reportDir);
  when(reportPublisher.getReportDir()).thenReturn(reportDir);
  ResourceCache resourceCache=new ResourceCache();
  resourceCache.add(org.sonar.api.resources.File.create("src/Foo.java").setEffectiveKey("module_key:src/Foo.java"),null);
  when(measureCache.byMetric(anyString(),anyString())).thenReturn(Collections.<Measure>emptyList());
  sut=new SourceDataFactory(measureCache,duplicationCache,reportPublisher,resourceCache);
  File baseDir=temp.newFolder();
  DefaultFileSystem fs=new DefaultFileSystem(baseDir.toPath());
  inputFile=new DefaultInputFile("module_key","src/Foo.java").setLines(3).setCharset(Charsets.UTF_8);
  fs.add(inputFile);
  FileUtils.write(inputFile.file(),"one\ntwo\nthree\n");
  output=sut.createForSource(inputFile);
  when(duplicationCache.byComponent(anyString())).thenReturn(Collections.<DefaultDuplication>emptyList());
}
