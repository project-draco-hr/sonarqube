{
  String componentKey="src/Foo.java";
  MockUserSession.set().addComponentPermission(UserRole.CODEVIEWER,"org.codehaus.sonar:sonar",componentKey);
  MeasureKey measureKey=MeasureKey.of(componentKey,CoreMetrics.DUPLICATIONS_DATA_KEY);
  when(measureDao.getByKey(measureKey,session)).thenReturn(MeasureDto.createFor(measureKey).setTextValue("{duplications}"));
  WsTester.TestRequest request=tester.newGetRequest("api/duplications","show").setParam("key",componentKey);
  request.execute();
  verify(duplicationsWriter).write(eq("{duplications}"),any(JsonWriter.class),eq(session));
}
