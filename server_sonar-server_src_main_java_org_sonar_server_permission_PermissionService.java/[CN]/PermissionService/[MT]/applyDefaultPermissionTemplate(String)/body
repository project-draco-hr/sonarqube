{
  userSession.checkLoggedIn();
  DbSession session=dbClient.openSession(false);
  try {
    ComponentDto component=componentFinder.getByKey(session,componentKey);
    ResourceDto provisioned=dbClient.resourceDao().selectProvisionedProject(session,componentKey);
    if (provisioned == null) {
      checkProjectAdminPermission(componentKey);
    }
 else {
      userSession.checkGlobalPermission(GlobalPermissions.PROVISIONING);
    }
    permissionRepository.grantDefaultRoles(session,component.getId(),component.qualifier());
    session.commit();
  }
  finally {
    session.close();
  }
  indexProjectPermissions();
}
