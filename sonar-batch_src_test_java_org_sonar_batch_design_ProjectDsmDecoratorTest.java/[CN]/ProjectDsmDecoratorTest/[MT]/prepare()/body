{
  index=mock(SonarIndex.class);
  decorator=new ProjectDsmDecorator(index);
  root=new Project("root");
  rootContext=mock(DecoratorContext.class);
  module1=new Project("module1").setName("Module1").setParent(root);
  module1.setId(1);
  when(index.getResource(module1)).thenReturn(module1);
  module2=new Project("module2").setName("Module2").setParent(root);
  module2.setId(2);
  when(index.getResource(module2)).thenReturn(module2);
  DecoratorContext module1Context=mock(DecoratorContext.class);
  when(module1Context.getResource()).thenReturn(module1);
  DecoratorContext module2Context=mock(DecoratorContext.class);
  when(module2Context.getResource()).thenReturn(module2);
  when(rootContext.getChildren()).thenReturn(Arrays.asList(module1Context,module2Context));
}
