{
  DbSession dbSession=dbClient.openSession(false);
  try {
    Component project=treeRootHolder.getRoot();
    dbClient.snapshotDao().unsetIsLastFlagForComponentUuid(dbSession,project.getUuid());
    dbClient.snapshotDao().setIsLastFlagForAnalysisUuid(dbSession,analysisMetadataHolder.getUuid());
    dbSession.commit();
  }
  finally {
    MyBatis.closeQuietly(dbSession);
  }
}
