{
  QProfileActivityQuery query=new QProfileActivityQuery();
  query.setQprofileKey((String)params.get("profileKey"));
  Date since=RubyUtils.toDate(params.get("since"));
  if (since != null) {
    query.setSince(since);
  }
  Date to=RubyUtils.toDate(params.get("to"));
  if (to != null) {
    query.setTo(to);
  }
  SearchOptions options=new SearchOptions();
  Integer page=RubyUtils.toInteger(params.get("p"));
  int pageIndex=page != null ? page : 1;
  options.setPage(pageIndex,50);
  Result<QProfileActivity> result=service.searchActivities(query,options);
  return new QProfileActivityResult(result.getHits(),forPageIndex(pageIndex).withPageSize(options.getLimit()).andTotal((int)result.getTotal()));
}
