{
  String detectedLanguage=null;
  for (  String languageKey : languagesToConsider) {
    if (isCandidateForLanguage(inputFile,languageKey)) {
      if (detectedLanguage == null) {
        detectedLanguage=languageKey;
      }
 else {
        throw MessageException.of(MessageFormat.format("Language of file ''{0}'' can not be decided as the file matches patterns of both {1} and {2}",inputFile.relativePath(),getDetails(detectedLanguage),getDetails(languageKey)));
      }
    }
  }
  if (detectedLanguage != null) {
    LOG.debug(String.format("Language of file '%s' is detected to be '%s'",inputFile.relativePath(),detectedLanguage));
    return detectedLanguage;
  }
  if (forcedLanguage != null && patternsByLanguage.get(forcedLanguage).length == 0) {
    return forcedLanguage;
  }
  return null;
}
