{
  String currentVersion=projectSnapshot.getVersion();
  Integer resourceId=projectSnapshot.getResourceId();
  Long snapshotId;
  session.commit();
  try (DbSession dbSession=mybatis.openSession(false)){
    snapshotId=dbSession.getMapper(EventMapper.class).findSnapshotIdOfPreviousVersion(resourceId,currentVersion);
  }
   if (snapshotId == null) {
    return new PastSnapshot(CoreProperties.TIMEMACHINE_MODE_PREVIOUS_VERSION);
  }
  Snapshot snapshot=session.getSingleResult(Snapshot.class,"id",snapshotId.intValue());
  return new PastSnapshot(CoreProperties.TIMEMACHINE_MODE_PREVIOUS_VERSION,longToDate(snapshot.getCreatedAtMs()),snapshot).setModeParameter(snapshot.getVersion());
}
