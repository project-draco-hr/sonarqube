{
  if (!toDir.exists()) {
    FileUtils.forceMkdir(toDir);
  }
  ZipFile zipFile=new ZipFile(zip);
  try {
    Enumeration<? extends ZipEntry> entries=zipFile.entries();
    while (entries.hasMoreElements()) {
      ZipEntry entry=entries.nextElement();
      if (filter.accept(entry)) {
        File to=new File(toDir,entry.getName());
        if (entry.isDirectory()) {
          if (!to.exists() && !to.mkdirs()) {
            throw new IOException("Error creating directory: " + to);
          }
        }
 else {
          File parent=to.getParentFile();
          if (parent != null && !parent.exists() && !parent.mkdirs()) {
            throw new IOException("Error creating directory: " + parent);
          }
          FileOutputStream fos=new FileOutputStream(to);
          try {
            IOUtils.copy(zipFile.getInputStream(entry),fos);
          }
  finally {
            IOUtils.closeQuietly(fos);
          }
        }
      }
    }
  }
  finally {
    zipFile.close();
  }
}
