{
  if (file.isDirectory()) {
    entryName+='/';
    ZipEntry entry=new ZipEntry(entryName);
    out.putNextEntry(entry);
    out.closeEntry();
    File[] files=file.listFiles();
    for (int i=0, len=files.length; i < len; i++) {
      doZip(entryName + files[i].getName(),files[i],out);
    }
  }
 else {
    InputStream in=null;
    try {
      in=new BufferedInputStream(new FileInputStream(file));
      doZip(entryName,in,out);
    }
  finally {
      IOUtils.closeQuietly(in);
    }
  }
}
