{
  DigestInputStream digestInputStream=null;
  try {
    MessageDigest digest=MessageDigest.getInstance("MD5");
    digestInputStream=new DigestInputStream(input,digest);
    while (digestInputStream.read() != -1) {
    }
    byte[] hash=digest.digest();
    return toHex(hash);
  }
 catch (  Exception e) {
    throw new IllegalStateException("Fail to compute hash",e);
  }
 finally {
    IOUtils.closeQuietly(digestInputStream);
    IOUtils.closeQuietly(input);
  }
}
