{
  MockUserSession.set().setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN).setLogin("me");
  service.activate(new RuleActivation(ActiveRuleKey.of(XOO_PROFILE_1,XOO_RULE_1)).setSeverity("MINOR"));
  service.activate(new RuleActivation(ActiveRuleKey.of(XOO_PROFILE_2,XOO_RULE_1)).setSeverity("BLOCKER"));
  dbSession.commit();
  Map<QualityProfileKey,Multimap<String,FacetValue>> stats=service.getAllProfileStats();
  System.out.println("stats = " + stats);
  assertThat(stats.size()).isEqualTo(2);
  assertThat(stats.get(XOO_PROFILE_1).size()).isEqualTo(3);
  assertThat(stats.get(XOO_PROFILE_1).get(ActiveRuleNormalizer.ActiveRuleField.SEVERITY.field()).size()).isEqualTo(1);
  assertThat(stats.get(XOO_PROFILE_1).get(ActiveRuleNormalizer.ActiveRuleField.INHERITANCE.field()).size()).isEqualTo(1);
  assertThat(stats.get(XOO_PROFILE_1).get("countActiveRules").size()).isEqualTo(1);
}
