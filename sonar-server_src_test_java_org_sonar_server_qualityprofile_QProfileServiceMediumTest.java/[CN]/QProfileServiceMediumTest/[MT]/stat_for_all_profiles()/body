{
  MockUserSession.set().setGlobalPermissions(GlobalPermissions.QUALITY_PROFILE_ADMIN).setLogin("me");
  service.activate(XOO_P1_KEY,new RuleActivation(RuleTesting.XOO_X1).setSeverity("MINOR"));
  service.activate(XOO_P2_KEY,new RuleActivation(RuleTesting.XOO_X1).setSeverity("BLOCKER"));
  dbSession.clearCache();
  Map<String,Multimap<String,FacetValue>> stats=service.getAllProfileStats();
  assertThat(stats.size()).isEqualTo(2);
  assertThat(stats.get(XOO_P1_KEY).size()).isEqualTo(3);
  assertThat(stats.get(XOO_P1_KEY).get(ActiveRuleNormalizer.ActiveRuleField.SEVERITY.field()).size()).isEqualTo(1);
  assertThat(stats.get(XOO_P1_KEY).get(ActiveRuleNormalizer.ActiveRuleField.INHERITANCE.field()).size()).isEqualTo(1);
  assertThat(stats.get(XOO_P1_KEY).get("countActiveRules").size()).isEqualTo(1);
}
