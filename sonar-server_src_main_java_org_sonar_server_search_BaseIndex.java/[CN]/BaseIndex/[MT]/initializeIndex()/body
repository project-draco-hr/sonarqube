{
  initializeManagementIndex();
  String index=this.getIndexName();
  IndicesExistsResponse indexExistsResponse=getClient().admin().indices().prepareExists(index).execute().actionGet();
  try {
    if (!indexExistsResponse.isExists()) {
      LOG.info("Setup of {} for type {}",this.getIndexName(),this.getIndexType());
      getClient().admin().indices().prepareCreate(index).setSettings(getIndexSettings()).execute().actionGet();
    }
    Map<String,Object> mapping=new HashMap<String,Object>();
    mapping.put("dynamic",false);
    mapping.put("_id",mapKey());
    mapping.put("properties",mapProperties());
    LOG.info("Update of index {} for type {}",this.getIndexName(),this.getIndexType());
    getClient().admin().indices().preparePutMapping(index).setType(getIndexType()).setIgnoreConflicts(true).setSource(mapping).get();
  }
 catch (  Exception e) {
    throw new IllegalStateException("Invalid configuration for index " + this.getIndexName(),e);
  }
}
