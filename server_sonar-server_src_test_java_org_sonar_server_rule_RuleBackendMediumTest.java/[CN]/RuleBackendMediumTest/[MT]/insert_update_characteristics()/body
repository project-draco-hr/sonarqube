{
  CharacteristicDto char1=DebtTesting.newCharacteristicDto("c1");
  db.debtCharacteristicDao().insert(dbSession,char1);
  dbSession.commit();
  CharacteristicDto char11=DebtTesting.newCharacteristicDto("c11").setParentId(char1.getId());
  db.debtCharacteristicDao().insert(dbSession,char11);
  dao.insert(dbSession,RuleTesting.newXooX1().setDefaultSubCharacteristicId(char11.getId()).setRemediationFunction(null).setRemediationCoefficient(null).setRemediationOffset(null));
  dbSession.commit();
  assertThat(db.debtCharacteristicDao().selectByKey("c1",dbSession)).isNotNull();
  assertThat(db.debtCharacteristicDao().selectByKey("c1",dbSession).getParentId()).isNull();
  assertThat(db.debtCharacteristicDao().selectByKey("c11",dbSession)).isNotNull();
  assertThat(db.debtCharacteristicDao().selectByKey("c11",dbSession).getParentId()).isEqualTo(char1.getId());
  Rule rule=index.getByKey(RuleTesting.XOO_X1);
  assertThat(rule.debtCharacteristicKey()).isEqualTo(char1.getKey());
  assertThat(rule.debtSubCharacteristicKey()).isEqualTo(char11.getKey());
  assertThat(rule.debtOverloaded()).isFalse();
  RuleDto ruleDto=db.deprecatedRuleDao().getByKey(dbSession,RuleTesting.XOO_X1);
  CharacteristicDto char2=DebtTesting.newCharacteristicDto("c2");
  db.debtCharacteristicDao().insert(dbSession,char2);
  CharacteristicDto char21=DebtTesting.newCharacteristicDto("c21").setParentId(char2.getId());
  db.debtCharacteristicDao().insert(dbSession,char21);
  ruleDto.setSubCharacteristicId(char21.getId());
  dao.update(dbSession,ruleDto);
  dbSession.commit();
  rule=index.getByKey(RuleTesting.XOO_X1);
  assertThat(rule.debtOverloaded()).isTrue();
  assertThat(rule.debtCharacteristicKey()).isEqualTo(char2.getKey());
  assertThat(rule.debtSubCharacteristicKey()).isEqualTo(char21.getKey());
  assertThat(rule.debtOverloaded()).isTrue();
  assertThat(rule.defaultDebtCharacteristicKey()).isEqualTo(char1.getKey());
  assertThat(rule.defaultDebtSubCharacteristicKey()).isEqualTo(char11.getKey());
}
