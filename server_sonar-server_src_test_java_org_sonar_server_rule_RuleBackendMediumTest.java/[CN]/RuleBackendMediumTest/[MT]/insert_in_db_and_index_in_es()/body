{
  RuleDto ruleDto=RuleTesting.newXooX1();
  dao.insert(dbSession,ruleDto);
  dbSession.commit();
  RuleDto persistedDto=dao.getNullableByKey(dbSession,RuleTesting.XOO_X1);
  assertThat(persistedDto).isNotNull();
  assertThat(persistedDto.getId()).isGreaterThanOrEqualTo(0);
  assertThat(persistedDto.getRuleKey()).isEqualTo(ruleDto.getRuleKey());
  assertThat(persistedDto.getLanguage()).isEqualTo(ruleDto.getLanguage());
  assertThat(persistedDto.getCreatedAt()).isNotNull();
  assertThat(persistedDto.getUpdatedAt()).isNotNull();
  Rule hit=index.getByKey(RuleTesting.XOO_X1);
  assertRuleEquivalent(ruleDto,hit);
  Collection<Rule> hits=index.getByKeys(RuleTesting.XOO_X1);
  assertThat(hits).hasSize(1);
  assertRuleEquivalent(ruleDto,Iterables.getFirst(hits,null));
}
