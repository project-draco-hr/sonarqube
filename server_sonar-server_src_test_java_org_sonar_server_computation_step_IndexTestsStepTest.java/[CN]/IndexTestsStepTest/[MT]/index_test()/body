{
  dbComponentsRefCache.addComponent(1,new DbComponentsRefCache.DbComponent(1L,"PROJECT_KEY","ABCD"));
  dbTester.prepareDbUnit(getClass(),"index_source.xml");
  Connection connection=dbTester.openConnection();
  TestTesting.updateDataColumn(connection,"FILE1_UUID",TestTesting.newRandomTests(1));
  connection.close();
  File reportDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(reportDir);
  writer.writeMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).build());
  step().execute(new ComputationContext(new FileBatchReportReader(new BatchReportReader(reportDir)),"PROJECT_KEY",new Settings(),dbClient,ComponentTreeBuilders.from(DumbComponent.DUMB_PROJECT),mock(LanguageRepository.class)));
  List<SearchHit> docs=esTester.getDocuments(TestIndexDefinition.INDEX,TestIndexDefinition.TYPE);
  assertThat(docs).hasSize(1);
  TestDoc doc=new TestDoc(docs.get(0).sourceAsMap());
  assertThat(doc.projectUuid()).isEqualTo("ABCD");
  assertThat(doc.fileUuid()).isEqualTo("FILE1_UUID");
  assertThat(doc.coveredFiles()).isNotEmpty();
}
