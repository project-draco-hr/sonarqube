{
  QualityProfileDto profileDto=new QualityProfileDto().setName("myprofile").setLanguage("java");
  qualityProfileDao.insert(profileDto,dbSession);
  RuleKey ruleKey=RuleKey.of("javascript","S001");
  RuleDto ruleDto=newRuleDto(ruleKey);
  dao.insert(ruleDto,dbSession);
  RuleParamDto minParam=new RuleParamDto().setName("min").setType("STRING");
  dao.addRuleParam(ruleDto,minParam,dbSession);
  RuleParamDto maxParam=new RuleParamDto().setName("max").setType("STRING");
  dao.addRuleParam(ruleDto,maxParam,dbSession);
  ActiveRuleDto activeRule=ActiveRuleDto.createFor(profileDto,ruleDto).setInheritance("inherited").setSeverity(Severity.BLOCKER);
  activeRuleDao.insert(activeRule,dbSession);
  ActiveRuleParamDto activeRuleMinParam=ActiveRuleParamDto.createFor(minParam).setValue("minimum");
  activeRuleDao.addParam(activeRule,activeRuleMinParam,dbSession);
  ActiveRuleParamDto activeRuleMaxParam=ActiveRuleParamDto.createFor(maxParam).setValue("maximum");
  activeRuleDao.addParam(activeRule,activeRuleMaxParam,dbSession);
  dbSession.commit();
  List<ActiveRuleParamDto> persistedDtos=activeRuleDao.findParamsByActiveRule(activeRule,dbSession);
  assertThat(persistedDtos).hasSize(2);
  index.refresh();
}
