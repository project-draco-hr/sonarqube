{
  sql.append(" s.status='P' AND s.islast=").append(database.getDialect().getTrueSqlValue());
  if (context.getBaseSnapshot() == null) {
    sql.append(" AND p.copy_resource_id IS NULL ");
  }
  if (!filter.getResourceQualifiers().isEmpty()) {
    sql.append(" AND s.qualifier IN ");
    appendInStatement(filter.getResourceQualifiers(),sql);
  }
  if (!filter.getResourceScopes().isEmpty()) {
    sql.append(" AND s.scope IN ");
    appendInStatement(filter.getResourceScopes(),sql);
  }
  if (!filter.getResourceLanguages().isEmpty()) {
    sql.append(" AND p.language IN ");
    appendInStatement(filter.getResourceLanguages(),sql);
  }
  appendDateConditions();
  appendFavouritesCondition();
  appendResourceNameCondition();
  appendResourceKeyCondition();
  appendResourceBaseCondition();
}
