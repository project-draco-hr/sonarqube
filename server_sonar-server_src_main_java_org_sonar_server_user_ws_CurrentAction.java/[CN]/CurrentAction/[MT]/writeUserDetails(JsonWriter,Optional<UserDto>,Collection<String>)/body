{
  json.prop("isLoggedIn",userSession.isLoggedIn()).prop("login",userSession.getLogin()).prop("name",userSession.getName());
  if (optionalUser.isPresent()) {
    UserDto user=optionalUser.get();
    if (!isNullOrEmpty(user.getEmail())) {
      json.prop("email",user.getEmail());
    }
    json.prop("local",user.isLocal());
    json.prop(FIELD_EXTERNAL_IDENTITY,user.getExternalIdentity());
    json.prop(FIELD_EXTERNAL_PROVIDER,user.getExternalIdentityProvider());
  }
  writeScmAccounts(json,optionalUser);
  writeGroups(json,groups);
  writePermissions(json,userSession);
}
