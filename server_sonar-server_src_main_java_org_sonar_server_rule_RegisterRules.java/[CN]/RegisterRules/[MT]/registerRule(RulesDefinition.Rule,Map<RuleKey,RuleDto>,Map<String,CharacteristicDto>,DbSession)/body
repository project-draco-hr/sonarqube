{
  RuleKey ruleKey=RuleKey.of(ruleDef.repository().key(),ruleDef.key());
  RuleDto rule=allRules.containsKey(ruleKey) ? allRules.remove(ruleKey) : createRuleDto(ruleDef,session);
  boolean executeUpdate=false;
  if (mergeRule(ruleDef,rule)) {
    executeUpdate=true;
  }
  CharacteristicDto subCharacteristic=characteristic(ruleDef,rule.getSubCharacteristicId(),allCharacteristics);
  if (mergeDebtDefinitions(ruleDef,rule,subCharacteristic)) {
    executeUpdate=true;
  }
  if (mergeTags(ruleDef,rule)) {
    executeUpdate=true;
  }
  if (executeUpdate) {
    dbClient.ruleDao().update(session,rule);
  }
  mergeParams(ruleDef,rule,session);
}
