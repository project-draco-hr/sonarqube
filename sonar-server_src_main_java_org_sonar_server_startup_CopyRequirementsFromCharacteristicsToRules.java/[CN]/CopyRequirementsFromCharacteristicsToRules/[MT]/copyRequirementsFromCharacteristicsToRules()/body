{
  DbSession dbSession=dbClient.openSession(true);
  try {
    List<Map<String,Object>> requirementDtos=dbSession.getMapper(CharacteristicMapper.class).selectDeprecatedRequirements();
    final Multimap<Number,RequirementDto> requirementsByRuleId=ArrayListMultimap.create();
    for (    Map<String,Object> map : requirementDtos) {
      RequirementDto requirementDto=new RequirementDto(map);
      requirementsByRuleId.put(requirementDto.getRuleId(),requirementDto);
    }
    List<RuleDto> rules=dbClient.ruleDao().findAll(dbSession);
    for (    RuleDto rule : rules) {
      Collection<RequirementDto> requirementsForRule=requirementsByRuleId.get(rule.getId());
      if (!requirementsForRule.isEmpty()) {
        convert(rule,requirementsForRule,dbSession);
      }
    }
    dbSession.commit();
  }
  finally {
    MyBatis.closeQuietly(dbSession);
  }
}
