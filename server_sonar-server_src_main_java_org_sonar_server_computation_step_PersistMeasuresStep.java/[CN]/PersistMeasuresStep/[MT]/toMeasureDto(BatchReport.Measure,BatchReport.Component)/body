{
  if (!in.hasValueType()) {
    throw new IllegalStateException(String.format("Measure %s does not have value type",in));
  }
  if (!in.hasMetricKey()) {
    throw new IllegalStateException(String.format("Measure %s does not have metric key",in));
  }
  MeasureDto out=new MeasureDto();
  out.setVariation(1,in.hasVariationValue1() ? in.getVariationValue1() : null);
  out.setVariation(2,in.hasVariationValue2() ? in.getVariationValue2() : null);
  out.setVariation(3,in.hasVariationValue3() ? in.getVariationValue3() : null);
  out.setVariation(4,in.hasVariationValue4() ? in.getVariationValue4() : null);
  out.setVariation(5,in.hasVariationValue5() ? in.getVariationValue5() : null);
  out.setAlertStatus(in.hasAlertStatus() ? in.getAlertStatus() : null);
  out.setAlertText(in.hasAlertText() ? in.getAlertText() : null);
  out.setDescription(in.hasDescription() ? in.getDescription() : null);
  out.setSeverity(in.hasSeverity() ? in.getSeverity().name() : null);
  out.setComponentId(component.getId());
  out.setSnapshotId(component.getSnapshotId());
  out.setMetricId(metricCache.get(in.getMetricKey()).getId());
  out.setRuleId(in.hasRuleKey() ? ruleCache.get(RuleKey.parse(in.getRuleKey())).getId() : null);
  out.setCharacteristicId(in.hasCharactericId() ? in.getCharactericId() : null);
  out.setPersonId(in.hasPersonId() ? in.getPersonId() : null);
  out.setValue(valueAsDouble(in));
  setData(in,out);
  return out;
}
