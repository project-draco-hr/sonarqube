{
  ComponentDto project=newProjectDto().setUuid("project-uuid");
  SnapshotDto projectSnapshot=componentDb.insertProjectAndSnapshot(project);
  SnapshotDto moduleSnapshot=componentDb.insertComponentAndSnapshot(newModuleDto("module-uuid-1",project),projectSnapshot);
  componentDb.insertComponentAndSnapshot(newFileDto(project,1),projectSnapshot);
  componentDb.insertComponentAndSnapshot(newFileDto(project,2),moduleSnapshot);
  SnapshotDto directorySnapshot=componentDb.insertComponentAndSnapshot(newDirectory(project,"directory-path-1"),moduleSnapshot);
  componentDb.insertComponentAndSnapshot(newFileDto(project,3),directorySnapshot);
  db.commit();
  componentDb.indexProjects();
  InputStream responseStream=ws.newRequest().setMediaType(MediaTypes.PROTOBUF).setParam(PARAM_STRATEGY,"leaves").setParam(PARAM_BASE_COMPONENT_ID,"project-uuid").setParam(PARAM_QUALIFIERS,Qualifiers.FILE).execute().getInputStream();
  WsComponents.TreeWsResponse response=WsComponents.TreeWsResponse.parseFrom(responseStream);
  assertThat(response.getComponentsCount()).isEqualTo(3);
  assertThat(response.getPaging().getTotal()).isEqualTo(3);
  assertThat(response.getComponentsList()).extracting("id").containsExactly("file-uuid-1","file-uuid-2","file-uuid-3");
}
