{
  NewIndex index=context.create(INDEX);
  index.refreshHandledByIndexer();
  index.configureShards(settings);
  NewIndex.NewIndexType ruleMapping=index.createType(TYPE_RULE);
  ruleMapping.setAttribute("_id",ImmutableMap.of("path",FIELD_RULE_KEY));
  ruleMapping.setAttribute("_routing",ImmutableMap.of("required",true,"path",RuleIndexDefinition.FIELD_RULE_REPOSITORY));
  ruleMapping.setEnableSource(false);
  ruleMapping.stringFieldBuilder(FIELD_RULE_KEY).enableSorting().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_RULE_KEY).enableSorting().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_REPOSITORY).docValues().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_INTERNAL_KEY).disableSearch().docValues().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_NAME).enableSorting().enableWordSearch().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_HTML_DESCRIPTION).enableWordSearch().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_SEVERITY).docValues().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_STATUS).docValues().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_LANGUAGE).build();
  ruleMapping.createBooleanField(FIELD_RULE_IS_TEMPLATE);
  ruleMapping.stringFieldBuilder(FIELD_RULE_TEMPLATE_KEY).docValues().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_ALL_TAGS).enableGramSearch().build();
  ruleMapping.stringFieldBuilder(FIELD_RULE_TYPE).build();
  ruleMapping.createLongField(FIELD_RULE_CREATED_AT);
  ruleMapping.createLongField(FIELD_RULE_UPDATED_AT);
  NewIndex.NewIndexType activeRuleMapping=index.createType(RuleIndexDefinition.TYPE_ACTIVE_RULE);
  activeRuleMapping.setEnableSource(false);
  activeRuleMapping.setAttribute("_id",ImmutableMap.of("path",RuleIndexDefinition.FIELD_ACTIVE_RULE_KEY));
  activeRuleMapping.setAttribute("_parent",ImmutableMap.of("type",RuleIndexDefinition.TYPE_RULE));
  activeRuleMapping.setAttribute("_routing",ImmutableMap.of("required",true,"path",RuleIndexDefinition.FIELD_ACTIVE_RULE_REPOSITORY));
  activeRuleMapping.stringFieldBuilder(RuleIndexDefinition.FIELD_ACTIVE_RULE_KEY).enableSorting().build();
  activeRuleMapping.stringFieldBuilder(RuleIndexDefinition.FIELD_ACTIVE_RULE_RULE_KEY).disableSearch().docValues().build();
  activeRuleMapping.stringFieldBuilder(RuleIndexDefinition.FIELD_ACTIVE_RULE_REPOSITORY).disableSearch().docValues().build();
  activeRuleMapping.stringFieldBuilder(RuleIndexDefinition.FIELD_ACTIVE_RULE_PROFILE_KEY).docValues().build();
  activeRuleMapping.stringFieldBuilder(RuleIndexDefinition.FIELD_ACTIVE_RULE_INHERITANCE).docValues().build();
  activeRuleMapping.stringFieldBuilder(RuleIndexDefinition.FIELD_ACTIVE_RULE_SEVERITY).docValues().build();
  activeRuleMapping.createLongField(RuleIndexDefinition.FIELD_ACTIVE_RULE_CREATED_AT);
  activeRuleMapping.createLongField(RuleIndexDefinition.FIELD_ACTIVE_RULE_UPDATED_AT);
}
