{
  IdentityProvider identityProvider=new FailWithNotAllowUserToSignUpIdProvider("failing");
  when(request.getRequestURI()).thenReturn("/sessions/init/" + identityProvider.getKey());
  identityProviderRepository.addIdentityProvider(identityProvider);
  underTest.doFilter(request,response,chain);
  verify(response).sendRedirect("/sessions/not_allowed_to_sign_up?providerName=Failing provider");
}
