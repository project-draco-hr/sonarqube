{
  dbTester.prepareDbUnit(getClass(),"empty.xml");
  dbComponentsRefCache.addComponent(1,new DbComponent(1L,"PROJECT_KEY","ABCD"));
  File reportDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(reportDir);
  writer.writeMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).setProjectKey("PROJECT_KEY").setAnalysisDate(150000000L).build());
  writer.writeComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).setSnapshotId(1000L).addEvent(BatchReport.Event.newBuilder().setName("Red (was Orange)").setCategory(Constants.EventCategory.ALERT).setDescription("Open issues > 0").build()).addEvent(BatchReport.Event.newBuilder().setName("Changes in 'Default' (Java)").setCategory(Constants.EventCategory.PROFILE).setEventData("from=2014-10-12T08:36:25+0000;key=java-default;to=2014-10-12T10:36:25+0000").build()).build());
  step.execute(new ComputationContext(new BatchReportReader(reportDir),mock(ComponentDto.class)));
  dbTester.assertDbUnit(getClass(),"add_events-result.xml","events");
}
