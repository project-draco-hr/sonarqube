{
  dbTester.prepareDbUnit(getClass(),"empty.xml");
  DumbComponent module=DumbComponent.builder(Component.Type.MODULE,2).setUuid("BCDE").build();
  DumbComponent root=DumbComponent.builder(Component.Type.PROJECT,1).setUuid("ABCD").addChildren(module).build();
  treeRootHolder.setRoot(root);
  dbIdsRepository.setSnapshotId(root,1000L);
  dbIdsRepository.setSnapshotId(module,1001L);
  reportReader.setMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).setAnalysisDate(150000000L).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).addChildRef(2).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(2).setType(Constants.ComponentType.MODULE).build());
  Component child=root.getChildren().get(0);
  when(eventRepository.getEvents(root)).thenReturn(ImmutableList.of(Event.createAlert("Red (was Orange)",null,"Open issues > 0")));
  when(eventRepository.getEvents(child)).thenReturn(ImmutableList.of(Event.createAlert("Red (was Orange)",null,"Open issues > 0")));
  treeRootHolder.setRoot(root);
  step.execute();
  dbTester.assertDbUnit(getClass(),"persist_report_events_with_component_children-result.xml","events");
}
