{
  dbTester.prepareDbUnit(getClass(),"keep_one_event_by_version.xml");
  dbComponentsRefCache.addComponent(1,new DbComponent(1L,PROJECT_KEY,"ABCD"));
  File reportDir=temp.newFolder();
  BatchReportWriter writer=new BatchReportWriter(reportDir);
  writer.writeMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).setProjectKey(PROJECT_KEY).setAnalysisDate(150000000L).build());
  writer.writeComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).setSnapshotId(1001L).setVersion("1.5-SNAPSHOT").build());
  step.execute(new ComputationContext(new BatchReportReader(reportDir),PROJECT_KEY,projectSettings,dbClient,ComponentTreeBuilders.from(DumbComponent.DUMB_PROJECT),languageRepository));
  dbTester.assertDbUnit(getClass(),"keep_one_event_by_version-result.xml","events");
}
