{
  Map<Integer,Rule> rulesById=rulesById(ruleFinder.findAll(RuleQuery.create()));
  for (  CharacteristicDto dto : dtos) {
    Integer ruleId=dto.getRuleId();
    if (ruleId != null) {
      Characteristic characteristic=characteristicsById.get(dto.getParentId());
      Rule rule=rulesById.get(ruleId);
      if (rule != null) {
        RuleKey ruleKey=RuleKey.of(rule.getRepositoryKey(),rule.getKey());
        dto.toRequirement(ruleKey,characteristic);
      }
 else {
        dto.toRequirement(null,characteristic);
      }
    }
  }
}
