{
  MockUserSession.set().setLogin("me");
  ruleDao.insert(dbSession,RuleTesting.newDto(RULE_KEY).setNoteData(null).setNoteUserLogin(null).setTags(ImmutableSet.of("tag1")).setSubCharacteristicId(33).setRemediationFunction(DebtRemediationFunction.Type.CONSTANT_ISSUE.name()).setRemediationCoefficient("1d").setRemediationOffset("5min"));
  dbSession.commit();
  RuleUpdate update=RuleUpdate.createForPluginRule(RULE_KEY);
  update.setMarkdownNote("my *note*");
  updater.update(update,UserSession.get());
  dbSession.clearCache();
  RuleDto rule=ruleDao.getNullableByKey(dbSession,RULE_KEY);
  assertThat(rule.getNoteData()).isEqualTo("my *note*");
  assertThat(rule.getNoteUserLogin()).isEqualTo("me");
  assertThat(rule.getNoteCreatedAt()).isNotNull();
  assertThat(rule.getNoteUpdatedAt()).isNotNull();
  assertThat(rule.getTags()).containsOnly("tag1");
  assertThat(rule.getSubCharacteristicId()).isEqualTo(33);
  assertThat(rule.getRemediationFunction()).isEqualTo(DebtRemediationFunction.Type.CONSTANT_ISSUE.name());
  assertThat(rule.getRemediationCoefficient()).isEqualTo("1d");
  assertThat(rule.getRemediationOffset()).isEqualTo("5min");
}
