{
  final String projectKey="123456789-987654321";
  ComponentDto project=new ComponentDto().setKey(projectKey);
  db.componentDao().insert(session,project);
  tester.get(PermissionFacade.class).insertGroupPermission(project.getId(),DefaultGroups.ANYONE,UserRole.USER,session);
  session.commit();
  MockUserSession.set().setLogin("john").setGlobalPermissions(GlobalPermissions.SCAN_EXECUTION);
  WsTester.TestRequest request=wsTester.newGetRequest(BatchWs.API_ENDPOINT,UploadReportAction.UPLOAD_REPORT_ACTION);
  request.setParam(UploadReportAction.PARAM_PROJECT,project.key());
  request.execute();
  List<AnalysisReportDto> analysisReports=db.analysisReportDao().findByProjectKey(session,projectKey);
  AnalysisReportDto analysisReport=analysisReports.get(0);
  assertThat(analysisReports).hasSize(1);
  assertThat(analysisReport.getProjectKey()).isEqualTo(projectKey);
  assertThat(analysisReport.getStatus()).isEqualTo(PENDING);
}
