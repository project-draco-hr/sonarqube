{
  when(propertiesDao.findNotificationSubscribers("NewViolations","Email","struts")).thenReturn(Lists.newArrayList("user1","user2"));
  when(propertiesDao.findNotificationSubscribers("NewViolations","Twitter","struts")).thenReturn(Lists.newArrayList("user2"));
  Multimap<String,NotificationChannel> multiMap=manager.findNotificationSubscribers(dispatcher,"struts");
  assertThat(multiMap.entries()).hasSize(3);
  Map<String,Collection<NotificationChannel>> map=multiMap.asMap();
  assertThat(map.get("user1")).containsOnly(emailChannel);
  assertThat(map.get("user2")).containsOnly(emailChannel,twitterChannel);
  assertThat(map.get("other")).isNull();
}
