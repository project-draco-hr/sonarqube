{
  ProjectReactor reactor=new ProjectReactor(ProjectDefinition.create().setKey("ALL_PROJECT"));
  ResourceCache resourceCache=new ResourceCache();
  ComponentsPublisher publisher=new ComponentsPublisher(reactor,resourceCache);
  View view=new View("ALL_PROJECT");
  view.setId(1);
  view.setAnalysisDate(new SimpleDateFormat("dd/MM/yyyy").parse("12/12/2012"));
  resourceCache.add(view,null).setSnapshot(new Snapshot().setId(11));
  org.sonar.api.resources.File mainFile=org.sonar.api.resources.File.create("ALL_PROJECTsample","ALL_PROJECTsample",null,false);
  mainFile.setEffectiveKey("ALL_PROJECTsample");
  mainFile.setId(2);
  resourceCache.add(mainFile,view).setSnapshot(new Snapshot().setId(12));
  File exportDir=temp.newFolder();
  ReportHelper helper=ReportHelper.create(exportDir);
  publisher.export(helper);
  JSONAssert.assertEquals(IOUtils.toString(this.getClass().getResourceAsStream("ComponentsPublisherTest/testComponentPublisher_containing_file_without_language.json"),"UTF-8"),FileUtils.readFileToString(new File(exportDir,"components.json")),true);
}
