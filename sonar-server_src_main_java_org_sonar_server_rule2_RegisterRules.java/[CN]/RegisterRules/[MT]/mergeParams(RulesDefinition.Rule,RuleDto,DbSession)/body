{
  List<RuleParamDto> paramDtos=dbClient.ruleDao().findRuleParamsByRuleKey(rule.getKey(),session);
  List<String> existingParamDtoNames=new ArrayList<String>();
  for (  RuleParamDto paramDto : paramDtos) {
    RulesDefinition.Param paramDef=ruleDef.param(paramDto.getName());
    if (paramDef == null) {
      dbClient.ruleDao().removeRuleParam(rule,paramDto,session);
    }
 else {
      if (mergeParam(paramDto,paramDef)) {
        dbClient.ruleDao().updateRuleParam(rule,paramDto,session);
      }
 else {
        session.enqueue(new EmbeddedIndexAction<RuleKey>(RuleIndexDefinition.INDEX_TYPE,IndexAction.Method.UPDATE,paramDto,rule.getKey()));
      }
      existingParamDtoNames.add(paramDto.getName());
    }
  }
  for (  RulesDefinition.Param param : ruleDef.params()) {
    if (!existingParamDtoNames.contains(param.key())) {
      RuleParamDto paramDto=RuleParamDto.createFor(rule).setName(param.key()).setDescription(param.description()).setDefaultValue(param.defaultValue()).setType(param.type().toString());
      dbClient.ruleDao().addRuleParam(rule,paramDto,session);
    }
  }
}
