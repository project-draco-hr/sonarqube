{
  Date now=new Date();
  Date aWeekAgo=DateUtils.addDays(now,-7);
  ComponentDto project=ComponentTesting.newProjectDto().setId(1L).setKey("123").setCreatedAt(aWeekAgo).setUpdatedAt(aWeekAgo);
  dbClient.componentDao().insert(dbSession,project);
  SnapshotDto snapshot=SnapshotTesting.createForProject(project).setCreatedAt(aWeekAgo).setUpdatedAt(aWeekAgo);
  dbClient.snapshotDao().insert(dbSession,snapshot);
  AnalysisReportDto report=AnalysisReportDto.newForTests(1L).setProjectKey("123").setSnapshotId(snapshot.getId()).setStatus(Status.PENDING);
  dbClient.analysisReportDao().insert(dbSession,report);
  dbClient.propertiesDao().setProperty(new PropertyDto().setKey(DbCleanerConstants.WEEKS_BEFORE_DELETING_ALL_SNAPSHOTS).setValue("52"));
  dbSession.commit();
  ComputationContext context=new ComputationContext(report,project);
  sut.execute(context);
  assertThat(dbClient.snapshotDao().getNullableByKey(dbSession,snapshot.getId())).isNotNull();
}
