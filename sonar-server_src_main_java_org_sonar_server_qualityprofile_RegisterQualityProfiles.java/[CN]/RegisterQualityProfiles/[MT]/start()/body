{
  TimeProfiler profiler=new TimeProfiler(LOGGER).start("Register Quality Profiles");
  DbSession session=dbClient.openSession(false);
  try {
    ListMultimap<String,RulesProfile> profilesByLanguage=profilesByLanguage();
    for (    String language : profilesByLanguage.keySet()) {
      List<RulesProfile> profileDefs=profilesByLanguage.get(language);
      verifyLanguage(language,profileDefs);
      for (      Map.Entry<String,Collection<RulesProfile>> entry : profilesByName(profileDefs).entrySet()) {
        String profileName=entry.getKey();
        QualityProfileKey profileKey=QualityProfileKey.of(profileName,language);
        if (shouldRegister(profileKey,session)) {
          register(profileKey,entry.getValue(),session);
        }
        defaultProfilesCache.put(language,profileName);
      }
      setDefault(language,profileDefs,session);
    }
    session.commit();
  }
  finally {
    MyBatis.closeQuietly(session);
    profiler.stop();
  }
}
