{
  if (bulkRequest.numberOfActions() > 0) {
    executeBulk(bulkRequest);
  }
  progressTask.log();
  counter.set(0L);
  timer.cancel();
  timer.purge();
  if (refresh) {
    client.prepareRefresh(indexName).get();
  }
  if (large) {
    client.nativeClient().admin().indices().prepareOptimize(indexName).setMaxNumSegments(1).setWaitForMerge(true).get();
    updateSettings(largeInitialSettings);
  }
  bulkRequest=null;
}
