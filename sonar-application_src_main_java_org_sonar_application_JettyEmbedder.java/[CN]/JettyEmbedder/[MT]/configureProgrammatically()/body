{
  configureServer();
  List<Handler> handlers=new ArrayList<Handler>();
  String shutdownCookie=System.getProperty("sonar.shutdownToken");
  if (shutdownCookie != null && !"".equals(shutdownCookie)) {
    System.out.println("Registering shutdown handler");
    ShutdownHandler shutdownHandler=new ShutdownHandler(server,shutdownCookie);
    shutdownHandler.setExitJvm(true);
    handlers.add(shutdownHandler);
  }
  WebAppContext context=new WebAppContext(getPath("/war/sonar-server"),contextPath);
  handlers.add(context);
  String filenamePattern=configuration.getProperty("sonar.web.jettyRequestLogs");
  if (filenamePattern != null) {
    handlers.add(configureRequestLogHandler(filenamePattern));
  }
  HandlerCollection handler=new HandlerCollection();
  handler.setHandlers(handlers.toArray(new Handler[handlers.size()]));
  server.setHandler(handler);
  return server;
}
