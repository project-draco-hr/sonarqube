{
  setupData("shared");
  DefaultResourcePersister persister=new DefaultResourcePersister(getSession(),mock(ResourcePermissions.class),snapshotCache,resourceCache);
  persister.saveProject(multiModuleProject,null);
  persister.saveProject(moduleA,multiModuleProject);
  persister.saveResource(moduleA,new JavaPackage("org.foo").setEffectiveKey("a:org.foo"));
  persister.saveResource(moduleA,new JavaFile("org.foo.MyClass").setEffectiveKey("a:org.foo.MyClass"));
  persister.clear();
  assertThat(persister.getSnapshotsByResource().size(),is(2));
  assertThat(persister.getSnapshotsByResource().get(multiModuleProject),notNullValue());
  assertThat(persister.getSnapshotsByResource().get(moduleA),notNullValue());
}
