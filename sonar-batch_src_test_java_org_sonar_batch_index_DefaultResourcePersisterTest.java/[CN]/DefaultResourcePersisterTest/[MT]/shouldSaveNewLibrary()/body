{
  setupData("shared");
  ResourcePersister persister=new DefaultResourcePersister(getSession(),mock(ResourcePermissions.class),snapshotCache,resourceCache);
  persister.saveProject(singleProject,null);
  persister.saveResource(singleProject,new Library("junit:junit","4.8.2").setEffectiveKey("junit:junit"));
  persister.saveResource(singleProject,new Library("junit:junit","4.8.2").setEffectiveKey("junit:junit"));
  persister.saveResource(singleProject,new Library("junit:junit","3.2").setEffectiveKey("junit:junit"));
  checkTables("shouldSaveNewLibrary",new String[]{"build_date","created_at","authorization_updated_at"},"projects","snapshots");
}
