{
  setupData("shared");
  ResourcePersister persister=new DefaultResourcePersister(getSession(),mock(ResourcePermissions.class),snapshotCache,resourceCache);
  persister.saveProject(singleProject,null);
  persister.saveResource(singleProject,Directory.create("src/main/java/org/foo","org.foo").setEffectiveKey("foo:src/main/java/org/foo"));
  checkTables("shouldSaveNewDirectory",new String[]{"build_date","created_at","authorization_updated_at","uuid","project_uuid","module_uuid","module_uuid_path"},"projects","snapshots");
  enableSnapshot(1001);
  enableSnapshot(1002);
  SqlSession session=getMyBatis().openSession(false);
  try {
    ComponentDto newProject=session.getMapper(ComponentMapper.class).selectByKey("foo");
    ComponentDto newDir=session.getMapper(ComponentMapper.class).selectByKey("foo:src/main/java/org/foo");
    assertThat(newDir.uuid()).isNotNull();
    assertThat(newDir.projectUuid()).isEqualTo(newProject.uuid());
    assertThat(newDir.moduleUuid()).isEqualTo(newProject.uuid());
    assertThat(newDir.moduleUuidPath()).isEqualTo(newProject.uuid());
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
