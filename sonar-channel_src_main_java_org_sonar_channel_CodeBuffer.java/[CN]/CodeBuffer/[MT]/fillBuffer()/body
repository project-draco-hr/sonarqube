{
  try {
    int offset=bufferSize - bufferPosition;
    if (offset != 0) {
      System.arraycopy(buffer,bufferPosition,buffer,0,bufferSize - bufferPosition);
    }
    bufferPosition=0;
    int numberOfChars=code.read(buffer,offset,bufferCapacity - offset);
    if (numberOfChars == -1) {
      numberOfChars=0;
    }
    bufferSize=numberOfChars + offset;
    return offset;
  }
 catch (  IOException e) {
    throw new ChannelException(e.getMessage(),e);
  }
}
