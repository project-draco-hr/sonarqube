{
  if (bufferPosition == bufferSize) {
    fillBuffer();
  }
  if (bufferSize == 0) {
    return -1;
  }
  int character=buffer[bufferPosition++];
  if (character == LF || character == CR) {
    if ((lastChar != LF && lastChar != CR) || lastChar == character || lastChar == LF) {
      cursor.line++;
    }
    cursor.column=0;
  }
 else {
    cursor.column++;
  }
  if (recordingMode) {
    recordedCharacters.append((char)character);
  }
  lastChar=character;
  return character;
}
