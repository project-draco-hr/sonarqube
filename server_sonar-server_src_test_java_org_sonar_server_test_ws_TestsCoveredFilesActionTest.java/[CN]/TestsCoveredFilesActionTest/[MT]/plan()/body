{
  MockUserSession.set().addComponentPermission(UserRole.CODEVIEWER,"SonarQube",TEST_PLAN_KEY);
  MutableTestCase testCase1=testCase("org.foo.Bar.java","src/main/java/org/foo/Bar.java",10);
  MutableTestCase testCase2=testCase("org.foo.File.java","src/main/java/org/foo/File.java",3);
  when(testPlan.testCasesByName("my_test")).thenReturn(newArrayList(testCase1,testCase2));
  WsTester.TestRequest request=tester.newGetRequest("api/tests","covered_files").setParam("key",TEST_PLAN_KEY).setParam("test","my_test");
  request.execute().assertJson("{\n" + "  \"files\": [\n" + "    {\n"+ "      \"key\": \"org.foo.Bar.java\",\n"+ "      \"longName\": \"src/main/java/org/foo/Bar.java\",\n"+ "      \"coveredLines\" : 10\n"+ "    },\n"+ "    {\n"+ "      \"key\": \"org.foo.File.java\",\n"+ "      \"longName\": \"src/main/java/org/foo/File.java\",\n"+ "      \"coveredLines\" : 3\n"+ "    }\n"+ "  ]\n"+ "}\n");
}
