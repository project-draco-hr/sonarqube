{
  DbSession dbSession=dbClient.openSession(false);
  try {
    Iterable<Metric> metrics=FluentIterable.from(metricRepository.getAll()).filter(NumericMetric.INSTANCE);
    new DepthTraversalTypeAwareCrawler(new VariationMeasuresVisitor(dbSession,metrics)).visit(treeRootHolder.getRoot());
  }
  finally {
    dbSession.close();
  }
}
