{
  DefaultIssue issue=new DefaultIssue().setKey("200").setComponentKey("struts:src/main/java/org/apache/struts/Action.java").setRuleKey(RuleKey.of("squid","AvoidCycles")).setMessage("There are 2 cycles").setSeverity("MINOR").setStatus(Issue.STATUS_OPEN).setResolution(null).setLine(1).setEffortToFix(3.14).setReporter("julien").setAssignee("simon").setCreationDate(SIMPLE_DATE_FORMAT.parse("2013-04-24")).setUpdateDate(SIMPLE_DATE_FORMAT.parse("2013-04-25")).setNew(false);
  when(issueCache.all()).thenReturn(Lists.newArrayList(issue));
  BatchInput.User user1=BatchInput.User.newBuilder().setLogin("julien").setName("Julien").build();
  BatchInput.User user2=BatchInput.User.newBuilder().setLogin("simon").setName("Simon").build();
  when(userRepository.load("julien")).thenReturn(user1);
  when(userRepository.load("simon")).thenReturn(user2);
  StringWriter writer=new StringWriter();
  jsonReport.writeJson(writer);
  JsonAssert.assertJson(writer.toString()).isSimilarTo(Resources.getResource("org/sonar/batch/scan/report/JsonReportTest/report.json"));
}
