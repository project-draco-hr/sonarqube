{
  List<SourceLineDoc> lines=sourceLineIndex.getLines(component.getUuid());
  Map<String,BatchReport.Changesets.Changeset> changesetByRevision=new HashMap<>();
  BatchReport.Changesets.Builder scmBuilder=BatchReport.Changesets.newBuilder().setComponentRef(component.getReportAttributes().getRef());
  for (  SourceLineDoc sourceLine : lines) {
    String scmRevision=sourceLine.scmRevision();
    if (scmRevision == null || changesetByRevision.get(scmRevision) == null) {
      BatchReport.Changesets.Changeset.Builder changeSetBuilder=BatchReport.Changesets.Changeset.newBuilder();
      String scmAuthor=sourceLine.scmAuthor();
      if (scmAuthor != null) {
        changeSetBuilder.setAuthor(scmAuthor);
      }
      Date scmDate=sourceLine.scmDate();
      if (scmDate != null) {
        changeSetBuilder.setDate(scmDate.getTime());
      }
      if (scmRevision != null) {
        changeSetBuilder.setRevision(scmRevision);
      }
      BatchReport.Changesets.Changeset changeset=changeSetBuilder.build();
      scmBuilder.addChangeset(changeset);
      scmBuilder.addChangesetIndexByLine(scmBuilder.getChangesetCount() - 1);
      if (scmRevision != null) {
        changesetByRevision.put(scmRevision,changeset);
      }
    }
 else {
      scmBuilder.addChangesetIndexByLine(scmBuilder.getChangesetList().indexOf(changesetByRevision.get(scmRevision)));
    }
  }
  return scmBuilder.build();
}
