{
  db.truncateTables();
  es.truncateIndices();
  this.session=db.myBatis().openSession(false);
  DbClient dbClient=new DbClient(db.database(),db.myBatis(),new IssueDao(db.myBatis()),new ComponentDao());
  issueIndex=new IssueIndex(es.client(),System2.INSTANCE);
  issueIndexer=new IssueIndexer(null,es.client());
  issueAuthorizationIndexer=new IssueAuthorizationIndexer(null,es.client());
  issuesAction=new IssuesAction(dbClient,issueIndex);
  componentDao=new ComponentDao();
  tester=new WsTester(new BatchWs(new BatchIndex(mock(Server.class)),issuesAction));
}
