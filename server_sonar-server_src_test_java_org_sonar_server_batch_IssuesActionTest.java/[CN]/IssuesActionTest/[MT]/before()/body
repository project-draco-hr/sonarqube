{
  db.truncateTables();
  es.truncateIndices();
  this.session=db.myBatis().openSession(false);
  componentDao=new ComponentDao(mock(System2.class));
  DbClient dbClient=new DbClient(db.database(),db.myBatis(),new IssueDao(db.myBatis()),componentDao);
  issueIndex=new IssueIndex(es.client(),System2.INSTANCE,userSessionRule);
  issueIndexer=new IssueIndexer(null,es.client());
  issueAuthorizationIndexer=new IssueAuthorizationIndexer(null,es.client());
  issuesAction=new IssuesAction(dbClient,issueIndex,userSessionRule);
  tester=new WsTester(new BatchWs(new BatchIndex(mock(Server.class)),issuesAction));
}
