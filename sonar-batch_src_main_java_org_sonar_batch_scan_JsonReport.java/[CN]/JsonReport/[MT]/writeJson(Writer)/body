{
  JsonWriter json=null;
  try {
    json=new JsonWriter(writer);
    json.setSerializeNulls(false);
    json.beginObject();
    json.name("version").value(server.getVersion());
    Set<RuleKey> ruleKeys=newHashSet();
    Set<String> componentKeys=newHashSet();
    writeJsonIssues(json,ruleKeys,componentKeys);
    writeJsonComponents(json,componentKeys);
    writeJsonRules(json,ruleKeys);
    json.endObject().flush();
  }
 catch (  IOException e) {
    throw new SonarException("Unable to write JSON report",e);
  }
 finally {
    Closeables.closeQuietly(json);
  }
}
