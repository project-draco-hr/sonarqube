{
  ComponentDto project=ComponentTesting.newProjectDto("ABCD").setKey(PROJECT_KEY).setName("Project");
  dbClient.componentDao().insert(dbTester.getSession(),project);
  ComponentDto module=ComponentTesting.newModuleDto("BCDE",project).setKey(MODULE_KEY).setName("Module");
  dbClient.componentDao().insert(dbTester.getSession(),module);
  dbTester.getSession().commit();
  treeRootHolder.setRoot(builder(PROJECT,1).setUuid("ABCD").setKey(PROJECT_KEY).setName("Project").addChildren(builder(Component.Type.MODULE,2).setUuid("BCDE").setKey(MODULE_KEY).setName("Module").addChildren(builder(DIRECTORY,3).setUuid("CDEF").setKey("MODULE_KEY:src/main/java/dir").setPath("src/main/java/dir").addChildren(builder(FILE,4).setUuid("DEFG").setKey("MODULE_KEY:src/main/java/dir/Foo.java").setPath("src/main/java/dir/Foo.java").build()).build()).build()).build());
  underTest.execute();
  assertThat(dbTester.countRowsOfTable("projects")).isEqualTo(4);
  ComponentDto projectReloaded=dbClient.componentDao().selectByKey(dbTester.getSession(),PROJECT_KEY).get();
  assertThat(projectReloaded.getId()).isEqualTo(project.getId());
  assertThat(projectReloaded.uuid()).isEqualTo(project.uuid());
  ComponentDto moduleReloaded=dbClient.componentDao().selectByKey(dbTester.getSession(),MODULE_KEY).get();
  assertThat(moduleReloaded.getId()).isEqualTo(module.getId());
  assertThat(moduleReloaded.uuid()).isEqualTo(module.uuid());
  assertThat(moduleReloaded.moduleUuid()).isEqualTo(module.moduleUuid());
  assertThat(moduleReloaded.moduleUuidPath()).isEqualTo(module.moduleUuidPath());
  assertThat(moduleReloaded.projectUuid()).isEqualTo(module.projectUuid());
  assertThat(moduleReloaded.getRootUuid()).isEqualTo(module.getRootUuid());
  ComponentDto directory=dbClient.componentDao().selectByKey(dbTester.getSession(),"MODULE_KEY:src/main/java/dir").get();
  assertThat(directory.moduleUuid()).isEqualTo(module.uuid());
  assertThat(directory.moduleUuidPath()).isEqualTo(module.moduleUuidPath());
  assertThat(directory.projectUuid()).isEqualTo(project.uuid());
  assertThat(directory.getRootUuid()).isEqualTo(module.uuid());
  ComponentDto file=dbClient.componentDao().selectByKey(dbTester.getSession(),"MODULE_KEY:src/main/java/dir/Foo.java").get();
  assertThat(file.moduleUuid()).isEqualTo(module.uuid());
  assertThat(file.moduleUuidPath()).isEqualTo(module.moduleUuidPath());
  assertThat(file.projectUuid()).isEqualTo(project.uuid());
  assertThat(file.getRootUuid()).isEqualTo(module.uuid());
}
