{
  ComponentDto project=ComponentTesting.newProjectDto();
  db.componentDao().insert(session,project);
  RuleDto rule=RuleTesting.newXooX1();
  tester.get(RuleDao.class).insert(session,rule);
  ComponentDto file=ComponentTesting.newFileDto(project);
  tester.get(ComponentDao.class).insert(session,file);
  tester.get(IssueDao.class).insert(session,IssueTesting.newDto(rule,file,project));
  session.commit();
  assertThat(tester.get(IssueIndex.class).countAll()).isEqualTo(1);
  service.delete(project.getKey());
  assertThat(tester.get(IssueIndex.class).countAll()).isEqualTo(0);
}
