{
  issueCache.newAppender().append(new DefaultIssue().setSeverity(Severity.BLOCKER)).close();
  when(notifService.hasProjectSubscribersForTypes(PROJECT_UUID,SendIssueNotificationsStep.NOTIF_TYPES)).thenReturn(true);
  sut.execute(new ComputationContext(new BatchReportReader(reportDir),PROJECT_KEY,projectSettings,mock(DbClient.class),ComponentTreeBuilders.from(new DumbComponent(Component.Type.PROJECT,1,null,null)),mock(LanguageRepository.class)));
  verify(notifService).deliver(any(NewIssuesNotification.class));
  verify(notifService,atLeastOnce()).deliver(any(IssueChangeNotification.class));
}
