{
  issueCache=new IssueCache(temp.newFile(),System2.INSTANCE);
  DbComponentsRefCache dbComponentsRefCache=new DbComponentsRefCache();
  NewIssuesNotificationFactory newIssuesNotificationFactory=mock(NewIssuesNotificationFactory.class,Mockito.RETURNS_DEEP_STUBS);
  sut=new SendIssueNotificationsStep(issueCache,mock(RuleCache.class),dbComponentsRefCache,notifService,reportReader,newIssuesNotificationFactory);
  dbComponentsRefCache.addComponent(1,new DbComponentsRefCache.DbComponent(1L,PROJECT_KEY,PROJECT_UUID));
  reportReader.setMetadata(BatchReport.Metadata.newBuilder().setRootComponentRef(1).build());
  reportReader.putComponent(BatchReport.Component.newBuilder().setRef(1).setType(Constants.ComponentType.PROJECT).setKey(PROJECT_KEY).setName("Project name").build());
}
