{
  Map<Locale,String> fileCache=fileContentCache.get(filename);
  if (fileCache != null && fileCache.containsKey(locale)) {
    return fileCache.get(locale);
  }
  String result=null;
  String bundleBase=propertyToBundles.get(relatedProperty);
  if (bundleBase == null) {
    return null;
  }
  String filePath=bundleBase.replace('.','/');
  if (!"en".equals(locale.getLanguage())) {
    filePath+="_" + locale.getLanguage();
  }
  filePath+="/" + filename;
  InputStream input=i18nClassloader.getResourceAsStream(filePath);
  if (input != null) {
    result=readInputStream(filePath,input);
  }
  if (keepInCache) {
    if (fileCache == null) {
      fileCache=Maps.newHashMap();
      fileContentCache.put(filename,fileCache);
    }
    fileCache.put(locale,result);
  }
  return result;
}
