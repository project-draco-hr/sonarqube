{
  Map<Locale,String> fileCache=fileContentCache.get(filename);
  if (fileCache != null && fileCache.containsKey(locale)) {
    return fileCache.get(locale);
  }
  ClassLoader classloader=getClassLoaderForProperty(relatedProperty,locale);
  String result=null;
  if (classloader != null) {
    String bundleBase=propertyToBundles.get(relatedProperty);
    String filePath=bundleBase.replace('.','/');
    if (!"en".equals(locale.getLanguage())) {
      filePath+="_" + locale.getLanguage();
    }
    filePath+="/" + filename;
    InputStream input=classloader.getResourceAsStream(filePath);
    if (input != null) {
      try {
        result=IOUtils.toString(input,"UTF-8");
      }
 catch (      IOException e) {
        throw new SonarException("Fail to load file: " + filePath,e);
      }
 finally {
        IOUtils.closeQuietly(input);
      }
    }
    if (keepInCache) {
      if (fileCache == null) {
        fileCache=Maps.newHashMap();
        fileContentCache.put(filename,fileCache);
      }
      fileCache.put(locale,result);
    }
  }
  return result;
}
