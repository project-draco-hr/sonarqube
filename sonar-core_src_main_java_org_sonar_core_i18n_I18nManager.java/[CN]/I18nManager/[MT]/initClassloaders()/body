{
  if (bundleToClassloaders == null) {
    ClassLoader coreClassLoader=pluginRepository.getPlugin(ENGLISH_PACK_PLUGIN_KEY).getClass().getClassLoader();
    bundleToClassloaders=Maps.newHashMap();
    for (    PluginMetadata metadata : pluginRepository.getMetadata()) {
      if (!metadata.isCore() && !ENGLISH_PACK_PLUGIN_KEY.equals(metadata.getBasePlugin())) {
        ClassLoader classLoader=pluginRepository.getPlugin(metadata.getKey()).getClass().getClassLoader();
        bundleToClassloaders.put(BUNDLE_PACKAGE + metadata.getKey(),classLoader);
      }
 else       if (metadata.isCore()) {
        bundleToClassloaders.put(BUNDLE_PACKAGE + metadata.getKey(),coreClassLoader);
      }
    }
  }
  bundleToClassloaders=Collections.unmodifiableMap(bundleToClassloaders);
}
