{
  BoolFilterBuilder fb=FilterBuilders.boolFilter();
  this.addMultiFieldTermFilter(query.getDebtCharacteristics(),fb,RuleNormalizer.RuleField.SUB_CHARACTERISTIC.key(),RuleNormalizer.RuleField.CHARACTERISTIC.key());
  this.addTermFilter(RuleNormalizer.RuleField.LANGUAGE.key(),query.getLanguages(),fb);
  this.addTermFilter(RuleNormalizer.RuleField.REPOSITORY.key(),query.getRepositories(),fb);
  this.addTermFilter(RuleNormalizer.RuleField.SEVERITY.key(),query.getSeverities(),fb);
  this.addTermFilter(RuleNormalizer.RuleField.KEY.key(),query.getKey(),fb);
  this.addTermFilter(RuleNormalizer.RuleField._TAGS.key(),query.getTags(),fb);
  if (query.getStatuses() != null && !query.getStatuses().isEmpty()) {
    Collection<String> stringStatus=new ArrayList<String>();
    for (    RuleStatus status : query.getStatuses()) {
      stringStatus.add(status.name());
    }
    this.addTermFilter(RuleNormalizer.RuleField.STATUS.key(),stringStatus,fb);
  }
  if (query.getActivation() != null && !query.getActivation().isEmpty()) {
    if (query.getActivation().equals("false")) {
      fb.mustNot(FilterBuilders.hasChildFilter(new ActiveRuleIndexDefinition().getIndexType(),QueryBuilders.matchAllQuery()));
    }
 else     if (query.getActivation().equals("all")) {
      fb.must(FilterBuilders.hasChildFilter(new ActiveRuleIndexDefinition().getIndexType(),QueryBuilders.matchAllQuery()));
    }
 else     if (query.getActivation().equals("true")) {
      if (query.getQProfileKey() == null || query.getQProfileKey().isEmpty()) {
        throw new IllegalStateException("qProfile is required when \"activation=true\"");
      }
      fb.must(FilterBuilders.hasChildFilter(new ActiveRuleIndexDefinition().getIndexType(),QueryBuilders.termQuery(ActiveRuleNormalizer.ActiveRuleField.PROFILE_KEY.key(),query.getQProfileKey())));
    }
  }
  if ((query.getLanguages() != null && !query.getLanguages().isEmpty()) || (query.getRepositories() != null && !query.getRepositories().isEmpty()) || (query.getSeverities() != null && !query.getSeverities().isEmpty())|| (query.getTags() != null && !query.getTags().isEmpty())|| (query.getStatuses() != null && !query.getStatuses().isEmpty())|| (query.getKey() != null && !query.getKey().isEmpty())|| (query.getDebtCharacteristics() != null && !query.getDebtCharacteristics().isEmpty())|| (query.getActivation() != null && !query.getActivation().isEmpty())) {
    return fb;
  }
 else {
    return FilterBuilders.matchAllFilter();
  }
}
