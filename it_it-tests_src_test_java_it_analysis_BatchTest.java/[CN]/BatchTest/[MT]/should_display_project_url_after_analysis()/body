{
  orchestrator.getServer().provisionProject("com.sonarsource.it.samples:multi-modules-sample","Sonar :: Integration Tests :: Multi-modules Sample");
  orchestrator.getServer().associateProjectToQualityProfile("com.sonarsource.it.samples:multi-modules-sample","xoo","one-issue-per-line");
  Assume.assumeTrue(orchestrator.getServer().version().isGreaterThanOrEquals("3.6"));
  BuildResult result=scan("shared/xoo-multi-modules-sample");
  assertThat(result.getLogs()).contains("/dashboard/index/com.sonarsource.it.samples:multi-modules-sample");
  result=scan("shared/xoo-multi-modules-sample","sonar.branch","mybranch");
  assertThat(result.getLogs()).contains("/dashboard/index/com.sonarsource.it.samples:multi-modules-sample:mybranch");
  try {
    orchestrator.getServer().getAdminWsClient().update(new PropertyUpdateQuery("sonar.core.serverBaseURL","http://foo:123/sonar"));
    result=scan("shared/xoo-multi-modules-sample");
    assertThat(result.getLogs()).contains("http://foo:123/sonar/dashboard/index/com.sonarsource.it.samples:multi-modules-sample");
  }
  finally {
    orchestrator.getServer().getAdminWsClient().update(new PropertyUpdateQuery("sonar.core.serverBaseURL",null));
  }
}
