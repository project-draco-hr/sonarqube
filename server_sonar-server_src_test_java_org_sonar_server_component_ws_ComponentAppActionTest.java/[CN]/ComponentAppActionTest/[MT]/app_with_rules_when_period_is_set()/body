{
  MockUserSession.set().addComponentPermission(UserRole.USER,SUB_PROJECT_KEY,COMPONENT_KEY);
  addComponent();
  Date periodDate=DateUtils.parseDate("2014-05-08");
  when(resourceDao.getLastSnapshotByResourceId(eq(1L),eq(session))).thenReturn(new SnapshotDto().setPeriodMode(1,"previous_analysis").setPeriodDate(1,periodDate));
  when(periods.label(anyString(),anyString(),any(Date.class))).thenReturn("since previous analysis (May 08 2014)");
  when(issueService.findRulesByComponent(COMPONENT_KEY,periodDate,session)).thenReturn(new RulesAggregation().add(new RuleDto().setRuleKey("AvoidCycle").setRepositoryKey("squid").setName("Avoid Cycle")));
  WsTester.TestRequest request=tester.newGetRequest("api/components","app").setParam("key",COMPONENT_KEY).setParam("period","1");
  request.execute().assertJson(getClass(),"app_with_rules_when_period_is_set.json");
}
