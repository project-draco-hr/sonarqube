{
  MockUserSession.set().setLogin("john").addComponentPermission(UserRole.USER,SUB_PROJECT_KEY,COMPONENT_KEY);
  ComponentDto file=ComponentTesting.newFileDto(project).setId(10L).setKey(COMPONENT_KEY).setName("Plugin.java").setLongName(null).setPath("src/main/java/org/sonar/api/Plugin.java").setParentProjectId(1L);
  when(componentDao.getNullableByKey(session,COMPONENT_KEY)).thenReturn(file);
  when(componentDao.getById(project.getId(),session)).thenReturn(project);
  when(componentDao.getByUuid(session,project.uuid())).thenReturn(project);
  when(propertiesDao.selectByQuery(any(PropertyQuery.class),eq(session))).thenReturn(newArrayList(new PropertyDto()));
  WsTester.TestRequest request=tester.newGetRequest("api/components","app").setParam("key",COMPONENT_KEY);
  request.execute().assertJson(getClass(),"app_with_sub_project_equals_to_project.json");
}
