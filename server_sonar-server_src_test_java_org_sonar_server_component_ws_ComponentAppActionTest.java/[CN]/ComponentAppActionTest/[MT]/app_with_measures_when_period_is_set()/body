{
  MockUserSession.set().addComponentPermission(UserRole.USER,SUB_PROJECT_KEY,COMPONENT_KEY);
  addComponent();
  addPeriod();
  addVariationMeasure(CoreMetrics.NCLOC_KEY,2,1);
  addVariationMeasure(CoreMetrics.COVERAGE_KEY,5d,1);
  addVariationMeasure(CoreMetrics.DUPLICATED_LINES_DENSITY_KEY,1.2,1);
  addVariationMeasure(CoreMetrics.SQALE_DEBT_RATIO_KEY,5d,1);
  measures.add(MeasureDto.createFor(MeasureKey.of(COMPONENT_KEY,CoreMetrics.TECHNICAL_DEBT_KEY)).setVariation(1,10.0));
  when(durations.format(any(Locale.class),any(Duration.class),eq(Durations.DurationFormat.SHORT))).thenReturn("10min");
  WsTester.TestRequest request=tester.newGetRequest("api/components","app").setParam("key",COMPONENT_KEY).setParam("period","1");
  request.execute().assertJson(getClass(),"app_with_measures_when_period_is_set.json");
  verify(measureDao).findByComponentKeyAndMetricKeys(eq(COMPONENT_KEY),measureKeysCaptor.capture(),eq(session));
  assertThat(measureKeysCaptor.getValue()).contains(CoreMetrics.NCLOC_KEY,CoreMetrics.COVERAGE_KEY,CoreMetrics.DUPLICATED_LINES_DENSITY_KEY,CoreMetrics.TECHNICAL_DEBT_KEY);
}
