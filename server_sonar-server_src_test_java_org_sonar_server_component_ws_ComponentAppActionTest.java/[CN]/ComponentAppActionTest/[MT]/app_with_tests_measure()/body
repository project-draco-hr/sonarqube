{
  String componentKey="org.codehaus.sonar:sonar-server:src/test/java/org/sonar/server/issue/PlanActionTest.java";
  MockUserSession.set().addComponentPermission(UserRole.USER,SUB_PROJECT_KEY,componentKey);
  ComponentDto file=ComponentTesting.newFileDto(project).setId(10L).setQualifier("UTS").setLongName(null).setKey(componentKey).setName("PlanActionTest.java").setPath("src/test/java/org/sonar/server/issue/PlanActionTest.java").setParentProjectId(5L);
  when(componentDao.getNullableByKey(session,componentKey)).thenReturn(file);
  when(componentDao.getById(5L,session)).thenReturn(new ComponentDto().setId(5L).setLongName("SonarQube :: Plugin API").setKey(SUB_PROJECT_KEY));
  when(componentDao.getByUuid(session,project.uuid())).thenReturn(project);
  addMeasure(CoreMetrics.TESTS_KEY,10);
  WsTester.TestRequest request=tester.newGetRequest("api/components","app").setParam("key",componentKey);
  request.execute().assertJson(getClass(),"app_with_tests_measure.json");
  verify(measureDao).findByComponentKeyAndMetricKeys(eq(componentKey),measureKeysCaptor.capture(),eq(session));
  assertThat(measureKeysCaptor.getValue()).contains(CoreMetrics.TESTS_KEY);
}
