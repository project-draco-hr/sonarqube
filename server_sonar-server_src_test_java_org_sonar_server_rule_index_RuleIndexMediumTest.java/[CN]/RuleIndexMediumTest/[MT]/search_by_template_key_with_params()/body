{
  RuleDto templateRule=RuleTesting.newDto(RuleKey.of("java","S001")).setIsTemplate(true);
  RuleParamDto ruleParamDto=RuleParamDto.createFor(templateRule).setName("regex").setType("STRING").setDescription("Reg ex").setDefaultValue(".*");
  dao.insert(dbSession,templateRule);
  dao.insertRuleParam(dbSession,templateRule,ruleParamDto);
  RuleDto customRule=RuleTesting.newDto(RuleKey.of("java","S001_MY_CUSTOM")).setTemplateId(templateRule.getId());
  RuleParamDto customRuleParam=RuleParamDto.createFor(customRule).setName("regex").setType("STRING").setDescription("Reg ex").setDefaultValue("a.*");
  dao.insert(dbSession,customRule);
  dao.insertRuleParam(dbSession,customRule,customRuleParam);
  dbSession.commit();
  RuleQuery query=new RuleQuery();
  Result<Rule> results=index.search(query,new QueryContext(userSessionRule));
  assertThat(results.getHits()).hasSize(2);
  assertThat(index.getByKey(templateRule.getKey()).params()).hasSize(1);
  assertThat(index.getByKey(customRule.getKey()).params()).hasSize(1);
}
