{
  return new InternalRequestWrapper(request){
    @Override public String param(    String key){
      Param paramDef=action.param(key);
      if (paramDef == null) {
        String message=String.format("BUG - parameter '%s' is undefined for action '%s'",key,action.key());
        LoggerFactory.getLogger(getClass()).error(message);
        throw new IllegalStateException(message);
      }
      String value=StringUtils.defaultString(super.param(key),paramDef.defaultValue());
      List<String> possibleValues=paramDef.possibleValues();
      if (value != null && possibleValues != null && !possibleValues.contains(value)) {
        throw new BadRequestException(String.format("Value of parameter '%s' can only be one of %s",key,possibleValues));
      }
      return value;
    }
  }
;
}
