{
  for (  final BatchComponent resource : resourceCache.all()) {
    if (!resource.isFile()) {
      continue;
    }
    Map<Integer,LineCoverage.Builder> coveragePerLine=new LinkedHashMap<>();
    int lineCount=((InputFile)resource.inputComponent()).lines();
    applyLineMeasure(resource.key(),lineCount,CoreMetrics.COVERAGE_LINE_HITS_DATA_KEY,coveragePerLine,new MeasureOperation(){
      @Override public void apply(      String value,      LineCoverage.Builder builder){
        builder.setUtHits(Integer.parseInt(value) > 0);
      }
    }
);
    applyLineMeasure(resource.key(),lineCount,CoreMetrics.CONDITIONS_BY_LINE_KEY,coveragePerLine,new MeasureOperation(){
      @Override public void apply(      String value,      LineCoverage.Builder builder){
        builder.setConditions(Integer.parseInt(value));
      }
    }
);
    applyLineMeasure(resource.key(),lineCount,CoreMetrics.COVERED_CONDITIONS_BY_LINE_KEY,coveragePerLine,new MeasureOperation(){
      @Override public void apply(      String value,      LineCoverage.Builder builder){
        builder.setUtCoveredConditions(Integer.parseInt(value));
      }
    }
);
    applyLineMeasure(resource.key(),lineCount,CoreMetrics.IT_COVERAGE_LINE_HITS_DATA_KEY,coveragePerLine,new MeasureOperation(){
      @Override public void apply(      String value,      LineCoverage.Builder builder){
        builder.setItHits(Integer.parseInt(value) > 0);
      }
    }
);
    applyLineMeasure(resource.key(),lineCount,CoreMetrics.IT_COVERED_CONDITIONS_BY_LINE_KEY,coveragePerLine,new MeasureOperation(){
      @Override public void apply(      String value,      LineCoverage.Builder builder){
        builder.setItCoveredConditions(Integer.parseInt(value));
      }
    }
);
    applyLineMeasure(resource.key(),lineCount,CoreMetrics.OVERALL_COVERED_CONDITIONS_BY_LINE_KEY,coveragePerLine,new MeasureOperation(){
      @Override public void apply(      String value,      LineCoverage.Builder builder){
        builder.setOverallCoveredConditions(Integer.parseInt(value));
      }
    }
);
    writer.writeComponentCoverage(resource.batchId(),Iterables.transform(coveragePerLine.values(),BuildCoverage.INSTANCE));
  }
}
