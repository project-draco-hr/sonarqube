{
  userSession.checkGlobalPermission(UserRole.ADMIN);
  String taskId=wsRequest.mandatoryParam(PARAM_TASK_ID);
  DbSession dbSession=dbClient.openSession(false);
  try {
    WsCe.TaskResponse.Builder wsTaskResponse=WsCe.TaskResponse.newBuilder();
    Optional<CeQueueDto> queueDto=dbClient.ceQueueDao().selectByUuid(dbSession,taskId);
    if (queueDto.isPresent()) {
      wsTaskResponse.setTask(wsTaskFormatter.format(queueDto.get()));
    }
 else {
      Optional<CeActivityDto> activityDto=dbClient.ceActivityDao().selectByUuid(dbSession,taskId);
      if (activityDto.isPresent()) {
        wsTaskResponse.setTask(wsTaskFormatter.format(activityDto.get()));
      }
 else {
        throw new NotFoundException();
      }
    }
    WsUtils.writeProtobuf(wsTaskResponse.build(),wsRequest,wsResponse);
  }
  finally {
    dbClient.closeSession(dbSession);
  }
}
