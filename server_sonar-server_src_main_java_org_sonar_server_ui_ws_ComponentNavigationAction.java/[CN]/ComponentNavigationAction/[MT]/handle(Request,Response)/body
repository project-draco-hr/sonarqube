{
  String componentKey=request.mandatoryParam(PARAM_COMPONENT_KEY);
  DbSession session=dbClient.openSession(false);
  try {
    ComponentDto component=componentFinder.getByKey(session,componentKey);
    userSession.checkComponentUuidPermission(UserRole.USER,component.projectUuid());
    Optional<SnapshotDto> analysis=dbClient.snapshotDao().selectLastAnalysisByRootComponentUuid(session,component.projectUuid());
    JsonWriter json=response.newJsonWriter();
    json.beginObject();
    writeComponent(json,session,component,analysis.orElse(null),userSession);
    if (userSession.hasComponentUuidPermission(UserRole.ADMIN,component.projectUuid()) || userSession.hasPermission(GlobalPermissions.QUALITY_PROFILE_ADMIN)) {
      writeConfiguration(json,component,userSession);
    }
    writeBreadCrumbs(json,session,component);
    json.endObject().close();
  }
  finally {
    session.close();
  }
}
