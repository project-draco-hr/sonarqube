{
  SnapshotDto period1ViewSnapshot=createForProject(VIEW_DTO).setLast(false);
  SnapshotDto period2ViewSnapshot=createForProject(VIEW_DTO).setLast(false);
  SnapshotDto period3ViewSnapshot=createForProject(VIEW_DTO).setLast(false);
  SnapshotDto period4ViewSnapshot=createForProject(VIEW_DTO).setLast(false);
  SnapshotDto period5ViewSnapshot=createForProject(VIEW_DTO).setLast(false);
  dbClient.snapshotDao().insert(session,period1ViewSnapshot,period2ViewSnapshot,period3ViewSnapshot,period4ViewSnapshot,period5ViewSnapshot);
  dbClient.measureDao().insert(session,newMeasureDto(ISSUES_METRIC.getId(),VIEW_DTO.getId(),period1ViewSnapshot.getId(),0d),newMeasureDto(ISSUES_METRIC.getId(),VIEW_DTO.getId(),period2ViewSnapshot.getId(),20d),newMeasureDto(ISSUES_METRIC.getId(),VIEW_DTO.getId(),period3ViewSnapshot.getId(),40d),newMeasureDto(ISSUES_METRIC.getId(),VIEW_DTO.getId(),period4ViewSnapshot.getId(),80d),newMeasureDto(ISSUES_METRIC.getId(),VIEW_DTO.getId(),period5ViewSnapshot.getId(),100d));
  session.commit();
  periodsHolder.setPeriods(newPeriod(1,period1ViewSnapshot),newPeriod(2,period2ViewSnapshot),newPeriod(3,period3ViewSnapshot),newPeriod(4,period4ViewSnapshot),newPeriod(5,period5ViewSnapshot));
  treeRootHolder.setRoot(VIEW);
  addRawMeasure(VIEW,ISSUES_METRIC,Measure.newMeasureBuilder().create(80,null));
  underTest.execute();
  assertThat(measureRepository.getRawMeasures(VIEW).keys()).hasSize(1);
  Measure measure=measureRepository.getRawMeasure(VIEW,ISSUES_METRIC).get();
  assertThat(measure.hasVariations()).isTrue();
  assertThat(measure.getVariations().getVariation1()).isEqualTo(80d);
  assertThat(measure.getVariations().getVariation2()).isEqualTo(60d);
  assertThat(measure.getVariations().getVariation3()).isEqualTo(40d);
  assertThat(measure.getVariations().getVariation4()).isEqualTo(0d);
  assertThat(measure.getVariations().getVariation5()).isEqualTo(-20d);
}
