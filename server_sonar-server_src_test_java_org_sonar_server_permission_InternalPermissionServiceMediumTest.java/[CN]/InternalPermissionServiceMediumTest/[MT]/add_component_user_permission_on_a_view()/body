{
  ComponentDto view=ComponentTesting.newProjectDto().setKey("MASTER").setQualifier(Qualifiers.VIEW).setUuid(null).setProjectUuid(null);
  db.componentDao().insert(session,view);
  session.commit();
  MockUserSession.set().setLogin("admin").addProjectPermissions(UserRole.ADMIN,view.key());
  UserDto user=new UserDto().setLogin("john").setName("John");
  db.userDao().insert(session,user);
  session.commit();
  assertThat(tester.get(RoleDao.class).selectUserPermissions(session,user.getLogin(),view.getId())).isEmpty();
  service.addPermission(params(user.getLogin(),null,view.key(),UserRole.USER));
  session.commit();
  assertThat(tester.get(RoleDao.class).selectUserPermissions(session,user.getLogin(),view.getId())).hasSize(1);
}
