{
  final long now=system.now();
  MassUpdate massUpdate=context.prepareMassUpdate();
  massUpdate.select("SELECT i.id, i.created_at, i.updated_at FROM issues i WHERE created_at_ms IS NULL");
  massUpdate.update("UPDATE issues SET created_at_ms=?, updated_at_ms=? WHERE id=?");
  massUpdate.rowPluralName("issues");
  massUpdate.execute(new MassUpdate.Handler(){
    @Override public boolean handle(    Select.Row row,    SqlStatement update) throws SQLException {
      Long id=row.getNullableLong(1);
      Date createdAt=row.getNullableDate(2);
      Date updatedAt=row.getNullableDate(3);
      if (createdAt == null) {
        update.setLong(1,now);
      }
 else {
        update.setLong(1,Math.min(now,createdAt.getTime()));
      }
      if (updatedAt == null) {
        update.setLong(2,now);
      }
 else {
        update.setLong(2,Math.min(now,updatedAt.getTime()));
      }
      update.setLong(3,id);
      return true;
    }
  }
);
}
