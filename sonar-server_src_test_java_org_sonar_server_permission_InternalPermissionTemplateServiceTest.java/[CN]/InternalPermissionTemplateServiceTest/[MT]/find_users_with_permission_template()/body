{
  service.findUsersWithPermissionTemplate(ImmutableMap.<String,Object>of("permission","user","template","my_template","selected","all"));
  ArgumentCaptor<WithPermissionQuery> argumentCaptor=ArgumentCaptor.forClass(WithPermissionQuery.class);
  verify(finder).findUsersWithPermissionTemplate(argumentCaptor.capture());
  WithPermissionQuery query=argumentCaptor.getValue();
  assertThat(query.permission()).isEqualTo("user");
  assertThat(query.template()).isEqualTo("my_template");
  assertThat(query.membership()).isEqualTo(WithPermissionQuery.ANY);
}
