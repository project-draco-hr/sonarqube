{
  Characteristic characteristic=Iterables.find(characteristics,new Predicate<Characteristic>(){
    @Override public boolean apply(    @Nullable Characteristic input){
      return input != null && input.key.equals(key);
    }
  }
,null);
  if (characteristic != null) {
    Integer parentId=characteristic.getParentId();
    if (parentId == null) {
      throw new IllegalStateException(String.format("'%s' must be a sub-characteristic",characteristic.getName()));
    }
 else     if (!parentId.equals(parent.getId())) {
      throw new IllegalStateException(String.format("'%s' must be defined under '%s'",characteristic.getName(),parent.getName()));
    }
  }
  return characteristic;
}
