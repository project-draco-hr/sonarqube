{
  boolean hasScanPerm=userSession.hasGlobalPermission(GlobalPermissions.SCAN_EXECUTION);
  boolean hasPreviewPerm=userSession.hasGlobalPermission(GlobalPermissions.PREVIEW_EXECUTION);
  if (!hasPreviewPerm && !hasScanPerm) {
    throw new ForbiddenException(Messages.NO_PERMISSION);
  }
  if (!preview && !hasScanPerm) {
    throw new ForbiddenException("You're only authorized to execute a local (preview) SonarQube analysis without pushing the results to the SonarQube server. " + "Please contact your SonarQube administrator.");
  }
  if (preview && !hasPreviewPerm) {
    throw new ForbiddenException("You're not authorized to execute a preview analysis. Please contact your SonarQube administrator.");
  }
}
