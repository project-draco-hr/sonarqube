{
  QualityProfileDto qualityProfileDto=profileName != null ? qProfileFactory.getByNameAndLanguage(session,profileName,languageKey) : null;
  if (qualityProfileDto == null && projectKey != null) {
    qualityProfileDto=qProfileFactory.getByProjectAndLanguage(session,projectKey,languageKey);
  }
  qualityProfileDto=qualityProfileDto != null ? qualityProfileDto : qProfileFactory.getDefault(session,languageKey);
  if (qualityProfileDto != null) {
    return qualityProfileDto;
  }
 else {
    throw new IllegalStateException(String.format("No quality profile can been found on language '%s' for project '%s'",languageKey,projectKey));
  }
}
