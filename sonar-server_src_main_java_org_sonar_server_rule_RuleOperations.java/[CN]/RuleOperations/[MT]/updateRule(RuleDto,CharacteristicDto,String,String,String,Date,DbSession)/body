{
  boolean needUpdate=false;
  if (newSubCharacteristic != null && newFunction != null) {
    if (isRuleDebtSameAsDefaultValues(ruleDto,newSubCharacteristic,newFunction,newCoefficient,newOffset)) {
      ruleDto.setSubCharacteristicId(null);
      ruleDto.setRemediationFunction(null);
      ruleDto.setRemediationCoefficient(null);
      ruleDto.setRemediationOffset(null);
      needUpdate=true;
    }
 else     if (!isRuleDebtSameAsOverriddenValues(ruleDto,newSubCharacteristic,newFunction,newCoefficient,newOffset)) {
      ruleDto.setSubCharacteristicId(newSubCharacteristic.getId());
      DefaultDebtRemediationFunction debtRemediationFunction=new DefaultDebtRemediationFunction(DebtRemediationFunction.Type.valueOf(newFunction),newCoefficient,newOffset);
      ruleDto.setRemediationFunction(debtRemediationFunction.type().name());
      ruleDto.setRemediationCoefficient(debtRemediationFunction.coefficient());
      ruleDto.setRemediationOffset(debtRemediationFunction.offset());
      needUpdate=true;
    }
  }
 else {
    if (ruleDto.getSubCharacteristicId() == null || !RuleDto.DISABLED_CHARACTERISTIC_ID.equals(ruleDto.getSubCharacteristicId())) {
      ruleDto.setSubCharacteristicId(ruleDto.getDefaultSubCharacteristicId() != null ? RuleDto.DISABLED_CHARACTERISTIC_ID : null);
      ruleDto.setRemediationFunction(null);
      ruleDto.setRemediationCoefficient(null);
      ruleDto.setRemediationOffset(null);
      needUpdate=true;
    }
  }
  if (needUpdate) {
    ruleDto.setUpdatedAt(updateDate);
    ruleDao.update(ruleDto,session);
  }
  return needUpdate;
}
