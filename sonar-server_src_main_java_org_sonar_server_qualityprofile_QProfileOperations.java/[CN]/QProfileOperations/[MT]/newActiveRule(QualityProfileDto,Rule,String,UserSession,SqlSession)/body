{
  ActiveRuleDto activeRuleDto=new ActiveRuleDto().setProfileId(qualityProfile.getId()).setRuleId(rule.getId().longValue()).setSeverity(Severity.ordinal(severity));
  activeRuleDao.insert(activeRuleDto,session);
  List<RuleParamDto> ruleParams=ruleDao.selectParameters(rule.getId().longValue(),session);
  List<ActiveRuleParamDto> activeRuleParams=Lists.newArrayList();
  for (  RuleParamDto ruleParam : ruleParams) {
    ActiveRuleParamDto activeRuleParam=new ActiveRuleParamDto().setActiveRuleId(activeRuleDto.getId()).setRulesParameterId(ruleParam.getId()).setKey(ruleParam.getName()).setValue(ruleParam.getDefaultValue());
    activeRuleParams.add(activeRuleParam);
    activeRuleDao.insert(activeRuleParam,session);
  }
  session.commit();
  ruleRegistry.save(activeRuleDto,activeRuleParams);
  profilesManager.activated(qualityProfile.getId(),activeRuleDto.getId(),userSession.name());
  return activeRuleDto;
}
