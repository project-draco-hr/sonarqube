{
  List<ActiveRuleDto> activeRuleDtos=newArrayList();
  Multimap<Integer,ActiveRuleParamDto> paramsByActiveRule=ArrayListMultimap.create();
  for (  ActiveRule activeRule : rulesProfile.getActiveRules()) {
    ActiveRuleDto activeRuleDto=toActiveRuleDto(activeRule,profileId);
    activeRuleDao.insert(activeRuleDto,sqlSession);
    activeRuleDtos.add(activeRuleDto);
    for (    ActiveRuleParam activeRuleParam : activeRule.getActiveRuleParams()) {
      ActiveRuleParamDto activeRuleParamDto=toActiveRuleParamDto(activeRuleParam,activeRuleDto);
      activeRuleDao.insert(activeRuleParamDto,sqlSession);
      paramsByActiveRule.put(activeRuleDto.getId(),activeRuleParamDto);
    }
  }
  ruleRegistry.bulkIndexActiveRules(activeRuleDtos,paramsByActiveRule);
}
