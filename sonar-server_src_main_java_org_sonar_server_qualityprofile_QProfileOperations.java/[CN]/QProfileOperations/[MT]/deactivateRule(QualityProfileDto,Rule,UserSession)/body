{
  checkPermission(userSession);
  SqlSession session=myBatis.openSession();
  try {
    ActiveRuleDto activeRule=validate(qualityProfile,rule);
    RuleInheritanceActions actions=profilesManager.deactivated(activeRule.getProfileId(),activeRule.getId(),userSession.name());
    activeRuleDao.delete(activeRule.getId(),session);
    activeRuleDao.deleteParameters(activeRule.getId(),session);
    actions.addToDelete(activeRule.getId());
    session.commit();
    reindexInheritanceResult(actions,session);
    return new RuleActivationResult(QProfile.from(qualityProfile),profileRules.getFromRuleId(rule.getId()));
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
