{
  SqlSession session=myBatis.openSession();
  try {
    QProfile profile=newProfile(name,language,userSession,session);
    QProfileResult result=new QProfileResult();
    List<RulesProfile> importProfiles=readProfilesFromXml(result,xmlProfilesByPlugin);
    for (    RulesProfile rulesProfile : importProfiles) {
      importProfile(profile.id(),rulesProfile,session);
    }
    result.setProfile(profile);
    session.commit();
    dryRunCache.reportGlobalModification();
    return result;
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
