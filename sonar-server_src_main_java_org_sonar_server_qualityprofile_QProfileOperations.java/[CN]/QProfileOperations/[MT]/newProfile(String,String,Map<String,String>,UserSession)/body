{
  validateNewProfile(name,language,userSession);
  NewProfileResult result=new NewProfileResult();
  List<RulesProfile> importProfiles=readProfilesFromXml(result,xmlProfilesByPlugin);
  SqlSession sqlSession=myBatis.openSession();
  try {
    QualityProfileDto dto=new QualityProfileDto().setName(name).setLanguage(language).setVersion(1).setUsed(false);
    dao.insert(dto,sqlSession);
    for (    RulesProfile rulesProfile : importProfiles) {
      importProfile(dto,rulesProfile,sqlSession);
    }
    result.setProfile(QProfile.from(dto));
  }
  finally {
    sqlSession.commit();
    dryRunCache.reportGlobalModification();
    return result;
  }
}
