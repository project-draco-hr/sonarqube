{
  checkPermission(userSession);
  SqlSession session=myBatis.openSession();
  try {
    QualityProfileDto profileDto=findNotNull(profileId,session);
    String oldName=profileDto.getName();
    QProfile profile=QProfile.from(profileDto);
    if (!oldName.equals(newName)) {
      checkNotAlreadyExists(newName,profile.language(),session);
    }
    profileDto.setName(newName);
    dao.update(profileDto,session);
    List<QProfile> children=profileLookup.children(profile,session);
    for (    QProfile child : children) {
      dao.update(child.setParent(newName).toDto(),session);
    }
    propertiesDao.updateProperties(PROFILE_PROPERTY_PREFIX + profile.language(),oldName,newName,session);
    session.commit();
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
