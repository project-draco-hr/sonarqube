{
  checkPermission(userSession);
  SqlSession session=myBatis.openSession();
  try {
    RuleParamDto ruleParam=ruleDao.selectParamByRuleAndKey(activeRule.getRulId(),key,session);
    if (ruleParam == null) {
      throw new IllegalArgumentException("No rule param found");
    }
    ActiveRuleParamDto activeRuleParam=new ActiveRuleParamDto().setActiveRuleId(activeRule.getId()).setKey(key).setValue(value).setRulesParameterId(ruleParam.getId());
    activeRuleDao.insert(activeRuleParam,session);
    session.commit();
    RuleInheritanceActions actions=profilesManager.ruleParamChanged(activeRule.getProfileId(),activeRule.getId(),key,null,value,userSession.name());
    reindexInheritanceResult(actions,session);
    return profileRules.getFromActiveRuleId(activeRule.getId());
  }
  finally {
    MyBatis.closeQuietly(session);
  }
}
