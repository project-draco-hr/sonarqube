{
  ComponentDto project=insertComponent(ComponentTesting.newProjectDto("ABCD").setKey("MyProject"));
  setDefaultProjectPermission(project);
  ComponentDto module=insertComponent(ComponentTesting.newModuleDto("BCDE",project).setKey("MyModule"));
  ComponentDto subModule1=insertComponent(ComponentTesting.newModuleDto("CDEF",module).setKey("MySubModule1"));
  ComponentDto subModule2=insertComponent(ComponentTesting.newModuleDto("DEFA",module).setKey("MySubModule2"));
  ComponentDto subModule3=insertComponent(ComponentTesting.newModuleDto("EFAB",module).setKey("MySubModule3"));
  ComponentDto file1=insertComponent(ComponentTesting.newFileDto(subModule1,"FEDC").setKey("MyComponent1"));
  ComponentDto file2=insertComponent(ComponentTesting.newFileDto(subModule2,"EDCB").setKey("MyComponent2"));
  RuleDto newRule=newRule();
  IssueDto issue1=IssueTesting.newDto(newRule,file1,project).setKee("82fd47d4-b650-4037-80bc-7b112bd4eac2");
  IssueDto issue2=IssueTesting.newDto(newRule,file2,project).setKee("2bd4eac2-b650-4037-80bc-7b1182fd47d4");
  db.issueDao().insert(session,issue1,issue2);
  session.commit();
  tester.get(IssueIndexer.class).indexAll();
  wsTester.newGetRequest(IssuesWs.API_ENDPOINT,SearchAction.SEARCH_ACTION).setParam(IssueFilterParameters.COMPONENT_UUIDS,module.uuid()).setParam(IssueFilterParameters.MODULE_UUIDS,subModule1.uuid() + "," + subModule3.uuid()).setParam(WebService.Param.FACETS,"moduleUuids").execute().assertJson(this.getClass(),"display_module_facet.json");
}
