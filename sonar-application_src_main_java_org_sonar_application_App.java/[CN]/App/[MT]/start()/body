{
  try {
    Logger logger=LoggerFactory.getLogger(getClass());
    monitor.start();
    elasticsearch=new ProcessWrapper(SONAR_SEARCH_PROCESS).setWorkDir(installation.homeDir()).setJmxPort(Integer.parseInt(installation.prop(DefaultSettings.ES_JMX_PORT_KEY))).addJavaOpts(installation.prop(DefaultSettings.ES_JAVA_OPTS_KEY)).addJavaOpts(String.format("-Djava.io.tmpdir=%s",installation.tempDir().getAbsolutePath())).addJavaOpts(String.format("-Dsonar.path.logs=%s",installation.logsDir().getAbsolutePath())).setClassName("org.sonar.search.SearchServer").setProperties(installation.props().encryptedProperties()).addClasspath(installation.starPath("lib/common")).addClasspath(installation.starPath("lib/search"));
    if (elasticsearch.execute()) {
      monitor.registerProcess(elasticsearch);
      if (elasticsearch.waitForReady()) {
        logger.info("Search server is ready");
        server=new ProcessWrapper(SONAR_WEB_PROCESS).setWorkDir(installation.homeDir()).setJmxPort(Integer.parseInt(installation.prop(DefaultSettings.WEB_JMX_PORT_KEY))).addJavaOpts(installation.prop(DefaultSettings.WEB_JAVA_OPTS_KEY)).addJavaOpts(DefaultSettings.WEB_JAVA_OPTS_APPENDED_VAL).addJavaOpts(String.format("-Djava.io.tmpdir=%s",installation.tempDir().getAbsolutePath())).setClassName("org.sonar.server.app.WebServer").setProperties(installation.props().encryptedProperties()).addClasspath(installation.starPath("extensions/jdbc-driver/mysql")).addClasspath(installation.starPath("extensions/jdbc-driver/mssql")).addClasspath(installation.starPath("extensions/jdbc-driver/oracle")).addClasspath(installation.starPath("extensions/jdbc-driver/postgresql")).addClasspath(installation.starPath("lib/common")).addClasspath(installation.starPath("lib/server"));
        if (server.execute()) {
          monitor.registerProcess(server);
          if (server.waitForReady()) {
            logger.info("Web server is ready");
            monitor.join();
          }
        }
      }
    }
  }
  finally {
    terminate();
  }
}
