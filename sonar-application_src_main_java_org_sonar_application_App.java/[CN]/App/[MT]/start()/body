{
  try {
    Logger logger=LoggerFactory.getLogger(getClass());
    monitor.start();
    elasticsearch=new ProcessWrapper(JmxUtils.SEARCH_SERVER_NAME).setWorkDir(installation.homeDir()).setJmxPort(Integer.parseInt(installation.prop(DefaultSettings.ES_JMX_PORT_KEY))).addJavaOpts(installation.prop(DefaultSettings.ES_JAVA_OPTS_KEY)).addJavaOpts(String.format("-Djava.io.tmpdir=%s",installation.tempDir().getAbsolutePath())).addJavaOpts(String.format("-Dsonar.path.logs=%s",installation.logsDir().getAbsolutePath())).setClassName("org.sonar.search.SearchServer").addProperties(installation.props().rawProperties()).addClasspath(installation.starPath("lib/common")).addClasspath(installation.starPath("lib/search"));
    if (elasticsearch.execute()) {
      monitor.registerProcess(elasticsearch);
      if (elasticsearch.waitForReady()) {
        logger.info("search server is up");
        server=new ProcessWrapper(JmxUtils.WEB_SERVER_NAME).setWorkDir(installation.homeDir()).setJmxPort(Integer.parseInt(installation.prop(DefaultSettings.WEB_JMX_PORT_KEY))).addJavaOpts(installation.prop(DefaultSettings.WEB_JAVA_OPTS_KEY)).addJavaOpts(String.format("-Djava.io.tmpdir=%s",installation.tempDir().getAbsolutePath())).addJavaOpts(String.format("-Dsonar.path.logs=%s",installation.logsDir().getAbsolutePath())).setClassName("org.sonar.server.app.WebServer").addProperties(installation.props().rawProperties()).addClasspath(installation.starPath("extensions/jdbc-driver/mysql")).addClasspath(installation.starPath("extensions/jdbc-driver/mssql")).addClasspath(installation.starPath("extensions/jdbc-driver/oracle")).addClasspath(installation.starPath("extensions/jdbc-driver/postgresql")).addClasspath(installation.starPath("lib/common")).addClasspath(installation.starPath("lib/server"));
        if (server.execute()) {
          monitor.registerProcess(server);
          if (server.waitForReady()) {
            success=true;
            logger.info("web server is up");
            monitor.join();
          }
        }
      }
    }
  }
  finally {
    terminate();
  }
}
