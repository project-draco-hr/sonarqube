{
  List<RulesProfile> profiles=session.getResults(RulesProfile.class,"language",language.getKey());
  RulesProfile profileToActivate=null;
  boolean oneProfileIsActivated=false;
  if (profiles.isEmpty()) {
    profileToActivate=RulesProfile.create("Default " + language.getName(),language.getKey());
    profileToActivate.setDefaultProfile(true);
    profileToActivate.setProvided(false);
  }
 else   if (profiles.size() == 1) {
    profileToActivate=profiles.get(0);
  }
 else   if (!activeProfileFoundInDB(profiles)) {
    Iterator<RulesProfile> iterator=profiles.iterator();
    while (iterator.hasNext() && !oneProfileIsActivated) {
      RulesProfile profile=iterator.next();
      oneProfileIsActivated=profile.getDefaultProfile();
      if (RulesProfile.SONAR_WAY_NAME.equals(profile.getName())) {
        profileToActivate=profile;
      }
    }
    if (!oneProfileIsActivated && profileToActivate == null) {
      profileToActivate=profiles.get(0);
    }
  }
  activateProfileIfNeeded(session,profileToActivate,oneProfileIsActivated);
}
