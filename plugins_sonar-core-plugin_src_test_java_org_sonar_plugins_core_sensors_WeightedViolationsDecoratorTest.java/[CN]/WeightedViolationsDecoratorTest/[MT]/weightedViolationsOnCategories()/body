{
  Map<RulePriority,Integer> weights=createWeights();
  WeightedViolationsDecorator decorator=new WeightedViolationsDecorator(weights);
  DecoratorContext context=mock(DecoratorContext.class);
  when(context.getMeasures((MeasuresFilter)anyObject())).thenReturn(createViolationsMeasures());
  decorator.decorate(mock(Resource.class),context);
  verify(context).saveMeasure(argThat(new IsRuleMeasure(CoreMetrics.WEIGHTED_VIOLATIONS,null,3,null,40.0 * 0 + 80.0 * 5 + 90.0 * 10)));
  verify(context).saveMeasure(argThat(new IsRuleMeasure(CoreMetrics.WEIGHTED_VIOLATIONS,null,4,null,10.0 * 0 + 10.0 * 10)));
}
