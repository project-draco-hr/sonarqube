{
  setupData("last_snapshot");
  ServerClient server=mock(ServerClient.class);
  when(server.request(anyString(),eq(false),eq(30 * 1000))).thenThrow(new HttpDownloader.HttpException(new URI(""),500));
  when(mode.isPreview()).thenReturn(true);
  LastSnapshots lastSnapshots=new LastSnapshots(mode,getSession(),server);
  thrown.expect(HttpDownloader.HttpException.class);
  lastSnapshots.getSource(newFile());
}
