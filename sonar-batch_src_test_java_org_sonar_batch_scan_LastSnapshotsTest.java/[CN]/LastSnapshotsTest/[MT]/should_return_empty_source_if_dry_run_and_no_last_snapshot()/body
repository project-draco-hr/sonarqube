{
  setupData("last_snapshot");
  ServerClient server=mock(ServerClient.class);
  when(server.request(anyString(),eq(false))).thenThrow(new HttpDownloader.HttpException(new URI(""),404));
  Settings settings=new Settings();
  settings.setProperty(CoreProperties.DRY_RUN,true);
  LastSnapshots lastSnapshots=new LastSnapshots(settings,getSession(),server);
  String source=lastSnapshots.getSource(newFile());
  assertThat(source).isEqualTo("");
  verify(server).request("/api/sources?resource=myproject:org/foo/Bar.c&format=txt",false);
}
