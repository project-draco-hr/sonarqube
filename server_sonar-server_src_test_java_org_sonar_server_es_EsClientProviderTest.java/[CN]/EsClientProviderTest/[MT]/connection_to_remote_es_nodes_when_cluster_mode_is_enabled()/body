{
  settings.setProperty(ProcessProperties.CLUSTER_ENABLED,true);
  settings.setProperty(ProcessProperties.CLUSTER_SEARCH_HOSTS,format("%s:8080,%s:8081",localhost,localhost));
  EsClient client=underTest.provide(settings);
  TransportClient transportClient=(TransportClient)client.nativeClient();
  assertThat(transportClient.transportAddresses()).hasSize(2);
  TransportAddress address=transportClient.transportAddresses().get(0);
  assertThat(address.getAddress()).isEqualTo(localhost);
  assertThat(address.getPort()).isEqualTo(8080);
  address=transportClient.transportAddresses().get(1);
  assertThat(address.getAddress()).isEqualTo(localhost);
  assertThat(address.getPort()).isEqualTo(8081);
  assertThat(underTest.provide(settings)).isSameAs(client);
}
