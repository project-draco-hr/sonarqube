{
  String state="state";
  when(request.getCookies()).thenReturn(new Cookie[]{new Cookie("OAUTHSTATE",sha256Hex(state))});
  when(request.getParameter("state")).thenReturn(state);
  when(server.getContextPath()).thenReturn("/sonarqube");
  underTest.verifyState(request,response);
  verify(response).addCookie(cookieArgumentCaptor.capture());
  Cookie updatedCookie=cookieArgumentCaptor.getValue();
  assertThat(updatedCookie.getPath()).isEqualTo("/sonarqube/");
}
