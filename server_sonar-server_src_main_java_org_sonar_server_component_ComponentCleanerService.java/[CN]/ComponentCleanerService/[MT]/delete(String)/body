{
  DbSession session=dbClient.openSession(false);
  try {
    AuthorizedComponentDto project=dbClient.componentDao().getAuthorizedComponentByKey(projectKey,session);
    if (!Scopes.PROJECT.equals(project.scope())) {
      throw new IllegalArgumentException("Only project can be deleted");
    }
    purgeDao.deleteResourceTree(project.getId());
    deletePermissionIndexes(session,project.uuid());
    session.commit();
  }
  finally {
    session.close();
  }
  deleteIssuesFromIndex(projectKey);
}
