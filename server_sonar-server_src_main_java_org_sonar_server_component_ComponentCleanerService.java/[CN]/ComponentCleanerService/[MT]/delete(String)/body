{
  DbSession dbSession=dbClient.openSession(false);
  try {
    ComponentDto project=dbClient.componentDao().getByKey(dbSession,projectKey);
    if (!Scopes.PROJECT.equals(project.scope())) {
      throw new IllegalArgumentException("Only projects can be deleted");
    }
    purgeDao.deleteResourceTree(project.getId());
    dbSession.commit();
    deleteFromIndices(project.uuid());
  }
  finally {
    MyBatis.closeQuietly(dbSession);
  }
}
