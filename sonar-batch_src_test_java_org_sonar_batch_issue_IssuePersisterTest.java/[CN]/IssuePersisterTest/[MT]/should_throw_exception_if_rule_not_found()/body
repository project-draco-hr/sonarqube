{
  Issue issue=new DefaultIssue().setComponentKey("componentKey").setRuleRepositoryKey("repoKey").setRuleKey("ruleKey");
  when(issueCache.issues()).thenReturn(newArrayList(issue));
  Snapshot snapshot=mock(Snapshot.class);
  when(snapshotCache.get("componentKey")).thenReturn(snapshot);
  when(ruleFinder.findByKey("repoKey","ruleKey")).thenReturn(null);
  issuePersister.persist();
}
