{
  Snapshot snapshot=new Snapshot();
  snapshot.setId(100);
  snapshot.setResourceId(200);
  snapshots.put("org/struts/Action.java",snapshot);
  Issue issue=new DefaultIssue().setKey("ABCD").setComponentKey("org/struts/Action.java").setRuleRepositoryKey("squid").setRuleKey("NullDef").setNew(true).setStatus(Issue.STATUS_OPEN).setSeverity(Issue.SEVERITY_BLOCKER).setCreatedAt(DateUtils.parseDate("2013-05-18")).setUpdatedAt(DateUtils.parseDate("2013-05-23"));
  when(issues.componentIssues("org/struts/Action.java")).thenReturn(newArrayList(issue));
  Rule rule=Rule.create("squid","NullDef");
  rule.setId(300);
  when(ruleFinder.findByKey("squid","NullDef")).thenReturn(rule);
  persister.persist();
  checkTables("should_insert_new_issue","issues");
}
