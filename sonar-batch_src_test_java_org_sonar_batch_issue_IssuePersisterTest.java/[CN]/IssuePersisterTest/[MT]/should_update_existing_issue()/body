{
  setupData("should_update_existing_issue");
  Snapshot snapshot=new Snapshot();
  snapshot.setId(100);
  snapshot.setResourceId(200);
  snapshots.put("org/struts/Action.java",snapshot);
  Issue issue=new DefaultIssue().setKey("ABCD").setComponentKey("org/struts/Action.java").setRuleKey(RuleKey.of("squid","NullDef")).setNew(false).setStatus(Issue.STATUS_CLOSED).setSeverity(Severity.BLOCKER).setCreatedAt(DateUtils.parseDate("2013-05-18")).setUpdatedAt(DateUtils.parseDate("2013-05-23"));
  when(issues.componentIssues("org/struts/Action.java")).thenReturn(newArrayList(issue));
  Rule rule=Rule.create("squid","NullDef");
  rule.setId(300);
  when(ruleFinder.findByKey("squid","NullDef")).thenReturn(rule);
  persister.persist();
  checkTables("should_update_existing_issue","issues");
}
