{
  when(userSession.isLoggedIn()).thenReturn(true);
  when(userSession.userId()).thenReturn(10);
  when(userSession.login()).thenReturn("arthur");
  when(authorizationDao.isAuthorizedComponentKey(anyString(),eq(10),anyString())).thenReturn(true);
  when(finder.find(any(IssueQuery.class))).thenReturn(issueQueryResult);
  when(issueQueryResult.issues()).thenReturn(newArrayList((Issue)issue));
  when(issueQueryResult.first()).thenReturn(issue);
  when(resource.getKey()).thenReturn("org.sonar.Sample");
  when(project.getKey()).thenReturn("Sample");
  issueService=new IssueService(finder,workflow,issueStorage,issueUpdater,issueNotifications,actionPlanService,ruleFinder,resourceDao,issueDao,authorizationDao,userFinder,mock(PreviewCache.class));
}
