{
  when(lastSnapshots.getSource(project)).thenReturn(load("example1-v1"));
  String source=load("example1-v2");
  RuleFailureModel referenceViolation1=newReferenceViolation("Indentation",7,50);
  RuleFailureModel referenceViolation2=newReferenceViolation("Indentation",11,50);
  Violation newViolation1=newViolation("Indentation",9,50);
  Violation newViolation2=newViolation("Indentation",13,50);
  Violation newViolation3=newViolation("Indentation",17,50);
  Violation newViolation4=newViolation("Indentation",21,50);
  Map<Violation,RuleFailureModel> mapping=decorator.mapViolations(Arrays.asList(newViolation1,newViolation2,newViolation3,newViolation4),Arrays.asList(referenceViolation1,referenceViolation2),source,project);
  assertThat(newViolation1.isNew(),is(true));
  assertThat(newViolation2.isNew(),is(true));
  assertThat(newViolation3.isNew(),is(false));
  assertThat(mapping.get(newViolation3),equalTo(referenceViolation1));
  assertThat(newViolation4.isNew(),is(false));
  assertThat(mapping.get(newViolation4),equalTo(referenceViolation2));
}
