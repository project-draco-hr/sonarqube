{
  SearchHits hits=searchIndex.executeRequest(searchIndex.client().prepareSearch(INDEX_RULES).setTypes(TYPE_RULE).setPostFilter(FilterBuilders.boolFilter().must(FilterBuilders.termFilter(RuleDocument.FIELD_NAME,query.query())).mustNot(FilterBuilders.termFilter(RuleDocument.FIELD_STATUS,STATUS_REMOVED))).addSort(RuleDocument.FIELD_NAME,SortOrder.ASC).setSize(query.paging().pageSize()).setFrom(query.paging().offset()));
  Builder<Rule> rulesBuilder=ImmutableList.builder();
  for (  SearchHit hit : hits.hits()) {
    rulesBuilder.add(RuleDocumentParser.parse(hit.sourceAsMap()));
  }
  return new PagedResult<Rule>(rulesBuilder.build(),PagingResult.create(query.paging().pageSize(),query.paging().pageIndex(),hits.getTotalHits()));
}
