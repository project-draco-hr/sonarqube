{
  String[] ids=new String[rules.size()];
  BytesStream[] docs=new BytesStream[rules.size()];
  String[] parentIds=new String[rules.size()];
  int index=0;
  TimeProfiler profiler=new TimeProfiler();
  profiler.start("Build active rules documents");
  for (  ActiveRule rule : rules) {
    ids[index]=rule.getId().toString();
    docs[index]=activeRuleDocument(rule);
    parentIds[index]=rule.getRule().getId().toString();
    index++;
  }
  profiler.stop();
  profiler.start("Index active rules");
  searchIndex.bulkIndex(INDEX_RULES,TYPE_ACTIVE_RULE,ids,docs,parentIds);
  profiler.stop();
  List<String> indexIds=searchIndex.findDocumentIds(SearchQuery.create().index(INDEX_RULES).type(TYPE_ACTIVE_RULE));
  indexIds.removeAll(Arrays.asList(ids));
  if (!indexIds.isEmpty()) {
    profiler.start("Remove deleted active rule documents");
    searchIndex.bulkDelete(INDEX_RULES,TYPE_ACTIVE_RULE,indexIds.toArray(new String[0]));
    profiler.stop();
  }
}
