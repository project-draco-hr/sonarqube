{
  TimeProfiler profiler=new TimeProfiler();
  profiler.start("Rebuilding rules index - query");
  List<RuleDto> rules=ruleDao.selectNonManual();
  List<RuleParamDto> flatParams=ruleDao.selectParameters();
  profiler.stop();
  Multimap<Integer,RuleParamDto> paramsByRule=ArrayListMultimap.create();
  for (  RuleParamDto param : flatParams) {
    paramsByRule.put(param.getRuleId(),param);
  }
  try {
    bulkIndex(rules,paramsByRule);
  }
 catch (  IOException ioe) {
    throw new IllegalStateException("Unable to index rules",ioe);
  }
}
