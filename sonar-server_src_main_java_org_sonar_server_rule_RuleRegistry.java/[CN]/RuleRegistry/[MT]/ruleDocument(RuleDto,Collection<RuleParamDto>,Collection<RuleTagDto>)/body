{
  XContentBuilder document=XContentFactory.jsonBuilder().startObject().field(RuleDocument.FIELD_ID,rule.getId()).field(RuleDocument.FIELD_KEY,rule.getRuleKey()).field(RuleDocument.FIELD_LANGUAGE,rule.getLanguage()).field(RuleDocument.FIELD_NAME,rule.getName()).field(RuleDocument.FIELD_DESCRIPTION,rule.getDescription()).field(RuleDocument.FIELD_PARENT_KEY,rule.getParentId() == null ? null : rule.getParentId()).field(RuleDocument.FIELD_REPOSITORY_KEY,rule.getRepositoryKey()).field(RuleDocument.FIELD_SEVERITY,getSeverityFromOrdinal(rule.getSeverity())).field(RuleDocument.FIELD_STATUS,rule.getStatus()).field(RuleDocument.FIELD_CARDINALITY,rule.getCardinality()).field(RuleDocument.FIELD_CREATED_AT,rule.getCreatedAt()).field(RuleDocument.FIELD_UPDATED_AT,rule.getUpdatedAt());
  if (rule.getNoteData() != null || rule.getNoteUserLogin() != null) {
    document.startObject(RuleDocument.FIELD_NOTE).field(RuleDocument.FIELD_NOTE_DATA,rule.getNoteData()).field(RuleDocument.FIELD_NOTE_USER_LOGIN,rule.getNoteUserLogin()).field(RuleDocument.FIELD_NOTE_CREATED_AT,rule.getNoteCreatedAt()).field(RuleDocument.FIELD_NOTE_UPDATED_AT,rule.getNoteUpdatedAt()).endObject();
  }
  if (!params.isEmpty()) {
    document.startArray(RuleDocument.FIELD_PARAMS);
    for (    RuleParamDto param : params) {
      document.startObject().field(RuleDocument.FIELD_PARAM_KEY,param.getName()).field(RuleDocument.FIELD_PARAM_TYPE,param.getType()).field(RuleDocument.FIELD_PARAM_DEFAULT_VALUE,param.getDefaultValue()).field(RuleDocument.FIELD_PARAM_DESCRIPTION,param.getDescription()).endObject();
    }
    document.endArray();
  }
  List<String> systemTags=Lists.newArrayList();
  List<String> adminTags=Lists.newArrayList();
  for (  RuleTagDto tag : tags) {
    if (tag.getType() == RuleTagType.SYSTEM) {
      systemTags.add(tag.getTag());
    }
 else {
      adminTags.add(tag.getTag());
    }
  }
  if (!systemTags.isEmpty()) {
    document.array(RuleDocument.FIELD_SYSTEM_TAGS,systemTags.toArray());
  }
  if (!adminTags.isEmpty()) {
    document.array(RuleDocument.FIELD_ADMIN_TAGS,adminTags.toArray());
  }
  document.endObject();
  return document;
}
