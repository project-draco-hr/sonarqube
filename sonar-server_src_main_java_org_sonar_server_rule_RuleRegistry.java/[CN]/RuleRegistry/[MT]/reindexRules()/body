{
  SqlSession sqlSession=myBatis.openSession();
  try {
    Multimap<Integer,RuleParamDto> paramsByRuleId=ArrayListMultimap.create();
    Multimap<Integer,RuleRuleTagDto> tagsByRuleId=ArrayListMultimap.create();
    Map<Integer,CharacteristicDto> characteristicsById=newHashMap();
    for (    RuleParamDto paramDto : ruleDao.selectParameters(sqlSession)) {
      paramsByRuleId.put(paramDto.getRuleId(),paramDto);
    }
    for (    RuleRuleTagDto tagDto : ruleDao.selectTags(sqlSession)) {
      tagsByRuleId.put(tagDto.getRuleId(),tagDto);
    }
    for (    CharacteristicDto characteristicDto : characteristicDao.selectEnabledCharacteristics(sqlSession)) {
      characteristicsById.put(characteristicDto.getId(),characteristicDto);
    }
    bulkIndexRules(ruleDao.selectEnablesAndNonManual(sqlSession),characteristicsById,paramsByRuleId,tagsByRuleId);
  }
  finally {
    sqlSession.close();
  }
}
