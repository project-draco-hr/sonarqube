{
  context=mock(DecoratorContext.class);
  Resource f=File.create("src/Foo.java").setEffectiveKey("foo:src/Foo.java");
  when(context.getResource()).thenReturn(f);
  BatchComponentCache cache=new BatchComponentCache();
  cache.add(f,null);
  List<AbstractNewCoverageFileAnalyzer.PeriodStruct> structs=Arrays.asList(new AbstractNewCoverageFileAnalyzer.PeriodStruct(1,newDate("2009-12-25")),new AbstractNewCoverageFileAnalyzer.PeriodStruct(3,newDate("2011-02-18")));
  ReportPublisher publishReportJob=mock(ReportPublisher.class);
  java.io.File reportBaseDir=temp.newFolder();
  when(publishReportJob.getReportDir()).thenReturn(reportBaseDir);
  writer=new BatchReportWriter(reportBaseDir);
  decorator=new NewCoverageFileAnalyzer(structs,publishReportJob,cache);
}
