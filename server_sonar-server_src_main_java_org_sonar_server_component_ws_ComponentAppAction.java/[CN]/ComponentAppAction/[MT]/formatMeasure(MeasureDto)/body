{
  if (measure == null) {
    return null;
  }
  Metric metric=CoreMetrics.getMetric(measure.getMetricKey());
  Metric.ValueType metricType=metric.getType();
  Double value=measure.getValue();
  String data=measure.getData();
  if (BooleanUtils.isTrue(metric.isOptimizedBestValue()) && value == null) {
    value=metric.getBestValue();
  }
  if (metricType.equals(Metric.ValueType.FLOAT) && value != null) {
    return i18n.formatDouble(userSession.locale(),value);
  }
  if (metricType.equals(Metric.ValueType.INT) && value != null) {
    return i18n.formatInteger(userSession.locale(),value.intValue());
  }
  if (metricType.equals(Metric.ValueType.PERCENT) && value != null) {
    return i18n.formatDouble(userSession.locale(),value) + "%";
  }
  if (metricType.equals(Metric.ValueType.WORK_DUR) && value != null) {
    return durations.format(userSession.locale(),durations.create(value.longValue()),Durations.DurationFormat.SHORT);
  }
  if ((metricType.equals(Metric.ValueType.STRING) || metricType.equals(Metric.ValueType.RATING)) && data != null) {
    return data;
  }
  return null;
}
