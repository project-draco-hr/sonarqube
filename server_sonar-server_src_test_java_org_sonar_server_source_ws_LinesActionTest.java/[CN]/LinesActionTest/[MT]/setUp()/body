{
  dbTester.truncateTables();
  esTester.truncateIndices();
  htmlSourceDecorator=new HtmlSourceDecorator();
  sourceLineIndex=new SourceLineIndex(esTester.client());
  componentDao=new ComponentDao(mock(System2.class));
  DbClient dbClient=new DbClient(dbTester.database(),dbTester.myBatis(),componentDao);
  session=dbClient.openSession(false);
  wsTester=new WsTester(new SourcesWs(new LinesAction(dbClient,sourceLineIndex,htmlSourceDecorator,userSessionRule)));
}
