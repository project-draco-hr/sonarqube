{
  ActiveRule oldActiveRule=profile.getActiveRule(parentActiveRule.getRule());
  RuleInheritanceActions actions=new RuleInheritanceActions();
  if (oldActiveRule != null) {
    if (oldActiveRule.isInherited()) {
      removeActiveRule(oldActiveRule);
      actions.addToDelete(oldActiveRule.getId());
    }
 else {
      oldActiveRule.setInheritance(ActiveRule.OVERRIDES);
      getSession().saveWithoutFlush(oldActiveRule);
      actions.addToIndex(oldActiveRule.getId());
      return actions;
    }
  }
  ActiveRule newActiveRule=(ActiveRule)parentActiveRule.clone();
  newActiveRule.setRulesProfile(profile);
  newActiveRule.setInheritance(ActiveRule.INHERITED);
  profile.addActiveRule(newActiveRule);
  getSession().saveWithoutFlush(newActiveRule);
  actions.addToIndex(newActiveRule.getId());
  if (oldActiveRule != null) {
    ruleChanged(profile,oldActiveRule,newActiveRule,userName);
  }
 else {
    ruleEnabled(profile,newActiveRule,userName);
  }
  for (  RulesProfile child : getChildren(profile)) {
    actions.add(activateOrChange(child,newActiveRule,userName));
  }
  return actions;
}
