{
  try {
    Logs.INFO.info("Creating JDBC datasource");
    Properties properties=new Properties();
    List<String> jdbcKeys=configuration.getKeysStartingWith("sonar.jdbc.");
    for (    String jdbcKey : jdbcKeys) {
      properties.setProperty(StringUtils.removeStart(jdbcKey,"sonar.jdbc."),configuration.getString(jdbcKey));
    }
    properties.setProperty("accessToUnderlyingConnectionAllowed","true");
    datasource=BasicDataSourceFactory.createDataSource(properties);
    CustomHibernateConnectionProvider.datasource=datasource;
  }
 catch (  Exception e) {
    throw new SonarException("Fail to connect to database",e);
  }
}
